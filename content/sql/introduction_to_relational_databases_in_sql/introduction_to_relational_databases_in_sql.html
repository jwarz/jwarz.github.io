<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joschka Schwarz">

<title>Joschka Schwarz - Introduction to Relational Databases in SQL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../content/sql/introduction_to_sql/introduction_to_sql.html" rel="next">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Joschka Schwarz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-science" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Science</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-science">    
        <li>
    <a class="dropdown-item" href="../../../content/R/index.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../content/python/index.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../content/sql/index.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../slides/index.html">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../resumes/index.html">
 <span class="menu-text">Resumes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jwarz/"><i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/j-schwarz"><i class="bi bi-linkedin" role="img" aria-label="Quarto LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Introduction to Relational Databases in SQL</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/sql/index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">SQL</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/sql/introduction_to_relational_databases_in_sql/introduction_to_relational_databases_in_sql.html" class="sidebar-item-text sidebar-link active">Introduction to Relational Databases in SQL</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/sql/introduction_to_sql/introduction_to_sql.html" class="sidebar-item-text sidebar-link">Introduction to SQL</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/sql/joining_data_in_sql/joining_data_in_sql.html" class="sidebar-item-text sidebar-link">Joining Data in SQL</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#your-first-database" id="toc-your-first-database" class="nav-link active" data-scroll-target="#your-first-database">1. Your first database</a>
  <ul class="collapse">
  <li><a href="#introduction-to-relational-databases" id="toc-introduction-to-relational-databases" class="nav-link" data-scroll-target="#introduction-to-relational-databases">Introduction to relational databases</a></li>
  <li><a href="#attributes-of-relational-databases" id="toc-attributes-of-relational-databases" class="nav-link" data-scroll-target="#attributes-of-relational-databases">Attributes of relational databases</a></li>
  <li><a href="#query-information_schema-with-select" id="toc-query-information_schema-with-select" class="nav-link" data-scroll-target="#query-information_schema-with-select">Query information_schema with SELECT</a></li>
  <li><a href="#tables-at-the-core-of-every-database" id="toc-tables-at-the-core-of-every-database" class="nav-link" data-scroll-target="#tables-at-the-core-of-every-database">Tables: At the core of every database</a></li>
  <li><a href="#create-your-first-few-tables" id="toc-create-your-first-few-tables" class="nav-link" data-scroll-target="#create-your-first-few-tables">CREATE your first few TABLEs</a></li>
  <li><a href="#add-a-column-with-alter-table" id="toc-add-a-column-with-alter-table" class="nav-link" data-scroll-target="#add-a-column-with-alter-table">ADD a COLUMN with ALTER TABLE</a></li>
  <li><a href="#update-your-database-as-the-structure-changes" id="toc-update-your-database-as-the-structure-changes" class="nav-link" data-scroll-target="#update-your-database-as-the-structure-changes">Update your database as the structure changes</a></li>
  <li><a href="#rename-and-drop-columns-in-affiliations" id="toc-rename-and-drop-columns-in-affiliations" class="nav-link" data-scroll-target="#rename-and-drop-columns-in-affiliations">RENAME and DROP COLUMNs in affiliations</a></li>
  <li><a href="#migrate-data-with-insert-into-select-distinct" id="toc-migrate-data-with-insert-into-select-distinct" class="nav-link" data-scroll-target="#migrate-data-with-insert-into-select-distinct">Migrate data with INSERT INTO SELECT DISTINCT</a></li>
  <li><a href="#delete-tables-with-drop-table" id="toc-delete-tables-with-drop-table" class="nav-link" data-scroll-target="#delete-tables-with-drop-table">Delete tables with DROP TABLE</a></li>
  </ul></li>
  <li><a href="#enforce-data-consistency-with-attribute-constraints" id="toc-enforce-data-consistency-with-attribute-constraints" class="nav-link" data-scroll-target="#enforce-data-consistency-with-attribute-constraints">2. Enforce data consistency with attribute constraints</a>
  <ul class="collapse">
  <li><a href="#better-data-quality-with-constraints" id="toc-better-data-quality-with-constraints" class="nav-link" data-scroll-target="#better-data-quality-with-constraints">Better data quality with constraints</a></li>
  <li><a href="#types-of-database-constraints" id="toc-types-of-database-constraints" class="nav-link" data-scroll-target="#types-of-database-constraints">Types of database constraints</a></li>
  <li><a href="#conforming-with-data-types" id="toc-conforming-with-data-types" class="nav-link" data-scroll-target="#conforming-with-data-types">Conforming with data types</a></li>
  <li><a href="#type-casts" id="toc-type-casts" class="nav-link" data-scroll-target="#type-casts">Type CASTs</a></li>
  <li><a href="#working-with-data-types" id="toc-working-with-data-types" class="nav-link" data-scroll-target="#working-with-data-types">Working with data types</a></li>
  <li><a href="#change-types-with-alter-column" id="toc-change-types-with-alter-column" class="nav-link" data-scroll-target="#change-types-with-alter-column">Change types with ALTER COLUMN</a></li>
  <li><a href="#convert-types-using-a-function" id="toc-convert-types-using-a-function" class="nav-link" data-scroll-target="#convert-types-using-a-function">Convert types USING a function</a></li>
  <li><a href="#the-not-null-and-unique-constraints" id="toc-the-not-null-and-unique-constraints" class="nav-link" data-scroll-target="#the-not-null-and-unique-constraints">The not-null and unique constraints</a></li>
  <li><a href="#disallow-null-values-with-set-not-null" id="toc-disallow-null-values-with-set-not-null" class="nav-link" data-scroll-target="#disallow-null-values-with-set-not-null">Disallow NULL values with SET NOT NULL</a></li>
  <li><a href="#what-happens-if-you-try-to-enter-nulls" id="toc-what-happens-if-you-try-to-enter-nulls" class="nav-link" data-scroll-target="#what-happens-if-you-try-to-enter-nulls">What happens if you try to enter NULLs?</a></li>
  <li><a href="#make-your-columns-unique-with-add-constraint" id="toc-make-your-columns-unique-with-add-constraint" class="nav-link" data-scroll-target="#make-your-columns-unique-with-add-constraint">Make your columns UNIQUE with ADD CONSTRAINT</a></li>
  </ul></li>
  <li><a href="#uniquely-identify-records-with-key-constraints" id="toc-uniquely-identify-records-with-key-constraints" class="nav-link" data-scroll-target="#uniquely-identify-records-with-key-constraints">3. Uniquely identify records with key constraints</a>
  <ul class="collapse">
  <li><a href="#keys-and-superkeys" id="toc-keys-and-superkeys" class="nav-link" data-scroll-target="#keys-and-superkeys">Keys and superkeys</a></li>
  <li><a href="#get-to-know-select-count-distinct" id="toc-get-to-know-select-count-distinct" class="nav-link" data-scroll-target="#get-to-know-select-count-distinct">Get to know SELECT COUNT DISTINCT</a></li>
  <li><a href="#identify-keys-with-select-count-distinct" id="toc-identify-keys-with-select-count-distinct" class="nav-link" data-scroll-target="#identify-keys-with-select-count-distinct">Identify keys with SELECT COUNT DISTINCT</a></li>
  <li><a href="#primary-keys" id="toc-primary-keys" class="nav-link" data-scroll-target="#primary-keys">Primary keys</a></li>
  <li><a href="#identify-the-primary-key" id="toc-identify-the-primary-key" class="nav-link" data-scroll-target="#identify-the-primary-key">Identify the primary key</a></li>
  <li><a href="#add-key-constraints-to-the-tables" id="toc-add-key-constraints-to-the-tables" class="nav-link" data-scroll-target="#add-key-constraints-to-the-tables">ADD key CONSTRAINTs to the tables</a></li>
  <li><a href="#surrogate-keys" id="toc-surrogate-keys" class="nav-link" data-scroll-target="#surrogate-keys">Surrogate keys</a></li>
  <li><a href="#add-a-serial-surrogate-key" id="toc-add-a-serial-surrogate-key" class="nav-link" data-scroll-target="#add-a-serial-surrogate-key">Add a SERIAL surrogate key</a></li>
  <li><a href="#concatenate-columns-to-a-surrogate-key" id="toc-concatenate-columns-to-a-surrogate-key" class="nav-link" data-scroll-target="#concatenate-columns-to-a-surrogate-key">CONCATenate columns to a surrogate key</a></li>
  <li><a href="#test-your-knowledge-before-advancing" id="toc-test-your-knowledge-before-advancing" class="nav-link" data-scroll-target="#test-your-knowledge-before-advancing">Test your knowledge before advancing</a></li>
  </ul></li>
  <li><a href="#glue-together-tables-with-foreign-keys" id="toc-glue-together-tables-with-foreign-keys" class="nav-link" data-scroll-target="#glue-together-tables-with-foreign-keys">4. Glue together tables with foreign keys</a>
  <ul class="collapse">
  <li><a href="#model-1n-relationships-with-foreign-keys" id="toc-model-1n-relationships-with-foreign-keys" class="nav-link" data-scroll-target="#model-1n-relationships-with-foreign-keys">Model 1:N relationships with foreign keys</a></li>
  <li><a href="#reference-a-table-with-a-foreign-key" id="toc-reference-a-table-with-a-foreign-key" class="nav-link" data-scroll-target="#reference-a-table-with-a-foreign-key">REFERENCE a table with a FOREIGN KEY</a></li>
  <li><a href="#explore-foreign-key-constraints" id="toc-explore-foreign-key-constraints" class="nav-link" data-scroll-target="#explore-foreign-key-constraints">Explore foreign key constraints</a></li>
  <li><a href="#join-tables-linked-by-a-foreign-key" id="toc-join-tables-linked-by-a-foreign-key" class="nav-link" data-scroll-target="#join-tables-linked-by-a-foreign-key">JOIN tables linked by a foreign key</a></li>
  <li><a href="#model-more-complex-relationships" id="toc-model-more-complex-relationships" class="nav-link" data-scroll-target="#model-more-complex-relationships">Model more complex relationships</a></li>
  <li><a href="#add-foreign-keys-to-the-affiliations-table" id="toc-add-foreign-keys-to-the-affiliations-table" class="nav-link" data-scroll-target="#add-foreign-keys-to-the-affiliations-table">Add foreign keys to the “affiliations” table</a></li>
  <li><a href="#populate-the-professor_id-column" id="toc-populate-the-professor_id-column" class="nav-link" data-scroll-target="#populate-the-professor_id-column">Populate the “professor_id” column</a></li>
  <li><a href="#drop-firstname-and-lastname" id="toc-drop-firstname-and-lastname" class="nav-link" data-scroll-target="#drop-firstname-and-lastname">Drop “firstname” and “lastname”</a></li>
  <li><a href="#referential-integrity" id="toc-referential-integrity" class="nav-link" data-scroll-target="#referential-integrity">Referential integrity</a></li>
  <li><a href="#referential-integrity-violations" id="toc-referential-integrity-violations" class="nav-link" data-scroll-target="#referential-integrity-violations">Referential integrity violations</a></li>
  <li><a href="#change-the-referential-integrity-behavior-of-a-key" id="toc-change-the-referential-integrity-behavior-of-a-key" class="nav-link" data-scroll-target="#change-the-referential-integrity-behavior-of-a-key">Change the referential integrity behavior of a key</a></li>
  <li><a href="#roundup" id="toc-roundup" class="nav-link" data-scroll-target="#roundup">Roundup</a></li>
  <li><a href="#count-affiliations-per-university" id="toc-count-affiliations-per-university" class="nav-link" data-scroll-target="#count-affiliations-per-university">Count affiliations per university</a></li>
  <li><a href="#join-all-the-tables-together" id="toc-join-all-the-tables-together" class="nav-link" data-scroll-target="#join-all-the-tables-together">Join all the tables together</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jwarz/jwarz.github.io/edit/main/content/sql/introduction_to_relational_databases_in_sql/introduction_to_relational_databases_in_sql.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jwarz/jwarz.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Introduction to Relational Databases in SQL</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joschka Schwarz </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> university_professors (</span>
<span id="cb1-2"><a href="#cb1-2"></a>  firstname text, </span>
<span id="cb1-3"><a href="#cb1-3"></a>  lastname text, </span>
<span id="cb1-4"><a href="#cb1-4"></a>  university text, </span>
<span id="cb1-5"><a href="#cb1-5"></a>  university_shortname text, </span>
<span id="cb1-6"><a href="#cb1-6"></a>  university_city text, </span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="kw">function</span> text, </span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="kw">organization</span> text, </span>
<span id="cb1-9"><a href="#cb1-9"></a>  organization_sector text </span>
<span id="cb1-10"><a href="#cb1-10"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Short Description</strong></p>
<p>Learn how to create tables and specify their relationships in SQL, as well as how to enforce data integrity and other unique features of database systems.</p>
<p><strong>Long Description</strong></p>
<p>You’ve already used SQL to query data from databases. But did you know that there’s a lot more you can do with databases? You can model different phenomena in your data, as well as the relationships between them. This gives your data structure and consistency, which results in better data quality. In this course, you’ll experience this firsthand by working with a real-life dataset that was used to investigate questionable university affiliations. Column by column, table by table, you’ll get to unlock and admire the full potential of databases. You’ll learn how to create tables and specify their relationships, as well as how to enforce data integrity. You’ll also discover other unique features of database systems, such as constraints.</p>
<section id="your-first-database" class="level1">
<h1>1. Your first database</h1>
<p>In this chapter, you’ll create your very first database with a set of simple SQL commands. Next, you’ll migrate data from existing flat tables into that database. You’ll also learn how meta-information about a database can be queried.</p>
<section id="introduction-to-relational-databases" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-relational-databases">Introduction to relational databases</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Your first database</strong></p>
<p>Welcome to this course on Introduction to Relational Databases. My name is Timo Grossenbacher, and I work as a data journalist in Switzerland. In this course, you will see why using relational databases has many advantages over using flat files like CSVs or Excel sheets. You’ll learn how to create such databases, and bring into force their most prominent features.</p>
<p><strong>2. Investigating universities in Switzerland</strong></p>
<p>Let me tell you a little story first. As a data journalist, I try to uncover corruption, misconduct and other newsworthy stuff with data. A couple of years ago I researched secondary employment of Swiss university professors. It turns out a lot of them have more than one side job besides their university duty, being paid by big companies like banks and insurances. So I discovered more than 1500 external employments and visualized them in an interactive graphic, shown on the left. For this story, I had to compile data from various sources with varying quality. Also, I had to account for certain specialties, for example, that a professor can work for different universities; or that a third-party company can have multiple professors working for them. In order to analyze the data, I needed to make sure its quality was good and stayed good throughout the process. That’s why I stored my data in a database, whose quite complex design you can see in the right graphic. All these rectangles were turned into database tables.</p>
<p><strong>3. A relational database:</strong></p>
<p>But why did I use a database? A database models real-life entities like professors and universities by storing them in tables. Each table only contains data from a single entity type. This reduces redundancy by storing entities only once – for example, there only needs to be one row of data containing the details of a certain company. Lastly, a database can be used to model relationships between entities. You can define exactly how entities relate to each other. For instance, a professor can work at multiple universities and companies, while a company can employ more than one professor.</p>
<p><strong>4. Throughout this course you will:</strong></p>
<p>Throughout this course, you will actually work with the same real-life data used during my investigation. You’ll start from a single table of data and build a full-blown relational database from it, column by column, table by table. By doing so, you’ll get to know constraints, keys, and referential integrity. These three concepts help preserve data quality in databases. By the end of the course, you’ll know how to use them. In order to get going, you’ll just need a basic understanding of SQL – which can also be used to build and maintain databases, not just for querying data.</p>
<p><strong>5. Your first duty: Have a look at the PostgreSQL database</strong></p>
<p>I’ve already created a single PostgreSQL database table containing all the raw data for this course. In the next few exercises, I want you to have a look at that table. For that, you’ll need to retrieve your SQL knowledge and query the “information_schema” database, which is available in PostgreSQL by default. “information_schema” is actually some sort of meta-database that holds information about your current database. It’s not PostgreSQL specific and also available in other database management systems like MySQL or SQL Server. This “information_schema” database holds various information in different tables, for example in the “tables” table.</p>
<p><strong>6. Have a look at the columns of a certain table</strong></p>
<p>“information_schema” also holds information about columns in the “columns” table. Once you know the name of a table, you can query its columns by accessing the “columns” table. Here, for example, you see that the system table “pg_config” has only two columns – supposedly for storing name-value pairs.</p>
<p><strong>7. Let’s do this.</strong></p>
<p>Okay, let’s have a look at your first database.</p>
</section>
<section id="attributes-of-relational-databases" class="level2">
<h2 class="anchored" data-anchor-id="attributes-of-relational-databases">Attributes of relational databases</h2>
<blockquote class="blockquote">
<h2 id="question" class="anchored"><em>Question</em></h2>
<p>Which of the following statements does <em>not</em> hold true for databases? Relational databases …<br> <br> ⬜ … store different real-world entities in different tables.<br> ⬜ … allow to establish relationships between entities.<br> ✅ … are called “relational” because they store data only about people.<br> ⬜ … use constraints, keys and referential integrity in order to assure data quality.<br></p>
</blockquote>
<p>Correct! Of course, databases can also store information about any other kind of entities, e.g.&nbsp;spare car parts.</p>
</section>
<section id="query-information_schema-with-select" class="level2">
<h2 class="anchored" data-anchor-id="query-information_schema-with-select">Query information_schema with SELECT</h2>
<p><code>information_schema</code> is a meta-database that holds information about your current database. <code>information_schema</code> has multiple tables you can query with the known <code>SELECT * FROM</code> syntax:</p>
<ul>
<li><code>tables</code>: information about all <em>tables</em> in your current database</li>
<li><code>columns</code>: information about all <em>columns</em> in all of the tables in your current database</li>
<li>…</li>
</ul>
<p>In this exercise, you’ll only need information from the <code>'public'</code> schema, which is specified as the column <code>table_schema</code> of the <code>tables</code> and <code>columns</code> tables. The <code>'public'</code> schema holds information about user-defined tables and databases. The other types of <code>table_schema</code> hold system information – for this course, you’re only interested in user-defined stuff.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Get information on all table names in the current database, while limiting your query to the <code>'public'</code> <code>table_schema</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">-- Query the right table in information_schema</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">SELECT</span> table_name </span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">FROM</span> information_schema.<span class="kw">tables</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">-- Specify the correct table_schema value</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">WHERE</span> table_schema <span class="op">=</span> <span class="st">'public'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">table_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">university_professors</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Now have a look at the columns in <code>university_professors</code> by selecting all entries in <code>information_schema.columns</code> that correspond to that table.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">-- Query the right table in information_schema to get columns</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">SELECT</span> column_name, data_type </span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">FROM</span> information_schema.<span class="kw">columns</span> </span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">WHERE</span> table_name <span class="op">=</span> <span class="st">'university_professors'</span> <span class="kw">AND</span> table_schema <span class="op">=</span> <span class="st">'public'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>8 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">column_name</th>
<th style="text-align: left;">data_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">firstname</td>
<td style="text-align: left;">text</td>
</tr>
<tr class="even">
<td style="text-align: left;">lastname</td>
<td style="text-align: left;">text</td>
</tr>
<tr class="odd">
<td style="text-align: left;">university</td>
<td style="text-align: left;">text</td>
</tr>
<tr class="even">
<td style="text-align: left;">university_shortname</td>
<td style="text-align: left;">text</td>
</tr>
<tr class="odd">
<td style="text-align: left;">university_city</td>
<td style="text-align: left;">text</td>
</tr>
<tr class="even">
<td style="text-align: left;">function</td>
<td style="text-align: left;">text</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organization</td>
<td style="text-align: left;">text</td>
</tr>
<tr class="even">
<td style="text-align: left;">organization_sector</td>
<td style="text-align: left;">text</td>
</tr>
</tbody>
</table>
</div>
</div>
<blockquote class="blockquote">
<h2 id="question-1" class="anchored"><em>Question</em></h2>
<p>How many columns does the table <code>university_professors</code> have?<br> <br> ⬜ 12<br> ⬜ 9<br> ✅ 8<br> ⬜ 5<br></p>
</blockquote>
<ol start="3" type="1">
<li>Finally, print the first five rows of the <code>university_professors</code> table.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">-- Query the first five rows of our table</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">FROM</span> university_professors </span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>5 records</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 26%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">university</th>
<th style="text-align: left;">university_shortname</th>
<th style="text-align: left;">university_city</th>
<th style="text-align: left;">function</th>
<th style="text-align: left;">organization</th>
<th style="text-align: left;">organization_sector</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Karl</td>
<td style="text-align: left;">Aberer</td>
<td style="text-align: left;">ETH Lausanne</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: left;">Lausanne</td>
<td style="text-align: left;">Chairman of L3S Advisory Board</td>
<td style="text-align: left;">L3S Advisory Board</td>
<td style="text-align: left;">Education &amp; research</td>
</tr>
<tr class="even">
<td style="text-align: left;">Karl</td>
<td style="text-align: left;">Aberer</td>
<td style="text-align: left;">ETH Lausanne</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: left;">Lausanne</td>
<td style="text-align: left;">Member Conseil of Zeno-Karl Schindler Foundation</td>
<td style="text-align: left;">Zeno-Karl Schindler Foundation</td>
<td style="text-align: left;">Education &amp; research</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Karl</td>
<td style="text-align: left;">Aberer</td>
<td style="text-align: left;">ETH Lausanne</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: left;">Lausanne</td>
<td style="text-align: left;">Member of Conseil Fondation IDIAP</td>
<td style="text-align: left;">Fondation IDIAP</td>
<td style="text-align: left;">Education &amp; research</td>
</tr>
<tr class="even">
<td style="text-align: left;">Karl</td>
<td style="text-align: left;">Aberer</td>
<td style="text-align: left;">ETH Lausanne</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: left;">Lausanne</td>
<td style="text-align: left;">Panel Member</td>
<td style="text-align: left;">SNF Ambizione Program</td>
<td style="text-align: left;">Education &amp; research</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reza Shokrollah</td>
<td style="text-align: left;">Abhari</td>
<td style="text-align: left;">ETH Zürich</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
<td style="text-align: left;">Aufsichtsratsmandat</td>
<td style="text-align: left;">PNE Wind AG</td>
<td style="text-align: left;">Energy, environment &amp; mobility</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Great work! You’re now familiar with the pre-existing <code>university_professors</code> table, which holds information on all kinds of entities. You’ll migrate data from this table to other tables in the upcoming lessons.</p>
</section>
<section id="tables-at-the-core-of-every-database" class="level2">
<h2 class="anchored" data-anchor-id="tables-at-the-core-of-every-database">Tables: At the core of every database</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Tables: At the core of every database</strong></p>
<p>Now that you’ve had a first look at your database, let’s delve into one of the most important concepts behind databases: tables.</p>
<p><strong>2. Redundancy in the university_professors table</strong></p>
<p>You might have noticed that there’s some redundancy in the “university_professors” table. Let’s have a look at the first three records, for example.</p>
<p><strong>3. Redundancy in the university_professors table</strong></p>
<p>As you can see, this professor is repeated in the first three records. Also, his university, the “ETH Lausanne”, is repeated a couple of times – because he only works for this university. However, he seems to have affiliations with at least three different organizations. So, there’s a certain redundancy in that table. The reason for this is that the table actually contains entities of at least three different types. Let’s have a look at these entity types.</p>
<p><strong>4. Redundancy in the university_professors table</strong></p>
<p>Actually the table stores professors, highlighted in blue, universities, highlighted in green, and organizations, highlighted in brown. There’s also this column called “function” which denotes the role the professor plays at a certain organization. More on that later.</p>
<p><strong>5. Currently: One “entity type” in the database</strong></p>
<p>Let’s look at the current database once again. The graphic used here is called an entity-relationship diagram. Squares denote so-called entity types, while circles connected to these denote attributes (or columns). So far, we have only modeled one so-called entity type – “university_professors”. However, we discovered that this table actually holds many different entity types…</p>
<p><strong>6. A better database model with three entity types</strong></p>
<p>…so this updated entity-relationship model on the right side would be better suited. It represents three entity types, “professors”, “universities”, and “organizations” in their own tables, with respective attributes. This reduces redundancy, as professors, unlike now, need to be stored only once. Note that, for each professor, the respective university is also denoted through the “university_shortname” attribute. However, one original attribute, the “function”, is still missing.</p>
<p><strong>7. A better database model with four entity types</strong></p>
<p>As you know, this database contains affiliations of professors with third-party organizations. The attribute “function” gives some extra information to that affiliation. For instance, somebody might act as chairman for a certain third-party organization. So the best idea at the moment is to store these affiliations in their own table – it connects professors with their respective organizations, where they have a certain function.</p>
<p><strong>8. Create new tables with CREATE TABLE</strong></p>
<p>The first thing you need to do now is to create four empty tables for professors, universities, organizations, and affiliations. This is quite easy with SQL – you’ll use the “CREATE TABLE” command for that. At the minimum, this command requires a table name and one or more columns with their respective data types.</p>
<p><strong>9. Create new tables with CREATE TABLE</strong></p>
<p>For example, you could create a “weather” table with three aptly named columns. After each column name, you must specify the data type. There are many different types, and you will discover some in the remainder of this course. For example, you could specify a text column, a numeric column, and a column that requires fixed-length character strings with 5 characters each. These data types will be explained in more detail in the next chapter.</p>
<p><strong>10. Let’s practice!</strong></p>
<p>For now, you will first create the four tables and then migrate data from the original table to them. Let’s do this.</p>
</section>
<section id="create-your-first-few-tables" class="level2">
<h2 class="anchored" data-anchor-id="create-your-first-few-tables">CREATE your first few TABLEs</h2>
<p>You’ll now start implementing a better database model. For this, you’ll create tables for the <code>professors</code> and <code>universities</code> entity types. The other tables will be created for you.</p>
<p>The syntax for creating simple tables is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> table_name (</span>
<span id="cb5-2"><a href="#cb5-2"></a> column_a data_type,</span>
<span id="cb5-3"><a href="#cb5-3"></a> column_b data_type,</span>
<span id="cb5-4"><a href="#cb5-4"></a> column_c data_type</span>
<span id="cb5-5"><a href="#cb5-5"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Attention</em>: Table and columns names, as well as data types, don’t need to be surrounded by quotation marks.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a table <code>professors</code> with two <code>text</code> columns: <code>firstname</code> and <code>lastname</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">-- Create a table for the professors entity type</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> professors (</span>
<span id="cb6-3"><a href="#cb6-3"></a> firstname text,</span>
<span id="cb6-4"><a href="#cb6-4"></a> lastname text</span>
<span id="cb6-5"><a href="#cb6-5"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">-- Print the contents of this table</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">FROM</span> professors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table>
<caption>0 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Create a table <code>universities</code> with three <code>text</code> columns: <code>university_shortname</code>, <code>university</code>, and <code>university_city</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">-- Create a table for the universities entity type</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> universities (</span>
<span id="cb8-3"><a href="#cb8-3"></a> university_shortname text,</span>
<span id="cb8-4"><a href="#cb8-4"></a> university text,</span>
<span id="cb8-5"><a href="#cb8-5"></a> university_city text</span>
<span id="cb8-6"><a href="#cb8-6"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">-- Print the contents of this table</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">FROM</span> universities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table>
<caption>0 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">university_shortname</th>
<th style="text-align: left;">university</th>
<th style="text-align: left;">university_city</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<p>Great job. The other two tables, <code>affiliations</code> and <code>organizations</code>, will be created for you.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> affiliations (</span>
<span id="cb10-2"><a href="#cb10-2"></a> firstname text,</span>
<span id="cb10-3"><a href="#cb10-3"></a> lastname text,</span>
<span id="cb10-4"><a href="#cb10-4"></a> university_shortname text,</span>
<span id="cb10-5"><a href="#cb10-5"></a> <span class="kw">function</span> text,</span>
<span id="cb10-6"><a href="#cb10-6"></a> organisation text</span>
<span id="cb10-7"><a href="#cb10-7"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> organizations (</span>
<span id="cb11-2"><a href="#cb11-2"></a> <span class="kw">organization</span> text,</span>
<span id="cb11-3"><a href="#cb11-3"></a> organization_sector text</span>
<span id="cb11-4"><a href="#cb11-4"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-a-column-with-alter-table" class="level2">
<h2 class="anchored" data-anchor-id="add-a-column-with-alter-table">ADD a COLUMN with ALTER TABLE</h2>
<p>Oops! We forgot to add the <code>university_shortname</code> column to the <code>professors</code> table. You’ve probably already noticed:</p>
<p><img src="http://assets.datacamp.com/production/repositories/3632/datasets/94c058ee469cf65f72ff3f09db1d16791f0294a7/1_erm_professors.png" alt=""></p>
<p>In chapter 4 of this course, you’ll need this column for connecting the <code>professors</code> table with the <code>universities</code> table.</p>
<p>However, adding columns to existing tables is easy, especially if they’re still empty.</p>
<p>To add columns you can use the following SQL query:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">ADD</span> <span class="kw">COLUMN</span> column_name data_type;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Alter <code>professors</code> to add the text column <code>university_shortname</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">-- Add the university_shortname column</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw">ADD</span> <span class="kw">COLUMN</span> university_shortname text;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">-- Print the contents of this table</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="kw">FROM</span> professors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table>
<caption>0 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">university_shortname</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<p>Perfect – now your first sample database model is complete. Time to fill these tables with data!</p>
</section>
<section id="update-your-database-as-the-structure-changes" class="level2">
<h2 class="anchored" data-anchor-id="update-your-database-as-the-structure-changes">Update your database as the structure changes</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Update your database as the structure changes</strong></p>
<p>Well done so far. You now have a database consisting of five different tables. Now it’s time to migrate the data.</p>
<p><strong>2. The current database model</strong></p>
<p>Here’s the current entity-relationship diagram, showing the five tables.</p>
<p><strong>3. The current database model</strong></p>
<p>At this moment, only the “university_professors” table holds data. The other four, shown in red, are still empty. In the remainder of this chapter, you will migrate data from the green part of this diagram to the red part, moving the respective entity types to their appropriate tables. In the end, you’ll be able to delete the “university_professors” table.</p>
<p><strong>4. Only store DISTINCT data in the new tables</strong></p>
<p>One advantage of splitting up “university_professors” into several tables is the reduced redundancy. As of now, “university_professors” holds 1377 entries. However, there are only 1287 distinct organizations, as this query shows. Therefore, you only need to store 1287 distinct organizations in the new “organizations” table.</p>
<p><strong>5. INSERT DISTINCT records INTO the new tables</strong></p>
<p>In order to copy data from an existing table to a new one, you can use the “INSERT INTO SELECT DISTINCT” pattern. After “INSERT INTO”, you specify the name of the target table – “organizations” in this case. Then you select the columns that should be copied over from the source table – “unviversity_professors” in this case. You use the “DISTINCT” keyword to only copy over distinct organizations. As the output shows, only 1287 records are inserted into the “organizations” table. If you just used “INSERT INTO SELECT”, without the “DISTINCT” keyword, duplicate records would be copied over as well. In the following exercises, you will migrate your data to the four new tables.</p>
<p><strong>6. The INSERT INTO statement</strong></p>
<p>By the way, this is the normal use case for “INSERT INTO” – where you insert values manually. “INSERT INTO” is followed by the table name and an optional list of columns which should be filled with data. Then follows the “VALUES” keyword and the actual values you want to insert.</p>
<p><strong>7. RENAME a COLUMN in affiliations</strong></p>
<p>Before you start migrating the table, you need to fix some stuff! In the last lesson, I created the “affiliations” table for you. Unfortunately, I made a mistake in this process. Can you spot it? The way the “organisation” column is spelled is not consistent with the American-style spelling of this table, using an “s” instead of a “z”. In the first exercise after the video, you will correct this with the known “ALTER TABLE” syntax. You do this with the RENAME COLUMN command by specifying the old column name first and then the new column name, i.e., “RENAME COLUMN old_name TO new_name”.</p>
<p><strong>8. DROP a COLUMN in affiliations</strong></p>
<p>Also, the “university_shortname” column is not even needed here. So I want you to delete it. The syntax for this is again very simple, you use a “DROP COLUMN” command followed by the name of the column. Dropping columns is straightforward when the tables are still empty, so it’s not too late to fix this error. But why is it an error in the first place?</p>
<p><strong>9. A professor is uniquely identified by firstname, lastname only</strong></p>
<p>Well, I queried the “university_professors” table and saw that there are 551 unique combinations of first names, last names, and associated universities. I then queried the table again and only looked for unique combinations of first and last names. Turns out, this is also 551 records. This means that the columns “firstname” and “lastname” uniquely identify a professor.</p>
<p><strong>10. A professor is uniquely identified by firstname, lastname only</strong></p>
<p>So the “university_shortname” column is not needed in order to reference a professor in the affiliations table. You can remove it, and this will reduce the redundancy in your database again. In other words: The columns “firstname”, “lastname”, “function”, and “organization” are enough to store the affiliation a professor has with a certain organization.</p>
<p><strong>11. Let’s get to work!</strong></p>
<p>Time to prepare the database for data migration. After this, you will migrate the data.</p>
</section>
<section id="rename-and-drop-columns-in-affiliations" class="level2">
<h2 class="anchored" data-anchor-id="rename-and-drop-columns-in-affiliations">RENAME and DROP COLUMNs in affiliations</h2>
<p>As mentioned in the video, the still empty affiliations table has some flaws. In this exercise, you’ll correct them as outlined in the video.</p>
<p>You’ll use the following queries:</p>
<ul>
<li>To rename columns:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">RENAME</span> <span class="kw">COLUMN</span> old_name <span class="kw">TO</span> new_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>To delete columns:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="kw">DROP</span> <span class="kw">COLUMN</span> column_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Rename the <code>organisation</code> column to <code>organization</code> in <code>affiliations</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">-- Rename the organisation column</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="kw">RENAME</span> <span class="kw">COLUMN</span> organisation <span class="kw">TO</span> <span class="kw">organization</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Delete the <code>university_shortname</code> column in <code>affiliations</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">-- Delete the university_shortname column</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="kw">DROP</span> <span class="kw">COLUMN</span> university_shortname;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great work! Now the tables are finally ready for data migration.</p>
</section>
<section id="migrate-data-with-insert-into-select-distinct" class="level2">
<h2 class="anchored" data-anchor-id="migrate-data-with-insert-into-select-distinct">Migrate data with INSERT INTO SELECT DISTINCT</h2>
<p>Now it’s finally time to migrate the data into the new tables. You’ll use the following pattern:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="op">..</span>. </span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="op">..</span>. </span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="kw">FROM</span> <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It can be broken up into two parts:</p>
<p><em>First part:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> column_name1, column_name2, <span class="op">..</span>. </span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="kw">FROM</span> table_a;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This selects all distinct values in table <code>table_a</code> – nothing new for you.</p>
<p><em>Second part:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> table_b <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Take this part and append it to the first, so it inserts all distinct rows from <code>table_a</code> into <code>table_b</code>.</p>
<p><strong>One last thing</strong>: It is important that you run all of the code at the same time once you have filled out the blanks.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Insert all <code>DISTINCT</code> professors from <code>university_professors</code> into <code>professors</code>.</li>
<li>Print all the rows in <code>professors</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">-- Insert unique professors into the new table</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> professors </span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> firstname, lastname, university_shortname </span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="kw">FROM</span> university_professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">-- Doublecheck the contents of professors</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="kw">FROM</span> professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">university_shortname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Michel</td>
<td style="text-align: left;">Rappaz</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hilal</td>
<td style="text-align: left;">Lashuel</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jeffrey</td>
<td style="text-align: left;">Huang</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pierre</td>
<td style="text-align: left;">Magistretti</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paolo</td>
<td style="text-align: left;">Ienne</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="even">
<td style="text-align: left;">Frédéric</td>
<td style="text-align: left;">Kaplan</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Olivier</td>
<td style="text-align: left;">Hari</td>
<td style="text-align: left;">UNE</td>
</tr>
<tr class="even">
<td style="text-align: left;">Christian</td>
<td style="text-align: left;">Hesse</td>
<td style="text-align: left;">UBE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majed</td>
<td style="text-align: left;">Chergui</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="even">
<td style="text-align: left;">Douglas</td>
<td style="text-align: left;">Hanahan</td>
<td style="text-align: left;">EPF</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="3" type="1">
<li>Insert all <code>DISTINCT</code> affiliations into <code>affiliations</code> from <code>university_professors</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">-- Insert unique affiliations into the new table</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> affiliations </span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> firstname, lastname, <span class="kw">function</span>, <span class="kw">organization</span> </span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="kw">FROM</span> university_professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">-- Doublecheck the contents of affiliations</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="kw">FROM</span> affiliations;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 39%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">function</th>
<th style="text-align: left;">organization</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dimos</td>
<td style="text-align: left;">Poulikakos</td>
<td style="text-align: left;">VR-Mandat</td>
<td style="text-align: left;">Scrona AG</td>
</tr>
<tr class="even">
<td style="text-align: left;">Francesco</td>
<td style="text-align: left;">Stellacci</td>
<td style="text-align: left;">Co-editor in Chief, Nanoscale</td>
<td style="text-align: left;">Royal Chemistry Society, UK</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alexander</td>
<td style="text-align: left;">Fust</td>
<td style="text-align: left;">Fachexperte und Coach für Designer Startups</td>
<td style="text-align: left;">Creative Hub</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jürgen</td>
<td style="text-align: left;">Brugger</td>
<td style="text-align: left;">Proposal reviewing HEPIA</td>
<td style="text-align: left;">HES Campus Biotech, Genève</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hervé</td>
<td style="text-align: left;">Bourlard</td>
<td style="text-align: left;">Director</td>
<td style="text-align: left;">Idiap Research Institute</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ioannis</td>
<td style="text-align: left;">Papadopoulos</td>
<td style="text-align: left;">Mandat</td>
<td style="text-align: left;">Schweizerischer Nationalfonds (SNF)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Olaf</td>
<td style="text-align: left;">Blanke</td>
<td style="text-align: left;">Professeur à 20%</td>
<td style="text-align: left;">Université de Genève</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leo</td>
<td style="text-align: left;">Staub</td>
<td style="text-align: left;">Präsident Verwaltungsrat</td>
<td style="text-align: left;">Genossenschaft Migros Ostschweiz</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pascal</td>
<td style="text-align: left;">Pichonnaz</td>
<td style="text-align: left;">Vize-Präsident</td>
<td style="text-align: left;">EKK (Eidgenössische Konsumenten Kommission)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dietmar</td>
<td style="text-align: left;">Grichnik</td>
<td style="text-align: left;">Präsident</td>
<td style="text-align: left;">Swiss Startup Monitor Stiftung</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">-- Doublecheck the contents of affiliations</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="kw">FROM</span> affiliations;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1377</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Perfect. You can see that there are 1377 distinct combinations of professors and organisations in the dataset. We’ll migrate the other two tables <code>universities</code> and <code>organisations</code> for you.</p>
<p><strong>Migrate data to the universities and organizations tables</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> universities</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> university_shortname, university, university_city</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="kw">FROM</span> university_professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="kw">FROM</span> universities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">university_shortname</th>
<th style="text-align: left;">university</th>
<th style="text-align: left;">university_city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">UGE</td>
<td style="text-align: left;">Uni Genf</td>
<td style="text-align: left;">Geneva</td>
</tr>
<tr class="even">
<td style="text-align: left;">USI</td>
<td style="text-align: left;">USI Lugano</td>
<td style="text-align: left;">Lugano</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UFR</td>
<td style="text-align: left;">Uni Freiburg</td>
<td style="text-align: left;">Fribourg</td>
</tr>
<tr class="even">
<td style="text-align: left;">USG</td>
<td style="text-align: left;">Uni St.&nbsp;Gallen</td>
<td style="text-align: left;">Saint Gallen</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ULA</td>
<td style="text-align: left;">Uni Lausanne</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="even">
<td style="text-align: left;">EPF</td>
<td style="text-align: left;">ETH Lausanne</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">ETH Zürich</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UNE</td>
<td style="text-align: left;">Uni Neuenburg</td>
<td style="text-align: left;">Neuchâtel</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBA</td>
<td style="text-align: left;">Uni Basel</td>
<td style="text-align: left;">Basel</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> organizations</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">organization</span>, organization_sector</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="kw">FROM</span> university_professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">FROM</span> organizations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">organization</th>
<th style="text-align: left;">organization_sector</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Stiftung-Sammlung Schweizer Rechtsquellen</td>
<td style="text-align: left;">Not classifiable</td>
</tr>
<tr class="even">
<td style="text-align: left;">ResponsAbility</td>
<td style="text-align: left;">Financial industry &amp; insurances</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fondation IQRGC</td>
<td style="text-align: left;">Not classifiable</td>
</tr>
<tr class="even">
<td style="text-align: left;">u-blox AG</td>
<td style="text-align: left;">Industry, construction &amp; agriculture</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Departement für Entwicklungshilfe und -zusammenarbeit DEZA</td>
<td style="text-align: left;">Politics, administration, justice system &amp; security sector</td>
</tr>
<tr class="even">
<td style="text-align: left;">ub-invent GmbH</td>
<td style="text-align: left;">Pharma &amp; health</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Quiartet Medicine, Boston, USA</td>
<td style="text-align: left;">Technology</td>
</tr>
<tr class="even">
<td style="text-align: left;">CSSI Bern</td>
<td style="text-align: left;">Politics, administration, justice system &amp; security sector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Schweizerische Akademie der Naturwissenschaften SCNAT Bern</td>
<td style="text-align: left;">Education &amp; research</td>
</tr>
<tr class="even">
<td style="text-align: left;">Avenir Suisse</td>
<td style="text-align: left;">Society, Social, Culture &amp; Sports</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The last thing to do in this chapter is to delete the no longer needed <code>university_professors</code> table.</p>
</section>
<section id="delete-tables-with-drop-table" class="level2">
<h2 class="anchored" data-anchor-id="delete-tables-with-drop-table">Delete tables with DROP TABLE</h2>
<p>Obviously, the <code>university_professors</code> table is now no longer needed and can safely be deleted.</p>
<p>For table deletion, you can use the simple command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> table_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Delete the <code>university_professors</code> table.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">-- Delete the university_professors table</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> university_professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect! Now it’s finally time to delve into the <em>real advantages of databases</em>. <strong>In the following chapters</strong>, you will discover many cool features that ultimately lead to better data consistency and quality, such as <em>domain constraints</em>, <em>keys</em>, and <em>referential integrity</em>. See you soon!</p>
</section>
</section>
<section id="enforce-data-consistency-with-attribute-constraints" class="level1">
<h1>2. Enforce data consistency with attribute constraints</h1>
<p>After building a simple database, it’s now time to make use of the features. You’ll specify data types in columns, enforce column uniqueness, and disallow NULL values in this chapter.</p>
<section id="better-data-quality-with-constraints" class="level2">
<h2 class="anchored" data-anchor-id="better-data-quality-with-constraints">Better data quality with constraints</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Better data quality with constraints</strong></p>
<p>So far you’ve learned how to set up a simple database that consists of multiple tables. Apart from storing different entity types, such as professors, in different tables, you haven’t made much use of database features. In the end, the idea of a database is to push data into a certain structure – a pre-defined model, where you enforce data types, relationships, and other rules. Generally, these rules are called integrity constraints, although different names exist.</p>
<p><strong>2. Integrity constraints</strong></p>
<p>Integrity constraints can roughly be divided into three types. The most simple ones are probably the so-called attribute constraints. For example, a certain attribute, represented through a database column, could have the integer data type, allowing only for integers to be stored in this column. They’ll be the subject of this chapter. Secondly, there are so-called key constraints. Primary keys, for example, uniquely identify each record, or row, of a database table. They’ll be discussed in the next chapter. Lastly, there are referential integrity constraints. In short, they glue different database tables together. You’ll learn about them in the last chapter of this course.</p>
<p><strong>3. Why constraints?</strong></p>
<p>So why should you know about constraints? Well, they press the data into a certain form. With good constraints in place, people who type in birthdates, for example, have to enter them in always the same form. Data entered by humans is often very tedious to pre-process. So constraints give you consistency, meaning that a row in a certain table has exactly the same form as the next row, and so forth. All in all, they help to solve a lot of data quality issues. While enforcing constraints on human-entered data is difficult and tedious, database management systems can be a great help. In the next chapters and exercises, you’ll explore how.</p>
<p><strong>4. Data types as attribute constraints</strong></p>
<p>You’ll start with attribute constraints in this chapter. In its simplest form, attribute constraints are data types that can be specified for each column of a table. Here you see the beginning of a list of all data types in PostgreSQL. There are basic data types for numbers, such as “bigint”, or strings of characters, such as “character varying”. There are also more high-level data types like “cidr”, which can be used for IP addresses. Implementing such a type on a column would disallow anything that doesn’t fit the structure of an IP.</p>
<p><strong>5. Dealing with data types (casting)</strong></p>
<p>Data types also restrict possible SQL operations on the stored data. For example, it is impossible to calculate a product from an integer <em>and</em> a text column, as shown here in the example. The text column “wind_speed” may store numbers, but PostgreSQL doesn’t know how to use text in a calculation. The solution for this is type casts, that is, on-the-fly type conversions. In this case, you can use the “CAST” function, followed by the column name, the AS keyword, and the desired data type, and PostgreSQL will turn “wind_speed” into an integer right before the calculation.</p>
<p><strong>6. Let’s practice!</strong></p>
<p>Okay, let’s look into this first type of constraints!</p>
</section>
<section id="types-of-database-constraints" class="level2">
<h2 class="anchored" data-anchor-id="types-of-database-constraints">Types of database constraints</h2>
<blockquote class="blockquote">
<h2 id="question-2" class="anchored"><em>Question</em></h2>
<p>Which of the following is not used to enforce a database constraint?<br> <br> ⬜ Foreign keys<br> ✅ SQL aggregate functions<br> ⬜ The BIGINT data type<br> ⬜ Primary keys<br></p>
</blockquote>
<p>Exactly! SQL aggregate functions are not used to enforce constraints, but to do calculations on data.</p>
</section>
<section id="conforming-with-data-types" class="level2">
<h2 class="anchored" data-anchor-id="conforming-with-data-types">Conforming with data types</h2>
<p>For demonstration purposes, I created a fictional database table that only holds three records. The columns have the data types <code>date</code>, <code>integer</code>, and <code>text</code>, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> transactions (</span>
<span id="cb33-2"><a href="#cb33-2"></a> transaction_date <span class="dt">date</span>, </span>
<span id="cb33-3"><a href="#cb33-3"></a> amount <span class="dt">integer</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a> fee text</span>
<span id="cb33-5"><a href="#cb33-5"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Have a look at the contents of the <code>transactions</code> table.</p>
<p>The <code>transaction_date</code> accepts <code>date</code> values. According to <a href="https://www.postgresql.org/docs/10/datatype-datetime.html#DATATYPE-DATETIME-INPUT">the PostgreSQL documentation</a>, it accepts values in the form of <code>YYYY-MM-DD</code>, <code>DD/MM/YY</code>, and so forth.</p>
<p>Both columns <code>amount</code> and <code>fee</code> appear to be numeric, however, the latter is modeled as <code>text</code> – which you will account for in the next exercise.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Execute the given sample code.</li>
<li>As it doesn’t work, have a look at the error message and correct the statement accordingly – then execute it again.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">-- Let's add a record to the table</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> transactions (transaction_date, amount, fee) </span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="kw">VALUES</span> (<span class="st">'2018-24-09'</span>, <span class="dv">5454</span>, <span class="st">'30'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: Failed to prepare query: ERROR:  date/time field value out of range: "2018-24-09"
LINE 3: VALUES ('2018-24-09', 5454, '30');
                ^
HINT:  Perhaps you need a different "datestyle" setting.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">-- Let's add a record to the table</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> transactions (transaction_date, amount, fee) </span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="kw">VALUES</span> (<span class="st">'2018-09-24'</span>, <span class="dv">5454</span>, <span class="st">'30'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">-- Doublecheck the contents</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="kw">FROM</span> transactions;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">transaction_date</th>
<th style="text-align: right;">amount</th>
<th style="text-align: left;">fee</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1999-01-08</td>
<td style="text-align: right;">500</td>
<td style="text-align: left;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001-02-20</td>
<td style="text-align: right;">403</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001-03-20</td>
<td style="text-align: right;">3430</td>
<td style="text-align: left;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018-09-24</td>
<td style="text-align: right;">5454</td>
<td style="text-align: left;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999-01-08</td>
<td style="text-align: right;">500</td>
<td style="text-align: left;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001-02-20</td>
<td style="text-align: right;">403</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001-03-20</td>
<td style="text-align: right;">3430</td>
<td style="text-align: left;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018-09-24</td>
<td style="text-align: right;">5454</td>
<td style="text-align: left;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999-01-08</td>
<td style="text-align: right;">500</td>
<td style="text-align: left;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001-02-20</td>
<td style="text-align: right;">403</td>
<td style="text-align: left;">15</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Good work. You can see that data types provide certain <em>restrictions</em> on how data can be entered into a table. This may be tedious at the moment of insertion, but saves a lot of headache in the long run.</p>
</section>
<section id="type-casts" class="level2">
<h2 class="anchored" data-anchor-id="type-casts">Type CASTs</h2>
<p>In the video, you saw that type casts are a possible solution for data type issues. If you know that a certain column stores numbers as <code>text</code>, you can <em>cast</em> the column to a numeric form, i.e.&nbsp;to <code>integer</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">SELECT</span> <span class="fu">CAST</span>(some_column <span class="kw">AS</span> <span class="dt">integer</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="kw">FROM</span> <span class="kw">table</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the <code>some_column</code> column is temporarily represented as <code>integer</code> instead of <code>text</code>, meaning that you can perform numeric calculations on the column.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Execute the given sample code.</li>
<li>As it doesn’t work, add an <code>integer</code> type cast at the right place and execute it again.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">-- Calculate the net amount as amount + fee</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="kw">SELECT</span> transaction_date, amount <span class="op">+</span> fee <span class="kw">AS</span> net_amount </span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="kw">FROM</span> transactions;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: Failed to prepare query: ERROR:  operator does not exist: double precision + text
LINE 2: SELECT transaction_date, amount + fee AS net_amount 
                                        ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1"></a><span class="co">-- Calculate the net amount as amount + fee</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="kw">SELECT</span> transaction_date, amount <span class="op">+</span> <span class="fu">CAST</span>(fee <span class="kw">AS</span> <span class="dt">integer</span>) <span class="kw">AS</span> net_amount </span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="kw">FROM</span> transactions;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">transaction_date</th>
<th style="text-align: right;">net_amount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1999-01-08</td>
<td style="text-align: right;">520</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001-02-20</td>
<td style="text-align: right;">418</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001-03-20</td>
<td style="text-align: right;">3465</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018-09-24</td>
<td style="text-align: right;">5484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999-01-08</td>
<td style="text-align: right;">520</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001-02-20</td>
<td style="text-align: right;">418</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001-03-20</td>
<td style="text-align: right;">3465</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018-09-24</td>
<td style="text-align: right;">5484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999-01-08</td>
<td style="text-align: right;">520</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001-02-20</td>
<td style="text-align: right;">418</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Good job! You saw how, sometimes, type casts are necessary to work with data. However, it is better to store columns in the right data type from the first place. You’ll learn how to do this in the next exercises.</p>
</section>
<section id="working-with-data-types" class="level2">
<h2 class="anchored" data-anchor-id="working-with-data-types">Working with data types</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Working with data types</strong></p>
<p>Working with data types is straightforward in a database management system like PostgreSQL.</p>
<p><strong>2. Working with data types</strong></p>
<p>As said before, data types are attribute constraints and are therefore implemented for single columns of a table. They define the so-called “domain” of values in a column, that means, what form these values can take – and what not. Therefore, they also define what operations are possible with the values in the column, as you saw in the previous exercises. Of course, through this, consistent storage is enforced, so a street number will always be an actual number, and a postal code will always have no more than 6 digits, according to your conventions. This greatly helps with data quality.</p>
<p><strong>3. The most common types</strong></p>
<p>Here are the most common types in PostgreSQL. Note that these types are specific to PostgreSQL but appear in many other database management systems as well, and they mostly conform to the SQL standard. The “text” type allows characters strings of any length, while the “varchar” and “char” types specify a maximum number of characters, or a character string of fixed length, respectively. You’ll use these two for your database. The “boolean” type allows for two boolean values, for example, “true” and “false” or “1” and “0”, and for a third unknown value, expressed through “NULL”.</p>
<p><strong>4. The most common types (cont’d.)</strong></p>
<p>Then there are various formats for date and time calculations, also with timezone support. “numeric” is a general type for any sort of numbers with arbitrary precision, while “integer” allows only whole numbers in a certain range. If that range is not enough for your numbers, there’s also “bigint” for larger numbers.</p>
<p><strong>5. Specifying types upon table creation</strong></p>
<p>Here’s an example of how types are specified upon table creation. Let’s say the social security number, “ssn”, should be stored as an integer as it only contains whole numbers. The name may be a string with a maximum of 64 characters, which might or might not be enough. The date of birth, “dob”, is naturally stored as a date, while the average grade is a numeric value with a precision of 3 and a scale of 2, meaning that numbers with a total of three digits and two digits after the fractional point are allowed. Lastly, the information whether the tuition of the student was paid is, of course, a boolean one, as it can be either true or false.</p>
<p><strong>6. Alter types after table creation</strong></p>
<p>Altering types after table creation is also straightforward, just use the shown “ALTER TABLE ALTER COLUMN” statement. In this case, the maximum name length is extended to 128 characters.Sometimes it may be necessary to truncate column values or transform them in any other way, so they fit with the new data type. Then you can use the “USING” keyword, and specify a transformation that should happen before the type is altered. Let’s say you’d want to turn the “average_grade” column into an integer type. Normally, PostgreSQL would just keep the part of the number before the fractional point. With “USING”, you can tell it to round the number to the nearest integer, for example.</p>
<p><strong>7. Let’s apply this!</strong></p>
<p>Let’s apply this to your database and add the proper types to your table columns.</p>
</section>
<section id="change-types-with-alter-column" class="level2">
<h2 class="anchored" data-anchor-id="change-types-with-alter-column">Change types with ALTER COLUMN</h2>
<p>The syntax for changing the data type of a column is straightforward. The following code changes the data type of the <code>column_name</code> column in <code>table_name</code> to <code>varchar(10)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name</span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> column_name</span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="kw">TYPE</span> <span class="dt">varchar</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now it’s time to start adding constraints to your database.</p>
<p><strong>Steps</strong> 1. Have a look at the distinct <code>university_shortname</code> values in the <code>professors</code> table and take note of the length of the strings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1"></a><span class="co">-- Select the university_shortname column</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span>(university_shortname) </span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="kw">FROM</span> professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">university_shortname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ULA</td>
</tr>
<tr class="even">
<td style="text-align: left;">UNE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EPF</td>
</tr>
<tr class="even">
<td style="text-align: left;">USG</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UBA</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UZH</td>
</tr>
<tr class="even">
<td style="text-align: left;">UGE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UFR</td>
</tr>
<tr class="even">
<td style="text-align: left;">USI</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Now specify a fixed-length character type with the correct length for <code>university_shortname</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb44-1"><a href="#cb44-1"></a><span class="co">-- Specify the correct fixed-length character type</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors</span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> university_shortname</span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="kw">TYPE</span> <span class="dt">char</span>(<span class="dv">3</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Change the type of the <code>firstname</code> column to <code>varchar(64)</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb45-1"><a href="#cb45-1"></a><span class="co">-- Change the type of firstname</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> firstname</span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="kw">TYPE</span> <span class="dt">varchar</span>(<span class="dv">64</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Good work. I’ve specified the types of the other tables for you.</p>
</section>
<section id="convert-types-using-a-function" class="level2">
<h2 class="anchored" data-anchor-id="convert-types-using-a-function">Convert types USING a function</h2>
<p>If you don’t want to reserve too much space for a certain <code>varchar</code> column, you can <em>truncate</em> the values before converting its type.</p>
<p>For this, you can use the following syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> column_name</span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="kw">TYPE</span> <span class="dt">varchar</span>(x)</span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="kw">USING</span> SUBSTRING(column_name <span class="kw">FROM</span> <span class="dv">1</span> <span class="cf">FOR</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should read it like this: Because you want to reserve only <code>x</code> characters for <code>column_name</code>, you have to retain a <code>SUBSTRING</code> of every value, i.e.&nbsp;the first <code>x</code> characters of it, and throw away the rest. This way, the values will fit the <code>varchar(x)</code> requirement.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Run the sample code as is and take note of the error.</li>
<li>Now use <code>SUBSTRING()</code> to reduce <code>firstname</code> to 16 characters so its type can be altered to <code>varchar(16)</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb47-1"><a href="#cb47-1"></a><span class="co">-- Convert the values in firstname to a max. of 16 characters</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors </span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> firstname </span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="kw">TYPE</span> <span class="dt">varchar</span>(<span class="dv">16</span>) </span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="kw">USING</span> SUBSTRING(firstname <span class="kw">FROM</span> <span class="dv">1</span> <span class="cf">FOR</span> <span class="dv">16</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect! However, it’s best not to truncate any values in your database, so we’ll revert this column to <code>varchar(64)</code>. Now it’s time to move on to the next set of attribute constraints!</p>
</section>
<section id="the-not-null-and-unique-constraints" class="level2">
<h2 class="anchored" data-anchor-id="the-not-null-and-unique-constraints">The not-null and unique constraints</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. The not-null and unique constraints</strong></p>
<p>In the last part of this chapter, you’ll get to know two special attribute constraints: the not-null and unique constraints.</p>
<p><strong>2. The not-null constraint</strong></p>
<p>As the name already says, the not-null constraint disallows any “NULL” values on a given column. This must hold true for the existing state of the database, but also for any future state. Therefore, you can only specify a not-null constraint on a column that doesn’t hold any “NULL” values yet. And: It won’t be possible to insert “NULL” values in the future.</p>
<p><strong>3. What does NULL mean?</strong></p>
<p>Before I go on explaining how to specify not-null constraints, I want you to think about “NULL” values. What do they actually mean to you? There’s no clear definition. “NULL” can mean a couple of things, for example, that the value is unknown, or does not exist at all. It can also be possible that a value does not apply to the column. Let’s look into an example.</p>
<p><strong>4. What does NULL mean? An example</strong></p>
<p>Let’s say we define a table “students”. The first two columns for the social security number and the last name cannot be “NULL”, which makes sense: this should be known and apply to every student. The “home_phone” and “office_phone” columns though should allow for null values – which is the default, by the way. Why? First of all, these numbers can be unknown, for any reason, or simply not exist, because a student might not have a phone. Also, some values just don’t apply: Some students might not have an office, so they don’t have an office phone, and so forth. So, one important take away is that two “NULL” values must not have the same meaning. This also means that comparing “NULL” with “NULL” always results in a “FALSE” value.</p>
<p><strong>5. How to add or remove a not-null constraint</strong></p>
<p>You’ve just seen how to add a not-null constraint to certain columns when creating a table. Just add “not null” after the respective columns. But you can also add and remove not-null constraints to and from existing tables. To add a not-null constraint to an existing table, you can use the “ALTER COLUMN SET NOT NULL” syntax as shown here. Similarly, to remove a not-null constraint, you can use “ALTER COLUMN DROP NOT NULL”.</p>
<p><strong>6. The unique constraint</strong></p>
<p>The unique constraint on a column makes sure that there are no duplicates in a column. So any given value in a column can only exist once. This, for example, makes sense for university short names, as storing universities more than once leads to unnecessary redundancy. However, it doesn’t make sense for university cities, as two universities can co-exist in the same city. Just as with the not-null constraint, you can only add a unique constraint if the column doesn’t hold any duplicates before you apply it.</p>
<p><strong>7. Adding unique constraints</strong></p>
<p>Here’s how to create columns with unique constraints. Just add the “UNIQUE” keyword after the respective table column. You can also add a unique constraint to an existing table. For that, you have to use the “ADD CONSTRAINT” syntax. This is different from adding a “NOT NULL” constraint. However, it’s a pattern that frequently occurs. You’ll see plenty of other examples of “ADD CONSTRAINT” in the remainder of this course.</p>
<p><strong>8. Let’s apply this to the database!</strong></p>
<p>Okay, time now to apply the not-null and unique constraints to some of the columns of your current university affiliations database.</p>
</section>
<section id="disallow-null-values-with-set-not-null" class="level2">
<h2 class="anchored" data-anchor-id="disallow-null-values-with-set-not-null">Disallow NULL values with SET NOT NULL</h2>
<p>The <code>professors</code> table is almost ready now. However, it still allows for <code>NULL</code>s to be entered. Although some information might be missing about some professors, there’s certainly columns that <em>always</em> need to be specified.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a not-null constraint for the <code>firstname</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb48-1"><a href="#cb48-1"></a><span class="co">-- Disallow NULL values in firstname</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors </span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> firstname <span class="kw">SET</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Add a not-null constraint for the <code>lastname</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb49-1"><a href="#cb49-1"></a><span class="co">-- Disallow NULL values in lastname</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors </span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> lastname <span class="kw">SET</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Good job – it is no longer possible to add professors which have either their first or last name set to <code>NULL</code>. Likewise, it is no longer possible to update an existing professor and setting their first or last name to <code>NULL</code>.</p>
</section>
<section id="what-happens-if-you-try-to-enter-nulls" class="level2">
<h2 class="anchored" data-anchor-id="what-happens-if-you-try-to-enter-nulls">What happens if you try to enter NULLs?</h2>
<p>Execute the following statement:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> professors (firstname, lastname, university_shortname)</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="kw">VALUES</span> (<span class="kw">NULL</span>, <span class="st">'Miller'</span>, <span class="st">'ETH'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: Failed to fetch row: ERROR:  null value in column "firstname" of relation "professors" violates not-null constraint
DETAIL:  Failing row contains (null, Miller, ETH).</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h2 id="question-3" class="anchored"><em>Question</em></h2>
<p>Why does this throw an error?<br> <br> ⬜ Professors without first names do not exist.<br> ✅ Because a database constraint is violated.<br> ⬜ Error? This works just fine.<br> ⬜ <code>NULL</code> is not put in quotes.<br></p>
</blockquote>
<p>Correct! This statement violates one of the not-null constraints you’ve just specified.</p>
</section>
<section id="make-your-columns-unique-with-add-constraint" class="level2">
<h2 class="anchored" data-anchor-id="make-your-columns-unique-with-add-constraint">Make your columns UNIQUE with ADD CONSTRAINT</h2>
<p>As seen in the video, you add the <code>UNIQUE</code> keyword after the <code>column_name</code> that should be unique. This, of course, only works for <em>new</em> tables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> table_name (</span>
<span id="cb52-2"><a href="#cb52-2"></a> column_name <span class="kw">UNIQUE</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to add a unique constraint to an <em>existing</em> table, you do it like that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb53-1"><a href="#cb53-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name</span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> some_name <span class="kw">UNIQUE</span>(column_name);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that this is different from the <code>ALTER COLUMN</code> syntax for the not-null constraint. Also, you have to give the constraint a name <code>some_name</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a unique constraint to the <code>university_shortname</code> column in <code>universities</code>. Give it the name <code>university_shortname_unq</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb54-1"><a href="#cb54-1"></a><span class="co">-- Make universities.university_shortname unique</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> universities</span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> university_shortname_unq <span class="kw">UNIQUE</span>(university_shortname);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Add a unique constraint to the <code>organization</code> column in <code>organizations</code>. Give it the name <code>organization_unq</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb55-1"><a href="#cb55-1"></a><span class="co">-- Make organizations.organization unique</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> organizations</span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> organization_unq <span class="kw">UNIQUE</span>(<span class="kw">organization</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect. Making sure <code>universities.university_shortname</code> and <code>organizations.organization</code> only contain unique values is a prerequisite for turning them into so-called primary keys – the subject of the next chapter!</p>
</section>
</section>
<section id="uniquely-identify-records-with-key-constraints" class="level1">
<h1>3. Uniquely identify records with key constraints</h1>
<p>Now let’s get into the best practices of database engineering. It’s time to add primary and foreign keys to the tables. These are two of the most important concepts in databases, and are the building blocks you’ll use to establish relationships between tables.</p>
<section id="keys-and-superkeys" class="level2">
<h2 class="anchored" data-anchor-id="keys-and-superkeys">Keys and superkeys</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Keys and superkeys</strong></p>
<p>Welcome back! Let’s discuss key constraints. They are a very important concept in database systems, so we’ll spend a whole chapter on them.</p>
<p><strong>2. The current database model</strong></p>
<p>Let’s have a look at your current database model first. In the last chapter, you specified attribute constraints, first and foremost data types. You also set not-null and unique constraints on certain attributes. This didn’t actually change the structure of the model, so it still looks the same.</p>
<p><strong>3. The database model with primary keys</strong></p>
<p>By the end of this chapter, the database will look slightly different. You’ll add so-called primary keys to three different tables. You’ll name them “id”. In the entity-relationship diagram, keys are denoted by underlined attribute names. Notice that you’ll add a whole new attribute to the “professors” table, and you’ll modify existing columns of the “organizations” and “universities” tables.</p>
<p><strong>4. What is a key?</strong></p>
<p>Before we go into the nitty-gritty of what a primary key actually is, let’s look at keys in general. Typically a database table has an attribute, or a combination of multiple attributes, whose values are unique across the whole table. Such attributes identify a record uniquely. Normally, a table, as a whole, only contains unique records, meaning that the combination of all attributes is a key in itself. However, it’s not called a key, but a superkey, if attributes from that combination can be removed, and the attributes still uniquely identify records. If all possible attributes have been removed but the records are still uniquely identifiable by the remaining attributes, we speak of a minimal superkey. This is the actual key. So a key is always minimal. Let’s look at an example.</p>
<p><strong>5. An example</strong></p>
<p>Here’s an example that I found in a textbook on database systems. Obviously, the table shows six different cars, so the combination of all attributes is a superkey. If we remove the “year” attribute from the superkey, the six records are still unique, so it’s still a superkey. Actually, there are a lot of possible superkeys in this example.</p>
<p><strong>6. An example (contd.)</strong></p>
<p>However, there are only four minimal superkeys, and these are “license_no”, “serial_no”, and “model”, as well as the combination of “make” and “year”. Remember that superkeys are minimal if no attributes can be removed without losing the uniqueness property. This is trivial for K1 to 3, as they only consist of a single attribute. Also, if we remove “year” from K4, “make” would contain duplicates, and would, therefore, be no longer suited as key. These four minimal superkeys are also called candidate keys. Why candidate keys? In the end, there can only be one key for the table, which has to be chosen from the candidates. More on that in the next video.</p>
<p><strong>7. Let’s discover some keys!</strong></p>
<p>First I want you to have a look at some tables in your database and think about keys.</p>
</section>
<section id="get-to-know-select-count-distinct" class="level2">
<h2 class="anchored" data-anchor-id="get-to-know-select-count-distinct">Get to know SELECT COUNT DISTINCT</h2>
<p>Your database doesn’t have any defined keys so far, and you don’t know which columns or combinations of columns are suited as keys.</p>
<p>There’s a simple way of finding out whether a certain column (or a combination) contains only unique values – and thus identifies the records in the table.</p>
<p>You already know the <code>SELECT DISTINCT</code> query from the first chapter. Now you just have to wrap everything within the <code>COUNT()</code> function and PostgreSQL will return the number of unique rows for the given columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb56-1"><a href="#cb56-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span>(column_a, column_b, <span class="op">..</span>.))</span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="kw">FROM</span> <span class="kw">table</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>First, find out the number of rows in <code>universities</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb57-1"><a href="#cb57-1"></a><span class="co">-- Count the number of rows in universities</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="kw">FROM</span> universities;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Then, find out how many unique values there are in the <code>university_city</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb58-1"><a href="#cb58-1"></a><span class="co">-- Count the number of distinct values in the university_city column</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span>(university_city)) </span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="kw">FROM</span> universities;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Great! So, obviously, the <code>university_city</code> column wouldn\’t lend itself as a key. Why? Because there are only 9 distinct values, but the table has 11 rows.</p>
</section>
<section id="identify-keys-with-select-count-distinct" class="level2">
<h2 class="anchored" data-anchor-id="identify-keys-with-select-count-distinct">Identify keys with SELECT COUNT DISTINCT</h2>
<p>There’s a very basic way of finding out what qualifies for a key in an existing, populated table:</p>
<ol type="1">
<li>Count the distinct records for all possible combinations of columns. If the resulting number x equals the number of all rows in the table for a combination, you have discovered a superkey.</li>
<li>Then remove one column after another until you can no longer remove columns without seeing the number x decrease. If that is the case, you have discovered a (candidate) key.</li>
</ol>
<p>The table <code>professors</code> has 551 rows. It has only one possible candidate key, which is a combination of two attributes. You might want to try different combinations using the “Run code” button. Once you have found the solution, you can submit your answer.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using the above steps, identify the <em>candidate key</em> by trying out different combination of columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb59-1"><a href="#cb59-1"></a><span class="co">-- Try out different combinations</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span>(firstname, lastname)) </span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="kw">FROM</span> professors;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">551</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Indeed, the only combination that uniquely identifies <code>professors</code> is <code>{firstname, lastname}</code>. <code>{firstname, lastname, university_shortname}</code> is a superkey, and all other combinations give duplicate values. Hopefully, the concept of superkeys and keys is now a bit more clear. Let\’s move on to <em>primary</em> keys!</p>
</section>
<section id="primary-keys" class="level2">
<h2 class="anchored" data-anchor-id="primary-keys">Primary keys</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Primary keys</strong></p>
<p>Okay, now it’s time to look at an actual use case for superkeys, keys, and candidate keys.</p>
<p><strong>2. Primary keys</strong></p>
<p>Primary keys are one of the most important concepts in database design. Almost every database table should have a primary key – chosen by you from the set of candidate keys. The main purpose, as already explained, is uniquely identifying records in a table. This makes it easier to reference these records from other tables, for instance – a concept you will go through in the next and last chapter. You might have already guessed it, but primary keys need to be defined on columns that don’t accept duplicate or null values. Lastly, primary key constraints are time-invariant, meaning that they must hold for the current data in the table – but also for any future data that the table might hold. It is therefore wise to choose columns where values will always be unique and not null.</p>
<p><strong>3. Specifying primary keys</strong></p>
<p>So these two tables accept exactly the same data, however, the latter has an explicit primary key specified. As you can see, specifying primary keys upon table creation is very easy. Primary keys can also be specified like so: This notation is necessary if you want to designate more than one column as the primary key. Beware, that’s still only one primary key, it is just formed by the combination of two columns. Ideally, though, primary keys consist of as few columns as possible!</p>
<p><strong>4. Specifying primary keys (contd.)</strong></p>
<p>Adding primary key constraints to existing tables is the same procedure as adding unique constraints, which you might remember from the last chapter. As with unique constraints, you have to give the constraint a certain name.</p>
<p><strong>5. Your database</strong></p>
<p>In the exercises that follow, you will add primary keys to the tables “universities” and “organizations”. You will add a special type of primary key, a so-called surrogate key, to the table “professors” in the last part of this chapter.</p>
<p><strong>6. Let’s practice!</strong></p>
<p>Let’s go add these keys.</p>
</section>
<section id="identify-the-primary-key" class="level2">
<h2 class="anchored" data-anchor-id="identify-the-primary-key">Identify the primary key</h2>
<p>Have a look at the example table from the previous video. As the database designer, you have to make a wise choice as to which column should be the primary key.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb60-1"><a href="#cb60-1"></a>     license_no     | serial_no |    make    |  model  | <span class="dt">year</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="co">--------------------+-----------+------------+---------+------</span></span>
<span id="cb60-3"><a href="#cb60-3"></a> Texas ABC<span class="op">-</span><span class="dv">739</span>      | A69352    | Ford       | Mustang |    <span class="dv">2</span></span>
<span id="cb60-4"><a href="#cb60-4"></a> Florida TVP<span class="op">-</span><span class="dv">347</span>    | B43696    | Oldsmobile | Cutlass |    <span class="dv">5</span></span>
<span id="cb60-5"><a href="#cb60-5"></a> <span class="kw">New</span> York MPO<span class="op">-</span><span class="dv">22</span>    | X83554    | Oldsmobile | Delta   |    <span class="dv">1</span></span>
<span id="cb60-6"><a href="#cb60-6"></a> California <span class="dv">432</span><span class="op">-</span>TFY | C43742    | Mercedes   | <span class="dv">190</span><span class="op">-</span>D   |   <span class="dv">99</span></span>
<span id="cb60-7"><a href="#cb60-7"></a> California RSK<span class="op">-</span><span class="dv">629</span> | Y82935    | Toyota     | Camry   |    <span class="dv">4</span></span>
<span id="cb60-8"><a href="#cb60-8"></a> Texas RSK<span class="op">-</span><span class="dv">629</span>      | U028365   | Jaguar     | XJS     |    <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-4" class="anchored"><em>Question</em></h2>
<p>Which of the following column or column combinations could best serve as primary key?<br> <br> ⬜ PK = {make}<br> ⬜ PK = {model, year}<br> ✅ PK = {license_no}<br> ⬜ PK = {year, make}<br></p>
</blockquote>
<p>Correct! A primary key consisting solely of “license_no” is probably the wisest choice, as license numbers are certainly unique across all registered cars in a country.</p>
</section>
<section id="add-key-constraints-to-the-tables" class="level2">
<h2 class="anchored" data-anchor-id="add-key-constraints-to-the-tables">ADD key CONSTRAINTs to the tables</h2>
<p>Two of the tables in your database already have well-suited candidate keys consisting of one column each: <code>organizations</code> and <code>universities</code> with the <code>organization</code> and <code>university_shortname</code> columns, respectively.</p>
<p>In this exercise, you’ll rename these columns to <code>id</code> using the <code>RENAME COLUMN</code> command and then specify primary key constraints for them. This is as straightforward as adding unique constraints (see the last exercise of Chapter 2):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb61-1"><a href="#cb61-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name</span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> some_name <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (column_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you can also specify more than one column in the brackets.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Rename the <code>organization</code> column to <code>id</code> in <code>organizations</code>.</li>
<li>Make <code>id</code> a primary key and name it <code>organization_pk</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb62-1"><a href="#cb62-1"></a><span class="co">-- Rename the organization column to id</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> organizations</span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="kw">RENAME</span> <span class="kw">COLUMN</span> <span class="kw">organization</span> <span class="kw">TO</span> <span class="kw">id</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb63-1"><a href="#cb63-1"></a><span class="co">-- Make id a primary key</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> organizations</span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> organization_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Rename the <code>university_shortname</code> column to <code>id</code> in <code>universities</code>.</li>
<li>Make <code>id</code> a primary key and name it <code>university_pk</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb64-1"><a href="#cb64-1"></a><span class="co">-- Rename the university_shortname column to id</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> universities</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="kw">RENAME</span> <span class="kw">COLUMN</span> university_shortname <span class="kw">TO</span> <span class="kw">id</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb65-1"><a href="#cb65-1"></a><span class="co">-- Make id a primary key</span></span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> universities</span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> university_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Good job! That was easy, wasn’t it? Let’s tackle the last table that needs a primary key right now: <code>professors</code>. However, things are going to be different this time, because you’ll add a so-called surrogate key.</p>
</section>
<section id="surrogate-keys" class="level2">
<h2 class="anchored" data-anchor-id="surrogate-keys">Surrogate keys</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Surrogate keys</strong></p>
<p>Surrogate keys are sort of an artificial primary key. In other words, they are not based on a native column in your data, but on a column that just exists for the sake of having a primary key. Why would you need that?</p>
<p><strong>2. Surrogate keys</strong></p>
<p>There are several reasons for creating an artificial surrogate key. As mentioned before, a primary key is ideally constructed from as few columns as possible. Secondly, the primary key of a record should never change over time. If you define an artificial primary key, ideally consisting of a unique number or string, you can be sure that this number stays the same for each record. Other attributes might change, but the primary key always has the same value for a given record.</p>
<p><strong>3. An example</strong></p>
<p>Let’s look back at the example in the first video of this chapter. I altered it slightly and added the “color” column. In this table, the “license_no” column would be suited as the primary key – the license number is unlikely to change over time, not like the color column, for example, which might change if the car is repainted. So there’s no need for a surrogate key here. However, let’s say there were only these three attributes in the table. The only sensible primary key would be the combination of “make” and “model”, but that’s two columns for the primary key.</p>
<p><strong>4. Adding a surrogate key with serial data type</strong></p>
<p>You could add a new surrogate key column, called “id”, to solve this problem. Actually, there’s a special data type in PostgreSQL that allows the addition of auto-incrementing numbers to an existing table: the “serial” type. It is specified just like any other data type. Once you add a column with the “serial” type, all the records in your table will be numbered. Whenever you add a new record to the table, it will automatically get a number that does not exist yet. There are similar data types in other database management systems, like MySQL.</p>
<p><strong>5. Adding a surrogate key with serial data type (contd.)</strong></p>
<p>Also, if you try to specify an ID that already exists, the primary key constraint will prevent you from doing so. So, after all, the “id” column uniquely identifies each record in this table – which is very useful, for example, when you want to refer to these records from another table. But this will be the subject of the next chapter.</p>
<p><strong>6. Another type of surrogate key</strong></p>
<p>Another strategy for creating a surrogate key is to combine two existing columns into a new one. In this example, we first add a new column with the “varchar” data type. We then “UPDATE” that column with the concatenation of two existing columns. The “CONCAT” function glues together the values of two or more existing columns. Lastly, we turn that new column into a surrogate primary key.</p>
<p><strong>7. Your database</strong></p>
<p>In the exercises, you’ll add a surrogate key to the “professors” table, because the existing attributes are not really suited as primary key. Theoretically, there could be more than one professor with the same name working for one university, resulting in duplicates. With an auto-incrementing “id” column as the primary key, you make sure that each professor can be uniquely referred to. This was not necessary for organizations and universities, as their names can be assumed to be unique across these tables. In other words: It is unlikely that two organizations with the same name exist, solely for trademark reasons. The same goes for universities.</p>
<p><strong>8. Let’s try this!</strong></p>
<p>Let’s try this out before you move on to the last chapter.</p>
</section>
<section id="add-a-serial-surrogate-key" class="level2">
<h2 class="anchored" data-anchor-id="add-a-serial-surrogate-key">Add a SERIAL surrogate key</h2>
<p>Since there’s no single column candidate key in <code>professors</code> (only a composite key candidate consisting of <code>firstname</code>, <code>lastname</code>), you’ll add a new column <code>id</code> to that table.</p>
<p>This column has a special data type <code>serial</code>, which turns the column into an auto-incrementing number. This means that, whenever you add a new professor to the table, it will automatically get an <code>id</code> that does not exist yet in the table: a perfect primary key!</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a new column <code>id</code> with data type <code>serial</code> to the <code>professors</code> table.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb66-1"><a href="#cb66-1"></a><span class="co">-- Add the new column to the table</span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors </span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="kw">ADD</span> <span class="kw">COLUMN</span> <span class="kw">id</span> serial;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Make <code>id</code> a primary key and name it <code>professors_pkey</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb67-1"><a href="#cb67-1"></a><span class="co">-- Make id a primary key</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors </span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> professors_pkey <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Write a query that returns all the columns and 10 rows from <code>professors</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb68-1"><a href="#cb68-1"></a><span class="co">-- Have a look at the first 10 rows of professors</span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="kw">FROM</span> professors </span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">university_shortname</th>
<th style="text-align: right;">id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Michel</td>
<td style="text-align: left;">Rappaz</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hilal</td>
<td style="text-align: left;">Lashuel</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jeffrey</td>
<td style="text-align: left;">Huang</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pierre</td>
<td style="text-align: left;">Magistretti</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paolo</td>
<td style="text-align: left;">Ienne</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Frédéric</td>
<td style="text-align: left;">Kaplan</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Olivier</td>
<td style="text-align: left;">Hari</td>
<td style="text-align: left;">UNE</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Christian</td>
<td style="text-align: left;">Hesse</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majed</td>
<td style="text-align: left;">Chergui</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Douglas</td>
<td style="text-align: left;">Hanahan</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Well done. As you can see, PostgreSQL has automatically numbered the rows with the <code>id</code> column, which now functions as a (surrogate) primary key – it uniquely identifies professors.</p>
</section>
<section id="concatenate-columns-to-a-surrogate-key" class="level2">
<h2 class="anchored" data-anchor-id="concatenate-columns-to-a-surrogate-key">CONCATenate columns to a surrogate key</h2>
<p>Another strategy to add a surrogate key to an existing table is to concatenate existing columns with the <code>CONCAT()</code> function.</p>
<p>Let’s think of the following example table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> cars (</span>
<span id="cb69-2"><a href="#cb69-2"></a> make <span class="dt">varchar</span>(<span class="dv">64</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb69-3"><a href="#cb69-3"></a> model <span class="dt">varchar</span>(<span class="dv">64</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb69-4"><a href="#cb69-4"></a> mpg <span class="dt">integer</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb69-5"><a href="#cb69-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The table is populated with <strong>10</strong> rows of <em>completely fictional</em> data.</p>
<p>Unfortunately, the table doesn’t have a primary key yet. None of the columns consists of only unique values, so some columns can be combined to form a key.</p>
<p>In the course of the following exercises, you will combine <code>make</code> and <code>model</code> into such a surrogate key.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the number of distinct rows with a combination of the <code>make</code> and <code>model</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb70-1"><a href="#cb70-1"></a><span class="co">-- Count the number of distinct rows with columns make, model</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span>(make, model)) </span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="kw">FROM</span> cars;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Add a new column <code>id</code> with the data type <code>varchar(128)</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb71-1"><a href="#cb71-1"></a><span class="co">-- Count the number of distinct rows with columns make, model</span></span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span>(make, model)) </span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="kw">FROM</span> cars;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb72-1"><a href="#cb72-1"></a><span class="co">-- Add the id column</span></span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> cars</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="kw">ADD</span> <span class="kw">COLUMN</span> <span class="kw">id</span> <span class="dt">varchar</span>(<span class="dv">128</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Concatenate <code>make</code> and <code>model</code> into <code>id</code> using an <code>UPDATE table_name SET column_name = ...</code> query and the <code>CONCAT()</code> function.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb73-1"><a href="#cb73-1"></a><span class="co">-- Update id with make + model</span></span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="kw">UPDATE</span> cars</span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="kw">SET</span> <span class="kw">id</span> <span class="op">=</span> <span class="fu">CONCAT</span>(make, model);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Make <code>id</code> a primary key and name it <code>id_pk</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb74-1"><a href="#cb74-1"></a><span class="co">-- Make id a primary key</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> cars</span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> id_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb75-1"><a href="#cb75-1"></a><span class="co">-- Have a look at the table</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> cars;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">make</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">mpg</th>
<th style="text-align: left;">id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subaru</td>
<td style="text-align: left;">Forester</td>
<td style="text-align: right;">24</td>
<td style="text-align: left;">SubaruForester</td>
</tr>
<tr class="even">
<td style="text-align: left;">Opel</td>
<td style="text-align: left;">Astra</td>
<td style="text-align: right;">45</td>
<td style="text-align: left;">OpelAstra</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Opel</td>
<td style="text-align: left;">Vectra</td>
<td style="text-align: right;">40</td>
<td style="text-align: left;">OpelVectra</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ford</td>
<td style="text-align: left;">Avenger</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">FordAvenger</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ford</td>
<td style="text-align: left;">Galaxy</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">FordGalaxy</td>
</tr>
<tr class="even">
<td style="text-align: left;">Toyota</td>
<td style="text-align: left;">Prius</td>
<td style="text-align: right;">50</td>
<td style="text-align: left;">ToyotaPrius</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Toyota</td>
<td style="text-align: left;">Speedster</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">ToyotaSpeedster</td>
</tr>
<tr class="even">
<td style="text-align: left;">Toyota</td>
<td style="text-align: left;">Galaxy</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">ToyotaGalaxy</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mitsubishi</td>
<td style="text-align: left;">Forester</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">MitsubishiForester</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mitsubishi</td>
<td style="text-align: left;">Galaxy</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">MitsubishiGalaxy</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Good job! These were quite some steps, but you’ve managed! Let’s look into another method of adding a surrogate key now.</p>
</section>
<section id="test-your-knowledge-before-advancing" class="level2">
<h2 class="anchored" data-anchor-id="test-your-knowledge-before-advancing">Test your knowledge before advancing</h2>
<p>Before you move on to the next chapter, let’s quickly review what you’ve learned so far about attributes and key constraints. If you’re unsure about the answer, please quickly review chapters 2 and 3, respectively.</p>
<p>Let’s think of an entity type “student”. A student has:</p>
<ul>
<li>a <strong>last name</strong> consisting of <em>up to 128</em> characters (required),</li>
<li>a unique <strong>social security number</strong>, consisting only of integers, that should serve as a key,</li>
<li>a <strong>phone number</strong> of <em>fixed length 12</em>, consisting of numbers and characters (but some students don’t have one). <strong>Steps</strong></li>
</ul>
<ol type="1">
<li>Given the above description of a student entity, create a table <code>students</code> with the correct column types.</li>
<li>Add a <code>PRIMARY KEY</code> for the social security number <code>ssn</code>.</li>
</ol>
<p><em>Note that there is no formal length requirement for the integer column. The application would have to make sure it’s a correct SSN!</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb76-1"><a href="#cb76-1"></a><span class="co">-- Create the table</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> students (</span>
<span id="cb76-3"><a href="#cb76-3"></a>  last_name <span class="dt">varchar</span>(<span class="dv">128</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb76-4"><a href="#cb76-4"></a>  ssn <span class="dt">integer</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb76-5"><a href="#cb76-5"></a>  phone_no <span class="dt">char</span>(<span class="dv">12</span>)</span>
<span id="cb76-6"><a href="#cb76-6"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Looks like you are ready for the last chapter of this course, where you\’ll connect tables in your database.</p>
</section>
</section>
<section id="glue-together-tables-with-foreign-keys" class="level1">
<h1>4. Glue together tables with foreign keys</h1>
<p>In the final chapter, you’ll leverage foreign keys to connect tables and establish relationships that will greatly benefit your data quality. And you’ll run ad hoc analyses on your new database.</p>
<section id="model-1n-relationships-with-foreign-keys" class="level2">
<h2 class="anchored" data-anchor-id="model-1n-relationships-with-foreign-keys">Model 1:N relationships with foreign keys</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Model 1:N relationships with foreign keys</strong></p>
<p>Welcome to the last chapter of this course. Now it’s time to make use of key constraints.</p>
<p><strong>2. The current database model</strong></p>
<p>Here’s your current database model. The three entity types “professors”, “organizations”, and “universities” all have primary keys – but “affiliations” doesn’t, for a specific reason that will be revealed in this chapter.</p>
<p><strong>3. The next database model</strong></p>
<p>Next up, you’ll model a so-called relationship type between “professors” and “universities”. As you know, in your database, each professor works for a university. In the ER diagram, this is drawn with a rhombus. The small numbers specify the cardinality of the relationship: a professor works for at most one university, while a university can have any number of professors working for it – even zero.</p>
<p><strong>4. Implementing relationships with foreign keys</strong></p>
<p>Such relationships are implemented with foreign keys. Foreign keys are designated columns that point to a primary key of another table. There are some restrictions for foreign keys. First, the domain and the data type must be the same as one of the primary key. Secondly, only foreign key values are allowed that exist as values in the primary key of the referenced table. This is the actual foreign key constraint, also called “referential integrity”. You’ll dig into referential integrity at the end of this chapter. Lastly, a foreign key is not necessarily an actual key, because duplicates and “NULL” values are allowed. Let’s have a look at your database.</p>
<p><strong>5. A query</strong></p>
<p>As you can see, the column “university_shortname” of “professors” has the same domain as the “id” column of the “universities” table. If you go through each record of “professors”, you can always find the respective “id” in the “universities” table. So both criteria for a foreign key in the table “professors” referencing “universities” are fulfilled. Also, you see that “university_shortname” is not really a key because there are duplicates. For example, the id “EPF” and “UBE” occur three times each.</p>
<p><strong>6. Specifying foreign keys</strong></p>
<p>When you create a new table, you can specify a foreign key similarly to a primary key. Let’s look at two example tables. First, we create a “manufacturers” table with a primary key called “name”. Then we create a table “cars”, that also has a primary key, called “model”. As each car is produced by a certain manufacturer, it makes sense to also add a foreign key to this table. We do that by writing the “REFERENCES” keyword, followed by the referenced table and its primary key in brackets. From now on, only cars with valid and existing manufacturers may be entered into that table. Trying to enter models with manufacturers that are not yet stored in the “manufacturers” table won’t be possible, thanks to the foreign key constraint.</p>
<p><strong>7. Specifying foreign keys to existing tables</strong></p>
<p>Again, the syntax for adding foreign keys to existing tables is the same as the one for adding primary keys and unique constraints.</p>
<p><strong>8. Let’s implement this!</strong></p>
<p>Okay, let’s have a look at your database and implement a simple relationship between “professors” and “universities”.</p>
</section>
<section id="reference-a-table-with-a-foreign-key" class="level2">
<h2 class="anchored" data-anchor-id="reference-a-table-with-a-foreign-key">REFERENCE a table with a FOREIGN KEY</h2>
<p>In your database, you want the <code>professors</code> table to reference the <code>universities</code> table. You can do that by specifying a column in <code>professors</code> table that references a column in the <code>universities</code> table.</p>
<p>As just shown in the video, the syntax for that looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb77-1"><a href="#cb77-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> a </span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> a_fkey <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (b_id) <span class="kw">REFERENCES</span> b (<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Table <code>a</code> should now refer to table <code>b</code>, via <code>b_id</code>, which points to <code>id</code>. <code>a_fkey</code> is, as usual, a constraint name you can choose on your own.</p>
<p>Pay attention to the <strong>naming convention</strong> employed here: Usually, a foreign key referencing another primary key with name <code>id</code> is named <code>x_id</code>, where <code>x</code> is the name of the referencing table in the singular form.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Rename the <code>university_shortname</code> column to <code>university_id</code> in <code>professors</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb78-1"><a href="#cb78-1"></a><span class="co">-- Rename the university_shortname column</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors</span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="kw">RENAME</span> <span class="kw">COLUMN</span> university_shortname <span class="kw">TO</span> university_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Add a foreign key on <code>university_id</code> column in <code>professors</code> that references the <code>id</code> column in <code>universities</code>.</li>
<li>Name this foreign key <code>professors_fkey</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb79-1"><a href="#cb79-1"></a><span class="co">-- Add a foreign key on professors referencing universities</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> professors </span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> professors_fkey <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (university_id) <span class="kw">REFERENCES</span> universities (<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect! Now, the <code>professors</code> table has a link to the <code>universities</code> table. Each professor belongs to exactly one university.</p>
</section>
<section id="explore-foreign-key-constraints" class="level2">
<h2 class="anchored" data-anchor-id="explore-foreign-key-constraints">Explore foreign key constraints</h2>
<p>Foreign key constraints help you to keep order in your database mini-world. In your database, for instance, only professors belonging to Swiss universities should be allowed, as only Swiss universities are part of the <code>universities</code> table.</p>
<p>The foreign key on <code>professors</code> referencing <code>universities</code> you just created thus makes sure that only existing universities can be specified when inserting new data. Let’s test this!</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Run the sample code and have a look at the error message.</li>
<li>What’s wrong? Correct the <code>university_id</code> so that it actually reflects where Albert Einstein wrote his dissertation and became a professor – at the University of Zurich (UZH)!</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb80-1"><a href="#cb80-1"></a><span class="co">-- Try to insert a new professor</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> professors (firstname, lastname, university_id)</span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="kw">VALUES</span> (<span class="st">'Albert'</span>, <span class="st">'Einstein'</span>, <span class="st">'MIT'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: Failed to fetch row: ERROR:  insert or update on table "professors" violates foreign key constraint "professors_fkey"
DETAIL:  Key (university_id)=(MIT) is not present in table "universities".</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb82-1"><a href="#cb82-1"></a><span class="co">-- Try to insert a new professor</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> professors (firstname, lastname, university_id)</span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="kw">VALUES</span> (<span class="st">'Albert'</span>, <span class="st">'Einstein'</span>, <span class="st">'UZH'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! As you can see, inserting a professor with non-existing university IDs violates the foreign key constraint you\’ve just added. This also makes sure that all universities are spelled equally – adding to data consistency.</p>
</section>
<section id="join-tables-linked-by-a-foreign-key" class="level2">
<h2 class="anchored" data-anchor-id="join-tables-linked-by-a-foreign-key">JOIN tables linked by a foreign key</h2>
<p>Let’s join these two tables to analyze the data further!</p>
<p>You might already know how SQL joins work from the <a href="https://www.datacamp.com/courses/intro-to-sql-for-data-science">Intro to SQL for Data Science</a> course (last exercise) or from <a href="https://www.datacamp.com/courses/joining-data-in-postgresql">Joining Data in PostgreSQL</a>.</p>
<p>Here’s a quick recap on how joins generally work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb83-1"><a href="#cb83-1"></a><span class="kw">SELECT</span> <span class="op">..</span>.</span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="kw">FROM</span> table_a</span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="kw">JOIN</span> table_b</span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="kw">ON</span> <span class="op">..</span>.</span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="kw">WHERE</span> <span class="op">..</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While foreign keys and primary keys are not strictly necessary for join queries, they greatly help by telling you what to expect. For instance, you can be sure that records referenced from table A will always be present in table B – so a join from table A will always find something in table B. If not, the foreign key constraint would be violated.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><code>JOIN</code> <code>professors</code> with <code>universities</code> on <code>professors.university_id = universities.id</code>, i.e., retain all records where the foreign key of <code>professors</code> is equal to the primary key of <code>universities</code>.</li>
<li>Filter for <code>university_city = 'Zurich'</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb84-1"><a href="#cb84-1"></a><span class="co">-- Select all professors working for universities in the city of Zurich</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="kw">SELECT</span> professors.lastname, universities.<span class="kw">id</span>, universities.university_city</span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="kw">FROM</span> professors</span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="kw">JOIN</span> universities</span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="kw">ON</span> professors.university_id <span class="op">=</span> universities.<span class="kw">id</span></span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="kw">WHERE</span> universities.university_city <span class="op">=</span> <span class="st">'Zurich'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">id</th>
<th style="text-align: left;">university_city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grote</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: left;">Carreira</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wennemers</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hafen</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Saar</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: left;">Loeliger</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Schönsleben</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bühler</td>
<td style="text-align: left;">UZH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hellweg</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gugerli</td>
<td style="text-align: left;">UZH</td>
<td style="text-align: left;">Zurich</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>That’s a long query! First, the university belonging to each professor was attached with the <code>JOIN</code> operation. Then, only professors having \“Zurich\”” as university city were retained with the <code>WHERE</code> clause.</p>
</section>
<section id="model-more-complex-relationships" class="level2">
<h2 class="anchored" data-anchor-id="model-more-complex-relationships">Model more complex relationships</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Model more complex relationships</strong></p>
<p>In the last few exercises, you made your first steps in modeling and implementing 1:N-relationships. Now it’s time to look at more complex relationships between tables.</p>
<p><strong>2. The current database model</strong></p>
<p>So you’ve added a 1:N-relationship between professors and universities. Such relationships have to be implemented with one foreign key in the table that has at most one foreign entity associated. In this case, that’s the “professors” table, as professors cannot have more than one university associated. Now, what about affiliations? We know that a professor can have more than one affiliation with organizations, for instance, as a chairman of a bank and as a president of a golf club. On the other hand, organizations can also have more than one professor connected to them. Let’s look at the entity-relationship diagram that models this.</p>
<p><strong>3. The final database model</strong></p>
<p>There are a couple of things that are new. First of all, a new relationship between organizations and professors was added. This is an N:M relationship, not an 1:N relationship as with professors and universities. This depicts the fact that a professor can be affiliated with more than one organization and vice versa. Also, it has an own attribute, the function. Remember that each affiliation comes with a function, for instance, “chairman”. The second thing you’ll notice is that the affiliations entity type disappeared altogether. For clarity, I still included it in the diagram, but it’s no longer needed. However, you’ll still have four tables: Three for the entities “professors”, “universities” and “organizations”, and one for the N:M-relationship between “professors” and “organizations”.</p>
<p><strong>4. How to implement N:M-relationships</strong></p>
<p>Such a relationship is implemented with an ordinary database table that contains two foreign keys that point to both connected entities. In this case, that’s a foreign key pointing to the “professors.id” column, and one pointing to the “organizations.id” column. Also, additional attributes, in this case “function”, need to be included. If you were to create that relationship table from scratch, you would define it as shown. Note that “professor_id” is stored as “integer”, as the primary key it refers to has the type “serial”, which is also an integer. On the other hand, “organization_id” has “varchar(256)” as type, conforming to the primary key in the “organizations” table. One last thing: Notice that no primary key is defined here because a professor can theoretically have multiple functions in one organization. One could define the combination of all three attributes as the primary key in order to have some form of unique constraint in that table, but that would be a bit over the top.</p>
<p><strong>5. Time to implement this!</strong></p>
<p>Since you already have a pre-populated affiliations table, things are not going to be so straightforward. You’ll need to link and migrate the data to a new table to implement this relationship. This will be the goal of the following exercises.</p>
</section>
<section id="add-foreign-keys-to-the-affiliations-table" class="level2">
<h2 class="anchored" data-anchor-id="add-foreign-keys-to-the-affiliations-table">Add foreign keys to the “affiliations” table</h2>
<p>At the moment, the <code>affiliations</code> table has the structure {<code>firstname</code>, <code>lastname</code>, <code>function</code>, <code>organization</code>}, as you can see in the preview at the bottom right. In the next three exercises, you’re going to turn this table into the form {<code>professor_id</code>, <code>organization_id</code>, <code>function</code>}, with <code>professor_id</code> and <code>organization_id</code> being foreign keys that point to the respective tables.</p>
<p>You’re going to transform the <code>affiliations</code> table <em>in-place</em>, i.e., without creating a temporary table to cache your intermediate results.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a <code>professor_id</code> column with <code>integer</code> data type to <code>affiliations</code>, and declare it to be a foreign key that references the <code>id</code> column in <code>professors</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb85-1"><a href="#cb85-1"></a><span class="co">-- Add a professor_id column</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="kw">ADD</span> <span class="kw">COLUMN</span> professor_id <span class="dt">integer</span> <span class="kw">REFERENCES</span> professors (<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Rename the <code>organization</code> column in <code>affiliations</code> to <code>organization_id</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb86-1"><a href="#cb86-1"></a><span class="co">-- Rename the organization column to organization_id</span></span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="kw">RENAME</span> <span class="kw">organization</span> <span class="kw">TO</span> organization_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Add a foreign key constraint on <code>organization_id</code> so that it references the <code>id</code> column in <code>organizations</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb87-1"><a href="#cb87-1"></a><span class="co">-- Add a foreign key on organization_id</span></span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb87-3"><a href="#cb87-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> affiliations_organization_fkey <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (organization_id) <span class="kw">REFERENCES</span> organizations (<span class="kw">id</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect! Making <code>organization_id</code> a foreign key worked flawlessly because these organizations actually exist in the <code>organizations</code> table. That was only the first part, though. Now it\’s time to update <code>professor_id</code> in <code>affiliations</code> – so that it correctly refers to the corresponding professors.</p>
</section>
<section id="populate-the-professor_id-column" class="level2">
<h2 class="anchored" data-anchor-id="populate-the-professor_id-column">Populate the “professor_id” column</h2>
<p>Now it’s time to also populate <code>professors_id</code>. You’ll take the ID directly from <code>professors</code>.</p>
<p>Here’s a way to update columns of a table based on values in another table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb88-1"><a href="#cb88-1"></a><span class="kw">UPDATE</span> table_a</span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="kw">SET</span> column_to_update <span class="op">=</span> table_b.column_to_update_from</span>
<span id="cb88-3"><a href="#cb88-3"></a><span class="kw">FROM</span> table_b</span>
<span id="cb88-4"><a href="#cb88-4"></a><span class="kw">WHERE</span> condition1 <span class="kw">AND</span> condition2 <span class="kw">AND</span> <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This query does the following:</p>
<ol type="1">
<li>For each row in table_a, find the corresponding row in table_b where condition1, condition2, etc., are met.</li>
<li>Set the value of column_to_update to the value of column_to_update_from (from that corresponding row).</li>
</ol>
<p>The conditions usually compare other columns of both tables, e.g.&nbsp;<code>table_a.some_column = table_b.some_column</code>. Of course, this query only makes sense if there is only <em>one</em> matching row in <code>table_b</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>First, have a look at the current state of <code>affiliations</code> by fetching 10 rows and all columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb89-1"><a href="#cb89-1"></a><span class="co">-- Have a look at the 10 first rows of affiliations</span></span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb89-3"><a href="#cb89-3"></a><span class="kw">FROM</span> affiliations </span>
<span id="cb89-4"><a href="#cb89-4"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 35%">
<col style="width: 35%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">function</th>
<th style="text-align: left;">organization_id</th>
<th style="text-align: right;">professor_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dimos</td>
<td style="text-align: left;">Poulikakos</td>
<td style="text-align: left;">VR-Mandat</td>
<td style="text-align: left;">Scrona AG</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Francesco</td>
<td style="text-align: left;">Stellacci</td>
<td style="text-align: left;">Co-editor in Chief, Nanoscale</td>
<td style="text-align: left;">Royal Chemistry Society, UK</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alexander</td>
<td style="text-align: left;">Fust</td>
<td style="text-align: left;">Fachexperte und Coach für Designer Startups</td>
<td style="text-align: left;">Creative Hub</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jürgen</td>
<td style="text-align: left;">Brugger</td>
<td style="text-align: left;">Proposal reviewing HEPIA</td>
<td style="text-align: left;">HES Campus Biotech, Genève</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hervé</td>
<td style="text-align: left;">Bourlard</td>
<td style="text-align: left;">Director</td>
<td style="text-align: left;">Idiap Research Institute</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ioannis</td>
<td style="text-align: left;">Papadopoulos</td>
<td style="text-align: left;">Mandat</td>
<td style="text-align: left;">Schweizerischer Nationalfonds (SNF)</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Olaf</td>
<td style="text-align: left;">Blanke</td>
<td style="text-align: left;">Professeur à 20%</td>
<td style="text-align: left;">Université de Genève</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leo</td>
<td style="text-align: left;">Staub</td>
<td style="text-align: left;">Präsident Verwaltungsrat</td>
<td style="text-align: left;">Genossenschaft Migros Ostschweiz</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pascal</td>
<td style="text-align: left;">Pichonnaz</td>
<td style="text-align: left;">Vize-Präsident</td>
<td style="text-align: left;">EKK (Eidgenössische Konsumenten Kommission)</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dietmar</td>
<td style="text-align: left;">Grichnik</td>
<td style="text-align: left;">Präsident</td>
<td style="text-align: left;">Swiss Startup Monitor Stiftung</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Update the <code>professor_id</code> column with the corresponding value of the <code>id</code> column in <code>professors</code>.</li>
</ol>
<p><em>“Corresponding” means rows in <code>professors</code> where the <code>firstname</code> and <code>lastname</code> are identical to the ones in <code>affiliations</code>.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb90-1"><a href="#cb90-1"></a><span class="co">-- Update professor_id to professors.id where firstname, lastname correspond to rows in professors</span></span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="kw">UPDATE</span> affiliations</span>
<span id="cb90-3"><a href="#cb90-3"></a><span class="kw">SET</span> professor_id <span class="op">=</span> professors.<span class="kw">id</span></span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="kw">FROM</span> professors</span>
<span id="cb90-5"><a href="#cb90-5"></a><span class="kw">WHERE</span> affiliations.firstname <span class="op">=</span> professors.firstname <span class="kw">AND</span> affiliations.lastname <span class="op">=</span> professors.lastname;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Check out the first 10 rows and all columns of <code>affiliations</code> again. Have the <code>professor_id</code>s been correctly matched?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb91-1"><a href="#cb91-1"></a><span class="co">-- Have a look at the 10 first rows of affiliations again</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="kw">FROM</span> affiliations </span>
<span id="cb91-4"><a href="#cb91-4"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 38%">
<col style="width: 32%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">function</th>
<th style="text-align: left;">organization_id</th>
<th style="text-align: right;">professor_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Françoise Gisou van der</td>
<td style="text-align: left;">Goot Grunberg</td>
<td style="text-align: left;">Conseil de fondation et Conseil Scientifique de la Fondation Jeantet</td>
<td style="text-align: left;">Fondation Jeantet, Genève</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Walter Hans Jakob</td>
<td style="text-align: left;">Kaufmann</td>
<td style="text-align: left;">VR-Mandat</td>
<td style="text-align: left;">dsp Ingenieure &amp; Planer AG</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jérôme Jean-Constant</td>
<td style="text-align: left;">Faist</td>
<td style="text-align: left;">VR-Mandat</td>
<td style="text-align: left;">Alpes Lasers S.A.</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Johan Olof Anders</td>
<td style="text-align: left;">Robertsson</td>
<td style="text-align: left;">Geschäftsführer</td>
<td style="text-align: left;">Robertsson Industrial Geoscience Innovation GmbH</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Françoise Gisou van der</td>
<td style="text-align: left;">Goot Grunberg</td>
<td style="text-align: left;">EMBO YIP (Young Investigator Program) committee</td>
<td style="text-align: left;">EMBO, Heidelberg</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alain</td>
<td style="text-align: left;">Wegmann</td>
<td style="text-align: left;">Conseil informatique</td>
<td style="text-align: left;">TAG Aviation, Genève</td>
<td style="text-align: right;">462</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Françoise Gisou van der</td>
<td style="text-align: left;">Goot Grunberg</td>
<td style="text-align: left;">Conseil Suisse de la Science et de l’Innovation</td>
<td style="text-align: left;">CSSI Bern</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Françoise Gisou van der</td>
<td style="text-align: left;">Goot Grunberg</td>
<td style="text-align: left;">Diverses commissions du SNF</td>
<td style="text-align: left;">SNF Bern</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Françoise Gisou van der</td>
<td style="text-align: left;">Goot Grunberg</td>
<td style="text-align: left;">Scientific Advisory Board Clinical Research Department</td>
<td style="text-align: left;">Univ Bern</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jérôme Jean-Constant</td>
<td style="text-align: left;">Faist</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Centre Suisse d’Electronique et de Microtechnique (CSEM)</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Wow, that was a thing! As you can see, the correct <code>professors.id</code> has been inserted into <code>professor_id</code> for each record, thanks to the matching <code>firstname</code> and <code>lastname</code> in both tables.</p>
</section>
<section id="drop-firstname-and-lastname" class="level2">
<h2 class="anchored" data-anchor-id="drop-firstname-and-lastname">Drop “firstname” and “lastname”</h2>
<p>The <code>firstname</code> and <code>lastname</code> columns of <code>affiliations</code> were used to establish a link to the <code>professors</code> table in the last exercise – so the appropriate professor IDs could be copied over. This only worked because there is exactly one corresponding professor for each row in <code>affiliations</code>. In other words: {<code>firstname</code>, <code>lastname</code>} is a candidate key of <code>professors</code> – a unique combination of columns.</p>
<p>It isn’t one in <code>affiliations</code> though, because, as said in the video, professors can have more than one affiliation.</p>
<p>Because <code>professors</code> are referenced by <code>professor_id</code> now, the <code>firstname</code> and <code>lastname</code> columns are no longer needed, so it’s time to drop them. After all, one of the goals of a database is to reduce redundancy where possible.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Drop the <code>firstname</code> and <code>lastname</code> columns from the <code>affiliations</code> table.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb92-1"><a href="#cb92-1"></a><span class="co">-- Drop the firstname column</span></span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb92-3"><a href="#cb92-3"></a><span class="kw">DROP</span> <span class="kw">COLUMN</span> firstname;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb93-1"><a href="#cb93-1"></a><span class="co">-- Drop the lastname column</span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="kw">DROP</span> <span class="kw">COLUMN</span> lastname;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Good job! Now the <code>affiliations</code> table that models the N:M-relationship between <code>professors</code> and <code>organizations</code> is finally complete.</p>
</section>
<section id="referential-integrity" class="level2">
<h2 class="anchored" data-anchor-id="referential-integrity">Referential integrity</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Referential integrity</strong></p>
<p>We’ll now talk about one of the most important concepts in database systems: referential integrity. It’s a very simple concept…</p>
<p><strong>2. Referential integrity</strong></p>
<p>…that states that a record referencing another record in another table must always refer to an existing record. In other words: A record in table A cannot point to a record in table B that does not exist. Referential integrity is a constraint that always concerns two tables, and is enforced through foreign keys, as you’ve seen in the previous lessons of this chapter. So if you define a foreign key in the table “professors” referencing the table “universities”, referential integrity is held from “professors” to “universities”.</p>
<p><strong>3. Referential integrity violations</strong></p>
<p>Referential integrity can be violated in two ways. Let’s say table A references table B. So if a record in table B that is already referenced from table A is deleted, you have a violation. On the other hand, if you try to insert a record in table A that refers to something that does not exist in table B, you also violate the principle. And that’s the main reason for foreign keys – they will throw errors and stop you from accidentally doing these things.</p>
<p><strong>4. Dealing with violations</strong></p>
<p>However, throwing an error is not the only option. If you specify a foreign key on a column, you can actually tell the database system what should happen if an entry in the referenced table is deleted. By default, the “ON DELETE NO ACTION” keyword is automatically appended to a foreign key definition, like in the example here. This means that if you try to delete a record in table B which is referenced from table A, the system will throw an error. However, there are other options. For example, there’s the “CASCADE” option, which will first allow the deletion of the record in table B, and then will automatically delete all referencing records in table A. So that deletion is cascaded.</p>
<p><strong>5. Dealing with violations, contd.</strong></p>
<p>There are even more options. The “RESTRICT” option is almost identical to the “NO ACTION” option. The differences are technical and beyond the scope of this course. More interesting is the “SET NULL” option. It will set the value of the foreign key for this record to “NULL”. The “SET DEFAULT” option only works if you have specified a default value for a column. It automatically changes the referencing column to a certain default value if the referenced record is deleted. Setting default values is also beyond the scope of this course, but this option is still good to know.</p>
<p><strong>6. Let’s look at some examples!</strong></p>
<p>Let’s practice this a bit and change the referential integrity behavior of your database.</p>
</section>
<section id="referential-integrity-violations" class="level2">
<h2 class="anchored" data-anchor-id="referential-integrity-violations">Referential integrity violations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb94-1"><a href="#cb94-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> universities <span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> <span class="st">'EPF'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: Failed to fetch row: ERROR:  update or delete on table "universities" violates foreign key constraint "professors_fkey" on table "professors"
DETAIL:  Key (id)=(EPF) is still referenced from table "professors".</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h2 id="question-5" class="anchored"><em>Question</em></h2>
<p>Given the current state of your database, what happens if you execute the following SQL statement?<br> <br> ⬜ It throws an error because the university with ID “EPF” does not exist.<br> ⬜ The university with ID “EPF” is deleted.<br> ⬜ It fails because referential integrity from <code>universities</code> to <code>professors</code> is violated.<br> ✅ It fails because referential integrity from <code>professors</code> to <code>universities</code> is violated.<br></p>
</blockquote>
<p>Correct! You defined a foreign key on <code>professors.university_id</code> that references <code>universities.id</code>, so referential integrity is said to hold from <code>professors</code> to <code>universities</code>.</p>
</section>
<section id="change-the-referential-integrity-behavior-of-a-key" class="level2">
<h2 class="anchored" data-anchor-id="change-the-referential-integrity-behavior-of-a-key">Change the referential integrity behavior of a key</h2>
<p>So far, you implemented three foreign key constraints:</p>
<ol type="1">
<li><code>professors.university_id</code> to <code>universities.id</code></li>
<li><code>affiliations.organization_id</code> to <code>organizations.id</code></li>
<li><code>affiliations.professor_id</code> to <code>professors.id</code></li>
</ol>
<p>These foreign keys currently have the behavior <code>ON DELETE NO ACTION</code>. Here, you’re going to change that behavior for the column referencing <code>organizations</code> from <code>affiliations</code>. If an organization is deleted, all its affiliations (by any professor) should also be deleted.</p>
<p>Altering a key constraint doesn’t work with <code>ALTER COLUMN</code>. Instead, you have to <strong><code>DROP</code> the key constraint</strong> and then <strong><code>ADD</code> a new one</strong> with a different <code>ON DELETE</code> behavior.</p>
<p>For deleting constraints, though, you need to know their name. This information is also stored in <code>information_schema</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Have a look at the existing foreign key constraints by querying <code>table_constraints</code> in <code>information_schema</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb96-1"><a href="#cb96-1"></a><span class="co">-- Identify the correct constraint name</span></span>
<span id="cb96-2"><a href="#cb96-2"></a><span class="kw">SELECT</span> constraint_name, table_name, constraint_type</span>
<span id="cb96-3"><a href="#cb96-3"></a><span class="kw">FROM</span> information_schema.table_constraints</span>
<span id="cb96-4"><a href="#cb96-4"></a><span class="kw">WHERE</span> constraint_type <span class="op">=</span> <span class="st">'FOREIGN KEY'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">constraint_name</th>
<th style="text-align: left;">table_name</th>
<th style="text-align: left;">constraint_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">professors_fkey</td>
<td style="text-align: left;">professors</td>
<td style="text-align: left;">FOREIGN KEY</td>
</tr>
<tr class="even">
<td style="text-align: left;">affiliations_professor_id_fkey</td>
<td style="text-align: left;">affiliations</td>
<td style="text-align: left;">FOREIGN KEY</td>
</tr>
<tr class="odd">
<td style="text-align: left;">affiliations_organization_fkey</td>
<td style="text-align: left;">affiliations</td>
<td style="text-align: left;">FOREIGN KEY</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Delete the <code>affiliations_organization_fkey</code> foreign key constraint in <code>affiliations</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb97-1"><a href="#cb97-1"></a><span class="co">-- Drop the right foreign key constraint</span></span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb97-3"><a href="#cb97-3"></a><span class="kw">DROP</span> <span class="kw">CONSTRAINT</span> affiliations_organization_fkey;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Add a new foreign key to <code>affiliations</code> that <code>CASCADE</code>s deletion if a referenced record is deleted from <code>organizations</code>. Name it <code>affiliations_organization_id_fkey</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb98-1"><a href="#cb98-1"></a><span class="co">-- Add a new foreign key constraint from affiliations to organizations which cascades deletion</span></span>
<span id="cb98-2"><a href="#cb98-2"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> affiliations</span>
<span id="cb98-3"><a href="#cb98-3"></a><span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> affiliations_organization_id_fkey <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (organization_id) <span class="kw">REFERENCES</span> organizations (<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Run the <code>DELETE</code> and <code>SELECT</code> queries to double check that the deletion cascade actually works.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb99-1"><a href="#cb99-1"></a><span class="co">-- Delete an organization </span></span>
<span id="cb99-2"><a href="#cb99-2"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> organizations </span>
<span id="cb99-3"><a href="#cb99-3"></a><span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> <span class="st">'CUREM'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb100-1"><a href="#cb100-1"></a><span class="co">-- Check that no more affiliations with this organization exist</span></span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> affiliations</span>
<span id="cb100-3"><a href="#cb100-3"></a><span class="kw">WHERE</span> organization_id <span class="op">=</span> <span class="st">'CUREM'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table>
<caption>0 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">function</th>
<th style="text-align: left;">organization_id</th>
<th style="text-align: right;">professor_id</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<p>Good job. As you can see, whenever an organization referenced by an affiliation is deleted, the affiliations also gets deleted. It is your job as database designer to judge whether this is a sensible configuration. Sometimes, setting values to <code>NULL</code> or to restrict deletion altogether might make more sense!</p>
</section>
<section id="roundup" class="level2">
<h2 class="anchored" data-anchor-id="roundup">Roundup</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Roundup</strong></p>
<p>Congratulations, you’re almost done. Let’s quickly revise what you’ve done throughout this course.</p>
<p><strong>2. How you’ve transformed the database</strong></p>
<p>You started with a simple table with a lot of redundancy. You might be used to such tables when working with flat files like CSVs or Excel files. Throughout the course, you transformed it step by step into the database schema on the right – only by executing SQL queries. You’ve defined column data types, added primary keys and foreign keys, and through that, specified relationships between tables. All these measures will guarantee better data consistency and therefore quality. This is especially helpful if you add new data to the database but also makes analyzing the data easier.</p>
<p><strong>3. The database ecosystem</strong></p>
<p>To go further from here, it’s useful to look at the bigger picture for a minute. In this course, you’ve transformed a database. You did that with PostgreSQL, which is also called a “Database Management System”, or DBMS. The DBMS and one or more databases together form the “Database System”. The DBMS exposes a query interface where you can run ad-hoc analyses and queries with SQL. However, you can also access this interface through other client applications. You could, for example, program a Python script that connects to the database, loads data from it, and visualizes it.</p>
<p><strong>4. The database ecosystem</strong></p>
<p>In the remainder of this course, you’ll no longer manipulate data in your database system, but employ some analysis queries on your database. This will be a quick repetition of what you’ve learned in previous SQL courses such as “Intro to SQL for Data Science”, but it will also demonstrate the advantages of having a database instead of a flat file in the first place.</p>
<p><strong>5. Thank you!</strong></p>
<p>For me it’s time to say goodbye, thank you for taking this course, and I hope you will soon build your first relational database with the knowledge you’ve gained here.</p>
</section>
<section id="count-affiliations-per-university" class="level2">
<h2 class="anchored" data-anchor-id="count-affiliations-per-university">Count affiliations per university</h2>
<p>Now that your data is ready for analysis, let’s run some exemplary SQL queries on the database. You’ll now use already known concepts such as grouping by columns and joining tables.</p>
<p>In this exercise, you will find out which university has the most affiliations (through its professors). For that, you need both <code>affiliations</code> and <code>professors</code> tables, as the latter also holds the <code>university_id</code>.</p>
<p>As a quick repetition, remember that joins have the following structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb101-1"><a href="#cb101-1"></a><span class="kw">SELECT</span> table_a.column1, table_a.column2, table_b.column1, <span class="op">..</span>. </span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="kw">FROM</span> table_a</span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="kw">JOIN</span> table_b </span>
<span id="cb101-4"><a href="#cb101-4"></a><span class="kw">ON</span> table_a.<span class="kw">column</span> <span class="op">=</span> table_b.<span class="kw">column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This results in a combination of <code>table_a</code> and <code>table_b</code>, but only with rows where <code>table_a.column</code> is equal to <code>table_b.column</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the number of total affiliations by university.</li>
<li>Sort the result by that count, in descending order.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb102-1"><a href="#cb102-1"></a><span class="co">-- Count the total number of affiliations per university</span></span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>), professors.university_id </span>
<span id="cb102-3"><a href="#cb102-3"></a><span class="kw">FROM</span> affiliations</span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="kw">JOIN</span> professors</span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="kw">ON</span> affiliations.professor_id <span class="op">=</span> professors.<span class="kw">id</span></span>
<span id="cb102-6"><a href="#cb102-6"></a><span class="co">-- Group by the university ids of professors</span></span>
<span id="cb102-7"><a href="#cb102-7"></a><span class="kw">GROUP</span> <span class="kw">BY</span> professors.university_id </span>
<span id="cb102-8"><a href="#cb102-8"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">count</span> <span class="kw">DESC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
<th style="text-align: left;">university_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">572</td>
<td style="text-align: left;">EPF</td>
</tr>
<tr class="even">
<td style="text-align: right;">272</td>
<td style="text-align: left;">USG</td>
</tr>
<tr class="odd">
<td style="text-align: right;">162</td>
<td style="text-align: left;">UBE</td>
</tr>
<tr class="even">
<td style="text-align: right;">128</td>
<td style="text-align: left;">ETH</td>
</tr>
<tr class="odd">
<td style="text-align: right;">75</td>
<td style="text-align: left;">UBA</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: left;">UFR</td>
</tr>
<tr class="odd">
<td style="text-align: right;">36</td>
<td style="text-align: left;">UNE</td>
</tr>
<tr class="even">
<td style="text-align: right;">35</td>
<td style="text-align: left;">ULA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">33</td>
<td style="text-align: left;">UGE</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">UZH</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Very good. As you can see, the count of affiliations is completely different from university to university.</p>
</section>
<section id="join-all-the-tables-together" class="level2">
<h2 class="anchored" data-anchor-id="join-all-the-tables-together">Join all the tables together</h2>
<p>In this last exercise, your task is to <em>find the university city of the professor with the most affiliations in the sector “Media &amp; communication”</em>.</p>
<p>For this,</p>
<ul>
<li>you need to join all the tables,</li>
<li>group by some column,</li>
<li>and then use selection criteria to get only the rows in the correct sector. Let’s do this in three steps!</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Join all tables in the database (starting with <code>affiliations</code>, <code>professors</code>, <code>organizations</code>, and <code>universities</code>) and look at the result.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb103-1"><a href="#cb103-1"></a><span class="co">-- Join all tables</span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="kw">FROM</span> affiliations</span>
<span id="cb103-4"><a href="#cb103-4"></a><span class="kw">JOIN</span> professors</span>
<span id="cb103-5"><a href="#cb103-5"></a><span class="kw">ON</span> affiliations.professor_id <span class="op">=</span> professors.<span class="kw">id</span></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="kw">JOIN</span> organizations</span>
<span id="cb103-7"><a href="#cb103-7"></a><span class="kw">ON</span> affiliations.organization_id <span class="op">=</span> organizations.<span class="kw">id</span></span>
<span id="cb103-8"><a href="#cb103-8"></a><span class="kw">JOIN</span> universities</span>
<span id="cb103-9"><a href="#cb103-9"></a><span class="kw">ON</span> professors.university_id <span class="op">=</span> universities.<span class="kw">id</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 1%">
<col style="width: 17%">
<col style="width: 21%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">function</th>
<th style="text-align: left;">organization_id</th>
<th style="text-align: right;">professor_id</th>
<th style="text-align: left;">firstname</th>
<th style="text-align: left;">lastname</th>
<th style="text-align: left;">university_id</th>
<th style="text-align: right;">id</th>
<th style="text-align: left;">id..8</th>
<th style="text-align: left;">organization_sector</th>
<th style="text-align: left;">id..10</th>
<th style="text-align: left;">university</th>
<th style="text-align: left;">university_city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Conseil informatique</td>
<td style="text-align: left;">TAG Aviation, Genève</td>
<td style="text-align: right;">462</td>
<td style="text-align: left;">Alain</td>
<td style="text-align: left;">Wegmann</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">462</td>
<td style="text-align: left;">TAG Aviation, Genève</td>
<td style="text-align: left;">Energy, environment &amp; mobility</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: left;">ETH Lausanne</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">WHO, Geneva</td>
<td style="text-align: right;">534</td>
<td style="text-align: left;">Matthias</td>
<td style="text-align: left;">Egger</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">534</td>
<td style="text-align: left;">WHO, Geneva</td>
<td style="text-align: left;">Pharma &amp; health</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Securitas AG</td>
<td style="text-align: right;">242</td>
<td style="text-align: left;">Artur</td>
<td style="text-align: left;">Baldauf</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">242</td>
<td style="text-align: left;">Securitas AG</td>
<td style="text-align: left;">Politics, administration, justice system &amp; security sector</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Foundation of Talents</td>
<td style="text-align: right;">407</td>
<td style="text-align: left;">Achim</td>
<td style="text-align: left;">Conzelmann</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">407</td>
<td style="text-align: left;">Foundation of Talents</td>
<td style="text-align: left;">Society, Social, Culture &amp; Sports</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">PH Bern, Schulrat</td>
<td style="text-align: right;">407</td>
<td style="text-align: left;">Achim</td>
<td style="text-align: left;">Conzelmann</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">407</td>
<td style="text-align: left;">PH Bern, Schulrat</td>
<td style="text-align: left;">Education &amp; research</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Büro Vatter AG</td>
<td style="text-align: right;">386</td>
<td style="text-align: left;">Adrian</td>
<td style="text-align: left;">Vatter</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">386</td>
<td style="text-align: left;">Büro Vatter AG</td>
<td style="text-align: left;">Consulting, public relations, legal &amp; trust</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Curt Rommel Stiftung</td>
<td style="text-align: right;">344</td>
<td style="text-align: left;">Adriano</td>
<td style="text-align: left;">Marantelli</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">344</td>
<td style="text-align: left;">Curt Rommel Stiftung</td>
<td style="text-align: left;">Education &amp; research</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Vereinsvorstand BEWEST (Weiterbildungsverein)</td>
<td style="text-align: right;">344</td>
<td style="text-align: left;">Adriano</td>
<td style="text-align: left;">Marantelli</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">344</td>
<td style="text-align: left;">Vereinsvorstand BEWEST (Weiterbildungsverein)</td>
<td style="text-align: left;">Education &amp; research</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Stiftung Archiv für schweizerisches Abgaberecht</td>
<td style="text-align: right;">344</td>
<td style="text-align: left;">Adriano</td>
<td style="text-align: left;">Marantelli</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: right;">344</td>
<td style="text-align: left;">Stiftung Archiv für schweizerisches Abgaberecht</td>
<td style="text-align: left;">Society, Social, Culture &amp; Sports</td>
<td style="text-align: left;">UBE</td>
<td style="text-align: left;">Uni Bern</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="even">
<td style="text-align: left;">Conseil informatique (non-payé)</td>
<td style="text-align: left;">Aeroport Genève</td>
<td style="text-align: right;">462</td>
<td style="text-align: left;">Alain</td>
<td style="text-align: left;">Wegmann</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: right;">462</td>
<td style="text-align: left;">Aeroport Genève</td>
<td style="text-align: left;">Energy, environment &amp; mobility</td>
<td style="text-align: left;">EPF</td>
<td style="text-align: left;">ETH Lausanne</td>
<td style="text-align: left;">Lausanne</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Now group the result by organization sector, professor, and university city.</li>
<li>Count the resulting number of rows.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb104-1"><a href="#cb104-1"></a><span class="co">-- Group the table by organization sector, professor ID and university city</span></span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>), organizations.organization_sector, </span>
<span id="cb104-3"><a href="#cb104-3"></a>professors.<span class="kw">id</span>, universities.university_city</span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="kw">FROM</span> affiliations</span>
<span id="cb104-5"><a href="#cb104-5"></a><span class="kw">JOIN</span> professors</span>
<span id="cb104-6"><a href="#cb104-6"></a><span class="kw">ON</span> affiliations.professor_id <span class="op">=</span> professors.<span class="kw">id</span></span>
<span id="cb104-7"><a href="#cb104-7"></a><span class="kw">JOIN</span> organizations</span>
<span id="cb104-8"><a href="#cb104-8"></a><span class="kw">ON</span> affiliations.organization_id <span class="op">=</span> organizations.<span class="kw">id</span></span>
<span id="cb104-9"><a href="#cb104-9"></a><span class="kw">JOIN</span> universities</span>
<span id="cb104-10"><a href="#cb104-10"></a><span class="kw">ON</span> professors.university_id <span class="op">=</span> universities.<span class="kw">id</span></span>
<span id="cb104-11"><a href="#cb104-11"></a><span class="kw">GROUP</span> <span class="kw">BY</span> organizations.organization_sector, </span>
<span id="cb104-12"><a href="#cb104-12"></a>professors.<span class="kw">id</span>, universities.university_city;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
<th style="text-align: left;">organization_sector</th>
<th style="text-align: right;">id</th>
<th style="text-align: left;">university_city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Technology</td>
<td style="text-align: right;">135</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Education &amp; research</td>
<td style="text-align: right;">113</td>
<td style="text-align: left;">Basel</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Technology</td>
<td style="text-align: right;">363</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Industry, construction &amp; agriculture</td>
<td style="text-align: right;">39</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Society, Social, Culture &amp; Sports</td>
<td style="text-align: right;">182</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Pharma &amp; health</td>
<td style="text-align: right;">377</td>
<td style="text-align: left;">Bern</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">50</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Energy, environment &amp; mobility</td>
<td style="text-align: right;">320</td>
<td style="text-align: left;">Saint Gallen</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Education &amp; research</td>
<td style="text-align: right;">327</td>
<td style="text-align: left;">Fribourg</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Energy, environment &amp; mobility</td>
<td style="text-align: right;">194</td>
<td style="text-align: left;">Lausanne</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="4" type="1">
<li>Only retain rows with “Media &amp; communication” as organization sector, and sort the table by count, in descending order.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb105-1"><a href="#cb105-1"></a><span class="co">-- Filter the table and sort it</span></span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>), organizations.organization_sector, </span>
<span id="cb105-3"><a href="#cb105-3"></a>professors.<span class="kw">id</span>, universities.university_city</span>
<span id="cb105-4"><a href="#cb105-4"></a><span class="kw">FROM</span> affiliations</span>
<span id="cb105-5"><a href="#cb105-5"></a><span class="kw">JOIN</span> professors</span>
<span id="cb105-6"><a href="#cb105-6"></a><span class="kw">ON</span> affiliations.professor_id <span class="op">=</span> professors.<span class="kw">id</span></span>
<span id="cb105-7"><a href="#cb105-7"></a><span class="kw">JOIN</span> organizations</span>
<span id="cb105-8"><a href="#cb105-8"></a><span class="kw">ON</span> affiliations.organization_id <span class="op">=</span> organizations.<span class="kw">id</span></span>
<span id="cb105-9"><a href="#cb105-9"></a><span class="kw">JOIN</span> universities</span>
<span id="cb105-10"><a href="#cb105-10"></a><span class="kw">ON</span> professors.university_id <span class="op">=</span> universities.<span class="kw">id</span></span>
<span id="cb105-11"><a href="#cb105-11"></a><span class="kw">WHERE</span> organizations.organization_sector <span class="op">=</span> <span class="st">'Media &amp; communication'</span></span>
<span id="cb105-12"><a href="#cb105-12"></a><span class="kw">GROUP</span> <span class="kw">BY</span> organizations.organization_sector, </span>
<span id="cb105-13"><a href="#cb105-13"></a>professors.<span class="kw">id</span>, universities.university_city</span>
<span id="cb105-14"><a href="#cb105-14"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">count</span> <span class="kw">DESC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: right;">count</th>
<th style="text-align: left;">organization_sector</th>
<th style="text-align: right;">id</th>
<th style="text-align: left;">university_city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">345</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">253</td>
<td style="text-align: left;">Saint Gallen</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">322</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">453</td>
<td style="text-align: left;">Saint Gallen</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">380</td>
<td style="text-align: left;">Saint Gallen</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">290</td>
<td style="text-align: left;">Saint Gallen</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">439</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">378</td>
<td style="text-align: left;">Lausanne</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">452</td>
<td style="text-align: left;">Zurich</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Media &amp; communication</td>
<td style="text-align: right;">115</td>
<td style="text-align: left;">Lausanne</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Good job! The professor with <code>id</code> 538 has the most affiliations in the “Media &amp; communication” sector, and he or she lives in the city of Lausanne. Thanks to your database design, you can be sure that the data you’ve just queried is consistent. Of course, you could also put <code>university_city</code> and <code>organization_sector</code> in their own tables, making the data model even more formal. However, in database design, you have to strike a balance between modeling overhead, desired data consistency, and usability for queries like the one you\’ve just wrote. Congratulations, you made it to the end!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../content/sql/introduction_to_sql/introduction_to_sql.html" class="pagination-link">
        <span class="nav-page-text">Introduction to SQL</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2022 by <a href="https://www.startupengineer.io/authors/schwarz/">Joschka Schwarz</a> <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/jwarz/jwarz.github.io">View the source at GitHub</a></div>
  </div>
</footer>



<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>