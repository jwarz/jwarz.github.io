<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joschka Schwarz">

<title>Joschka Schwarz - Intermediate Data Visualization with ggplot2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../../content/R/topics/04_data_visualization/introduction_to_data_visualization_with_ggplot2/ggplot2_intro.html" rel="prev">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

<link href="../../../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Joschka Schwarz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-science" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Science</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-science">    
        <li>
    <a class="dropdown-item" href="../../../../../content/R/index.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/python/index.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/sql/index.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../../slides/index.html">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../resumes/index.html">
 <span class="menu-text">Resumes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jwarz/"><i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/j-schwarz"><i class="bi bi-linkedin" role="img" aria-label="Quarto LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Intermediate Data Visualization with ggplot2</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Topics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <b><i>1 Programming Basics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/01_programming_beginner/01_programming_beginner.html" class="sidebar-item-text sidebar-link">1.1: Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/02_programming_intermediate/02_programming_intermediate.html" class="sidebar-item-text sidebar-link">1.2: Intermediate R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/03_programming_tidyverse/03_programming_tidyverse.html" class="sidebar-item-text sidebar-link">1.3: Introduction to the tidyverse</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>2 Importing Data</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/01_importing_data_beginner/01_importing_data_beginner.html" class="sidebar-item-text sidebar-link">2.1: Introduction to Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/02_importing_data_intermediate/02_importing_data_intermediate.html" class="sidebar-item-text sidebar-link">2.2: Intermediate Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/03_working_with_web_data/03_working_with_web_data.html" class="sidebar-item-text sidebar-link">2.3: Working with web data</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>3 Data Wrangling</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/01_data_manipulation_with_dplyr/01_data_manipulation_with_dplyr.html" class="sidebar-item-text sidebar-link">3.1: Data Manipulation with dplyr</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/02_joining_data_with_dplyr/02_joining_data_with_dplyr.html" class="sidebar-item-text sidebar-link">3.2: Joining data with dplyr</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/exploratory_data_analysis_in_r/exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">3.3: Exploratory Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/case_study_exploratory_data_analysis_in_r/case_study_exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">3.4: Case Study: EDA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" class="sidebar-item-text sidebar-link">3.5: Cleaning Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/data_manipulation_with_datatable/data_manipulation_with_datatable.html" class="sidebar-item-text sidebar-link">3.6: Data Manipulation with data.table</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/joining_data_with_datatable/joining_data_with_datatable.html" class="sidebar-item-text sidebar-link">3.7: Joining Data with data.table</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>4 Data Visualization</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/introduction_to_data_visualization_with_ggplot2/ggplot2_intro.html" class="sidebar-item-text sidebar-link">4.1: Introduction to Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/data_visualization_with_ggplot2_intermediate/ggplot2_intermediate.html" class="sidebar-item-text sidebar-link active">4.2: Intermediate Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>5 Statistics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/01_statistics_beginner/01_statistics_beginner.html" class="sidebar-item-text sidebar-link">5.1: Introduction to Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/02_foundations_of_probability_in_r/02_foundations_of_probability_in_r.html" class="sidebar-item-text sidebar-link">5.2: Foundations of Probability</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/03_regression_beginner/03_regression_beginner.html" class="sidebar-item-text sidebar-link">5.3: Introduction to Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/04_regression_intermediate/04_regression_intermediate.html" class="sidebar-item-text sidebar-link">5.4: Intermediate Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/06_modeling_with_data_in_the_tidyverse/06_modeling_with_data_in_the_tidyverse.html" class="sidebar-item-text sidebar-link">5.5: Modeling with Data in the Tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/09_experimental_design/09_experimental_design.html" class="sidebar-item-text sidebar-link">5.6: Experimental Design</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/10_ab_testing_in_r/10_ab_testing_in_r.html" class="sidebar-item-text sidebar-link">5.7: A/B Testing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/19_fundamentals_of_bayesian_data_analysis/19_fundamentals_of_bayesian_data_analysis.html" class="sidebar-item-text sidebar-link">5.8: Fundamentals of Bayesian Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/21_factor_analysis_in_r/21_factor_analysis_in_r.html" class="sidebar-item-text sidebar-link">5.9: Factor Analysis</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>7 Machine Learning</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/01_supervised_learning_classification/01_supervised_learning_classification.html" class="sidebar-item-text sidebar-link">7.1: Supervised Learning: Classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/02_supervised_learning_regression/02_supervised_learning_regression.html" class="sidebar-item-text sidebar-link">7.2: Supervised Learning: Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/03_unsupervised_learning/03_unsupervised_learning.html" class="sidebar-item-text sidebar-link">7.3: Unsupervised Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/04_machine_learning_in_the_tidyverse/04_machine_learning_in_the_tidyverse.html" class="sidebar-item-text sidebar-link">7.4: Machine Learning in the tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/05_cluster_analysis/05_cluster_analysis.html" class="sidebar-item-text sidebar-link">7.5: Cluster Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/06_machine_learning_with_caret/06_machine_learning_with_caret.html" class="sidebar-item-text sidebar-link">7.6: Machine Learning with caret</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/07_modeling_with_tidymodels/07_modeling_with_tidymodels.html" class="sidebar-item-text sidebar-link">7.7: Modeling with tidymodels</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/08_machine_learning_with_tree-based_models/08_machine_learning_with_tree-based_models.html" class="sidebar-item-text sidebar-link">7.8: Machine Learning with tree-based Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/09_support_vector_machines/09_support_vector_machines.html" class="sidebar-item-text sidebar-link">7.9: Support Vector Machines</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/10_topic_modeling/10_topic_modeling.html" class="sidebar-item-text sidebar-link">7.10: Topic Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/11_hyperparameter_tuning/11_hyperparameter_tuning.html" class="sidebar-item-text sidebar-link">7.11: Hyperparameter Tuning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/12_bayesian_regression_modeling_with_rstanarm/12_bayesian_regression_modeling_with_rstanarm.html" class="sidebar-item-text sidebar-link">7.12: Bayesian Regression Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/13_spark_with_sparklyr_in_R/13_spark_with_sparklyr_in_R.html" class="sidebar-item-text sidebar-link">7.13: Introduction to Spark</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">R Manuals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/test.html" class="sidebar-item-text sidebar-link">1: An Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/02-content.html" class="sidebar-item-text sidebar-link">2: R Data Import/Export</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/03-content.html" class="sidebar-item-text sidebar-link">3: R Installation and Administration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/04-content.html" class="sidebar-item-text sidebar-link">4: Writing R Extensions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/05-content.html" class="sidebar-item-text sidebar-link">5: R Language Definition</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/06-content.html" class="sidebar-item-text sidebar-link">6: R Internals</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#statistics" id="toc-statistics" class="nav-link active" data-scroll-target="#statistics"><span class="toc-section-number">1</span>  Statistics</a>
  <ul class="collapse">
  <li><a href="#smoothing" id="toc-smoothing" class="nav-link" data-scroll-target="#smoothing"><span class="toc-section-number">1.1</span>  Smoothing</a></li>
  <li><a href="#quantiles" id="toc-quantiles" class="nav-link" data-scroll-target="#quantiles"><span class="toc-section-number">1.2</span>  Quantiles</a></li>
  </ul></li>
  <li><a href="#coordinates" id="toc-coordinates" class="nav-link" data-scroll-target="#coordinates"><span class="toc-section-number">2</span>  Coordinates</a>
  <ul class="collapse">
  <li><a href="#zooming-in" id="toc-zooming-in" class="nav-link" data-scroll-target="#zooming-in"><span class="toc-section-number">2.1</span>  Zooming In</a></li>
  <li><a href="#aspect-ratio" id="toc-aspect-ratio" class="nav-link" data-scroll-target="#aspect-ratio"><span class="toc-section-number">2.2</span>  Aspect ratio</a></li>
  <li><a href="#expand-and-clip" id="toc-expand-and-clip" class="nav-link" data-scroll-target="#expand-and-clip"><span class="toc-section-number">2.3</span>  Expand and clip</a></li>
  <li><a href="#coordinates-vs.-scales" id="toc-coordinates-vs.-scales" class="nav-link" data-scroll-target="#coordinates-vs.-scales"><span class="toc-section-number">2.4</span>  Coordinates vs.&nbsp;scales</a></li>
  <li><a href="#double-and-flipped-axes" id="toc-double-and-flipped-axes" class="nav-link" data-scroll-target="#double-and-flipped-axes"><span class="toc-section-number">2.5</span>  Double and flipped axes</a></li>
  <li><a href="#useful-double-axes" id="toc-useful-double-axes" class="nav-link" data-scroll-target="#useful-double-axes"><span class="toc-section-number">2.6</span>  Useful double axes</a></li>
  <li><a href="#polar-coordinates" id="toc-polar-coordinates" class="nav-link" data-scroll-target="#polar-coordinates"><span class="toc-section-number">2.7</span>  Polar coordinates</a></li>
  </ul></li>
  <li><a href="#facets" id="toc-facets" class="nav-link" data-scroll-target="#facets"><span class="toc-section-number">3</span>  Facets</a>
  <ul class="collapse">
  <li><a href="#facet-layer-basics" id="toc-facet-layer-basics" class="nav-link" data-scroll-target="#facet-layer-basics"><span class="toc-section-number">3.1</span>  Facet layer basics</a></li>
  <li><a href="#facet-labels-and-order" id="toc-facet-labels-and-order" class="nav-link" data-scroll-target="#facet-labels-and-order"><span class="toc-section-number">3.2</span>  Facet labels and order</a></li>
  <li><a href="#facet-plotting-spaces" id="toc-facet-plotting-spaces" class="nav-link" data-scroll-target="#facet-plotting-spaces"><span class="toc-section-number">3.3</span>  Facet plotting spaces</a></li>
  <li><a href="#facet-wrap-margins" id="toc-facet-wrap-margins" class="nav-link" data-scroll-target="#facet-wrap-margins"><span class="toc-section-number">3.4</span>  Facet wrap &amp; margins</a></li>
  <li><a href="#margin-plots" id="toc-margin-plots" class="nav-link" data-scroll-target="#margin-plots"><span class="toc-section-number">3.5</span>  Margin plots</a></li>
  </ul></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices"><span class="toc-section-number">4</span>  Best Practices</a>
  <ul class="collapse">
  <li><a href="#bar-plots" id="toc-bar-plots" class="nav-link" data-scroll-target="#bar-plots"><span class="toc-section-number">4.1</span>  Bar plots</a></li>
  <li><a href="#heat-maps" id="toc-heat-maps" class="nav-link" data-scroll-target="#heat-maps"><span class="toc-section-number">4.2</span>  Heat Maps</a></li>
  <li><a href="#when-good-data-makes-bad-plots" id="toc-when-good-data-makes-bad-plots" class="nav-link" data-scroll-target="#when-good-data-makes-bad-plots"><span class="toc-section-number">4.4</span>  When good data makes bad plots</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jwarz/jwarz.github.io/edit/main/content/R/topics/04_data_visualization/data_visualization_with_ggplot2_intermediate/ggplot2_intermediate.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jwarz/jwarz.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Intermediate Data Visualization with ggplot2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joschka Schwarz </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>This ggplot2 course builds on your knowledge from the introductory course to produce meaningful explanatory plots. Statistics will be calculated on the fly and you’ll see how Coordinates and Facets aid in communication. You’ll also explore details of data visualization best practices with ggplot2 to help make sure you have a sound understanding of what works and why. By the end of the course, you’ll have all the tools needed to make a custom plotting function to explore a large data set, combining statistics and excellent visuals.</p>
<section id="statistics" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Statistics</h1>
<p>A picture paints a thousand words, which is why R ggplot2 is such a powerful tool for graphical data analysis. In this chapter, you’ll progress from simply plotting data to applying a variety of statistical methods. These include a variety of linear models, descriptive and inferential statistics (mean, standard deviation and confidence intervals) and custom functions.</p>
<section id="stats-with-geoms" class="level3">
<h3 class="anchored" data-anchor-id="stats-with-geoms">Stats with geoms</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. Stats with geoms</strong></p>
<p>Welcome to the second ggplot2 course on data visualization! Here, we’re going to build on the skills you learned in the first course to develop a wide variety of plots that are not only appealing, but also meaningful.</p>
<p><strong>2. ggplot2, course 2</strong></p>
<p>We’ll examine the following three layers in detail: statistics, coordinates, and facets, plus, we’ll review some data viz tips so that you can make the most of your new skill-set.Let’s get started with the stats layer.</p>
<p><strong>3. Statistics layer</strong></p>
<p>There are two broad categories of functions in this family: those that are called from within a geom and those that are called independently.As you may have guessed, all the statistical functions begin with “stats”, followed by an underscore. Even those called from within the geom layer can be accessed independently in this way.</p>
<p><strong>4. geom_ &lt;-&gt; stat_</strong></p>
<p>We already saw a stats function when we used geom_histogram. Recall that under the hood, this called stat_bin to summarize the total count in each group.</p>
<p><strong>5. geom_ &lt;-&gt; stat_</strong></p>
<p>You may also remember that when we discussed geom_bar, I mentioned that it’s default stat is set to “bin” – so we could have produced the same result if we use geom_bar!</p>
<p><strong>6. geom_ &lt;-&gt; stat_</strong></p>
<p>The same thing happens with geom_bar, which just calls stat_count under the hood. If we called stat_count directly, we’d get the same plot since it would call geom_bar.</p>
<p><strong>7. The geom_/stat_ connection</strong></p>
<p>So we can see that specific geoms and stat functions are related.</p>
<p><strong>8. stat_smooth()</strong></p>
<p>stat_smooth can accessed with geom_smooth, shown here. The standard error, which is shown as a gray ribbon behind our smooth, is by default, a 95% confidence interval.</p>
<p><strong>9. stat_smooth(se = FALSE)</strong></p>
<p>We can remove this by setting the se argument to FALSE.We know we are calling stat_smooth because of another warning message: “geom_smooth is using method equal to loess, and formula y dependent on x”.LOESS is a non-parametric smoothing algorithm that is used when we have less than 1000 observations. It works by calculating a weighted mean by passing a sliding window along the x-axis and is a valuable tool in exploratory data analysis.</p>
<p><strong>10. geom_smooth(span = 0.4)</strong></p>
<p>The span argument controls the degree of smoothing, which is the size of the sliding window. Smaller spans are more noisy, as we can see here.</p>
<p><strong>11. geom_smooth(method = “lm”)</strong></p>
<p>The method argument can also define parametric models, such as “lm”, as shown here, or “glm”, “rlm” and “gam”. For groups larger than one thousand, the method defaults to gam. Notice that in both the LOESS and LM examples, the model is calculated on groups defined by color. We’ll look at how to override this in the exercises.</p>
<p><strong>12. geom_smooth(fullrange = TRUE)</strong></p>
<p>By default, each model is bound to the limits of its own group, but for parametric methods, we can use the fullrange argument to make predictions over the entire range. Just as we’d expect, the error increases the further away from our data set we attempt to define an estimate.</p>
<p><strong>13. The geom_/stat_ connection</strong></p>
<p>We can access smoothing using the geom smooth function or the stat smooth function.</p>
<p><strong>14. Other stat_ functions</strong></p>
<p>There are many other stats functions which we will encounter throughout the rest of the data visualization courses, some of which are particularly useful for summarizing data, like boxplots,</p>
<p><strong>15. Other stat_ functions</strong></p>
<p>or dealing with very large data sets, such as bindot, binhex, bin2d and contour - we’ll encounter those in the next course when we consider graphics of large datasets.</p>
<p><strong>16. Other stat_ functions</strong></p>
<p>We’ll encounter other functions throughout the exercises.In general, you won’t have to call these functions directly, but it is worth knowing about the relationship between geoms and their respective statistics. You’ll understand warning and error messages better and the help pages for the stats functions are often more informative if you need to adjust any parameters.</p>
<p><strong>17. Let’s practice!</strong></p>
<p>OK, let’s see how stat functions work in practice in the exercises.</p>
</section>
<section id="smoothing" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="smoothing"><span class="header-section-number">1.1</span> Smoothing</h2>
<p>To practice on the remaining layers (statistics, coordinates and facets), we’ll continue working on several datasets.</p>
<p>The <code>mtcars</code> dataset contains information for 32 cars from Motor Trends magazine from 1974. This dataset is small, intuitive, and contains a variety of continuous and categorical (both nominal and ordinal) variables.</p>
<p>In the previous course you learned how to effectively use some basic geometries, such as point, bar and line. In the first chapter of this course you’ll explore statistics associated with specific geoms, for example, smoothing and lines.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Look at the structure of <code>mtcars</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># View the structure of mtcars</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">str</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 'data.frame':    32 obs. of  11 variables:
#&gt;  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
#&gt;  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
#&gt;  $ disp: num  160 160 108 258 360 ...
#&gt;  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
#&gt;  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
#&gt;  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
#&gt;  $ qsec: num  16.5 17 18.6 19.4 17 ...
#&gt;  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
#&gt;  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
#&gt;  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
#&gt;  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Using <code>mtcars</code>, draw a scatter plot of <code>mpg</code> vs.&nbsp;<code>wt</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Using mtcars, draw a scatter plot of mpg vs. wt</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-4"><a href="#cb3-4"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Update the plot to add a smooth trend line. Use the default method, which uses the LOESS model to fit the curve.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Amend the plot to add a smooth layer</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Update the smooth layer. Apply a linear model by setting <code>method</code> to <code>"lm"</code>, and turn off the model’s 95% confidence interval (the ribbon) by setting <code>se</code> to <code>FALSE</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Amend the plot. Use lin. reg. smoothing; turn off std err ribbon</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li>Draw the same plot again, swapping <code>geom_smooth()</code> for <code>stat_smooth()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Amend the plot. Swap geom_smooth() for stat_smooth().</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! You can use either <a href="http://www.rdocumentation.org/packages/ggplot2/functions/geom_smooth"><code>stat_smooth()</code></a> or <a href="http://www.rdocumentation.org/packages/ggplot2/functions/geom_smooth"><code>geom_smooth()</code></a> to apply a linear model. Remember to always think about how the examples and concepts we discuss throughout the data viz courses can be applied to your own datasets!</p>
<section id="grouping-variables" class="level3">
<h3 class="anchored" data-anchor-id="grouping-variables">Grouping variables</h3>
<p>We’ll continue with the previous exercise by considering the situation of looking at sub-groups in our dataset. For this we’ll encounter the invisible <code>group</code> aesthetic.</p>
<p><code>mtcars</code> has been given an extra column, <code>fcyl</code>, that is the <code>cyl</code> column converted to a proper factor variable.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Using <code>mtcars</code>, plot <code>mpg</code> vs.&nbsp;<code>wt</code>, colored by <code>fcyl</code>.</p>
<ul>
<li>Add a point layer.</li>
<li>Add a smooth stat using a linear model, and don’t show the <code>se</code> ribbon.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># data</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> F)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">library</span>(forcats)</span>
<span id="cb7-4"><a href="#cb7-4"></a>mtcars <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> </span>
<span id="cb7-5"><a href="#cb7-5"></a>            <span class="fu">mutate</span>(<span class="at">fcyl =</span> <span class="fu">as_factor</span>(cyl))</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># Using mtcars, plot mpg vs. wt, colored by fcyl</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg, <span class="at">color =</span> fcyl)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="co"># Add a point layer</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="co"># Add a smooth lin reg stat, no ribbon</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>Update the plot to add a second smooth stat.</p>
<ul>
<li>Add a dummy <code>group</code> aesthetic to this layer, setting the value to <code>1</code>.</li>
<li>Use the same <code>method</code> and <code>se</code> values as the first stat smooth layer.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Amend the plot to add another smooth layer with dummy grouping</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg, <span class="at">color =</span> fcyl)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: The following aesthetics were dropped during statistical transformation: colour
#&gt; ℹ This can happen when ggplot fails to infer the correct grouping structure in
#&gt;   the data.
#&gt; ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
#&gt;   variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! Notice that the color aesthetic defined an invisible group aesthetic. Defining the group aesthetic for a specific geom means we can overwrite that. Here, we use a dummy variable to calculate the smoothing model for all values.</p>
</section>
<section id="modifying-stat_smooth-1" class="level3">
<h3 class="anchored" data-anchor-id="modifying-stat_smooth-1">Modifying stat_smooth (1)</h3>
<p>In the previous exercise we used <code>se = FALSE</code> in <code>stat_smooth()</code> to remove the 95% Confidence Interval. Here we’ll consider another argument, <code>span</code>, used in LOESS smoothing, and we’ll take a look at a nice scenario of properly mapping different models.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Explore the effect of the <code>span</code> argument on LOESS curves. Add three smooth LOESS stats, each without the standard error ribbon.</p>
<ul>
<li>Color the 1st one <code>"red"</code>; set its <code>span</code> to <code>0.9</code>.</li>
<li>Color the 2nd one <code>"green"</code>; set its <code>span</code> to <code>0.6</code>.</li>
<li>Color the 3rd one <code>"blue"</code>; set its <code>span</code> to <code>0.3</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="co"># Add 3 smooth LOESS stats, varying span &amp; color</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">stat_smooth</span>(<span class="at">se =</span> F, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">span =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">stat_smooth</span>(<span class="at">se =</span> F, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">span =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">stat_smooth</span>(<span class="at">se =</span> F, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">span =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>Compare LOESS and linear regression smoothing on small regions of data.</p>
<ul>
<li>Add a smooth LOESS stat, without the standard error ribbon.</li>
<li>Add a smooth linear regression stat, again without the standard error ribbon.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Amend the plot to color by fcyl</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="co"># Add a smooth LOESS stat, no ribbon</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">stat_smooth</span>(<span class="at">se=</span>F) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="co"># Add a smooth lin. reg. stat, no ribbon</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>LOESS isn’t great on very short sections of data; compare the pieces of linear regression to LOESS over the whole thing.</p>
<ul>
<li>Amend the smooth LOESS stat to map <code>color</code> to a dummy variable, <code>"All"</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Amend the plot</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg, <span class="at">color =</span> fcyl)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="co"># Map color to dummy variable "All"</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"All"</span>), <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Spantastic! The default span for LOESS is 0.9. A lower span will result in a better fit with more detail; but don’t overdo it or you’ll end up over-fitting!</p>
</section>
<section id="modifying-stat_smooth-2" class="level3">
<h3 class="anchored" data-anchor-id="modifying-stat_smooth-2">Modifying stat_smooth (2)</h3>
<p>In this exercise we’ll take a look at the standard error ribbons, which show the 95% confidence interval of smoothing models. <code>ggplot2</code> and the <code>Vocab</code> data frame are already loaded for you.</p>
<p><code>Vocab</code> has been given an extra column, <code>year_group</code>, splitting the dates into before and after 1995.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Using <code>Vocab</code>, plot <code>vocabulary</code> vs.&nbsp;<code>education</code>, colored by <code>year_group</code>.</p>
<ul>
<li>Use <code>geom_jitter()</code> to add jittered points with transparency <code>0.25</code>.</li>
<li>Add a smooth linear regression stat (with the standard error ribbon).</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># data</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">library</span>(car,<span class="at">warn.conflicts =</span> F, <span class="at">quietly =</span> T)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="fu">data</span>(Vocab)</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># Splitting the dates into before and after 1995. </span></span>
<span id="cb13-5"><a href="#cb13-5"></a>Vocab <span class="ot">&lt;-</span> Vocab <span class="sc">|&gt;</span> </span>
<span id="cb13-6"><a href="#cb13-6"></a>            <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-7"><a href="#cb13-7"></a>            <span class="fu">mutate</span>(<span class="at">year_group =</span> <span class="fu">cut</span>(year, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1974</span>, <span class="dv">1995</span>, <span class="dv">2016</span>), <span class="at">dig.lab =</span> <span class="dv">4</span>, <span class="at">include.lowest =</span> T))</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co"># Using Vocab, plot vocabulary vs. education, colored by year group</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary, <span class="at">color =</span> year_group)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="co"># Add jittered points with transparency 0.25</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="co"># Add a smooth lin. reg. line (with ribbon)</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>It’s easier to read the plot if the standard error ribbons match the lines, and the lines have more emphasis.</p>
<ul>
<li>Update the smooth stat.
<ul>
<li>Map the fill color to <code>year_group</code>.</li>
<li>Set the line linewidth to <code>1</code>.</li>
</ul></li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Amend the plot</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary, <span class="at">color =</span> year_group)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="co"># Map the fill color to year_group, set the linewidth size to 1</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">fill =</span> year_group), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>You have a vast plotting vocabulary! Notice that since 1995, education has relatively smaller effect on increasing vocabulary.</p>
</section>
<section id="stats-sum-and-quantile" class="level3">
<h3 class="anchored" data-anchor-id="stats-sum-and-quantile">Stats: sum and quantile</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. Stats: sum and quantile</strong></p>
<p>Let’s wrap up our discussion of stats called from within geoms by looking at two more useful functions: geom_count and geom_quantile</p>
<p><strong>2. Recall from course 1</strong></p>
<p>In the first course we saw that over-plotting is always a concern whenever we use geom point. Every data point must be visible. We discussed four ways in which our visualizations may mislead us.</p>
<p><strong>3. Plot counts to overcome over-plotting</strong></p>
<p>We can now add a new geom function to our solutions for low precision and integer data: geom_count plot the count at each location. In course 3, we’ll see even more elegant solutions that can be applied to all four situations.Let’s look at an example with geom_count.</p>
<p><strong>4. Low precision (&amp; integer) data</strong></p>
<p>In the iris data set, where we have low-precision data, jittering gives the impression that we have more precision that we actually do.</p>
<p><strong>5. Jittering may give a wrong impressions</strong></p>
<p>We should always mention that we’ve jittered our data because of this.</p>
<p><strong>6. geom_count()</strong></p>
<p>To avoid this problem, we can use another variant of geom_point. geom_count counts the number of observations at each location and then maps the count onto size as the point area.Our data is mapped onto the area of the circle, as opposed to its radius, since we more intuitively perceive area than radius.</p>
<p><strong>7. The geom/stat connection</strong></p>
<p>Remember that these geoms are associated with stats functions that can be called directly, as shown here.</p>
<p><strong>8. stat_sum()</strong></p>
<p>Calling the stat function gives the exact same plot.We’ll see this trick used with integer data in the exercises, which is a very common use.</p>
<p><strong>9. Over-plotting can still be a problem!</strong></p>
<p>But be careful here, you’ll still encounter over-plotting if the points are colored according to another variable. This makes it particularly difficult to read the plot!</p>
<p><strong>10. geom_quantile()</strong></p>
<p>The last function I want to look at in this section is geom_quantile. It’s another great tool for describing our data. This method allows us to model quantiles, which are robust, as opposed to linear models, which model the non-robust mean.We can choose any quantile we’re interested in, such as the median, which is just the second quartile. A typical case of using quantile regression would be when you have heteroscedasticity, that is the variance across the predictor variable is not consistent, in which case linear models may not be valid.</p>
<p><strong>11. Dealing with heteroscedasticity</strong></p>
<p>Here’s an example of heteroscedasticity from a dataset of economics journals from the AER package. We won’t get into the details of the data, but you can see that variance on the y axis is not consistent as we move along x axis.</p>
<p><strong>12. Using geom_quantiles</strong></p>
<p>Here, we can use geom_quantile to model the 5th and the 95th percentile as well as the median, the 50th percentile.</p>
<p><strong>13. The geom/stat connection</strong></p>
<p>Just like the previous geoms, this is also associated with a stats function that we can actually call directly.</p>
<p><strong>14. Ready for exercises!</strong></p>
<p>Let’s take these functions for a spin with some exercises!</p>
</section>
</section>
<section id="quantiles" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="quantiles"><span class="header-section-number">1.2</span> Quantiles</h2>
<p>Here, we’ll continue with the <code>Vocab</code> dataset and use <a href="http://www.rdocumentation.org/packages/ggplot2/functions/geom_quantile" target="_blank" rel="noopener noreferrer"><code>stat_quantile()</code></a> to apply a quantile regression.</p>
<p>Linear regression predicts the mean response from the explanatory variables, quantile regression predicts a quantile response (e.g.&nbsp;the median) from the explanatory variables. Specific quantiles can be specified with the <code>quantiles</code> argument.</p>
<p>Specifying many quantiles <em>and</em> color your models according to year can make plots too busy. We’ll explore ways of dealing with this in the next chapter.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Update the plot to add a quantile regression stat, at <code>quantiles</code> <code>0.05</code>, <code>0.5</code>, and <code>0.95</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="co"># Add a quantile stat, at 0.05, 0.5, and 0.95</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">stat_quantile</span>(<span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Amend the plot to color according to <code>year_group</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Amend the plot to color by year_group</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary, <span class="at">color =</span> year_group)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">stat_quantile</span>(<span class="fu">aes</span>(<span class="at">color =</span> year_group), <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in rq.fit.br(wx, wy, tau = tau, ...): Solution may be nonunique</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Quick quantiles! Quantile regression is a great tool for getting a more detailed overview of a large dataset.</p>
<section id="using-stat_sum" class="level3">
<h3 class="anchored" data-anchor-id="using-stat_sum">Using stat_sum</h3>
<p>In the <code>Vocab</code> dataset, <code>education</code> and <code>vocabulary</code> are integer variables. In the first course, you saw that this is one of the four causes of overplotting. You’d get a single point at each intersection between the two variables.</p>
<p>One solution, shown in the step 1, is jittering with transparency. Another solution is to use <a href="http://www.rdocumentation.org/packages/ggplot2/functions/geom_count" target="_blank" rel="noopener noreferrer"><code>stat_sum()</code></a>, which calculates the total number of overlapping observations and maps that onto the <code>size</code> aesthetic.</p>
<p><code>stat_sum()</code> allows a special variable, <code>..prop..</code>, to show the <em>proportion</em> of values within the dataset.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Run the code to see how jittering &amp; transparency solves overplotting.</li>
<li>Replace the jittered points with a sum stat, using <code>stat_sum()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Run this, look at the plot, then update it</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="co"># Replace this with a sum stat</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">stat_sum</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>Modify the size <em>aesthetic</em> with the appropriate scale function.</p>
<ul>
<li>Add a <code>scale_size()</code> function to set the <code>range</code> from <code>1</code> to <code>10</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">stat_sum</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="co"># Add a size scale, from 1 to 10</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">scale_size</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Inside <code>stat_sum()</code>, set <code>size</code> to <code>..prop..</code> so circle size represents the proportion of the whole dataset.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Amend the stat to use proportion sizes</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">stat_sum</span>(<span class="fu">aes</span>(<span class="at">size =</span> ..prop..))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: The dot-dot notation (`..prop..`) was deprecated in ggplot2 3.4.0.
#&gt; ℹ Please use `after_stat(prop)` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li>Update the plot to group by <code>education</code>, so that circle size represents the proportion of the group.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Amend the plot to group by education</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary, <span class="at">group =</span> education)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">stat_sum</span>(<span class="fu">aes</span>(<span class="at">size =</span> ..prop..))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-19-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Superb stat summing! If a few data points overlap, jittering is great. When you have lots of overlaps (particularly where continuous data has been rounded), using <code>stat_sum()</code> to count the overlaps is more useful.</p>
</section>
<section id="stats-outside-geoms" class="level3">
<h3 class="anchored" data-anchor-id="stats-outside-geoms">Stats outside geoms</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. Stats outside geoms</strong></p>
<p>Let’s take a look at some statistics that we call directly.</p>
<p><strong>2. Basic plot</strong></p>
<p>In this plot of the iris dataset, sepal length is described by species.What can we do with this data?</p>
<p><strong>3. Calculating statistics</strong></p>
<p>A typical way to summarize this data would be to take the mean and standard deviation or the 95% confidence interval.We can calculate these values manually, or we can do it directly in ggplot2.Let’s see how it works.</p>
<p><strong>4. Calculating statistics</strong></p>
<p>The function smean-dot-sdl from the Hmisc package returns the mean plus or minus one standard deviation as a named vector. By setting the mult argument to 1, we specify 1 standard deviation.In ggplot2, the function mean_sdl converts this vector to a data frame, renaming the variables to match ggplot2 aesthetics.</p>
<p><strong>5. stat_summary()</strong></p>
<p>We call mean_sdl using the fun.data argument of the stat_summary function. By default we get geom_pointrange, which requires y, ymin and ymax, exactly what is returned by mean_sdl.</p>
<p><strong>6. stat_summary()</strong></p>
<p>For errorbars, we can just calculate the mean and use “point” as the geom, then we can call mean_sdl using the “errorbar” geom, where we can also set the width of the error bars.</p>
<p><strong>7. stat_summary()</strong></p>
<p>But notice that we could have also made a typical bar plot with error bars, by simply calling the bar geom - but this is NOT RECOMMENDED! We’ll learn why when we get to data viz best practices later on!</p>
<p><strong>8. 95% confidence interval</strong></p>
<p>The 95% CI is also straight forward. mean_cl_normal returns the mean and the upper and lower bounds of the 95% confidence interval, calculated using the t-distribution.</p>
<p><strong>9. Other stat_ functions</strong></p>
<p>Two other useful stat_layer functions are stat_function and stat_qq. These are particularly useful if we want to look at distributions.Statisticians typically use visual cues to get an idea of the distribution of their data instead of relying only on numbers.</p>
<p><strong>10. MASS::mammals</strong></p>
<p>To see this in action let’s return to the first example we used in the first course - the mammalian body and brain weights stored in the mammals data frame. We mentioned that our linear model fitted the log10 transformed data reasonably well. What we mean is that the log transformed data appears to be normally distributed, so let’s take a look at that in detail.</p>
<p><strong>11. Normal distribution</strong></p>
<p>For stat_function, we can specify any function and produce the theoretical probability distribution as a line. Here, we call a normal distribution, that’s dnorm, and add arguments as a list to centered it on our distribution, that’s the mean and the sd). This allows us to compare how well our data is normally distributed. The log10 mammalian body weight is described by a log normal curve very well. Notice that we have another geom here, geom_rug, which adds those little tick marks on the bottom of the plot. This is a handy way of seeing the actual values in combination with a summary distribution.An empirical density plot, would be an nice alternative to the histogram, but we’ll get to that in the next course.</p>
<p><strong>12. QQ plot</strong></p>
<p>QQ plots also allows us to compare our data to a distribution. In this case, we plot our sample against the theoretical distribution, like the normal, and draw a line intersecting the scatter plot at the first and third quartiles. The closer that our data aligns to this line, the more closely it matches the theoretical distribution in question.</p>
<p><strong>13. Your turn!</strong></p>
<p>There are more stat_ functions which are available for you to explore during the exercises, so let’s take a look.</p>
</section>
<section id="preparations" class="level3">
<h3 class="anchored" data-anchor-id="preparations">Preparations</h3>
<p>In the following exercises, we’ll aim to make the plot shown in the viewer. Here, we’ll establish our positions and base layer of the plot.</p>
<p>Establishing these items as independent objects will allow us to recycle them easily in many layers, or plots.</p>
<ul>
<li><a href="http://www.rdocumentation.org/packages/ggplot2/functions/position_jitter" target="_blank" rel="noopener noreferrer"><code>position_jitter()</code></a> adds <em>jittering</em> (e.g.&nbsp;for points).</li>
<li><a href="http://www.rdocumentation.org/packages/ggplot2/functions/position_dodge" target="_blank" rel="noopener noreferrer"><code>position_dodge()</code></a> <em>dodges</em> geoms, (e.g.&nbsp;bar, col, boxplot, violin, errorbar, pointrange).</li>
<li><a href="http://www.rdocumentation.org/packages/ggplot2/functions/position_jitterdodge" target="_blank" rel="noopener noreferrer"><code>position_jitterdodge()</code></a> <em>jitters</em> <strong>and</strong> <em>dodges</em> geoms, (e.g.&nbsp;points).</li>
</ul>
<p>As before, we’ll use <code>mtcars</code>, where <code>fcyl</code> and <code>fam</code> are proper factor variables of the original <code>cyl</code> and <code>am</code> variables.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Using these three functions, define these position objects:</p>
<ul>
<li><code>posn_j</code>: will <em>jitter</em> with a <code>width</code> of <code>0.2</code>.</li>
<li><code>posn_d</code>: will <em>dodge</em> with a <code>width</code> of <code>0.1</code>.</li>
<li><code>posn_jd</code> will <em>jitter</em> <strong>and</strong> <em>dodge</em> with a <code>jitter.width</code> of <code>0.2</code> and a <code>dodge.width</code> of <code>0.1</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Define position objects</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co"># 1. Jitter with width 0.2</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>posn_j <span class="ot">&lt;-</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co"># 2. Dodge with width 0.1</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>posn_d <span class="ot">&lt;-</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.1</span>)   </span>
<span id="cb23-7"><a href="#cb23-7"></a></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="co"># 3. Jitter-dodge with jitter.width 0.2 and dodge.width 0.1</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>posn_jd <span class="ot">&lt;-</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="fl">0.2</span>, <span class="at">dodge.width =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li><p>Plot <code>wt</code> vs.&nbsp;<code>fcyl</code>, colored by <code>fam</code>. Assign this base layer to <code>p_wt_vs_fcyl_by_fam</code>.</p>
<ul>
<li>Plot the data using <code>geom_point()</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">#data</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>mtcars <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3"></a>            <span class="fu">mutate</span>(<span class="at">fam =</span> <span class="fu">as_factor</span>(am))</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co"># Create the plot base: wt vs. fcyl, colored by fam</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>p_wt_vs_fcyl_by_fam <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(fcyl, wt, <span class="at">color =</span> fam))</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="co"># Add a point layer</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>p_wt_vs_fcyl_by_fam <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-21-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Patient preparation! The default positioning of the points is highly susceptible to overplotting.</p>
</section>
<section id="using-position-objects" class="level3">
<h3 class="anchored" data-anchor-id="using-position-objects">Using position objects</h3>
<p>Now that the position objects have been created, you can apply them to the base plot to see their effects. You do this by adding a point geom and setting the <code>position</code> argument to the position object.</p>
<p>The variables from the last exercise, <code>posn_j</code>, <code>posn_d</code>, <code>posn_jd</code>, and <code>p_wt_vs_fcyl_by_fam</code> are available in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Apply the jitter position, <code>posn_j</code>, to the base plot.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Add jittering only</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>p_wt_vs_fcyl_by_fam <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> posn_j) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-22-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Apply the dodge position, <code>posn_d</code>, to the base plot.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Add dodging only</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>p_wt_vs_fcyl_by_fam <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> posn_d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-23-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Apply the jitter-dodge position, <code>posn_jd</code>, to the base plot.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Add jittering and dodging</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>p_wt_vs_fcyl_by_fam <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> posn_jd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Perfect positioning! Although you can set position by setting the <code>position</code> argument to a string (for example <code>position = "dodge"</code>), defining objects promotes consistency between layers.</p>
</section>
<section id="plotting-variations" class="level3">
<h3 class="anchored" data-anchor-id="plotting-variations">Plotting variations</h3>
<p>The preparation is done; now let’s explore <a href="http://www.rdocumentation.org/packages/ggplot2/functions/stat_summary" target="_blank" rel="noopener noreferrer"><code>stat_summary()</code></a>.</p>
<p><em>Summary statistics</em> refers to a combination of <em>location</em> (mean or median) and <em>spread</em> (standard deviation or confidence interval).</p>
<p>These metrics are calculated in <code>stat_summary()</code> by passing a function to the <code>fun.data</code> argument. <code>mean_sdl()</code>, calculates multiples of the standard deviation and <code>mean_cl_normal()</code> calculates the t-corrected 95% CI.</p>
<p>Arguments to the data function are passed to <code>stat_summary()</code>’s <code>fun.args</code> argument as a list.</p>
<p>The position object, <code>posn_d</code>, and the plot with jittered points, <code>p_wt_vs_fcyl_by_fam_jit</code>, are available.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Add error bars representing the standard deviation.</p>
<ul>
<li>Set the data function to <code>mean_sdl</code> (without parentheses).</li>
<li>Draw 1 standard deviation each side of the mean, pass arguments to the <code>mean_sdl()</code> function by assigning them to <code>fun.args</code> in the form of a list.</li>
<li>Use <code>posn_d</code> to set the position.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># packages</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="fu">library</span>(Hmisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Loading required package: Formula</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; The following objects are masked from 'package:dplyr':
#&gt; 
#&gt;     src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; The following objects are masked from 'package:base':
#&gt; 
#&gt;     format.pval, units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># data</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>p_wt_vs_fcyl_by_fam_jit <span class="ot">&lt;-</span> p_wt_vs_fcyl_by_fam <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>                            <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>)</span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a>p_wt_vs_fcyl_by_fam_jit <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="co"># Add a summary stat of std deviation limits</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb35-8"><a href="#cb35-8"></a>    <span class="at">fun.data =</span> mean_sdl,</span>
<span id="cb35-9"><a href="#cb35-9"></a>    <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="dv">1</span>),</span>
<span id="cb35-10"><a href="#cb35-10"></a>    <span class="at">position =</span> posn_d</span>
<span id="cb35-11"><a href="#cb35-11"></a></span>
<span id="cb35-12"><a href="#cb35-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>The default geom for <code>stat_summary()</code> is <code>"pointrange"</code> which is already great.</p>
<ul>
<li>Update the summary stat to use an <code>"errorbar"</code> geom by assigning it to the <code>geom</code> argument.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>p_wt_vs_fcyl_by_fam_jit <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="co"># Change the geom to be an errorbar</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl, <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>), <span class="at">position =</span> posn_d, <span class="at">geom =</span> <span class="st">"errorbar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>Update the plot to add a summary stat of 95% confidence limits.</p>
<ul>
<li>Set the data function to <code>mean_cl_normal</code> (without parentheses).</li>
<li>Again, use the dodge position.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>p_wt_vs_fcyl_by_fam_jit <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="co"># Add a summary stat of normal confidence limits</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb37-4"><a href="#cb37-4"></a>    <span class="at">fun.data =</span> mean_cl_normal,</span>
<span id="cb37-5"><a href="#cb37-5"></a>    <span class="at">position=</span>posn_d</span>
<span id="cb37-6"><a href="#cb37-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! You can always assign your own function to the <code>fun.data</code> argument as long as the result is a data frame and the variable names match the aesthetics that you will need for the geom layer.</p>
</section>
</section>
</section>
<section id="coordinates" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Coordinates</h1>
<p>The Coordinates layers offer specific and very useful tools for efficiently and accurately communicating data. Here we’ll look at the various ways of effectively using these layers, so you can clearly visualize lognormal datasets, variables with units, and periodic data.</p>
<section id="coordinates-1" class="level3">
<h3 class="anchored" data-anchor-id="coordinates-1">Coordinates</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. The Coordinates Layer</strong></p>
<p>The coord layer controls the dimensions of your plot.</p>
<p><strong>2. Coordinates layer</strong></p>
<p>The coord layer is composed of functions named coord_. Let’s explore their propertiesThe most commonly used function is coord_cartesian, which controls the x-y Cartesian plane of your plot.</p>
<p><strong>3. Zooming in</strong></p>
<p>We can use coord_cartesian to zoom in on a specific part of a plot. Alternatively, we could set the limits argument in scale_x_continuous or scale_y_continuous, or use an xlim or ylim function directly.</p>
<p><strong>4. Original plot</strong></p>
<p>Consider the following plot of the iris data. We’ve seen this plot in previous lessons. It plots sepal width against sepal length and draws a loess curve for each of our three iris species.</p>
<p><strong>5. scale_x_continuous()</strong></p>
<p>When we “zoomed in” to a small part of the x-axis using scale_x_continuous, we’re presented with some important warning messages. 95 rows have been removed. This happened because the limits we set in scale_x_continuous were a smaller range than the data and thus values were filtered out.</p>
<p><strong>6. scale_x_continuous()</strong></p>
<p>We can see this on the new zoomed-in plot, since the LOESS model is only defined for the points shown, although there is data beyond this region. That’s also why the models look different.</p>
<p><strong>7. xlim()</strong></p>
<p>A quick and dirty alternative is to call xlim as a function itself. It has the same effect.</p>
<p><strong>8. coord_cartesian()</strong></p>
<p>Contrast this to really zooming in using the coord_cartesian function. You can see the zoom because the LOESS curve continues past the data presented, and the models look the same as in the original plot.We haven’t filtered the data set, so if we did inadvertently cut off data values, it would not be clear simply from looking at the plot – unless we had some indicator such as a smoothing function.Changing the x and y limits can lead to unexpected consequences and should always be used with caution. Don’t recycle or hard code axis limits until you’ve seen the raw data.</p>
<p><strong>9. Aspect ratio</strong></p>
<p>Aside from zooming in, another common role that you’ll achieve with the coordinates layer is changing the aspect ratio. When we say ‘aspect ratio’, we are referring to the height-to-width aspect ratio.Changing the aspect ratio of a plot is one of the most common ways in which people either inadvertently or purposely deceive – or are deceived – with visualizations. There is no systematic method for choosing an appropriate aspect ratio.The only rule to follow in this area is that, typically, we should use a 1:1 aspect ratio when the units of measure are the same, although there are some exceptions to this rule - for example, when the scales are the same, but their ranges differ widely.The aspect ratio is particularly important when it changes our perception or interpretation of the data.</p>
<p><strong>10. Sunspots</strong></p>
<p>In this plot of over 250 years of sun spots data, there are three key trends. First, sun spots follow an 11-year oscillating cycle. Second, sun spot numbers also change over longer periods.However there is a third and subtle patten present in this time series, but it’s very difficult to see in this format.The aspect ratio here is 1:1, there are 250 units on the y and 265 units on the x. The physical distance for each unit in the same.</p>
<p><strong>11. Sunspots</strong></p>
<p>However, if we reduce the aspect ratio to something very low, like 0.055, we flatten the entire plot and notice something else.Sunspots arise more quickly than they disappear, a pattern that is more prevalent the higher the peak intensity in a given cycle is. Different trends are emphasized and the aspect ratio depends on what we are investigating or communicating.</p>
<p><strong>12. Practice time!</strong></p>
<p>OK, let’s head over to the exercises and look at coordinates in more detail.</p>
</section>
<section id="zooming-in" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="zooming-in"><span class="header-section-number">2.1</span> Zooming In</h2>
<p>In the video, you saw different ways of using the coordinates layer to zoom in. In this exercise, we’ll compare zooming by changing scales and by changing coordinates.</p>
<p>The big difference is that the scale functions change the underlying dataset, which affects calculations made by computed geoms (like histograms or smooth trend lines), whereas coordinate functions make no changes to the dataset.</p>
<p>A scatter plot using <code>mtcars</code> with a LOESS smoothed trend line is provided. Take a look at this before updating it.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Update the plot by adding (<code>+</code>) a continuous x scale with <code>limits</code> from <code>3</code> to <code>6</code>. <em>Spoiler: this will cause a problem!</em></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># Run the code, view the plot, then update it</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> hp, <span class="at">color =</span> fam)) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="fu">geom_smooth</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>  <span class="co"># Add a continuous x scale from 3 to 6</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;ScaleContinuousPosition&gt;
#&gt;  Range:  
#&gt;  Limits:    3 --    6</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Update the plot by adding a Cartesian coordinate system with x limits, <code>xlim</code>, from <code>3</code> to <code>6</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> hp, <span class="at">color =</span> fam)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="co"># Add Cartesian coordinates with x limits from 3 to 6</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-29-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Zesty zooming! Using the scale function to zoom in meant that there wasn’t enough data to calculate the trend line, and <code>geom_smooth()</code> failed. When <code>coord_cartesian()</code> was applied, the full dataset was used for the trend calculation.</p>
</section>
<section id="aspect-ratio" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="aspect-ratio"><span class="header-section-number">2.2</span> Aspect ratio</h2>
<section id="aspect-ratio-i-11-ratios" class="level3">
<h3 class="anchored" data-anchor-id="aspect-ratio-i-11-ratios">Aspect ratio I: 1:1 ratios</h3>
<p>We can set the aspect ratio of a plot with <a href="http://www.rdocumentation.org/packages/ggplot2/functions/coord_fixed" target="_blank" rel="noopener noreferrer"><code>coord_fixed()</code></a>, which uses <code>ratio = 1</code> as a default. A 1:1 aspect ratio is most appropriate when two continuous variables are on the same scale, as with the <code>iris</code> dataset.</p>
<p>All variables are measured in centimeters, so it only makes sense that one unit on the plot should be the same physical distance on each axis. This gives a more truthful depiction of the relationship between the two variables since the aspect ratio can change the angle of our smoothing line. This would give an erroneous impression of the data. Of course the underlying linear models don’t change, but our perception can be influenced by the angle drawn.</p>
<p>A plot using the <code>iris</code> dataset, of sepal width vs.&nbsp;sepal length colored by species, is shown in the viewer.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a fixed coordinate layer to force a 1:1 aspect ratio.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="co"># Fix the coordinate ratio</span></span>
<span id="cb42-5"><a href="#cb42-5"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; `geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Awe-inspiring aspect alteration! A 1:1 aspect ratio is helpful when your axes show the same scales.</p>
</section>
<section id="aspect-ratio-ii-setting-ratios" class="level3">
<h3 class="anchored" data-anchor-id="aspect-ratio-ii-setting-ratios">Aspect ratio II: setting ratios</h3>
<p>When values are not on the same scale it can be a bit tricky to set an appropriate aspect ratio. A classic William Cleveland (inventor of dot plots) example is the <code>sunspots</code> data set. We have 3200 observations from 1750 to 2016.</p>
<p><code>sun_plot</code> is a plot <em>without</em> any set aspect ratio. It fills up the graphics device.</p>
<p>To make aspect ratios clear, we’ve drawn an orange box that is 75 units high and 75 <em>years</em> wide. Using a 1:1 aspect ratio would make the box square. That aspect ratio would make things harder to see the oscillations: it is better to force a wider ratio.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>sunspots <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/sunspots.rds"</span>)</span>
<span id="cb44-2"><a href="#cb44-2"></a>sun_plot <span class="ot">&lt;-</span> sunspots <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Mean)) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Sunspots"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">310</span>, <span class="at">ymax =</span> <span class="dv">385</span>), <span class="at">xmin =</span> <span class="sc">-</span><span class="dv">40177</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">12784</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="st">"orange"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb44-7"><a href="#cb44-7"></a>sun_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-31-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>REWORK NECESSARY!</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Fix the coordinates to a 1:1 aspect ratio.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Fix the aspect ratio to 1:1</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>sun_plot <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-32-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>The <code>y</code> axis is now unreadably small. Make it bigger!</p>
<ul>
<li>Change the aspect <code>ratio</code> to 20:1. This is the aspect ratio recommended by Cleveland to help make the trend among oscillations easiest to see.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># Change the aspect ratio to 20:1</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>sun_plot <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="expand-and-clip" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="expand-and-clip"><span class="header-section-number">2.3</span> Expand and clip</h2>
<p>The <code>coord_*()</code> layer functions offer two useful arguments that work well together: <code>expand</code> and <code>clip</code>.</p>
<ul>
<li><code>expand</code> sets a buffer margin around the plot, so data and axes don’t overlap. Setting <code>expand</code> to <code>0</code> draws the axes to the limits of the data.</li>
<li><code>clip</code> decides whether plot elements that would lie outside the plot panel are displayed or ignored (“clipped”).</li>
</ul>
<p>When done properly this can make a great visual effect! We’ll use <code>theme_classic()</code> and modify the axis lines in this example.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add Cartesian coordinates with zero expansion, to remove all buffer margins on both the x and y axes.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="co"># Add Cartesian coordinates with zero expansion</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="fu">coord_cartesian</span>(<span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>Setting <code>expand</code> to <code>0</code> caused points at the edge of the plot panel to be cut off.</p>
<ul>
<li>Set the <code>clip</code> argument to <code>"off"</code> to prevent this.</li>
<li>Remove the axis lines by setting the <code>axis.line</code> argument to <code>element_blank()</code> in the <code>theme()</code> layer function.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="co"># Turn clipping off</span></span>
<span id="cb48-4"><a href="#cb48-4"></a>  <span class="fu">coord_cartesian</span>(<span class="at">expand =</span> <span class="dv">0</span>, <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6"></a>  <span class="co"># Remove axis lines</span></span>
<span id="cb48-7"><a href="#cb48-7"></a>  <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-35-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Cool clipping! These arguments make clean and accurate plots by not cutting off data.</p>
</section>
<section id="coordinates-vs.-scales" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="coordinates-vs.-scales"><span class="header-section-number">2.4</span> Coordinates vs.&nbsp;scales</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Coordinates vs.&nbsp;scales</strong></p>
<p>In the next set of exercises, I want to look at how to use the coordinate layer to perform transformations, and how that differs from using the scale functions.</p>
<p><strong>2. Plot the raw data</strong></p>
<p>For these examples, I’m going to use the body weight variable from the msleep data set. I made more adjustments than what’s shown here, but this is the basic code to get this univariate plot. We can see that this variable has a strong positive skew.In the first course, we saw how we can use the scale functions to modify things like the x-axis limits and breaks.Let’s consider three ways in which we can transform our data. A common transformation for positively skewed data is a natural, base e, logarithm, or the more intuitive common, base 10, logarithm.</p>
<p><strong>3. Transform the raw data</strong></p>
<p>We can transform the data before we begin plotting, and update the actual data frame, or we can transform the variable on-the-fly when we specify it in the aes function, as shown here. The result is the same.So far, so good! Notice that the axis labels are the log-transformed values, where zero is the log 10 of 1 kilograms, and 4 is the log 10 of 10000 kilograms.This is a very common solution, but it is a bit misleading in that the transformed scale is linear and we have to do some mental arithmetic to get back to the original values. So we’ve lost a bit of precision here.</p>
<p><strong>4. Add logtick annotation</strong></p>
<p>We could add log annotation tick marks using the annotation_logticks function. This highlights that the data is a log transformation.However, another solution is to have the data on a log scale, and label it with the actual original body weight value.We can do this in two ways.</p>
<p>**5. Use scale_*_log10()**</p>
<p>The first method uses the scale_x_log10 function. This transformed the data and then calculates any statistics needed.</p>
<p>**6. Compare direct transform and scale_*_log10() output**</p>
<p>The plots are almost identical, but pay attention to the axis labeling in the second plot using the scale_x_log10 function. The labels correspond to the actual value in the data set. This is the default output, we saw how to clean up axis labels in the first course.</p>
<p><strong>7. Use coord_trans()</strong></p>
<p>As you could imagine, we also have a function in the coordinate layer: coord_trans, which is actually more flexible in that we can apply any transformation we’d like.</p>
<p>**8. Compare scale_*_log10() and coord_trans() output**</p>
<p>Using coord_trans and setting the x argument to “log10” results in the same plot as with the scale function. The default labels happen to be different, but the plot is the same.</p>
<p><strong>9. Adjusting labels</strong></p>
<p>As a final step, we can add the actual values of the data on the axis. This is a really nice way to show the transformed values in relation to the original value on the axis labels.This may give you the impression that scale and coord functions work in the same way, but just like zooming, there are some fundamental differences under the hood when applying transformations. We’ll take a look at those in the exercises.</p>
<p><strong>10. Time for exercises</strong></p>
<p>Alright, now that you know how to use the scale and coord functions to apply transformations, let’s look at bivariate plots and see how these functions affect our statistics.</p>
<section id="log-transforming-scales" class="level3">
<h3 class="anchored" data-anchor-id="log-transforming-scales">Log-transforming scales</h3>
<p>Using <code>scale_y_log10()</code> and <code>scale_x_log10()</code> is equivalent to transforming our actual dataset <em>before</em> getting to <code>ggplot2</code>.</p>
<p>Using <code>coord_trans()</code>, setting <code>x = "log10"</code> and/or <code>y = "log10"</code> arguments, transforms the data <em>after</em> statistics have been calculated. The plot will look the same as with using <code>scale_*_log10()</code>, but the scales will be different, meaning that we’ll see the original values on our log10 transformed axes. This can be useful since log scales can be somewhat unintuitive.</p>
<p>Let’s see this in action with positively skewed data - the brain and body weight of 51 mammals from the <code>msleep</code> dataset.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using the <code>msleep</code> dataset, plot the raw values of <code>brainwt</code> against <code>bodywt</code> values as a scatter plot.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Produce a scatter plot of brainwt vs. bodywt</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt)) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">ggtitle</span>(<span class="st">"Raw Values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: Removed 27 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-36-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Add the <code>scale_x_log10()</code> and <code>scale_y_log10()</code> layers with default values to transform the data before plotting.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Add scale_*_*() functions</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt)) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6"></a>  <span class="fu">ggtitle</span>(<span class="st">"Scale_ functions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: Removed 27 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-37-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Use <code>coord_trans()</code> to apply a <code>"log10"</code> transformation to both the <code>x</code> and <code>y</code> scales.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Perform a log10 coordinate system transformation</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">coord_trans</span>(</span>
<span id="cb53-5"><a href="#cb53-5"></a>      <span class="at">x =</span> <span class="st">"log10"</span>,</span>
<span id="cb53-6"><a href="#cb53-6"></a>      <span class="at">y =</span> <span class="st">"log10"</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: Removed 27 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-38-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Terrific transformations! Each transformation method has implications for the plot’s interpretability. Think about your audience when choosing a method for applying transformations.</p>
</section>
<section id="adding-stats-to-transformed-scales" class="level3">
<h3 class="anchored" data-anchor-id="adding-stats-to-transformed-scales">Adding stats to transformed scales</h3>
<p>In the last exercise, we saw the usefulness of the <code>coord_trans()</code> function, but be careful! Remember that statistics are calculated on the untransformed data. A linear model may end up looking not-so-linear after an axis transformation. Let’s revisit the two plots from the previous exercise and compare their linear models.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add log10 transformed scales to the x and y axes.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Plot with a scale_*_*() function:</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt)) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>  <span class="co"># Add a log10 x scale</span></span>
<span id="cb55-6"><a href="#cb55-6"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7"></a>  <span class="co"># Add a log10 y scale</span></span>
<span id="cb55-8"><a href="#cb55-8"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9"></a>  <span class="fu">ggtitle</span>(<span class="st">"Scale functions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: Removed 27 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: Removed 27 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-39-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Add a log10 coordinate transformation for both the x and y axes.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Plot with transformed coordinates</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt)) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5"></a>  <span class="co"># Add a log10 coordinate transformation for x and y axes</span></span>
<span id="cb58-6"><a href="#cb58-6"></a>  <span class="fu">coord_trans</span>(</span>
<span id="cb58-7"><a href="#cb58-7"></a>      <span class="at">x =</span> <span class="st">"log10"</span>,</span>
<span id="cb58-8"><a href="#cb58-8"></a>      <span class="at">y =</span> <span class="st">"log10"</span></span>
<span id="cb58-9"><a href="#cb58-9"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: Removed 27 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: Removed 27 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-40-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Loopy lines! The smooth trend line is calculated after scale transformations but not coordinate transformations, so the second plot doesn’t make sense. Be careful when using the <code>coord_trans()</code> function!</p>
</section>
</section>
<section id="double-and-flipped-axes" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="double-and-flipped-axes"><span class="header-section-number">2.5</span> Double and flipped axes</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Double and flipped axes</strong></p>
<p>So far we’ve seen two ways in which we can modify our axes.</p>
<p><strong>2. Typical axis modifications</strong></p>
<p>First we saw that we can change the aspect ratio to obtain the best perspective.In the last video we saw how we can also apply appropriate transformation functions.Here, I want to take a look at two more common modifications.</p>
<p><strong>3. Typical axis modifications</strong></p>
<p>Let’s begin with having double x or y axes.Actually, having a double x or y axis is strongly discouraged. I’ll discuss when it can go wrong in chapter 4.Here, I want to give show you when double axes can actually work really well.</p>
<p><strong>4. Double axes</strong></p>
<p>We ended the last video with this plot. It displays log10 transformed values. One problem with presenting transformed values is that we are an additional step further removed from the raw data.</p>
<p><strong>5. Adding raw and transformed axes</strong></p>
<p>To make the plot easier to read, we can include the raw and the log10-transformed values on one plot. This is a beautiful use case since the double axis adds more information to an existing variable.</p>
<p><strong>6. Typical axis modifications</strong></p>
<p>Let’s take a look at one more typical modification. Flipping axes. This can be useful for changing the direction of dependencies, but also when we need to adjust the geometry’s orientation. We’ll look at the first case in the video and you’ll explore the second in the exercises.</p>
<p><strong>7. Flipping axes</strong></p>
<p>We saw this plot of the iris dataset in the first video of this course. It uses geom smooth to add three linear models to a scatter plot. In this case, both sepal width and length are dependent variables. That is, they are dependent on the species, which is the independent variable. Statistically, it doesn’t really matter which is mapped to the x or y.But in some cases it does. Our models are read as “y as a function of x” since we typically map the dependent variable onto the y axis and the independent variable onto the x axis.If we ever decide that our orientation is incorrect, we can either change our code to remap our variables, or</p>
<p><strong>8. coord_flip()</strong></p>
<p>we can use quick and easy coord flip function. In this way, we don’t need to manually adjust all our code.You can only use one coord layer function in each plot, so we don’t have the possibility to set the aspect ratio anymore.</p>
<p><strong>9. Let’s practice!</strong></p>
<p>Alright, we’ve seen four different ways in which we can modify our axes. Let’s practice with some exercises.</p>
</section>
<section id="useful-double-axes" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="useful-double-axes"><span class="header-section-number">2.6</span> Useful double axes</h2>
<p>Double x and y-axes are a contentious topic in data visualization. We’ll revisit that discussion at the end of chapter 4. Here, I want to review a great use case where double axes actually do add value to a plot.</p>
<p>Our goal plot is displayed in the viewer. The two axes are the raw temperature values on a Fahrenheit scale and the transformed values on a Celsius scale.</p>
<p>You can imagine a similar scenario for Log-transformed and original values, miles and kilometers, or pounds and kilograms. A scale that is unintuitive for many people can be made easier by adding a transformation as a double axis.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Begin with a standard line plot, of <code>Temp</code> described by <code>Date</code> in the <code>airquality</code> dataset.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># data</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>airquality <span class="ot">&lt;-</span> airquality <span class="sc">|&gt;</span> </span>
<span id="cb61-3"><a href="#cb61-3"></a>    <span class="fu">bind_cols</span>(<span class="at">Date =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"1973-05-01"</span>), <span class="fu">as.Date</span>(<span class="st">"1973-09-30"</span>), <span class="st">"days"</span>))</span>
<span id="cb61-4"><a href="#cb61-4"></a></span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="co"># Using airquality, plot Temp vs. Date</span></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(Date, Temp)) <span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7"></a>  <span class="co"># Add a line layer</span></span>
<span id="cb61-8"><a href="#cb61-8"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb61-9"><a href="#cb61-9"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Date (1973)"</span>, <span class="at">y =</span> <span class="st">"Fahrenheit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-41-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Convert <code>y_breaks</code> from Fahrenheit to Celsius (subtract 32, then multiply by 5, then divide by 9).</li>
<li>Define the secondary y-axis using <code>sec_axis()</code>. Use the <code>identity</code> transformation. Set the <code>breaks</code> and <code>labels</code> to the defined objects <code>y_breaks</code> and <code>y_labels</code>, respectively.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Define breaks (Fahrenheit)</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>y_breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">59</span>, <span class="dv">68</span>, <span class="dv">77</span>, <span class="dv">86</span>, <span class="dv">95</span>, <span class="dv">104</span>)</span>
<span id="cb62-3"><a href="#cb62-3"></a></span>
<span id="cb62-4"><a href="#cb62-4"></a><span class="co"># Convert y_breaks from Fahrenheit to Celsius</span></span>
<span id="cb62-5"><a href="#cb62-5"></a>y_labels <span class="ot">&lt;-</span> (y_breaks <span class="sc">-</span> <span class="dv">32</span>) <span class="sc">*</span> <span class="dv">5</span> <span class="sc">/</span> <span class="dv">9</span></span>
<span id="cb62-6"><a href="#cb62-6"></a></span>
<span id="cb62-7"><a href="#cb62-7"></a><span class="co"># Create a secondary x-axis</span></span>
<span id="cb62-8"><a href="#cb62-8"></a>secondary_y_axis <span class="ot">&lt;-</span> <span class="fu">sec_axis</span>(</span>
<span id="cb62-9"><a href="#cb62-9"></a>  <span class="co"># Use identity transformation</span></span>
<span id="cb62-10"><a href="#cb62-10"></a>  <span class="at">trans =</span> identity,</span>
<span id="cb62-11"><a href="#cb62-11"></a>  <span class="at">name =</span> <span class="st">"Celsius"</span>,</span>
<span id="cb62-12"><a href="#cb62-12"></a>  <span class="co"># Define breaks and labels as above</span></span>
<span id="cb62-13"><a href="#cb62-13"></a>  <span class="at">breaks =</span> y_breaks,</span>
<span id="cb62-14"><a href="#cb62-14"></a>  <span class="at">labels =</span> y_labels</span>
<span id="cb62-15"><a href="#cb62-15"></a>)</span>
<span id="cb62-16"><a href="#cb62-16"></a></span>
<span id="cb62-17"><a href="#cb62-17"></a><span class="co"># Examine the object</span></span>
<span id="cb62-18"><a href="#cb62-18"></a>secondary_y_axis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;ggproto object: Class AxisSecondary, gg&gt;
#&gt;     axis: NULL
#&gt;     break_info: function
#&gt;     breaks: 59 68 77 86 95 104
#&gt;     create_scale: function
#&gt;     detail: 1000
#&gt;     empty: function
#&gt;     guide: waiver
#&gt;     init: function
#&gt;     labels: 15 20 25 30 35 40
#&gt;     make_title: function
#&gt;     mono_test: function
#&gt;     name: Celsius
#&gt;     trans: function
#&gt;     transform_range: function
#&gt;     super:  &lt;ggproto object: Class AxisSecondary, gg&gt;</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Add your secondary y-axis to the <code>sec.axis</code> argument of <code>scale_y_continuous()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Update the plot</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(Date, Temp)) <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>  <span class="co"># Add the secondary y-axis </span></span>
<span id="cb64-5"><a href="#cb64-5"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> secondary_y_axis) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Date (1973)"</span>, <span class="at">y =</span> <span class="st">"Fahrenheit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Dazzling double axes! Double axes are most useful when you want to display the same value in two differnt units.</p>
<section id="flipping-axes-i" class="level3">
<h3 class="anchored" data-anchor-id="flipping-axes-i">Flipping axes I</h3>
<p><em>Flipping</em> axes means to reverse the variables mapped onto the <code>x</code> and <code>y</code> aesthetics. We can just change the mappings in <code>aes()</code>, but we can also use the <code>coord_flip()</code> layer function.</p>
<p>There are two reasons to use this function:</p>
<ul>
<li>We want a vertical geom to be horizontal, or</li>
<li>We’ve completed a long series of plotting functions and want to flip it without having to rewrite all our commands.</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a side-by-side (“dodged”) bar chart of <code>fam</code>, filled according to <code>fcyl</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># Plot fcyl bars, filled by fam</span></span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">fill =</span> fam, <span class="at">x =</span> fcyl)) <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3"></a>  <span class="co"># Place bars side by side</span></span>
<span id="cb65-4"><a href="#cb65-4"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>To get horizontal bars, add a <code>coord_flip()</code> function.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(fcyl, <span class="at">fill =</span> fam)) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>  <span class="co"># Flip the x and y coordinates</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Partially overlapping bars are popular with “infoviz” in magazines. Update the <code>position</code> argument to use <code>position_dodge()</code> with a width of <code>0.5</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(fcyl, <span class="at">fill =</span> fam)) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>  <span class="co"># Set a dodge width of 0.5 for partially overlapping bars</span></span>
<span id="cb67-3"><a href="#cb67-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Flipping fantastic! Horizontal bars are especially useful when the axis labels are long.</p>
</section>
<section id="flipping-axes-ii" class="level3">
<h3 class="anchored" data-anchor-id="flipping-axes-ii">Flipping axes II</h3>
<p>In this exercise, we’ll continue to use the <code>coord_flip()</code> layer function to reverse the variables mapped onto the <code>x</code> and <code>y</code> aesthetics.</p>
<p>Within the <code>mtcars</code> dataset, <code>car</code> is the name of the car and <code>wt</code> is its weight.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a scatter plot of <code>wt</code> versus <code>car</code> using the <code>mtcars</code> dataset. We’ll flip the axes in the next step.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># data</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>mtcars <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"car"</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a></span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="co"># Plot of wt vs. car</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(car, wt)) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6"></a>  <span class="co"># Add a point layer</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"car"</span>, <span class="at">y =</span> <span class="st">"weight"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-47-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>It would be easier to read if <code>car</code> was mapped to the y axis. Flip the coordinates. <em>Notice that the labels also get flipped!</em></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># Flip the axes to set car to the y axis</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(car, wt)) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"car"</span>, <span class="at">y =</span> <span class="st">"weight"</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-48-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Even funkier flips! Notice how much more interpretable the plot is after flipping the axes.</p>
</section>
</section>
<section id="polar-coordinates" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="polar-coordinates"><span class="header-section-number">2.7</span> Polar coordinates</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Polar coordinates</strong></p>
<p>Every plot we’ve made so far has used a Cartesian coordinate space.</p>
<p><strong>2. Projections control perception</strong></p>
<p>For two dimensions, this just means two orthogonal axes composed of straight lines.We can control how our data is perceived, by changing the limits of each axis and the aspect ratio, which we’ve covered already.</p>
<p><strong>3. Projections control perception</strong></p>
<p>However, another aspect that controls how we perceive data is the plotting projection.An example of this is with maps. We’ll cover this in detail in the next course, but it’s worth mentioning here in the context of projections.</p>
<p><strong>4. A preview of map projections</strong></p>
<p>There are many projections that we can use to present a 3D object, such as the Earth, on a 2D space, like a map. Some projections are better than others. For example the Mercator projection, on the left, is known to engross regions at the poles and diminish regions around the equator. The Conic projection is an alternative, but still suffers from the problem of projecting a 3D object in 2D.</p>
<p><strong>5. Polar coordinates</strong></p>
<p>The same applies to the Cartesian coordinate system. One of the most common projections is a polar transformation.</p>
<p><strong>6. coord_polar()</strong></p>
<p>Which can be seen here. In this case, theta, the axis which will be presented around the circumference, defaults to the x axis. Imagine that we just take the x axis on the left and bend it until it loops back on itself, while expanding the top side as we go along. We’d end up with the plot on the right.</p>
<p><strong>7. coord_polar(theta = “y”)</strong></p>
<p>a more common transformation is to place the y-axis on the circumference by setting theta to y.Actually, this is exactly what we’d do with a bar chart to convert it to a pie chart. As we’ll see in the exercises, a pie chart is simply a bar chart transformed onto a polar coordinate system.In the first course I mentioned how good data Visualization uses encoding elements for the data that allows the more efficient and accurate decoding by the viewer. According to that definition, polar coordinates should be used with extreme caution since they considerably distort that data. However, there are some specific use cases of polar coordinates, and we’ll explore these in the exercises.</p>
<p><strong>8. Let’s practice!</strong></p>
<p>Alright, let’s head over to the exercise and take a look at polar coordinates!</p>
<section id="pie-charts" class="level3">
<h3 class="anchored" data-anchor-id="pie-charts">Pie charts</h3>
<p>The <a href="http://www.rdocumentation.org/packages/ggplot2/functions/coord_polar" target="_blank" rel="noopener noreferrer"><code>coord_polar()</code></a> function converts a planar x-y Cartesian plot to polar coordinates. This can be useful if you are producing pie charts.</p>
<p>We can imagine two forms for pie charts - the typical filled circle, or a colored ring.</p>
<p>Typical pie charts omit all of the non-data ink, which we saw in the themes chapter of the last course. Pie charts are not really better than stacked bar charts, but we’ll come back to this point in the next chapter.</p>
<p>A bar plot using <code>mtcars</code> of the number of cylinders (as a factor), <code>fcyl</code>, is shown in the plot viewer.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><em>Run the code to see the stacked bar plot.</em></li>
<li>Add (<code>+</code>) a polar coordinate system, mapping the angle to the <code>y</code> variable by setting <code>theta</code> to <code>"y"</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Run the code, view the plot, then update it</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill =</span> fcyl)) <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb70-4"><a href="#cb70-4"></a>  <span class="co"># Add a polar coordinate system</span></span>
<span id="cb70-5"><a href="#cb70-5"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-49-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Reduce the <code>width</code> of the bars to <code>0.1</code>.</li>
<li>Make it a ring plot by adding a continuous x scale with limits from <code>0.5</code> to <code>1.5</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill =</span> fcyl)) <span class="sc">+</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>  <span class="co"># Reduce the bar width to 0.1</span></span>
<span id="cb71-3"><a href="#cb71-3"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5"></a>  <span class="co"># Add a continuous x scale from 0.5 to 1.5</span></span>
<span id="cb71-6"><a href="#cb71-6"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb71-7"><a href="#cb71-7"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb71-8"><a href="#cb71-8"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-50-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Super-fly pie! Polar coordinates are particularly useful if you are dealing with a cycle, like yearly data, that you would like to see represented as such.</p>
</section>
<section id="wind-rose-plots" class="level3">
<h3 class="anchored" data-anchor-id="wind-rose-plots">Wind rose plots</h3>
<p>Polar coordinate plots are well-suited to scales like compass direction or time of day. A popular example is the “wind rose”.</p>
<p>The <code>wind</code> dataset is taken from the <code>openair</code> package and contains hourly measurements for windspeed (<code>ws</code>) and direction (<code>wd</code>) from London in 2003. Both variables are factors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="fu">library</span>(openair)</span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="fu">library</span>(forcats)</span>
<span id="cb72-4"><a href="#cb72-4"></a><span class="fu">library</span>(purrr, <span class="at">warn.conflicts =</span> F)</span>
<span id="cb72-5"><a href="#cb72-5"></a></span>
<span id="cb72-6"><a href="#cb72-6"></a><span class="fu">data</span>(<span class="st">"mydata"</span>, <span class="at">package =</span> <span class="st">"openair"</span>)</span>
<span id="cb72-7"><a href="#cb72-7"></a>wind <span class="ot">&lt;-</span> mydata <span class="sc">|&gt;</span> </span>
<span id="cb72-8"><a href="#cb72-8"></a>            <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date) <span class="sc">==</span> <span class="dv">2003</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-9"><a href="#cb72-9"></a>            <span class="fu">mutate</span>(<span class="at">wsf =</span> <span class="fu">cut</span>(ws, <span class="at">breaks         =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">2</span>), <span class="cn">Inf</span>), </span>
<span id="cb72-10"><a href="#cb72-10"></a>                                 <span class="at">labels         =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">18</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">map_chr</span>(<span class="cf">function</span>(x) { <span class="fu">paste0</span>(x,<span class="st">" - "</span>,x <span class="sc">+</span> <span class="dv">2</span>) }), <span class="st">"20+"</span>),</span>
<span id="cb72-11"><a href="#cb72-11"></a>                                 <span class="at">include.lowest =</span> T) <span class="sc">|&gt;</span> <span class="fu">fct_rev</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb72-12"><a href="#cb72-12"></a>            <span class="fu">mutate</span>(<span class="at">wdf =</span> <span class="fu">cut</span>(wd, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">360</span> , <span class="at">by=</span><span class="fl">22.5</span>),</span>
<span id="cb72-13"><a href="#cb72-13"></a>                                 <span class="at">include.lowest =</span> T,</span>
<span id="cb72-14"><a href="#cb72-14"></a>                                 <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"N"</span>,<span class="st">"NNE"</span>,<span class="st">"NE"</span>, <span class="st">"ENE"</span>, <span class="st">"E"</span>, <span class="st">"ESE"</span>, <span class="st">"SE"</span>, <span class="st">"SSE"</span>, </span>
<span id="cb72-15"><a href="#cb72-15"></a>                                            <span class="st">"S"</span>, <span class="st">"SSW"</span>, <span class="st">"SW"</span>, <span class="st">"WSW"</span>, <span class="st">"W"</span>, <span class="st">"WNW"</span>, <span class="st">"NW"</span>, <span class="st">"NNW"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Make a classic bar plot mapping <code>wdf</code> onto the <code>x</code> aesthetic and <code>wsf</code> onto <code>fill</code>.</li>
<li>Use a <code>geom_bar()</code> layer, since we want to aggregate over all date values, and set the <code>width</code> argument to 1, to eliminate any spaces between the bars.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># Using wind, plot wd filled by ws</span></span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="fu">ggplot</span>(wind, <span class="fu">aes</span>(wdf, <span class="at">fill =</span> wsf)) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3"></a>  <span class="co"># Add a bar layer with width 1</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-52-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Convert the Cartesian coordinate space into a polar coordinate space with <code>coord_polar()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># Convert to polar coordinates:</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="fu">ggplot</span>(wind, <span class="fu">aes</span>(wdf, <span class="at">fill =</span> wsf)) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4"></a>  <span class="fu">coord_polar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-53-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Set the <code>start</code> argument to <code>-pi/16</code> to position North at the top of the plot.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># Convert to polar coordinates:</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="fu">ggplot</span>(wind, <span class="fu">aes</span>(wdf, <span class="at">fill =</span> wsf)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4"></a>  <span class="fu">coord_polar</span>(<span class="at">start =</span> <span class="sc">-</span>pi<span class="sc">/</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-54-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Perfect polar coordinates! They are not common, but polar coordinate plots are really useful.</p>
</section>
</section>
</section>
<section id="facets" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Facets</h1>
<p>Facets let you split plots into multiple panes, each displaying subsets of the dataset. Here you’ll learn how to wrap facets and arrange them in a grid, as well as providing custom labeling.</p>
<section id="the-facets-layer" class="level3">
<h3 class="anchored" data-anchor-id="the-facets-layer">The facets layer</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. The facets layer</strong></p>
<p>The next layer we’ll take a look at is the the facets layer.</p>
<p><strong>2. Facets</strong></p>
<p>Facets are a pretty straight-forward and very useful tool in data visualization. They are based on the concept of small multiples, popularized by Edward Tufte in his 1983 book the Visualization of Quantitative Information.</p>
<p><strong>3. The idea behind facets</strong></p>
<p>The idea is that we can split up a large, complex plot, to produce multiple smaller plots</p>
<p><strong>4. The idea behind facets</strong></p>
<p>that have the exact same coordinate system. On each plot we present different data sets so as to compare them more easily.</p>
<p><strong>5. iris.wide</strong></p>
<p>Here we use the iris.wide data frame to produce a scatter plot. We have information on each of the species, so we can add a facet_grid layer to add another variable to our plot.</p>
<p><strong>6. iris.wide &amp; facet_grid()</strong></p>
<p>facet_grid has arguments for splitting plots into rows or columns according to a variable provided in the var function. Here, we’re splitting according to columns using the cols argument.</p>
<p><strong>7. Formula notation</strong></p>
<p>The same result can be achieved by using the formula notation which you may be familiar with from defining linear models with the lm function. Everything on the left of the tilde (~) will split according to rows, and everything on the right will split according to columns.So the primary use of facets is to add another categorical variable to your plot, but they also aid in visual perception.</p>
<p><strong>8. iris.wide2</strong></p>
<p>For example, we already saw where this is very useful in the first course, when we talked about data structure. We used the iris.wide2 data frame to produce three different plots. The issue was that each plot was drawn on a separate y-axis, and we had to use three different plotting functions to get these plots.</p>
<p><strong>9. iris.tidy</strong></p>
<p>When we use the iris.tidy data set, we can take advantage of the facet_grid layer to solve both of theses problems. The trick in both of these examples is to understand that facets are simply splitting up our overall data set according to the levels in a categorical factor variable. If our data is in the right format we can achieve this easily using either columns or rows.</p>
<p><strong>10. iris.tidy done wrong</strong></p>
<p>In this case it doesn’t make sense to split according to rows because the whole point is to aid in visual perception and to make comparisons. When we split along columns, it allowed us to read our plots from left to right along a single axis.</p>
<p><strong>11. Other options</strong></p>
<p>So the choice depends on what type of data you are using. Of course you can also split according to both columns and rows, using two different variables, and if you have many levels in your categorical variable, you can wrap the subplots into a defined number of columns.</p>
<p><strong>12. Let’s practice!</strong></p>
<p>Alright, let’s explore these details and some further subtleties in the exercises.</p>
</section>
<section id="facet-layer-basics" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="facet-layer-basics"><span class="header-section-number">3.1</span> Facet layer basics</h2>
<p>Faceting splits the data up into groups, according to a categorical variable, then plots each group in its own panel. For splitting the data by one or two categorical variables, <a href="http://www.rdocumentation.org/packages/ggplot2/functions/facet_grid" target="_blank" rel="noopener noreferrer"><code>facet_grid()</code></a> is best.</p>
<p>Given categorical variables <code>A</code> and <code>B</code>, the code pattern is</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(A), <span class="at">cols =</span> <span class="fu">vars</span>(B))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This draws a panel for each pairwise combination of the values of <code>A</code> and <code>B</code>.</p>
<p>Here, we’ll use the <code>mtcars</code> data set to practice. Although <code>cyl</code> and <code>am</code> are not encoded as factor variables in the data set, <code>ggplot2</code> will coerce variables to factors when used in facets.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Facet the plot in a grid, with each <code>am</code> value in its own row.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span> </span>
<span id="cb77-2"><a href="#cb77-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3"></a>  <span class="co"># Facet rows by am</span></span>
<span id="cb77-4"><a href="#cb77-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(am))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-56-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Facet the plot in a grid, with each <code>cyl</code> value in its own column.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span> </span>
<span id="cb78-2"><a href="#cb78-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3"></a>  <span class="co"># Facet columns by cyl</span></span>
<span id="cb78-4"><a href="#cb78-4"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(cyl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-57-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-51"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Facet the plot in a grid, with each <code>am</code> value in its own row and each <code>cyl</code> value in its own column.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span> </span>
<span id="cb79-2"><a href="#cb79-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>  <span class="co"># Facet rows by am and columns by cyl</span></span>
<span id="cb79-4"><a href="#cb79-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(am), </span>
<span id="cb79-5"><a href="#cb79-5"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(cyl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-58-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Fantastic faceting! Compare the different plots that result and see which one makes most sense.</p>
<section id="many-variables" class="level3">
<h3 class="anchored" data-anchor-id="many-variables">Many variables</h3>
<p>In addition to aesthetics, facets are another way of encoding factor (i.e.&nbsp;categorical) variables. They can be used to reduce the complexity of plots with many variables.</p>
<p>Our goal is the plot in the viewer, which contains 7 variables.</p>
<p>Two variables are mapped onto the color aesthetic, using hue and lightness. To achieve this we combined <code>fcyl</code> and <code>fam</code> into a single <a href="https://www.rdocumentation.org/packages/base/topics/interaction" target="_blank" rel="noopener noreferrer">interaction</a> variable, <code>fcyl_fam</code>. This will allow us to take advantage of Color Brewer’s <em>Paired</em> color palette.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Map <code>fcyl_fam</code> onto the a <code>color</code> aesthetic.</li>
<li>Add a <code>scale_color_brewer()</code> layer and set <code>"Paired"</code> as the <code>palette</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># data</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>mtcars <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> </span>
<span id="cb80-3"><a href="#cb80-3"></a>            <span class="fu">mutate</span>(<span class="at">fcyl_fam =</span> <span class="fu">interaction</span>(fcyl, fam, <span class="at">sep =</span> <span class="st">":"</span>))</span>
<span id="cb80-4"><a href="#cb80-4"></a></span>
<span id="cb80-5"><a href="#cb80-5"></a><span class="co"># See the interaction column</span></span>
<span id="cb80-6"><a href="#cb80-6"></a>mtcars<span class="sc">$</span>fcyl_fam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] 6:1 6:1 4:1 6:0 8:0 6:0 8:0 4:0 4:0 6:0 6:0 8:0 8:0 8:0 8:0 8:0 8:0 4:1 4:1
#&gt; [20] 4:1 4:0 8:0 8:0 8:0 8:0 4:1 4:1 4:1 8:1 6:1 8:1 4:1
#&gt; Levels: 4:0 6:0 8:0 4:1 6:1 8:1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># Color the points by fcyl_fam</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg, <span class="at">color =</span> fcyl_fam)) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4"></a>  <span class="co"># Use a paired color palette</span></span>
<span id="cb82-5"><a href="#cb82-5"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-59-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-53"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Map <code>disp</code>, the displacement volume from each cylinder, onto the <code>size</code> aesthetic.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Update the plot to map disp to size</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg, <span class="at">color =</span> fcyl_fam, <span class="at">size =</span> disp)) <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-60-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-54"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Add a <code>facet_grid()</code> layer, faceting the plot according to <code>gear</code> on rows and <code>vs</code> on columns.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># Update the plot</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg, <span class="at">color =</span> fcyl_fam, <span class="at">size =</span> disp)) <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>) <span class="sc">+</span></span>
<span id="cb84-5"><a href="#cb84-5"></a>  <span class="co"># Grid facet on gear and vs</span></span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(gear), <span class="at">cols =</span> <span class="fu">vars</span>(vs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-61-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-55"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! The last plot you’ve created contains 7 variables (4 categorical, 3 continuous). Useful combinations of aesthetics and facets help to achieve this.</p>
</section>
<section id="formula-notation" class="level3">
<h3 class="anchored" data-anchor-id="formula-notation">Formula notation</h3>
<p>As well as the <code>vars()</code> notation for specifying which variables should be used to split the dataset into facets, there is also a traditional formula notation. The three cases are shown in the table.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Modern notation</th>
<th style="text-align: left;">Formula notation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>facet_grid(rows = vars(A))</code></td>
<td style="text-align: left;"><code>facet_grid(A ~ .)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>facet_grid(cols = vars(B))</code></td>
<td style="text-align: left;"><code>facet_grid(. ~ B)</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>facet_grid(rows = vars(A), cols = vars(B))</code></td>
<td style="text-align: left;"><code>facet_grid(A ~ B)</code></td>
</tr>
</tbody>
</table>
<p><code>mpg_by_wt</code> is available again. Rework the previous plots, this time using formula notation.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Facet the plot in a grid, with each <code>am</code> value in its own row.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span> </span>
<span id="cb85-2"><a href="#cb85-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3"></a>  <span class="co"># Facet rows by am using formula notation</span></span>
<span id="cb85-4"><a href="#cb85-4"></a>  <span class="fu">facet_grid</span>(am <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-62-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-56"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Facet the plot in a grid, with each <code>cyl</code> value in its own column.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span> </span>
<span id="cb86-2"><a href="#cb86-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3"></a>  <span class="co"># Facet columns by cyl using formula notation</span></span>
<span id="cb86-4"><a href="#cb86-4"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-63-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-57"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Facet the plot in a grid, with each <code>am</code> value in its own row and each <code>cyl</code> value in its own column.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span> </span>
<span id="cb87-2"><a href="#cb87-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3"></a>  <span class="co"># Facet rows by am and columns by cyl using formula notation</span></span>
<span id="cb87-4"><a href="#cb87-4"></a>  <span class="fu">facet_grid</span>(am <span class="sc">~</span> cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-64-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-58"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Fortunate formula formulation! While many ggplots still use the traditional formula notation, using <code>vars()</code> is now preferred.</p>
</section>
</section>
<section id="facet-labels-and-order" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="facet-labels-and-order"><span class="header-section-number">3.2</span> Facet labels and order</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Facet labels and order</strong></p>
<p>Now that you understand how to use facets for one or more categorical variables, let’s take a look at labeling and arranging facets properly.</p>
<p><strong>2. A new dataframe</strong></p>
<p>We’ll begin with a modified version of the msleep dataframe from ggplot2 that I’ve called msleep2. msleep2 contains the log10 transformed body and brain weights of 51 animals, which I’ve plotted as a scatterplot here.</p>
<p><strong>3. A new dataframe, with facets</strong></p>
<p>Another variable, called vore contains information on eating behavior, which we can use to facet the plot. There are four eating habits: Herbivore, Carnivore, Insectivore and Omnivore.</p>
<p><strong>4. A new dataframe, with facets</strong></p>
<p>To make sure you can read the labels we’ll periodically zoom in, which means that the entire plot may not be shown.</p>
<p><strong>5. Poor labels and order</strong></p>
<p>Two typical problems with facets are that they are often poorly labeled or that they have a wrong or inappropriate order.</p>
<p><strong>6. Poor labels and order</strong></p>
<p>We can fix up some of the labels inside ggplot2, but some things are better done on the actual data before plotting. Let’s take a look at both.</p>
<p><strong>7. The labeller argument</strong></p>
<p>The facet layer functions have a labeller argument, which defaults to label_value.</p>
<p><strong>8. Using label_both adds the variable name</strong></p>
<p>A more useful argument is to use label_both, which puts both the name of the variable and the level value.</p>
<p><strong>9. Two variables on one side</strong></p>
<p>In the exercises, we saw that we can use multiple variables on rows or columns, like I’ve done here with the conservation status.</p>
<p><strong>10. Using label_context avoids ambiguity</strong></p>
<p>In this case we can use the label_context argument which will add the variable name only if the labels may be ambiguous. If each variable has a small number of labels, this works well, as we’ll see in the exercises. Unfortunately, this plot is already pretty overloaded and you can see that the labels are too long for the space given!</p>
<p><strong>11. Use rows and columns when appropriate</strong></p>
<p>Let’s switch to faceting on both rows and columns, in which case label_context defaults to label_value,</p>
<p><strong>12. Use rows and columns when appropriate</strong></p>
<p>which means we can just leave it out.</p>
<p><strong>13. Use rows and columns when appropriate</strong></p>
<p>Here, all the labels fit nicely inside the alloted space.Let’s take a look at the actual facet labels and positions. To change these we need to go to the data set directly.</p>
<p><strong>14. Relabeling and reordering factors</strong></p>
<p>The forcats package in the tidyverse collection contains some really useful functions here. I like fct_recode, as shown here, for relabeling level names in a factor variable.</p>
<p><strong>15. Reinitialize plot with new labels</strong></p>
<p>If we reinitialize our plot, we’ll see the new, informative, labels.</p>
<p><strong>16. Reinitialize plot with new labels</strong></p>
<p>Nonetheless, we may still want them in a different order than alphabetical.</p>
<p><strong>17. Changing the order of levels</strong></p>
<p>The fct_relevel function makes this really easy, as the second argument we just need to put the levels in our desired order.</p>
<p><strong>18. Reinitialize plot with new order</strong></p>
<p>Now when we reinitialize out plot, our facets are in an appropriate order.</p>
<p><strong>19. Let’s practice!</strong></p>
<p>Let’s try this out on a few exercises with the mtcars dataframe.</p>
<section id="labeling-facets" class="level3">
<h3 class="anchored" data-anchor-id="labeling-facets">Labeling facets</h3>
<p>If your factor levels are not clear, your facet labels may be confusing. You can assign proper labels in your original data <em>before</em> plotting (see next exercise), or you can use the <code>labeller</code> argument in the facet layer.</p>
<p>The default value is</p>
<ul>
<li><code>label_value</code>: Default, displays only the value</li>
</ul>
<p>Common alternatives are:</p>
<ul>
<li><code>label_both</code>: Displays both the value and the variable name</li>
<li><code>label_context</code>: Displays only the values or both the values and variables depending on whether multiple factors are faceted</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a <code>facet_grid()</code> layer and facet <code>cols</code> according to the <code>cyl</code> using <code>vars()</code>. There is no labeling.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># Plot wt by mpg</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4"></a>  <span class="co"># The default is label_value</span></span>
<span id="cb88-5"><a href="#cb88-5"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(cyl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-65-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-59"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Apply <code>label_both</code> to the <code>labeller</code> argument and check the output.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># Plot wt by mpg</span></span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4"></a>  <span class="co"># Displaying both the values and the variables</span></span>
<span id="cb89-5"><a href="#cb89-5"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(cyl), <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-66-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-60"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Apply <code>label_context</code> to the <code>labeller</code> argument and check the output.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># Plot wt by mpg</span></span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4"></a>  <span class="co"># Label context</span></span>
<span id="cb90-5"><a href="#cb90-5"></a>  <span class="fu">facet_grid</span>(<span class="at">cols     =</span> <span class="fu">vars</span>(cyl), </span>
<span id="cb90-6"><a href="#cb90-6"></a>             <span class="at">labeller =</span> label_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-67-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-61"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>In addition to <code>label_context</code>, let’s facet by one more variable: <code>vs</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># Plot wt by mpg</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb91-4"><a href="#cb91-4"></a>  <span class="co"># Two variables</span></span>
<span id="cb91-5"><a href="#cb91-5"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(vs, cyl), <span class="at">labeller =</span> label_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-68-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-62"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Lovely labels! Make sure there is no ambiguity in interpreting plots by using proper labels.</p>
</section>
<section id="setting-order" class="level3">
<h3 class="anchored" data-anchor-id="setting-order">Setting order</h3>
<p>If you want to change the order of your facets, it’s best to properly define your factor variables <em>before</em> plotting.</p>
<p>Let’s see this in action with the <code>mtcars</code> transmission variable <code>am</code>. In this case, <code>0</code> = “automatic” and <code>1</code> = “manual”.</p>
<p>Here, we’ll make <code>am</code> a factor variable and relabel the numbers to proper names. The default order is alphabetical. To rearrange them we’ll call <code>fct_rev()</code> from the <code>forcats</code> package to reverse the order.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Explicitly label the <code>0</code> and <code>1</code> values of the <code>am</code> column as <code>"automatic"</code> and <code>"manual"</code>, respectively.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="co"># Make factor, set proper labels explictly</span></span>
<span id="cb92-2"><a href="#cb92-2"></a>mtcars<span class="sc">$</span>fam <span class="ot">&lt;-</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>am, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"automatic"</span>,</span>
<span id="cb92-3"><a href="#cb92-3"></a>                                           <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"manual"</span>))</span>
<span id="cb92-4"><a href="#cb92-4"></a></span>
<span id="cb92-5"><a href="#cb92-5"></a><span class="co"># Default order is alphabetical</span></span>
<span id="cb92-6"><a href="#cb92-6"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(fam))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-69-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-63"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Define a specific order using separate <code>levels</code> and <code>labels</code> arguments. Recall that <code>1</code> is <code>"manual"</code> and <code>0</code> is <code>"automatic"</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="co"># Make factor, set proper labels explictly, and</span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="co"># manually set the label order</span></span>
<span id="cb93-3"><a href="#cb93-3"></a>mtcars<span class="sc">$</span>fam <span class="ot">&lt;-</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>am,</span>
<span id="cb93-4"><a href="#cb93-4"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb93-5"><a href="#cb93-5"></a>                     <span class="at">labels =</span> <span class="fu">fct_rev</span>(<span class="fu">c</span>(<span class="st">"manual"</span>, <span class="st">"automatic"</span>)))</span>
<span id="cb93-6"><a href="#cb93-6"></a></span>
<span id="cb93-7"><a href="#cb93-7"></a><span class="co"># View again</span></span>
<span id="cb93-8"><a href="#cb93-8"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb93-9"><a href="#cb93-9"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb93-10"><a href="#cb93-10"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(fam))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-70-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-64"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Outstanding ordering! Arrange your facets in an intuitive order for your data.</p>
</section>
</section>
<section id="facet-plotting-spaces" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="facet-plotting-spaces"><span class="header-section-number">3.3</span> Facet plotting spaces</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Facet plotting spaces</strong></p>
<p>The major advantage of facets is that every plot is drawn on the same plotting space. This makes them all directly comparable.</p>
<p><strong>2. Facets and variable plotting spaces</strong></p>
<p>Nonetheless, you may encounter situations in which you actually don’t want this. For example in continuous variables, if the faceted subsets have wildly different ranges you’ll just be adding a lot of white space. In the case of categorical data, it’s common that each subset may have different groups, so it may not be necessary, or even appropriate to list all groups in each of the faceted plots.</p>
<p><strong>3. Adjusting the plotting space…</strong></p>
<p>Let’s look at this with the plot we ended the last video with. We used facet_grid to create rows according to eating habit and columns according to conservation status. To adjust the plotting space, we can use the scales argument.</p>
<p><strong>4. … but not with fixed scales</strong></p>
<p>If we set this argument to “free_x” we’ll allow each column of plot to have their own x axis. However, here we run into a typical problem. We can’t use a fixed coordinate space and have free axes as the same time.</p>
<p><strong>5. Adjusting the plotting space</strong></p>
<p>Once we remove the fixed coordinate space, then we can adjust the x axis for each column.</p>
<p><strong>6. Adjusting the plotting space</strong></p>
<p>We can do the same for the y axis by setting the scales argument to “free_y” instead.</p>
<p><strong>7. Adjusting the plotting space</strong></p>
<p>We can adjust both the x and y axes by setting the scales argument to “free”. Note that each column and row has at least a common x and y axis respectively.</p>
<p><strong>8. Adjusting the plotting space</strong></p>
<p>Let’s take a look at how this works with categorical variables. Each animal has only one eating behavior, stored in the vore variable. If we plotted the bodyweight of each animal in the name variable and facet according to <code>vore</code>, we would repeat the full name list in each sub-plot.This occurs when a categorical variable has many levels, like the name, that are not all present in each sub-group of another variable, like vore.</p>
<p><strong>9. Adjusting the plotting space</strong></p>
<p>If we set the scales to free_y, we’ll have only those names present in each facet, but the size of each plot is the still the same.</p>
<p><strong>10. Adjusting the plotting space</strong></p>
<p>This behavior can be changed with the spaces argument , which works in the same way as scales: “free_x” allows different sized facets on the x-axis, “free_y” allows different sized facets on the y-axis, and “free” allows different sizes in both directions. Here, we need to use “free_y”.This plot already looks great! But there is one more thing we may want to change.</p>
<p><strong>11. Final adjustments</strong></p>
<p>We can rearrange the data frame according to the weight and then redefine the factor levels according to the order in which they appear. This will arrange them in the same way in the plot.Thinking about the order of the names in this case makes the plot more intuitive.</p>
<p><strong>12. Let’s practice!</strong></p>
<p>Great, let’s head over to the exercises and see this all in action.</p>
<section id="variable-plotting-spaces-i-continuous-variables" class="level3">
<h3 class="anchored" data-anchor-id="variable-plotting-spaces-i-continuous-variables">Variable plotting spaces I: continuous variables</h3>
<p>By default every facet of a plot has the same axes. If the data ranges vary wildly between facets, it can be clearer if each facet has its own scale. This is achieved with the <code>scales</code> argument to <code>facet_grid()</code>.</p>
<ul>
<li><code>"fixed"</code> (default): axes are shared between facets.</li>
<li><code>free</code>: each facet has its own axes.</li>
<li><code>free_x</code>: each facet has its own x-axis, but the y-axis is shared.</li>
<li><code>free_y</code>: each facet has its own y-axis, but the x-axis is shared.</li>
</ul>
<p>When faceting by columns, <code>"free_y"</code> has no effect, but we can adjust the x-axis. In contrast, when faceting by rows, <code>"free_x"</code> has no effect, but we can adjust the y-axis.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Update the plot to facet columns by <code>cyl</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb94-3"><a href="#cb94-3"></a>  <span class="co"># Facet columns by cyl </span></span>
<span id="cb94-4"><a href="#cb94-4"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(cyl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-71-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-65"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Update the faceting to free the x-axis scales.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb95-2"><a href="#cb95-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb95-3"><a href="#cb95-3"></a>  <span class="co"># Update the faceting to free the x-axis scales</span></span>
<span id="cb95-4"><a href="#cb95-4"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(cyl),</span>
<span id="cb95-5"><a href="#cb95-5"></a>            <span class="at">scales =</span> <span class="st">"free_x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-72-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-66"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Facet <strong>rows</strong> by <code>cyl</code> (rather than columns).</li>
<li>Free the <strong>y</strong>-axis scales (instead of x).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb96-3"><a href="#cb96-3"></a>  <span class="co"># Swap cols for rows; free the y-axis scales</span></span>
<span id="cb96-4"><a href="#cb96-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(cyl), <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-73-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-67"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Freedom! Shared scales make it easy to compare between facets, but can be confusing if the data ranges are very different. In that case, used free scales.</p>
</section>
<section id="variable-plotting-spaces-ii-categorical-variables" class="level3">
<h3 class="anchored" data-anchor-id="variable-plotting-spaces-ii-categorical-variables">Variable plotting spaces II: categorical variables</h3>
<p>When you have a categorical variable with many levels which are not all present in each sub-group of another variable, it’s usually desirable to drop the unused levels.</p>
<p>By default, each facet of a plot is the same size. This behavior can be changed with the <code>spaces</code> argument, which works in the same way as <code>scales</code>: <code>"free_x"</code> allows different sized facets on the x-axis, <code>"free_y"</code>, allows different sized facets on the y-axis, <code>"free"</code> allows different sizes in both directions.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Facet the plot by rows according to <code>gear</code> using <code>vars()</code>. Notice that <em>every</em> car is listed in <em>every</em> facet, resulting in many lines without data.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> mpg, <span class="at">y =</span> car, <span class="at">color =</span> fam)) <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>  <span class="co"># Facet rows by gear</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(gear))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-74-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-68"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>To remove blank lines, set the <code>scales</code> and <code>space</code> arguments in <code>facet_grid()</code> to <code>free_y</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> mpg, <span class="at">y =</span> car, <span class="at">color =</span> fam)) <span class="sc">+</span></span>
<span id="cb98-2"><a href="#cb98-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb98-3"><a href="#cb98-3"></a>  <span class="co"># Free the y scales and space</span></span>
<span id="cb98-4"><a href="#cb98-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows   =</span> <span class="fu">vars</span>(gear),</span>
<span id="cb98-5"><a href="#cb98-5"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb98-6"><a href="#cb98-6"></a>             <span class="at">space  =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-75-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-69"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Super spaces! Freeing the y-scale to remove blank lines helps focus attention on the actual data present.</p>
</section>
</section>
<section id="facet-wrap-margins" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="facet-wrap-margins"><span class="header-section-number">3.4</span> Facet wrap &amp; margins</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Facet wrap &amp; margins</strong></p>
<p>In the last video we explored facet_grid() for splitting up a plot according to a categorical variable.</p>
<p><strong>2. Adjusting the plotting space</strong></p>
<p>We saw that this allowed us to set a free x axis for all plots the same column and a free y axis for all plots in the same row. That’s alright, but wouldn’t it be great if each plot can also have it’s own x and y axes dependent on their data? Actually, it kind of defeats the purpose of having small multiples, but it can be useful if we have distinct ranges.To achieve this, we can take advantage of another useful function in this layer: facet_wrap</p>
<p><strong>3. Using facet_wrap()</strong></p>
<p>There are a couple use cases for this function.First, as I just mentioned, when we want each plot to have its own plotting space, but we still want to take advantage of tidy data structure and ggplot2 to generate all those plots as facets of a larger plot, and not as individual plots.</p>
<p><strong>4. Using facet_wrap() - Scenario 1</strong></p>
<p>For facet_wrap, we specify one or more faceting variables with a single call to the vars function. facet_wrap will automatically choose an appropriate number of columns and rows.So this gets the job done, but you can see that it is more difficult to keep track of each plot and variable compared to facet_grid, so use this with caution.</p>
<p><strong>5. Using facet_wrap()</strong></p>
<p>Second, and what is a more typical scenario, is when our categorical variable has many groups, so that faceting along only rows or only columns is overwhelming.</p>
<p><strong>6. Using facet_wrap() - Scenario 2</strong></p>
<p>For example, here, our 51 animals belong to 13 taxonomic orders which is nicely displayed with facet wrap. Using facet grid would produce a single row or column with 13 plots, which would be impractical.</p>
<p><strong>7. Using margin plots</strong></p>
<p>Before we wrap up with facets, let’s look at one more adjustment we can make with this layer. We can present each facet <em>and</em> a composite plot with all categories together. These are called margin plots.This was our original facetted plot, but</p>
<p><strong>8. Using margin plots</strong></p>
<p>if we add the margins argument to the facet layer, we can add margin plots for both the rows and columns that display all points together. Notice that in the lower right corner, we have the complete data set in one facet.</p>
<p><strong>9. Using margin plots</strong></p>
<p>We can also specify one one variable to produce the margin plots.</p>
<p><strong>10. Let’s practice!</strong></p>
<p>So far so good. We’ve seen that there is a lot more to the facet layer than just splitting up your plots. Let’s explore these last concepts in the exercises.</p>
<section id="wrapping-for-many-levels" class="level3">
<h3 class="anchored" data-anchor-id="wrapping-for-many-levels">Wrapping for many levels</h3>
<p><code>facet_grid()</code> is fantastic for categorical variables with a small number of levels. Although it is possible to facet variables with many levels, the resulting plot will be very wide or very tall, which can make it difficult to view.</p>
<p>The solution is to use <code>facet_wrap()</code> which separates levels along one axis but wraps all the subsets across a given number of rows or columns.</p>
<p>For this plot, we’ll use the <code>Vocab</code> dataset that we’ve already seen. The base layer is provided.</p>
<p>Since we have many <code>years</code>, it doesn’t make sense to use <code>facet_grid()</code>, so let’s try <code>facet_wrap()</code> instead.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Add a facet_wrap() layer and specify:</p>
<ul>
<li>The <code>year</code> variable with an argument using the <code>vars()</code> function,</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary)) <span class="sc">+</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3"></a>  <span class="co"># Create facets, wrapping by year, using vars()</span></span>
<span id="cb99-4"><a href="#cb99-4"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-76-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-70"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Add a <code>facet_wrap()</code> layer and specify the <code>year</code> variable with a formula notation (<code>~</code>).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary)) <span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb100-3"><a href="#cb100-3"></a>  <span class="co"># Create facets, wrapping by year, using a formula</span></span>
<span id="cb100-4"><a href="#cb100-4"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-77-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-71"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>Add a <code>facet_wrap()</code> layer and specify:</p>
<ul>
<li>Formula notation as before, and <code>ncol</code> set to <code>11</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="fu">ggplot</span>(Vocab, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> vocabulary)) <span class="sc">+</span></span>
<span id="cb101-2"><a href="#cb101-2"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3"></a>  <span class="co"># Update the facet layout, using 11 columns</span></span>
<span id="cb101-4"><a href="#cb101-4"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">ncol =</span> <span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-78-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-72"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>It’s a wrap! Start experimenting with facets in your own plots.</p>
</section>
</section>
<section id="margin-plots" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="margin-plots"><span class="header-section-number">3.5</span> Margin plots</h2>
<p>Facets are great for seeing subsets in a variable, but sometimes you want to see <em>both</em> those subsets <em>and</em> all values in a variable.</p>
<p>Here, the <code>margins</code> argument to <code>facet_grid()</code> is your friend.</p>
<ul>
<li><code>FALSE</code> (default): no margins.</li>
<li><code>TRUE</code>: add margins to every variable being faceted by.</li>
<li><code>c("variable1", "variable2")</code>: only add margins to the variables listed.</li>
</ul>
<p>To make it easier to follow the facets, we’ve created two factor variables with proper labels — <code>fam</code> for the transmission type, and <code>fvs</code> for the engine type, respectively.</p>
<p><em>Zoom the graphics window to better view your plots.</em></p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Update the plot to facet the rows by <code>fvs</code> and <code>fam</code>, and columns by <code>gear</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="co"># data</span></span>
<span id="cb102-2"><a href="#cb102-2"></a>mtcars <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3"></a>           <span class="fu">mutate</span>(<span class="at">fvs =</span> <span class="fu">as_factor</span>(vs))</span>
<span id="cb102-4"><a href="#cb102-4"></a></span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="co"># Plot</span></span>
<span id="cb102-6"><a href="#cb102-6"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> </span>
<span id="cb102-7"><a href="#cb102-7"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb102-8"><a href="#cb102-8"></a>  <span class="co"># Facet rows by fvs and cols by fam</span></span>
<span id="cb102-9"><a href="#cb102-9"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(fvs, fam), </span>
<span id="cb102-10"><a href="#cb102-10"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(gear))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-79-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-73"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Add all possible margins to the plot.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> </span>
<span id="cb103-2"><a href="#cb103-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3"></a>  <span class="co"># Update the facets to add margins</span></span>
<span id="cb103-4"><a href="#cb103-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(fvs, fam), </span>
<span id="cb103-5"><a href="#cb103-5"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(gear),</span>
<span id="cb103-6"><a href="#cb103-6"></a>             <span class="at">margins =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-80-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-74"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Update the facets to only show margins on <code>"fam"</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> </span>
<span id="cb104-2"><a href="#cb104-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb104-3"><a href="#cb104-3"></a>  <span class="co"># Update the facets to only show margins on fam</span></span>
<span id="cb104-4"><a href="#cb104-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(fvs, fam), </span>
<span id="cb104-5"><a href="#cb104-5"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(gear), </span>
<span id="cb104-6"><a href="#cb104-6"></a>             <span class="at">margins =</span> <span class="st">"fam"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-81-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-75"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Update the facets to only show margins on <code>"gear"</code> and <code>"fvs"</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> </span>
<span id="cb105-2"><a href="#cb105-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3"></a>  <span class="co"># Update the facets to only show margins on gear and fvs</span></span>
<span id="cb105-4"><a href="#cb105-4"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(fvs, fam), <span class="at">cols =</span> <span class="fu">vars</span>(gear), <span class="at">margins =</span> <span class="fu">c</span>(<span class="st">"gear"</span>, <span class="st">"fvs"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-82-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-76"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Magic margins! It can be really helpful to show the full margin plots!</p>
</section>
</section>
<section id="best-practices" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Best Practices</h1>
<p>Now that you have the technical skills to make great visualizations, it’s important that you make them as meaningful as possible. In this chapter, you’ll review three plot types that are commonly discouraged in the data viz community: heat maps, pie charts, and dynamite plots. You’ll learn the pitfalls with these plots and how to avoid making these mistakes yourself.</p>
<section id="bar-plots" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="bar-plots"><span class="header-section-number">4.1</span> Bar plots</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Best practices: bar plots</strong></p>
<p>Knowing how to efficiently use ggplot is a good first step,</p>
<p><strong>2. In this chapter</strong></p>
<p>but now we need to consider what is the best way to graphically represent our data, what are the common pitfalls and what is the best way to represent our data.</p>
<p><strong>3. Bar plots</strong></p>
<p>There are two common types of bar plots. The first is simply showing an absolute count value. The second is a distribution, which is as terrible as it is common. Why is that?</p>
<p><strong>4. Mammalian sleep</strong></p>
<p>Let’s return to the mammalian sleep data set. We have eating habits of several mammals along with the time they spend sleeping and how much of that time is REM sleep.</p>
<p><strong>5. Dynamite plot</strong></p>
<p>We map vore and sleep onto the x and y aesthetics, respectively, and draw the error bars as discussed in chapter one.So far so good, but we have no idea how many observations we have in each category!This plot also suggests that our data is normally distributed. If our data is not normally distributed it’s not appropriate to represent it in this way.A further perceptual problem is that our bars give the impression of having data where there is no data. There for sure are no mammals which sleep 0 hours a day! Yet the bars begin showing data at 0, plus, the region above the mean contains values but no ink! What could be a better way?</p>
<p><strong>6. Individual data points</strong></p>
<p>Well first off, we can simply show the individual data points. This is first off necessary for ourselves, to really see what our data looks like, but it may actually already be a pretty good end point! Note that here we used geom_point and set the position to jitter with the position_jitter function so that we can control the width of the jittering. alpha is also set to 0.6 in case there is any residual over plotting.ok, so now we can start to see some strange patterns in our data set! First off, it’s pretty clear that we don’t have that much data for Insectivores, and that it anyways looks pretty strange. We can’t really say much about them, but if we had to say something it looks like they are bimodal. We’d need some more data to make better conclusions. Omnivores also look pretty interesting, it appears as though this data is positively skewed. So we can start drawing conclusions that were previously impossible to see.</p>
<p><strong>7. geom_errorbar()</strong></p>
<p>Of course we could still plot both the individual data points and the summary statistics with the geom errorbar</p>
<p><strong>8. geom_pointrange()</strong></p>
<p>or the geom pointrange.</p>
<p><strong>9. Without data points</strong></p>
<p>And it’s obvious that we could have simply shown these summary statistics by themselves.</p>
<p><strong>10. Bars are not necessary</strong></p>
<p>Notice that the error bars with points are a much cleaner representation of the data. The bars are simply not necessary! Now, none of these summary plots are particularly useful in this specific case, mostly because we know now that the insectivore and omnivore data sets are not suitable. Nonetheless they may be perfectly good alternatives for your data, so they are worth mentioning.There are some more plotting geometries that we’ll discuss in the next course when we get into statistical plots, such as box plots and violin plots are. Here I just want to mention that they are also alternatives, in general, but not necessarily in this situation.</p>
<p><strong>11. Ready for exercises!</strong></p>
<p>OK, let’s explore these concepts in more detail in the exercises.</p>
<section id="bar-plots-dynamite-plots" class="level3">
<h3 class="anchored" data-anchor-id="bar-plots-dynamite-plots">Bar plots: dynamite plots</h3>
<p>In the video we saw many reasons why “dynamite plots” (bar plots with error bars) are <em>not</em> well suited for their intended purpose of depicting distributions. If you <em>really</em> want error bars on bar plots, you can of course get them, but you’ll need to set the positions manually. A point geom will typically serve you much better.</p>
<p>Nonetheless, you should know how to handle these kinds of plots, so let’s give it a try.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using <code>mtcars,</code>, plot <code>wt</code> versus <code>fcyl</code>.</li>
<li>Add a bar summary stat, aggregating the <code>wt</code>s by their mean, filling the bars in a skyblue color.</li>
<li>Add an errorbar summary stat, aggregating the <code>wt</code>s by <code>mean_sdl</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="co"># Plot wt vs. fcyl</span></span>
<span id="cb106-2"><a href="#cb106-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> fcyl, <span class="at">y =</span> wt)) <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3"></a>  <span class="co"># Add a bar summary stat of means, colored skyblue</span></span>
<span id="cb106-4"><a href="#cb106-4"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb106-5"><a href="#cb106-5"></a>  <span class="co"># Add an errorbar summary stat std deviation limits</span></span>
<span id="cb106-6"><a href="#cb106-6"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl, <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>), <span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">width =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-83-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-77"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Excellent errors! Remember, we can specify any function in <code>fun.data</code> or <code>fun.y</code> and we can also specify any <code>geom</code>, as long as it’s appropriate to the data type.</p>
</section>
<section id="bar-plots-position-dodging" class="level3">
<h3 class="anchored" data-anchor-id="bar-plots-position-dodging">Bar plots: position dodging</h3>
<p>In the previous exercise we used the <code>mtcars</code> dataset to draw a dynamite plot about the weight of the cars per cylinder type.</p>
<p>In this exercise we will add a distinction between transmission type, <code>fam</code>, for the dynamite plots and explore position dodging (where bars are side-by-side).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add two more aesthetics so the bars are <code>color</code>ed and <code>fill</code>ed by <code>fam</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="co"># Update the aesthetics to color and fill by fam</span></span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> fcyl, <span class="at">y =</span> wt, <span class="at">color =</span> fam, <span class="at">fill =</span> fam)) <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"bar"</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl, <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>), <span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">width =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-84-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-78"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>The stacked bars are tricky to interpret. Make them transparent and side-by-side.</p>
<ul>
<li>Make the bar summary statistic transparent by setting <code>alpha</code> to <code>0.5</code>.</li>
<li>For each of the summary statistics, set the bars’ position to <code>"dodge"</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="co"># Set alpha for the first and set position for each stat summary function</span></span>
<span id="cb108-2"><a href="#cb108-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> fcyl, <span class="at">y =</span> wt, <span class="at">color =</span> fam, <span class="at">fill =</span> fam)) <span class="sc">+</span></span>
<span id="cb108-3"><a href="#cb108-3"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb108-4"><a href="#cb108-4"></a>    <span class="at">fun =</span> mean, </span>
<span id="cb108-5"><a href="#cb108-5"></a>    <span class="at">geom =</span> <span class="st">"bar"</span>, </span>
<span id="cb108-6"><a href="#cb108-6"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>, </span>
<span id="cb108-7"><a href="#cb108-7"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb108-9"><a href="#cb108-9"></a>    <span class="at">fun.data =</span> mean_sdl, </span>
<span id="cb108-10"><a href="#cb108-10"></a>    <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>), </span>
<span id="cb108-11"><a href="#cb108-11"></a>    <span class="at">geom     =</span> <span class="st">"errorbar"</span>, </span>
<span id="cb108-12"><a href="#cb108-12"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>, </span>
<span id="cb108-13"><a href="#cb108-13"></a>    <span class="at">width    =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-85-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-79"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>The error bars are incorrectly positioned. Use a position object.</p>
<ul>
<li>Define a dodge position object with width <code>0.9</code>, assigned to <code>posn_d</code>.</li>
<li>For each of the summary statistics, set the bars’ position to <code>posn_d</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="co"># Define a dodge position object with width 0.9</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>posn_d <span class="ot">&lt;-</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>)</span>
<span id="cb109-3"><a href="#cb109-3"></a></span>
<span id="cb109-4"><a href="#cb109-4"></a><span class="co"># For each summary stat, update the position to posn_d</span></span>
<span id="cb109-5"><a href="#cb109-5"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x     =</span> fcyl, </span>
<span id="cb109-6"><a href="#cb109-6"></a>                   <span class="at">y     =</span> wt, </span>
<span id="cb109-7"><a href="#cb109-7"></a>                   <span class="at">color =</span> fam, </span>
<span id="cb109-8"><a href="#cb109-8"></a>                   <span class="at">fill  =</span> fam)) <span class="sc">+</span></span>
<span id="cb109-9"><a href="#cb109-9"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb109-10"><a href="#cb109-10"></a>    <span class="at">fun      =</span> mean, </span>
<span id="cb109-11"><a href="#cb109-11"></a>    <span class="at">geom     =</span> <span class="st">"bar"</span>, </span>
<span id="cb109-12"><a href="#cb109-12"></a>    <span class="at">position =</span> posn_d, </span>
<span id="cb109-13"><a href="#cb109-13"></a>    <span class="at">alpha    =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb109-14"><a href="#cb109-14"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb109-15"><a href="#cb109-15"></a>    <span class="at">fun.data =</span> mean_sdl, </span>
<span id="cb109-16"><a href="#cb109-16"></a>    <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>), </span>
<span id="cb109-17"><a href="#cb109-17"></a>    <span class="at">width    =</span> <span class="fl">0.1</span>, </span>
<span id="cb109-18"><a href="#cb109-18"></a>    <span class="at">position =</span> posn_d, </span>
<span id="cb109-19"><a href="#cb109-19"></a>    <span class="at">geom     =</span> <span class="st">"errorbar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-86-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-80"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Bar plots 2.0! slightly overlapping bar plots are common in the popular press and add a bit of style to your data viz.</p>
</section>
<section id="bar-plots-using-aggregated-data" class="level3">
<h3 class="anchored" data-anchor-id="bar-plots-using-aggregated-data">Bar plots: Using aggregated data</h3>
<p>If it <em>is</em> appropriate to use bar plots (see the video!), then it nice to give an impression of the number of values in each group.</p>
<p><code>stat_summary()</code> doesn’t keep track of the count. <a href="http://www.rdocumentation.org/packages/ggplot2/functions/geom_count" target="_blank" rel="noopener noreferrer"><code>stat_sum()</code></a> does (that’s the whole point), but it’s difficult to access. It’s more straightforward to calculate exactly what we want to plot ourselves.</p>
<p>Here, we’ve created a summary data frame called <code>mtcars_by_cyl</code> which contains the average (<code>mean_wt</code>), standard deviations (<code>sd_wt</code>) and count (<code>n_wt</code>) of car weights, for each cylinder group, <code>cyl</code>. It also contains the proportion (<code>prop</code>) of each cylinder represented in the entire dataset. Use the console to familiarize yourself with the <code>mtcars_by_cyl</code> data frame.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Draw a bar plot with <code>geom_bar()</code>.</p>
<ul>
<li>Using <code>mtcars_by_cyl</code>, plot <code>mean_wt</code> versus <code>cyl</code>.</li>
<li>Add a bar layer, with <code>stat</code> set to <code>"identity"</code> an fill-color <code>"skyblue"</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="co"># data</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>mtcars_by_cyl <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> </span>
<span id="cb110-3"><a href="#cb110-3"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">|&gt;</span> </span>
<span id="cb110-4"><a href="#cb110-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_wt =</span> <span class="fu">mean</span>(wt),</span>
<span id="cb110-5"><a href="#cb110-5"></a>            <span class="at">sd_wt   =</span> <span class="fu">sd</span>(wt),</span>
<span id="cb110-6"><a href="#cb110-6"></a>            <span class="at">n_wt    =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb110-7"><a href="#cb110-7"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span>  n_wt<span class="sc">/</span><span class="fu">sum</span>(n_wt))</span>
<span id="cb110-8"><a href="#cb110-8"></a></span>
<span id="cb110-9"><a href="#cb110-9"></a><span class="co"># Using mtcars_cyl, plot mean_wt vs. cyl</span></span>
<span id="cb110-10"><a href="#cb110-10"></a><span class="fu">ggplot</span>(mtcars_by_cyl, <span class="fu">aes</span>(cyl, mean_wt)) <span class="sc">+</span></span>
<span id="cb110-11"><a href="#cb110-11"></a>  <span class="co"># Add a bar layer with identity stat, filled skyblue</span></span>
<span id="cb110-12"><a href="#cb110-12"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">fill=</span><span class="st">"skyblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-87-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-81"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>Draw the same plot with <code>geom_col()</code>.</p>
<ul>
<li>Replace <code>geom_bar()</code> with <code>geom_col()</code>.</li>
<li>Remove the <code>stat</code> argument.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="fu">ggplot</span>(mtcars_by_cyl, <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> mean_wt)) <span class="sc">+</span></span>
<span id="cb111-2"><a href="#cb111-2"></a>  <span class="co"># Swap geom_bar() for geom_col()</span></span>
<span id="cb111-3"><a href="#cb111-3"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-88-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-82"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>Change the bar widths to reflect the proportion of data they contain.</p>
<ul>
<li>Add a <code>width</code> aesthetic to <code>geom_col()</code>, set to <code>prop</code>. (<em>Ignore the warning from ggplot2.</em>)</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="fu">ggplot</span>(mtcars_by_cyl, <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> mean_wt)) <span class="sc">+</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>  <span class="co"># Set the width aesthetic to prop</span></span>
<span id="cb112-3"><a href="#cb112-3"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>,</span>
<span id="cb112-4"><a href="#cb112-4"></a>           <span class="fu">aes</span>(<span class="at">width =</span> prop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in geom_col(fill = "skyblue", aes(width = prop)): Ignoring unknown
#&gt; aesthetics: width</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-89-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-83"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><p>Add <code>geom_errorbar()</code>.</p>
<ul>
<li>Set the <code>ymin</code> aesthetic to <code>mean_wt</code> minus <code>sd_wt</code>. Set the <code>ymax</code> aesthetic to the mean weight plus the standard deviation of the weight.</li>
<li>Set the width to <code>0.1</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="fu">ggplot</span>(mtcars_by_cyl, <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> mean_wt)) <span class="sc">+</span></span>
<span id="cb114-2"><a href="#cb114-2"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">width =</span> prop), <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="co"># Add an errorbar layer</span></span>
<span id="cb114-4"><a href="#cb114-4"></a>  <span class="fu">geom_errorbar</span>(</span>
<span id="cb114-5"><a href="#cb114-5"></a>    <span class="co"># ... at mean weight plus or minus 1 std dev</span></span>
<span id="cb114-6"><a href="#cb114-6"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> mean_wt <span class="sc">-</span> sd_wt,</span>
<span id="cb114-7"><a href="#cb114-7"></a>        <span class="at">ymax =</span> mean_wt <span class="sc">+</span> sd_wt),</span>
<span id="cb114-8"><a href="#cb114-8"></a>    <span class="co"># with width 0.1</span></span>
<span id="cb114-9"><a href="#cb114-9"></a>    <span class="at">width =</span> <span class="fl">0.1</span></span>
<span id="cb114-10"><a href="#cb114-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in geom_col(aes(width = prop), fill = "skyblue"): Ignoring unknown
#&gt; aesthetics: width</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-90-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-84"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Awesome Aggregrates! This is a good start, but it’s difficult to adjust the spacing between the bars.</p>
</section>
</section>
<section id="heat-maps" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="heat-maps"><span class="header-section-number">4.2</span> Heat Maps</h2>
<section id="heatmaps-use-case-scenario" class="level3">
<h3 class="anchored" data-anchor-id="heatmaps-use-case-scenario">Heatmaps use case scenario</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. Heatmaps use case scenario</strong></p>
<p>I briefly mentioned before that heat maps are a poor data visualization method. It’s surprising, since they are really popular among scientists of all stripes. Let’s take a closer look.</p>
<p><strong>2. The barley dataset</strong></p>
<p>Our dataset is a classic in data visualization. We have four variables: The yield of 10 different barley varieties measured at two years and at 10 different sites.</p>
<p><strong>3. A basic heat map</strong></p>
<p>Our heat map is basically a colored table. Our three categorical variables are mapped onto x, y and fill. The continuous variable, yield, is mapped onto fill.So what’s wrong with this plot?Well, although there are some exceptions, color on a continuous scale is problematic. Color perception depends on context. Here, each color appears in a different background, which means that heat maps are not well-suited for seeing individual results. If our categories were clustered in a way the brings out overall trends, then we may make the case for a heat map, because it would at least communicate something. Often times this is not the case.Many times, heat maps look complex and try to impress the viewer with a meaningless “wow” factor.What would be a better alternative?</p>
<p><strong>4. A dot plot</strong></p>
<p>Here, we can switch the mapping of yield onto the x and year onto the color scale.Now we can ask very pointed questions, such as which variety performed best in a given year. How does a particular variety perform at a given site? To answer these questions, we use a process of slow table-look up type perception. It’s slow and time-consuming, but very useful.We can also start to see some trends. First, red, 1931, is mostly greater than blue, 1932. Second, the farms are arranged from lowest overall average, Grand Rapids, to highest, Waseca. Third, we can also notice a difference in spread among the farms. These large overall trends are discernible from this visualization, but they take a bit of time to see. How about an alternative?</p>
<p><strong>5. As a time series</strong></p>
<p>Typically, when you have a time scale, the key question is change over time. How do yields differ between the two years?This line plot shows that change for each variety over time. It has all the same information as the previous plot but it’s more difficult to answer the precise questions from before. However, it is an easier way to see the general trends in the data set. We’ve increased the speed of our perception.Notice that there are 10 colors for the 10 varieties. It’s getting pretty difficult to distinguish all the colors and we’re at the limits of visual perception. It still kind-of works, but it’s starting to push it.</p>
<p><strong>6. Using dodged error bars</strong></p>
<p>We can aggregate all the varieties by using their mean, and focus on the farms. We saw how to do this in the stat_summary section. Here I’ve used errorbars with some dodging.</p>
<p><strong>7. Using ribbons for error</strong></p>
<p>Alternatively, we could have also used ribbons without dodging. Both dodged error bars and overlapping ribbons work for showing uncertainty, the choice depends on the density of your data and your audience.In summary, there are many good alternatives to heat maps, depending on the research question and our take-home message.</p>
<p><strong>8. Coding Time!</strong></p>
<p>Let’s explore how to produce these plots in the exercises.</p>
</section>
<section id="heat-maps-1" class="level3">
<h3 class="anchored" data-anchor-id="heat-maps-1">Heat maps</h3>
<p>Since heat maps encode <em>color</em> on a continuous scale, they are difficult to accurately <em>decode</em>, a topic we discussed in the first course. Hence, heat maps are most useful if you have a small number of boxes and/or a clear pattern that allows you to overcome decoding difficulties.</p>
<p>To produce them, map two categorical variables onto the <code>x</code> and <code>y</code> aesthetics, along with a continuous variable onto <code>fill</code>. The <a href="http://www.rdocumentation.org/packages/ggplot2/functions/geom_tile" target="_blank" rel="noopener noreferrer"><code>geom_tile()</code></a> layer adds the boxes.</p>
<p>We’ll produce the heat map we saw in the video (in the viewer) with the built-in <code>barley</code> dataset. The <code>barley</code> dataset is in the <code>lattice</code> package and has already been loaded for you. Use <a href="http://www.rdocumentation.org/packages/utils/functions/str" target="_blank" rel="noopener noreferrer"><code>str()</code></a> to explore the structure.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using <code>barley</code>, plot <code>variety</code> versus <code>year</code>, filled by <code>yield</code>.</li>
<li>Add a <a href="http://www.rdocumentation.org/packages/ggplot2/functions/geom_tile" target="_blank" rel="noopener noreferrer"><code>geom_tile()</code></a> layer.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># data</span></span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="fu">library</span>(lattice)</span>
<span id="cb116-3"><a href="#cb116-3"></a></span>
<span id="cb116-4"><a href="#cb116-4"></a><span class="co"># Using barley, plot variety vs. year, filled by yield</span></span>
<span id="cb116-5"><a href="#cb116-5"></a><span class="fu">ggplot</span>(barley, <span class="fu">aes</span>(year, variety, <span class="at">fill =</span> yield)) <span class="sc">+</span></span>
<span id="cb116-6"><a href="#cb116-6"></a>  <span class="co"># Add a tile geom</span></span>
<span id="cb116-7"><a href="#cb116-7"></a>  <span class="fu">geom_tile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-91-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-85"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>3.. Add a <a href="http://www.rdocumentation.org/packages/ggplot2/functions/facet_wrap" target="_blank" rel="noopener noreferrer"><code>facet_wrap()</code></a> function with facets as <code>vars(site)</code> and <code>ncol = 1</code>. <em>Strip names will be above the panels, not to the side (as with <code>facet_grid()</code>).</em> 4. Give the heat maps a 2-color palette using <a href="http://www.rdocumentation.org/packages/ggplot2/functions/scale_gradient" target="_blank" rel="noopener noreferrer"><code>scale_fill_gradient()</code></a>. Set <code>low</code> and <code>high</code> to <code>"white"</code> and <code>"red"</code>, respectively.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="co"># Previously defined</span></span>
<span id="cb117-2"><a href="#cb117-2"></a><span class="fu">ggplot</span>(barley, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> variety, <span class="at">fill =</span> yield)) <span class="sc">+</span></span>
<span id="cb117-3"><a href="#cb117-3"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> </span>
<span id="cb117-4"><a href="#cb117-4"></a>  <span class="co"># Facet, wrapping by site, with 1 column</span></span>
<span id="cb117-5"><a href="#cb117-5"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(site), <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb117-6"><a href="#cb117-6"></a>  <span class="co"># Add a fill scale using an 2-color gradient</span></span>
<span id="cb117-7"><a href="#cb117-7"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-92-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-86"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li><p>A color palette of 9 reds, made with <a href="http://www.rdocumentation.org/packages/RColorBrewer/functions/ColorBrewer" target="_blank" rel="noopener noreferrer"><code>brewer.pal()</code></a>, is provided as <code>red_brewer_palette</code>.</p>
<ul>
<li>Update the fill scale to use an <em>n</em>-color gradient with <a href="http://www.rdocumentation.org/packages/ggplot2/functions/scale_gradient" target="_blank" rel="noopener noreferrer"><code>scale_fill_gradientn()</code></a> (note the <code>n</code>). Set the scale <code>colors</code> to the red brewer palette.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># A palette of 9 reds</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb118-3"><a href="#cb118-3"></a>red_brewer_palette <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">"Reds"</span>)</span>
<span id="cb118-4"><a href="#cb118-4"></a></span>
<span id="cb118-5"><a href="#cb118-5"></a><span class="co"># Update the plot</span></span>
<span id="cb118-6"><a href="#cb118-6"></a><span class="fu">ggplot</span>(barley, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> variety, <span class="at">fill =</span> yield)) <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> </span>
<span id="cb118-8"><a href="#cb118-8"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(site), <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb118-9"><a href="#cb118-9"></a>  <span class="co"># Update scale to use n-colors from red_brewer_palette</span></span>
<span id="cb118-10"><a href="#cb118-10"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> red_brewer_palette)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-93-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-87"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! You can continue by using breaks, limits and labels to modify the fill scale and update the theme, but this is a pretty good start.</p>
</section>
<section id="useful-heat-maps" class="level3">
<h3 class="anchored">Useful heat maps</h3>
<blockquote class="blockquote">
<h2 id="question" data-number="4.3" class="anchored" data-anchor-id="useful-heat-maps"><span class="header-section-number">4.3</span> <em>Question</em></h2>
<p>Heat maps are often a poor data viz solution because they typically don’t convey useful information. We saw a nice alternative in the last exercise. But sometimes they <em>are</em> really good. Which of the following scenarios is <em>not</em> one of those times?<br> <br> ⬜ When data has been sorted, e.g.&nbsp;according to a clustering algorithm, and we can see clear trends.<br> ⬜ When there are few groups with large differences.<br> ✅ When we have a large data set and we want to impress our colleagues with how complex our work is!<br> ⬜ When using explanatory plots to communicate a clear message to a non-scientific audience.<br></p>
</blockquote>
<p>Yes. This is typical and it’s why many people dislike heatmaps.</p>
</section>
<section id="heat-map-alternatives" class="level3">
<h3 class="anchored" data-anchor-id="heat-map-alternatives">Heat map alternatives</h3>
<p>There are several alternatives to heat maps. The best choice really depends on the data and the story you want to tell with this data. If there is a time component, the most obvious choice is a line plot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="co"># The heat map we want to replace</span></span>
<span id="cb119-2"><a href="#cb119-2"></a><span class="co"># Don't remove, it's here to help you!</span></span>
<span id="cb119-3"><a href="#cb119-3"></a><span class="fu">ggplot</span>(barley, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> variety, <span class="at">fill =</span> yield)) <span class="sc">+</span></span>
<span id="cb119-4"><a href="#cb119-4"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb119-5"><a href="#cb119-5"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> site, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-6"><a href="#cb119-6"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">"Reds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-94-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-88"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using <code>barley</code>, plot <code>yield</code> versus <code>year</code>, colored and grouped by <code>variety</code>.</li>
<li>Add a line layer.</li>
<li>Facet, wrapping by <code>site</code>, with 1 row.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># Using barley, plot yield vs. year, colored and grouped by variety</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="fu">ggplot</span>(barley, <span class="fu">aes</span>(year, yield, <span class="at">color =</span> variety, <span class="at">group =</span> variety)) <span class="sc">+</span></span>
<span id="cb120-3"><a href="#cb120-3"></a>  </span>
<span id="cb120-4"><a href="#cb120-4"></a>  <span class="co"># tie theme only allows for a max of 8 colors</span></span>
<span id="cb120-5"><a href="#cb120-5"></a>  <span class="fu">scale_color_hue</span>() <span class="sc">+</span></span>
<span id="cb120-6"><a href="#cb120-6"></a>  </span>
<span id="cb120-7"><a href="#cb120-7"></a>  <span class="co"># Add a line layer</span></span>
<span id="cb120-8"><a href="#cb120-8"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb120-9"><a href="#cb120-9"></a>  <span class="co"># Facet, wrapping by site, with 1 row</span></span>
<span id="cb120-10"><a href="#cb120-10"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> site, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-95-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-89"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><p>Display only means and ribbons for spread.</p>
<ul>
<li>Map <code>site</code> onto <code>color</code>, <code>group</code> and <code>fill</code>.</li>
<li>Add a <a href="http://www.rdocumentation.org/packages/ggplot2/functions/stat_summary" target="_blank" rel="noopener noreferrer"><code>stat_summary()</code></a> layer. set <code>fun.y = mean</code>, and <code>geom = "line"</code>.</li>
<li>In the second <a href="http://www.rdocumentation.org/packages/ggplot2/functions/stat_summary" target="_blank" rel="noopener noreferrer"><code>stat_summary()</code></a>, set <code>geom = "ribbon"</code>, <code>color = NA</code> and <code>alpha = 0.1</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="co"># Using barely, plot yield vs. year, colored, grouped, and filled by site</span></span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="fu">ggplot</span>(barley, <span class="fu">aes</span>(<span class="at">x =</span> year, </span>
<span id="cb121-3"><a href="#cb121-3"></a>                   <span class="at">y =</span> yield, </span>
<span id="cb121-4"><a href="#cb121-4"></a>                   <span class="at">color =</span> site, </span>
<span id="cb121-5"><a href="#cb121-5"></a>                   <span class="at">group =</span> site, </span>
<span id="cb121-6"><a href="#cb121-6"></a>                   <span class="at">fill  =</span> site)) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7"></a>  <span class="co"># Add a line summary stat aggregated by mean</span></span>
<span id="cb121-8"><a href="#cb121-8"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>) <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9"></a>  <span class="co"># Add a ribbon summary stat with 10% opacity, no color</span></span>
<span id="cb121-10"><a href="#cb121-10"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl, <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>), <span class="at">geom =</span> <span class="st">"ribbon"</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: The `fun.y` argument of `stat_summary()` is deprecated as of ggplot2 3.3.0.
#&gt; ℹ Please use the `fun` argument instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-96-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-90"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! Whenever you see a heat map, ask yourself it it’s really necessary. Many people use them because they look fancy and complicated - signs of poor communication skills.</p>
</section>
</section>
<section id="when-good-data-makes-bad-plots" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="when-good-data-makes-bad-plots"><span class="header-section-number">4.4</span> When good data makes bad plots</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. When good data makes bad plots</strong></p>
<p>So far, we’ve focused on making good plots, but it’s worthwhile to be able to identify and correct bad plots.</p>
<p><strong>2. Bad plots: style</strong></p>
<p>There are many ways in which we can have bad plots. Simple formatting errors like poor color and text choices make it difficult to read the data correctly or even make our plots look ugly. All text should also serve a purpose and be legible for our audience. Pause the video and take a minute to review the items listed here. You’ve probably seen them already in the wild.</p>
<p><strong>3. Bad plots: structure and content</strong></p>
<p>Deeper problems occur with structure and content. As the domain expert it’s your job to know if you are overloading a plot with too much information to simply impress your viewers, or if you are producing a useless plot just to fill us space.The axes, statistics and geometries must also be used effectively. It doesn’t hurt to reduce non-data ink and, finally, 3D plots should be avoided. Pause the video again and take a minute to review these topics before continuing.Let’s take a look at some common data viz pitfalls.</p>
<p><strong>4. Wrong orientation</strong></p>
<p>We typically read the y axis of a plot as a function of x, denoted f(x). That means that the variable on the y axis is a dependent variable of the independent x axis variable. Flipping the axes is confusing.</p>
<p><strong>5. Wrong orientation?</strong></p>
<p>But, actually, sometimes it works great! We saw this at the end of the last course,</p>
<p><strong>6. Wrong orientation?</strong></p>
<p>and in the last video. In both cases the axes were flipped to make them easier to read.</p>
<p><strong>7. Broken y-axes</strong></p>
<p>Broken y-axes are also popular. This compensates for a large range in the data set with a large gap between the high and low values.Unfortunately, the upper and lower parts are on different scales!</p>
<p><strong>8. Broken y-axes, replace with transformed data</strong></p>
<p>We would rather transform the scales. For example using a log 10 transformation, as shown here, or,</p>
<p><strong>9. Broken y-axes, use facets</strong></p>
<p>or more typically, use facets with free scales.</p>
<p><strong>10. 3D plots, without data on the 3rd axis</strong></p>
<p>The 3D plot is another favorite but often, the 3rd axis actually serves no purpose but to confuse the audience as to which part of the geometry should be read on the scale.</p>
<p><strong>11. 3D plots, with data on the 3rd axis</strong></p>
<p>Sometimes 3D plots really do contain information in the 3rd axis, like 3D scatter plots. But can you figure out the position of each dot in this plot? It just adds to obscuring our data. Ideally we’d like to provide this as an interactive object or else as a series of two dimensional plots.</p>
<p><strong>12. Double y-axes</strong></p>
<p>Double y-axes are also problematic but popular.Perceptual challenges in reading the data make this difficult, and it also invites suspicious activity since the scales are independent and the visual message can be manipulated to emphasis or diminish the perceived correlation by changing the range of values on the scale.If the two values are to be correlated then we should have an x-y plot that shows the correlation.</p>
<p><strong>13. Double y-axis for transformations</strong></p>
<p>We did actually see a great example of double x and y-axes in the second chapter, when we had a raw and transformed scale.</p>
<p><strong>14. Guidelines not rules</strong></p>
<p>But, remember, there are very few rules in data visualization, which is what makes it so interesting and difficult.Just use your common sense – if anything on your plot obscures communication it is at worst unethical and at best poor execution.I hope that by now you are also a critical consumer of data visualization and are not so easily fooled by other people’s poor judgement or purposeful misdirection.</p>
<p><strong>15. Let’s practice!</strong></p>
<p>We’ll explore the bits that we can fix in ggplot2 in the exercises, so let’s get started.</p>
<section id="suppression-of-the-origin" class="level3">
<h3 class="anchored">Suppression of the origin</h3>
<blockquote class="blockquote">
<h2 id="question-1" data-number="4.5" class="anchored" data-anchor-id="suppression-of-the-origin"><span class="header-section-number">4.5</span> <em>Question</em></h2>
<p>Suppression of the origin refers to <em>not</em> showing 0 on a continuous scale. When is it inappropriate to suppress the origin?<br> <br> ✅ When the scale <em>has</em> a natural zero, like height or distance.<br> ⬜ When the scale <em>doesn’t have</em> a natural zero, like temperature (in C or F).<br> ⬜ When there is a large amount of whitespace between the origin and the actual data.<br> ⬜ When it does not obscure the shape of the data.<br></p>
</blockquote>
<p>Correct. This would be a good reason to begin at 0, but it’s not strictly necessary and not always appropriate.</p>
</section>
<section id="color-blindness" class="level3">
<h3 class="anchored">Color blindness</h3>
<p>Red-Green color blindness is surprisingly prevalent, which means that part of your audience will not be able to ready your plot if you are relying on color aesthetics.</p>
<blockquote class="blockquote">
<h2 id="question-2" data-number="4.6" class="anchored" data-anchor-id="color-blindness"><span class="header-section-number">4.6</span> <em>Question</em></h2>
<p>Why would it be appropriate to use red and green in a plot?<br> <br> ⬜ When red and green are the actual colors in the sample (e.g.&nbsp;fluorescence in biological assays).<br> ⬜ When red means stop/bad and green means go/good.<br> ⬜ Because red and green are complimentary colors and look great together.<br> ✅ When red and green have different intensities (e.g.&nbsp;light red and dark green).<br></p>
</blockquote>
<p>If you really want to use red and green, this is a way to make them accessible to color blind people, since they sill still be able to distinguish intensity. It’s not as salient as hue, but it still works.</p>
</section>
<section id="typical-problems" class="level3">
<h3 class="anchored" data-anchor-id="typical-problems">Typical problems</h3>
<p>When you first encounter a data visualization, either from yourself or a colleague, you always want to critically ask if it’s obscuring the data in any way.</p>
<p>Let’s take a look at the steps we could take to produce and improve the plot in the view.</p>
<p>The data comes from an experiment where the effect of two different types of vitamin C sources, orange juice or ascorbic acid, were tested on the growth of the odontoblasts (cells responsible for tooth growth) in 60 guinea pigs.</p>
<p>The data is stored in the <code>TG</code> data frame, which contains three variables: <code>dose</code>, <code>len</code>, and <code>supp</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>The first plot contains purposely illegible labels. It’s a common problem that can occur when resizing plots. There is also too much non-data ink.</p>
<ul>
<li>Change <code>theme_gray(3)</code> to <code>theme_classic()</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="co"># data</span></span>
<span id="cb123-2"><a href="#cb123-2"></a><span class="fu">data</span>(<span class="st">"ToothGrowth"</span>)</span>
<span id="cb123-3"><a href="#cb123-3"></a>TG <span class="ot">&lt;-</span> ToothGrowth</span>
<span id="cb123-4"><a href="#cb123-4"></a></span>
<span id="cb123-5"><a href="#cb123-5"></a><span class="co"># Initial plot</span></span>
<span id="cb123-6"><a href="#cb123-6"></a>growth_by_dose <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(TG, <span class="fu">aes</span>(dose, len, <span class="at">color =</span> supp)) <span class="sc">+</span></span>
<span id="cb123-7"><a href="#cb123-7"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl,</span>
<span id="cb123-8"><a href="#cb123-8"></a>               <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb123-9"><a href="#cb123-9"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb123-10"><a href="#cb123-10"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb123-11"><a href="#cb123-11"></a></span>
<span id="cb123-12"><a href="#cb123-12"></a><span class="co"># View plot</span></span>
<span id="cb123-13"><a href="#cb123-13"></a>growth_by_dose</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-97-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-91"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>Our previous plot still has a major problem, <code>dose</code> is stored as a <code>factor</code> variable. That’s why the spacing is off between the levels.</p>
<ul>
<li>Use <code>as.character()</code> wrapped in <code>as.numeric()</code> to convert the factor variable to real (continuous) numbers.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="co"># Change type</span></span>
<span id="cb124-2"><a href="#cb124-2"></a>TG<span class="sc">$</span>dose <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(TG<span class="sc">$</span>dose))</span>
<span id="cb124-3"><a href="#cb124-3"></a></span>
<span id="cb124-4"><a href="#cb124-4"></a><span class="co"># Plot</span></span>
<span id="cb124-5"><a href="#cb124-5"></a>growth_by_dose <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(TG, <span class="fu">aes</span>(dose, len, <span class="at">color =</span> supp)) <span class="sc">+</span></span>
<span id="cb124-6"><a href="#cb124-6"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl,</span>
<span id="cb124-7"><a href="#cb124-7"></a>               <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb124-8"><a href="#cb124-8"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb124-9"><a href="#cb124-9"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb124-10"><a href="#cb124-10"></a></span>
<span id="cb124-11"><a href="#cb124-11"></a><span class="co"># View plot</span></span>
<span id="cb124-12"><a href="#cb124-12"></a>growth_by_dose</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-98-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-92"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>Use the appropriate geometry for the data:</p>
<ul>
<li>In the new <code>stat_summary()</code> function, set <code>fun.y</code> to to calculate the <code>mean</code> and the <code>geom</code> to a <code>"line"</code> to connect the points at their mean values.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="co"># Change type</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>TG<span class="sc">$</span>dose <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(TG<span class="sc">$</span>dose))</span>
<span id="cb125-3"><a href="#cb125-3"></a></span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="co"># Plot</span></span>
<span id="cb125-5"><a href="#cb125-5"></a>growth_by_dose <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(TG, <span class="fu">aes</span>(dose, len, <span class="at">color =</span> supp)) <span class="sc">+</span></span>
<span id="cb125-6"><a href="#cb125-6"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl,</span>
<span id="cb125-7"><a href="#cb125-7"></a>               <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb125-8"><a href="#cb125-8"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb125-9"><a href="#cb125-9"></a>  <span class="co"># Use the right geometry</span></span>
<span id="cb125-10"><a href="#cb125-10"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean,</span>
<span id="cb125-11"><a href="#cb125-11"></a>               <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb125-12"><a href="#cb125-12"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb125-13"><a href="#cb125-13"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb125-14"><a href="#cb125-14"></a></span>
<span id="cb125-15"><a href="#cb125-15"></a><span class="co"># View plot</span></span>
<span id="cb125-16"><a href="#cb125-16"></a>growth_by_dose</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-99-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-93"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><p>Make sure the labels are informative:</p>
<ul>
<li>Add the units <code>"(mg/day)"</code> and <code>"(mean, standard deviation)"</code> to the x and y labels, respectively.</li>
<li>Use the <code>"Set1"</code> palette.</li>
<li>Set the legend labels to <code>"Orange juice"</code> and <code>"Ascorbic acid"</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="co"># Change type</span></span>
<span id="cb126-2"><a href="#cb126-2"></a>TG<span class="sc">$</span>dose <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(TG<span class="sc">$</span>dose))</span>
<span id="cb126-3"><a href="#cb126-3"></a></span>
<span id="cb126-4"><a href="#cb126-4"></a><span class="co"># Plot</span></span>
<span id="cb126-5"><a href="#cb126-5"></a>growth_by_dose <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(TG, <span class="fu">aes</span>(dose, len, <span class="at">color =</span> supp)) <span class="sc">+</span></span>
<span id="cb126-6"><a href="#cb126-6"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl,</span>
<span id="cb126-7"><a href="#cb126-7"></a>               <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb126-8"><a href="#cb126-8"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb126-9"><a href="#cb126-9"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean,</span>
<span id="cb126-10"><a href="#cb126-10"></a>               <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb126-11"><a href="#cb126-11"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb126-12"><a href="#cb126-12"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb126-13"><a href="#cb126-13"></a>  <span class="co"># Adjust labels and colors:</span></span>
<span id="cb126-14"><a href="#cb126-14"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Dose (mg/day)"</span>, <span class="at">y =</span> <span class="st">"Odontoblasts length (mean, standard deviation)"</span>, <span class="at">color =</span> </span>
<span id="cb126-15"><a href="#cb126-15"></a><span class="st">"Supplement"</span>) <span class="sc">+</span></span>
<span id="cb126-16"><a href="#cb126-16"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Orange juice"</span>, <span class="st">"Ascorbic acid"</span>)) <span class="sc">+</span></span>
<span id="cb126-17"><a href="#cb126-17"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">35</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">35</span>, <span class="dv">5</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb126-18"><a href="#cb126-18"></a></span>
<span id="cb126-19"><a href="#cb126-19"></a><span class="co"># View plot</span></span>
<span id="cb126-20"><a href="#cb126-20"></a>growth_by_dose</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="ggplot2_intermediate_files/figure-html/unnamed-chunk-100-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-94"><img src="ggplot2_intermediate_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../../../content/R/topics/04_data_visualization/introduction_to_data_visualization_with_ggplot2/ggplot2_intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">4.1: Introduction to Data Visualization with ggplot2</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2022 by <a href="https://www.startupengineer.io/authors/schwarz/">Joschka Schwarz</a> <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/jwarz/jwarz.github.io">View the source at GitHub</a></div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","descPosition":"bottom","selector":".lightbox","loop":true,"closeEffect":"zoom"});</script>



<script src="../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>