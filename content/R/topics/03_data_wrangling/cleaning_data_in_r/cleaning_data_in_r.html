<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joschka Schwarz">

<title>Joschka Schwarz - Cleaning data in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Joschka Schwarz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-science" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Science</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-science">    
        <li>
    <a class="dropdown-item" href="../../../../../content/R/index.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/python/index.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/sql/index.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../../slides/index.html">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../resumes/index.html">
 <span class="menu-text">Resumes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jwarz/"><i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/j-schwarz"><i class="bi bi-linkedin" role="img" aria-label="Quarto LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#common-data-problems" id="toc-common-data-problems" class="nav-link active" data-scroll-target="#common-data-problems">1. Common Data Problems</a>
  <ul class="collapse">
  <li><a href="#data-type-constraints" id="toc-data-type-constraints" class="nav-link" data-scroll-target="#data-type-constraints">Data type constraints</a></li>
  <li><a href="#common-data-types" id="toc-common-data-types" class="nav-link" data-scroll-target="#common-data-types">Common data types</a></li>
  <li><a href="#time-and-date-classes" id="toc-time-and-date-classes" class="nav-link" data-scroll-target="#time-and-date-classes">Time and Date Classes</a></li>
  <li><a href="#converting-data-types" id="toc-converting-data-types" class="nav-link" data-scroll-target="#converting-data-types">Converting data types</a></li>
  <li><a href="#trimming-strings" id="toc-trimming-strings" class="nav-link" data-scroll-target="#trimming-strings">Trimming strings</a></li>
  <li><a href="#constraints" id="toc-constraints" class="nav-link" data-scroll-target="#constraints">Constraints</a></li>
  </ul></li>
  <li><a href="#categorical-and-text-data" id="toc-categorical-and-text-data" class="nav-link" data-scroll-target="#categorical-and-text-data">2. Categorical and Text Data</a>
  <ul class="collapse">
  <li><a href="#checking-membership" id="toc-checking-membership" class="nav-link" data-scroll-target="#checking-membership">Checking membership</a></li>
  <li><a href="#membership-constraints" id="toc-membership-constraints" class="nav-link" data-scroll-target="#membership-constraints">Membership constraints</a></li>
  <li><a href="#categorical-data-problems" id="toc-categorical-data-problems" class="nav-link" data-scroll-target="#categorical-data-problems">Categorical data problems</a></li>
  <li><a href="#identifying-inconsistent-categorical-data" id="toc-identifying-inconsistent-categorical-data" class="nav-link" data-scroll-target="#identifying-inconsistent-categorical-data">Identifying inconsistent categorical data</a></li>
  <li><a href="#correcting-inconsistent-categorical-data" id="toc-correcting-inconsistent-categorical-data" class="nav-link" data-scroll-target="#correcting-inconsistent-categorical-data">Correcting inconsistent categorical data</a></li>
  <li><a href="#cleaning-text-data" id="toc-cleaning-text-data" class="nav-link" data-scroll-target="#cleaning-text-data">Cleaning text data</a></li>
  <li><a href="#detecting-inconsistent-text-data" id="toc-detecting-inconsistent-text-data" class="nav-link" data-scroll-target="#detecting-inconsistent-text-data">Detecting inconsistent text data</a></li>
  <li><a href="#correcting-inconsistent-text-data" id="toc-correcting-inconsistent-text-data" class="nav-link" data-scroll-target="#correcting-inconsistent-text-data">Correcting inconsistent text data</a></li>
  <li><a href="#uniformity" id="toc-uniformity" class="nav-link" data-scroll-target="#uniformity">Uniformity</a></li>
  <li><a href="#cross-field-validation" id="toc-cross-field-validation" class="nav-link" data-scroll-target="#cross-field-validation">Cross field validation</a></li>
  <li><a href="#completeness" id="toc-completeness" class="nav-link" data-scroll-target="#completeness">Completeness</a></li>
  </ul></li>
  <li><a href="#record-linkage" id="toc-record-linkage" class="nav-link" data-scroll-target="#record-linkage">3. Record Linkage</a>
  <ul class="collapse">
  <li><a href="#comparing-strings" id="toc-comparing-strings" class="nav-link" data-scroll-target="#comparing-strings">Comparing strings</a></li>
  <li><a href="#stringdist-calculating-distance" id="toc-stringdist-calculating-distance" class="nav-link" data-scroll-target="#stringdist-calculating-distance">stringdist(): Calculating distance</a></li>
  <li><a href="#fuzzyjoin-fixing-typos-with-string-distance" id="toc-fuzzyjoin-fixing-typos-with-string-distance" class="nav-link" data-scroll-target="#fuzzyjoin-fixing-typos-with-string-distance">fuzzyjoin(): Fixing typos with string distance</a></li>
  <li><a href="#generating-and-comparing-pairs" id="toc-generating-and-comparing-pairs" class="nav-link" data-scroll-target="#generating-and-comparing-pairs">Generating and comparing pairs</a></li>
  <li><a href="#reclin-linking-records-with-pair-blocking" id="toc-reclin-linking-records-with-pair-blocking" class="nav-link" data-scroll-target="#reclin-linking-records-with-pair-blocking">reclin: Linking records with Pair Blocking</a></li>
  <li><a href="#scoring-and-linking" id="toc-scoring-and-linking" class="nav-link" data-scroll-target="#scoring-and-linking">Scoring and linking</a></li>
  <li><a href="#congratulations" id="toc-congratulations" class="nav-link" data-scroll-target="#congratulations">Congratulations!</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jwarz/jwarz.github.io/edit/main/content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jwarz/jwarz.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cleaning data in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joschka Schwarz </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><strong>Short Description</strong></p>
<p>Develop the skills you need to go from raw data to awesome insights as quickly and accurately as possible.</p>
<p><strong>Long Description</strong></p>
<p>It’s commonly said that data scientists spend 80% of their time cleaning and manipulating data and only 20% of their time analyzing it. The time spent cleaning is vital since analyzing dirty data can lead you to draw inaccurate conclusions.</p>
<p>In this section, you’ll learn how to clean dirty data. Using R, you’ll learn how to identify values that don’t look right and fix dirty data by converting data types, filling in missing values, and using fuzzy string matching. As you learn, you’ll brush up on your skills by working with real-world datasets, including bike-share trips, customer asset portfolios, and restaurant reviews—developing the skills you need to go from raw data to awesome insights as quickly and accurately as possible!</p>
<section id="common-data-problems" class="level1">
<h1>1. Common Data Problems</h1>
<p>In this part, you’ll learn how to overcome some of the most common dirty data problems. You’ll convert data types, apply range constraints to remove future data points, and remove duplicated data points to avoid double-counting.</p>
<section id="data-type-constraints" class="level2">
<h2 class="anchored" data-anchor-id="data-type-constraints">Data type constraints</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Data type constraints</strong></p>
<p>Hi and welcome to the course. My name is Maggie, and I’ll be guiding you as you learn how to clean data in R.</p>
<p><strong>2. Course outline</strong></p>
<p>In this course, you’ll learn how to diagnose and locate different problems in your data and how they can can come up during your workflow.</p>
<p><strong>3. Course outline</strong></p>
<p>You’ll also learn about what can go wrong if your data isn’t properly cleaned,</p>
<p><strong>4. Course outline</strong></p>
<p>and how to address different types of dirty data.</p>
<p><strong>5. Course outline</strong></p>
<p>In this chapter, we’ll discuss the most common problems you might encounter and how to address them. Let’s get started!</p>
<p><strong>6. Why do we need clean data?</strong></p>
<p>To understand why we need clean data, let’s take a look at the data science workflow.In a typical data science workflow, we usually access raw data first, explore and process it, then develop insights. Finally, we report these insights.</p>
<p><strong>7. Why do we need clean data?</strong></p>
<p>Dirty data can appear before we even access the data, due to mistakes such as typos and misspellings.</p>
<p><strong>8. Why do we need clean data?</strong></p>
<p>If we don’t address these mistakes early on, they’ll follow us through our entire workflow, which means we could end up drawing incorrect conclusions.</p>
<p><strong>9. Data type constraints</strong></p>
<p>You’ve probably encountered different types of data before, such as text, numbers, categories, and dates. Each of these data types is treated differently, so if each variable isn’t the correct data type, we risk compromising our analysis.</p>
<p><strong>10. Glimpsing at data types</strong></p>
<p>Let’s look at an example. Here’s a data frame containing revenue generated and quantity of items sold for different sales orders.To look at the data types of each column in “sales”, we can load the dplyr package and use glimpse. This gives us the data type for each column. The order ID and quantity have data type “dbl” or double, which is the same thing as numeric - double is just a way of specifying how many decimal places the number can have. However, the revenue column has the data type character, when it should be numeric.</p>
<p><strong>11. Checking data types</strong></p>
<p>We can use the is-dot-numeric function on the revenue column and see that it’s not numeric.Another way to do this check is to use the assert_is_numeric function from the assertive package. This provides extra protection because it will throw an error and stop our script from running, so we’ll immediately know that something’s amiss.If we call assert_is_numeric on something that is numeric, nothing is returned.</p>
<p><strong>12. Checking data types</strong></p>
<p>All data types have an is-dot function that returns TRUE or FALSE and an assert-is function that returns nothing or an error.</p>
<p><strong>13. Why does data type matter?</strong></p>
<p>We can use the class function on the revenue column to see that it’s a character type.If we want to know what the average revenue is, we get an NA and a warning, since taking the mean of text doesn’t make much sense. This is why it’s important to check that our data types are what we expect. Otherwise, we might think we’re getting one thing, in this case an average, when we’re actually getting something completely different, which is an NA. We’ll need to convert this column to a numeric type in order to get the average.</p>
<p><strong>14. Comma problems</strong></p>
<p>Printing revenue shows a comma in each number. We’ll need to remove them before converting the strings to numbers.</p>
<p><strong>15. Character to number</strong></p>
<p>This can be done using str_remove from the stringr package. The first argument is the string that we want to remove from, which is the revenue column. The second argument is what we want to remove, the comma. If we look at revenue_trimmed, all the commas are gone!To convert revenue_trimmed to a numeric type, we pass it into as-dot-numeric.</p>
<p><strong>16. Putting it together</strong></p>
<p>We can put it all together into the sales data frame by calling mutate. We create a new column called revenue_usd using str_remove and as-dot-numeric.</p>
<p><strong>17. Same function, different outcomes</strong></p>
<p>Now, taking the mean of revenue_usd gives us the average revenue, instead of the NA that we got earlier.</p>
<p><strong>18. Converting data types</strong></p>
<p>Just like the is-dot and assert-is functions, there are as-dot functions to convert to any data type.</p>
<p><strong>19. Watch out: factor to numeric</strong></p>
<p>Be careful when converting a factor to a numeric. Factors are a data type that represent a limited set of possible categories. Here, we have a product_type vector, which is a factor. 1000 represents clothing, 2000 represents food, and 3000 represents electronics.If we call as-numeric on product_type, we get these numbers, which isn’t what we’re looking for. This is due to the way that factors are encoded in R. Instead, we need to use as-character first, and then as-numeric.</p>
<p><strong>20. Let’s practice!</strong></p>
<p>Time to use your new knowledge of data types!</p>
</section>
<section id="common-data-types" class="level2">
<h2 class="anchored" data-anchor-id="common-data-types">Common data types</h2>
<p>Since different data types are treated and act differently, it’s important to be able to identify the data type that’s most suitable for the data you’re working with. Here, you’ll learn match different data with the data type that makes the data easiest to process and extract insights from.</p>
<table class="table">
<thead>
<tr class="header">
<th>Data type</th>
<th>Example</th>
<th>R Data type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Text</td>
<td>First name, Last name, address, …</td>
<td><code>character</code></td>
</tr>
<tr class="even">
<td>Integer</td>
<td>Subscriber Count, # Products sold, …</td>
<td><code>integer</code></td>
</tr>
<tr class="odd">
<td>Decimal</td>
<td>Temperature, exchange rate, …</td>
<td><code>numeric</code></td>
</tr>
<tr class="even">
<td>Binary</td>
<td>Is married, new customer, yes/no, …</td>
<td><code>logical</code></td>
</tr>
<tr class="odd">
<td>Category</td>
<td>Marriage status, color, …</td>
<td><code>factor</code></td>
</tr>
<tr class="even">
<td>Date</td>
<td>Order dates, date of birth, …</td>
<td><code>date</code></td>
</tr>
</tbody>
</table>
<p>The data types <code>raw</code> and <code>complex</code> will not be discussed in this section.</p>
<hr>
</section>
<section id="time-and-date-classes" class="level2">
<h2 class="anchored" data-anchor-id="time-and-date-classes">Time and Date Classes</h2>
<p>There are a variety of different types specific to time data fields in R.</p>
<p><strong>Date</strong></p>
<p>The <code>as.Date()</code> format doesn’t store any time information. When we use the <code>as.Date()</code> method to convert a date stored as a character class to an R date class, it will ignore all values after the date string.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">help</span>(DateTimeClasses)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># Convert character data to date (no time) </span></span>
<span id="cb1-3"><a href="#cb1-3"></a>d <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-01-01 10:15"</span>)   </span>
<span id="cb1-4"><a href="#cb1-4"></a>d</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; [1] "2020-01-01"</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">class</span>(d)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; [1] "Date"</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># to see the data in the 'raw' format, i.e., not formatted according to the class type to show us a date we recognize, use the `unclass()` function.</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">unclass</span>(d)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; [1] 18262</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">typeof</span>(d)</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; [1] "double"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><sup>Created on 2022-02-27 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v2.0.1)</sup></p>
<p>Internally, <code>Date</code> objects are stored as the number of days since January 1, 1970, using negative numbers for earlier dates. The <code>as.numeric()</code> / <code>unclass()</code> function can be used to convert a <code>Date</code> object to its internal form.</p>
<blockquote class="blockquote">
<p>Data Tip: The <code>unclass()</code> method in R allows you to view how a particular R object is stored.</p>
</blockquote>
<p>If we have a column containing both date and time we need to use a class that stores both date AND time. Base R offers two closely related classes for date and time: <code>POSIXct</code> and <code>POSIXlt</code>. To get the current time, the <code>Sys.time()</code> can be used, and you can play around a bit with the basic types to get a feel for what R is doing. The <code>as.POSIXct()</code> and <code>as.POSIXlt()</code> commands are used to convert the time value into the different formats.</p>
<p><strong>POSIXct</strong></p>
<p>The <code>as.POSIXct()</code> method converts a date-time string into a <code>POSIXct</code> class. <code>as.POSIXct()</code> stores both a date and time with an associated time zone. The default time zone selected, is the time zone that your computer is set to which is most often your local time zone. If you do not use a timezone specifically, <code>POSIXct</code> and <code>POSIXlt</code> will reference to your local timezone. However, this is not entirely reliable. It will not display the timezone in the output string. If you do want to avoid ambiguous behaviour, you have to specifiy a time zone.</p>
<p><code>POSIXct</code> stores date and time in seconds with the number of seconds beginning at 1 January 1970. Negative numbers are used to store dates prior to 1970. Thus, the <code>POSIXct</code> format stores each date and time a single value in units of seconds. Storing the data this way, optimizes use in data.frames and speeds up computation, processing and conversion to other formats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>t <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a>t</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; [1] "2022-02-27 12:02:23 CET"</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">class</span>(t)</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; [1] "POSIXct" "POSIXt"</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">unclass</span>(t)</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; [1] 1645959743</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="fu">typeof</span>(t)</span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; [1] "double"</span></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="fu">attr</span>(t, <span class="st">"tzone"</span>)</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; NULL</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="fu">attr</span>(t, <span class="st">"tzone"</span>) <span class="ot">&lt;-</span> <span class="st">"CET"</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="fu">unclass</span>(t)</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; [1] 1645959743</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; attr(,"tzone")</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; [1] "CET"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><sup>Created on 2022-02-27 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v2.0.1)</sup></p>
<p><strong>POSIXlt</strong></p>
<p>When we convert the data to <code>POSIXlt</code>, and view it in R, it still looks similar to the <code>POSIXct</code> format. However, <code>unclass()</code> shows us that the data are stored differently. The <code>POSIXlt</code> class stores the data separately in a list. The entries have the following meanings:</p>
<ul>
<li>seconds</li>
<li>minutes</li>
<li>hours</li>
<li>day of month (1-31)</li>
<li>month of the year (0-11)</li>
<li>years since 1900</li>
<li>day of the week (0-6 where 0 represents Sunday)</li>
<li>day of the year (0-365)</li>
<li>Daylight savings indicator (positive if it is daylight savings)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>l <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="fu">Sys.time</span>())</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">unclass</span>(l)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt; $sec</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; [1] 53.80329</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt; </span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; $min</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; [1] 8</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; $hour</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; [1] 12</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; $mday</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; [1] 27</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; $mon</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; </span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; $year</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; [1] 122</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt; </span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; $wday</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">#&gt; </span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt; $yday</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; [1] 57</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">#&gt; </span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">#&gt; $isdst</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="co">#&gt; </span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">#&gt; $zone</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">#&gt; [1] "CET"</span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">#&gt; </span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">#&gt; $gmtoff</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">#&gt; [1] 3600</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="co">#&gt; </span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">#&gt; attr(,"tzone")</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co">#&gt; [1] ""     "CET"  "CEST"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><sup>Created on 2022-02-27 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v2.0.1)</sup></p>
<p>Part of the difficulty with time data types is that R prints them out in a way that is different from how it stores them internally. This can make type conversions tricky, and you have to be careful and test your operations to insure that R is doing what you think it is doing.</p>
<hr>
<section id="checking-data-types" class="level3">
<h3 class="anchored" data-anchor-id="checking-data-types">Checking data types</h3>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Logical checking</strong> - returns <code>TRUE</code> / <code>FALSE</code></th>
<th><code>assertive</code> checking - error when <code>FALSE</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>is.character()</code></td>
<td><code>assert_is_character()</code></td>
</tr>
<tr class="even">
<td><code>is.numeric()</code></td>
<td><code>assert_is_numeric()</code></td>
</tr>
<tr class="odd">
<td><code>is.logical()</code></td>
<td><code>assert_is_logical()</code></td>
</tr>
<tr class="even">
<td><code>is.factor()</code></td>
<td><code>assert_is_factor()</code></td>
</tr>
<tr class="odd">
<td><code>is.date()</code></td>
<td><code>assert_is_date()</code></td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Alternatively, you can use Hadley Wickham’s <code>assertthat</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># Using base r</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="fu">stopifnot</span>(<span class="fu">is.character</span>(x))</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; Error: is.character(x) is not TRUE</span></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># Using assertthat</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="fu">library</span>(assertthat)</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="fu">assert_that</span>(<span class="fu">is.character</span>(x))</span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; Error: x is not a character vector</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="fu">assert_that</span>(<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">5</span>)</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; Error: length(x) not equal to 5</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="fu">assert_that</span>(<span class="fu">is.numeric</span>(x))</span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><sup>Created on 2022-02-26 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v2.0.1)</sup></p>
</section>
</section>
<section id="converting-data-types" class="level2">
<h2 class="anchored" data-anchor-id="converting-data-types">Converting data types</h2>
<p><strong>Data</strong></p>
<ul>
<li><code>bike_share_rides</code></li>
</ul>
<p>Throughout this section, we’ll be working with San Francisco bike share ride data called <code>bike_share_rides</code>. It contains information on start and end stations of each trip, the trip duration, and some user information.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code><a href="http://dplyr.tidyverse.org">dplyr</a></code></li>
<li><code><a href="https://github.com/cran/assertive">assertive</a></code>
<ul>
<li><code><a href="https://github.com/hadley/assertthat">assertthat</a></code></li>
</ul></li>
<li><code><a href="http://forcats.tidyverse.org">forcats</a></code></li>
<li><code><a href="http://tibble.tidyverse.org">tibble</a></code></li>
</ul>
<p><strong>Steps</strong></p>
<p>Before beginning to analyze any dataset, it’s important to take a look at the different types of columns we’ll be working with, which we can do using <code>glimpse()</code>.</p>
<p>At first, we’ll take a look at the data types contained in <code>bike_share_rides</code> and see how an incorrect data type can flaw your analysis.</p>
<ol type="1">
<li>Examine the data types of the columns of <code>bike_share_rides</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Libraries</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(tibble)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="fu">library</span>(assertive)</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># 1. Load &amp; glimpse at bike_share_rides</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>bike_share_rides <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/bike_share_rides.rds"</span>)</span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="fu">glimpse</span>(bike_share_rides)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Get a summary of the <code>user_birth_year</code> column of <code>bike_share_rides</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># 2. Summary of user_birth_year</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">summary</span>(bike_share_rides<span class="sc">$</span>user_birth_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question" class="anchored"><em>Question</em></h2>
<p>The summary statistics of <code>user_birth_year</code> don’t seem to offer much useful information about the different birth years in our dataset. Why do you think that is?<br> <br> ⬜ The <code>user_birth_year</code> column is not of the correct type and should be converted to a character.<br> ⬜ The <code>user_birth_year</code> column has an infinite set of possible values and should be converted to a factor.<br> ✅ The <code>user_birth_year</code> column represents groupings of data and should be converted to a factor.<br></p>
</blockquote>
<ol start="3" type="1">
<li>Add a new column to <code>bike_share_rides</code> called <code>user_birth_year_fct</code>, which contains <code>user_birth_year</code>, converted to a factor.</li>
<li>Assert that the <code>user_birth_year_fct</code> is a factor to confirm the conversion.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Libraries</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">library</span>(forcats)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># 3. Convert user_birth_year to factor: user_birth_year_fct</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>bike_share_rides <span class="ot">&lt;-</span> bike_share_rides <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">mutate</span>(<span class="at">user_birth_year_fct =</span> <span class="fu">as_factor</span>(user_birth_year))</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co"># 4. Assert user_birth_year_fct is a factor</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="fu">assert_is_factor</span>(bike_share_rides<span class="sc">$</span>user_birth_year_fct)</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co"># Summary of user_birth_year_fct</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="fu">summary</span>(bike_share_rides<span class="sc">$</span>user_birth_year_fct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the new summary statistics, more riders were born in <code>1988</code> than any other year.</p>
</section>
<section id="trimming-strings" class="level2">
<h2 class="anchored" data-anchor-id="trimming-strings">Trimming strings</h2>
<p>In the previous steps, you were able to identify the correct data type and convert <code>user_birth_year</code> to the correct type, allowing you to extract counts that gave you a bit more insight into the dataset.</p>
<p>Another common dirty data problem is having extra bits like percent signs or periods in numbers, causing them to be read in as <code>character</code>s. In order to be able to crunch these numbers, the extra bits need to be removed and the numbers need to be converted from <code>character</code> to <code>numeric</code>. In this section, you’ll need to convert the <code>duration</code> column from <code>character</code> to <code>numeric</code>, but before this can happen, the word <code>"minutes"</code> needs to be removed from each value.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code><a href="https://stringr.tidyverse.org">stringr</a></code></li>
</ul>
<p><strong>Comments</strong></p>
<ul>
<li><code>stringr</code> functions uses <strong><em>regular expression</em></strong></li>
<li>A <strong><em>regular expression</em></strong> is a sequence of characters that allows for robust searching within a string</li>
<li>Certain characters are treated differently in a regular expression:
<ul>
<li><code>(</code>,<code>)</code>,<code>[</code>,<code>]</code>, <code>$</code>, <code>.</code>, <code>+</code>, <code>*</code>, and others</li>
</ul></li>
<li>Searching for these characters requires usind <code>fixed()</code>:
<ul>
<li><code>str_detect(column, fixed("$"))</code></li>
</ul></li>
</ul>
<p><strong>Steps:</strong></p>
<ol type="1">
<li>Use <code>str_remove()</code> to remove <code>"minutes"</code> from the <code>duration</code> column of <code>bike_share_rides</code>. Add this as a new column called <code>duration_trimmed</code>.</li>
<li>Convert the <code>duration_trimmed</code> column to a numeric type and add this as a new column called <code>duration_mins</code>.</li>
<li>Glimpse at <code>bike_share_rides</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Libraries</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(stringr)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># 1. &amp; 2.</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>bike_share_rides <span class="ot">&lt;-</span> bike_share_rides <span class="sc">|&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="co"># Remove 'minutes' from duration: duration_trimmed</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="fu">mutate</span>(<span class="at">duration_trimmed =</span> duration <span class="sc">|&gt;</span> <span class="fu">str_remove</span>(<span class="st">" minutes"</span>),</span>
<span id="cb8-8"><a href="#cb8-8"></a>         <span class="co"># Convert duration_trimmed to numeric: duration_mins</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>         <span class="at">duration_mins =</span> duration_trimmed <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>())</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co"># 3. Glimpse at bike_share_rides</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>bike_share_rides <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="alternatives" class="anchored"><em>Alternatives</em></h2>
<ul>
<li>
Instead of removing characters, you can also just extract the digits (including grouping and decimal marks) with a regex <code>stringr::str_extract(“[\d\.]*“)</code>
</li>
<li>
Regex Cheatsheets:
<ul>
<li>
<a href="https://devhints.io/regexp">devhints.io</a>
</li>
<li>
<a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf"><code>stringr</code> cheatsheet</a>
</li>
</ul>
</li><li>
The function <code>readr::parse_number()</code> does everything in one step.
</li>
</ul>
</blockquote>
<ol start="4" type="1">
<li>Assert that the <code>duration_mins</code> column is <code>numeric</code>.</li>
<li>Calculate the mean of <code>duration_mins</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># 4. Assert duration_mins is numeric</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">assert_is_numeric</span>(bike_share_rides<span class="sc">$</span>duration_mins)</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># 5. Calculate mean duration</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="fu">mean</span>(bike_share_rides<span class="sc">$</span>duration_mins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great work! By removing characters and converting to a numeric type, you were able to figure out that the average ride duration is about 13 minutes - not bad for a city like San Francisco!</p>
</section>
<section id="constraints" class="level2">
<h2 class="anchored" data-anchor-id="constraints">Constraints</h2>
<section id="range-constraints" class="level3">
<h3 class="anchored" data-anchor-id="range-constraints">Range constraints</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. Range constraints</strong></p>
<p>Now that we’ve discussed data type constraints, let’s talk about another type of constraint: range constraints.</p>
<p><strong>2. What’s an out of range value?</strong></p>
<p>Many variables have some range that you can reasonably expect all of the data points to fall within. For example, the college entrance test in the US is scored between 400 and 1600, so there shouldn’t be any scores below 400 or above 1600. Other examples are the weight of a package, which can’t be negative, or heart rate, which is expected to be between 60 and 100 beats per minute in most adults.Since we know what these reasonable ranges are, we know that there’s something off if we see an SAT score of 2000 or a weight of -5 pounds in our dataset.</p>
<p><strong>3. Finding out of range values</strong></p>
<p>Let’s say we’re given some data containing movie ratings. Movies are rated using a five-star system, so all ratings should fall between 0 and 5.</p>
<p><strong>4. Finding out of range values</strong></p>
<p>To see if there’s any data that’s clearly out of range, we can create a histogram.We’ll create a vector called breaks, which contains the minimum rating, then 0, the bottom of the expected range, then 5, the top of the expected range, then the maximum rating. We’ll create a histogram of avg_rating using geom_histogram, setting the breaks argument to the breaks vector we just created.We end up with a histogram broken up into 3 groups: too low, in range, and too high. We can easily see now that there’s one value below 0 and two values above 5 in our dataset.</p>
<p><strong>5. Finding out of range values</strong></p>
<p>We can also use the assert_all_are_in_closed_range function, which takes in a lower value and an upper value. It will give an error if anything falls outside of the specified range.</p>
<p><strong>6. Handling out of range values</strong></p>
<p>Once we identify that there are values out of range, how do we deal with them? We could remove those data points completely, but this should only be done when only a small proportion of the values are out of range, otherwise, we would significantly increase the amount of bias in our dataset. We could also treat each out of range value as missing, or replace it with <code>NA</code>. This allows us to use different imputation techniques for missing data, which we’ll discuss in more detail later in the course.We can also replace out of range values with the range limit. For example, if we know our ratings should fall between 0 and 5 and there’s a value of 6, we can replace the 6 with 5 so that it’s in range.Finally, we can replace the values with some other number based on our knowledge of the dataset. For example, we could replace them with the average rating of all movies.</p>
<p><strong>7. Removing rows</strong></p>
<p>To remove out of range rows, we can use the filter function to get all the rows with values that fall into the range. In this case, we want all the ratings greater than or equal to 0 and less than or equal to 5, which will eliminate the rows that have an out of range rating.If we create a histogram of avg_rating now, we can see that there are no more out of range values left in the dataset.</p>
<p><strong>8. Treat as missing</strong></p>
<p>To treat values as missing, we’ll need to replace all the out of range values with NA. We can do this using the replace function, which takes in the column you want to replace values in, the condition that should be met for a replacement to happen, and what the replacement should be. Here, we create a new column called rating_miss, replacing values of the avg_rating column that are too big with NA.</p>
<p><strong>9. Replacing out of range values</strong></p>
<p>We can also use the replacement function to replace out of range values with the range limit. Here, we replace all the values of avg_rating that are greater than 5 with 5.</p>
<p><strong>10. Date range constraints</strong></p>
<p>Dates can also be out of range. A common scenario is when data contains dates in the future. In our movies data, all of the dates should be in the past, since it’s not possible for us to have a movie rating for a movie that no one has seen yet.We can use the assert_all_are_in_past function from the assertive package to check for future dates, and it looks like we have one.We can take a closer look at this row by filtering for date_recorded greater than today’s date. Just like numbers, dates can be compared using greater than, less than, and equals equals operators. The today function from lubridate will get the current date.</p>
<p><strong>11. Removing out-of-range dates</strong></p>
<p>We can remove the rows with future dates using filter as well, but this time, we filter for date_recorded less than or equal to today.When we use assert_all_are_in_past now, nothing is returned, so we know that our range constraints have been met.</p>
<p><strong>12. Let’s practice!</strong></p>
<p>Now it’s time to practice wrangling your data with ranges.</p>
<p><em>What’s an out of range value?</em></p>
<ul>
<li>SAT score: 400-1600</li>
<li>Package weight: at least 0 lb/kg</li>
<li>Adult heart rate: 60-100 beats per minute</li>
</ul>
<p><em>Handling out of range values</em></p>
<ul>
<li>Remove rows</li>
<li>Treat as missing (<code>NA</code>)</li>
<li>Replace with range limit</li>
<li>Replace with other value based on domain knowledge and/or knowledge of dataset</li>
</ul>
<p>Values that are out of range can throw off an analysis, so it’s important to catch them early on. In this section, you’ll be examining the <code>duration_min</code> column more closely. Bikes are not allowed to be kept out for <a href="https://help.baywheels.com/hc/en-us/articles/360033790932-How-long-can-I-keep-a-bike-out-" target="_blank" rel="noopener noreferrer">more than 24 hours</a>, or 1440 minutes at a time, but issues with some of the bikes caused inaccurate recording of the time they were returned.</p>
<p>In this sections, you’ll replace erroneous data with the range limit (1440 minutes), however, you could just as easily replace these values with <code>NA</code>s.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code><a href="http://ggplot2.tidyverse.org">ggplot2</a></code></li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a three-bin histogram of the <code>duration_min</code> column of <code>bike_share_rides</code> using <code>ggplot2</code> to identify if there is out-of-range data.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Library</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># Load data</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>bike_share_rides_sample <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/bike_share_rides_sample.rds"</span>)</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co"># 1.1 Create breaks</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(bike_share_rides_sample<span class="sc">$</span>duration_min), <span class="dv">0</span>, <span class="dv">1440</span>, <span class="fu">max</span>(bike_share_rides_sample<span class="sc">$</span>duration_min))</span>
<span id="cb10-9"><a href="#cb10-9"></a></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co"># 1.2 Create a histogram of duration_min</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="fu">ggplot</span>(bike_share_rides_sample, <span class="fu">aes</span>(duration_min)) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>  <span class="fu">geom_histogram</span>(<span class="at">breaks =</span> breaks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Replace the values of <code>duration_min</code> that are greater than <code>1440</code> minutes (24 hours) with <code>1440</code>. Add this to <code>bike_share_rides</code> as a <strong>new</strong> column called <code>duration_min_const</code>.</li>
<li>Assert that all values of <code>duration_min_const</code> are between <code>0</code> and <code>1440</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># 2. duration_min_const: replace vals of duration_min &gt; 1440 with 1440</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>bike_share_rides_sample <span class="ot">&lt;-</span> bike_share_rides_sample <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">mutate</span>(<span class="at">duration_min_const =</span> <span class="fu">replace</span>(duration_min, duration_min <span class="sc">&gt;</span> <span class="dv">1440</span>, <span class="dv">1440</span>))</span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co"># 3. Make sure all values of duration_min_const are between 0 and 1440</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="fu">assert_all_are_in_closed_range</span>(bike_share_rides_sample<span class="sc">$</span>duration_min_const, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1440</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Radical replacing! The method of replacing erroneous data with the range limit works well, but you could just as easily replace these values with <code>NA</code>s or something else instead.</p>
</section>
<section id="date-constraints" class="level3">
<h3 class="anchored" data-anchor-id="date-constraints">Date constraints</h3>
<p>Something has gone wrong and it looks like you have data with dates from the future, which is way outside of the date range you expected to be working with. To fix this, you’ll need to remove any rides from the dataset that have a <code>date</code> in the future. Before you can do this, the <code>date</code> column needs to be converted from a <code>character</code> to a <code>Date</code>. Having these as <code>Date</code> objects will make it much easier to figure out which rides are from the future, since R makes it easy to check if one <code>Date</code> object is before (<code>&lt;</code>) or after (<code>&gt;</code>) another.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code><a href="http://lubridate.tidyverse.org">lubridate</a></code></li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Convert the <code>date</code> column of <code>bike_share_rides</code> from <code>character</code> to the <code>Date</code> data type.</li>
<li>Assert that all values in the <code>date</code> column happened sometime in the past and not in the future.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Libraries</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co"># 1. Convert date to Date type</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>bike_share_rides <span class="ot">&lt;-</span> bike_share_rides <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_datetime</span>(date))</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co"># Modify data: Change year to 2043 of 10 random observations</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>bike_share_rides_mod <span class="ot">&lt;-</span> bike_share_rides <span class="sc">|&gt;</span> </span>
<span id="cb12-10"><a href="#cb12-10"></a>                            <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">case_when</span>(ride_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">99874</span>,<span class="dv">15624</span>,<span class="dv">89173</span>,<span class="dv">39239</span>,<span class="dv">23104</span>,<span class="dv">39307</span>,<span class="dv">13170</span>,<span class="dv">51086</span>,<span class="dv">87586</span>,<span class="dv">21989</span>) <span class="sc">~</span> <span class="st">`</span><span class="at">year&lt;-</span><span class="st">`</span>(date, <span class="dv">2043</span>),</span>
<span id="cb12-11"><a href="#cb12-11"></a>                                                    T <span class="sc">~</span> date))</span>
<span id="cb12-12"><a href="#cb12-12"></a></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co"># 2. Make sure all dates are in the past</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="fu">assert_all_are_in_past</span>(bike_share_rides_mod<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Filter <code>bike_share_rides</code> to get only the rides from the past or today, and save this as <code>bike_share_rides_past</code>.</li>
<li>Assert that the <code>dates</code> in <code>bike_share_rides_past</code> occurred only in the past.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># 3. Filter for rides that occurred before or on today's date</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>bike_share_rides_past <span class="ot">&lt;-</span> bike_share_rides_mod <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;=</span> <span class="fu">today</span>())</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co"># 4. Make sure all dates from bike_share_rides_past are in the past</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="fu">assert_all_are_in_past</span>(bike_share_rides_past<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fabulous filtering! Handling data from the future like this is much easier than trying to verify the data’s correctness by time traveling.</p>
</section>
<section id="uniqueness-constraints-duplicates" class="level3">
<h3 class="anchored" data-anchor-id="uniqueness-constraints-duplicates">Uniqueness constraints (Duplicates)</h3>
<p>Theory. Coming soon …</p>
<p><strong>1. Uniqueness constraints</strong></p>
<p>Sometimes we might have data containing duplicated data points caused by an error earlier in the pipeline. Duplicated data can have lots of unwanted side effects, but uniqueness constraints help us find and fix these duplicated data points.</p>
<p><strong>2. What’s a duplicate?</strong></p>
<p>A duplicate is a data point that has the same values as another data in all columns, or in most columns.</p>
<p><strong>3. Why do duplicates occur?</strong></p>
<p>Duplicates can arise from data entry errors or other human errors,</p>
<p><strong>4. Why do duplicates occur?</strong></p>
<p>from bugs or design errors in data pipelines,</p>
<p><strong>5. Why do duplicates occur?</strong></p>
<p>but they most commonly arise from errors in joining data together from multiple sources.</p>
<p><strong>6. Full duplicates</strong></p>
<p>A full duplicate occurs when there are multiple rows that have the same value in every column. Here, rows 2 and 4 are full duplicates of each other, and rows 5 and 6 are also full duplicates of each other.</p>
<p><strong>7. Finding full duplicates</strong></p>
<p>We can find full duplicates using R’s built-in “duplicated” function. If we pass in our data frame, called credit_scores, we get a logical vector, which is TRUE for each row that is a duplicate. If we take the sum of this vector, we get the total number of duplicates in the dataset, which is 2.</p>
<p><strong>8. Finding full duplicates</strong></p>
<p>We can check out the rows that are duplicates by using the duplicated function inside of filter, like this.</p>
<p><strong>9. Dropping full duplicates</strong></p>
<p>Since full duplicates are exact copies of each other, we can deal with these by simply removing them from the dataset, leaving only one copy behind. This can be done using dplyr’s distinct function on our data frame. If we count the number of duplicates in the dataset now, we get 0.</p>
<p><strong>10. Partial duplicates</strong></p>
<p>Partial duplicates are rows of data that have much of the same information and refer to the same data point, but there may be some columns that differ between them. Here, rows 3 and 4 are partial duplicates of each other and rows 5 and 6 are partial duplicates of each other. They have the same name and address, but different credit scores. This can happen due to data entry errors or technical errors. In this example, some data from a year ago may have gotten mixed with the data from this year.</p>
<p><strong>11. Finding partial duplicates</strong></p>
<p>To include partial duplicates in our search, we can use dplyr’s count function to count the number of occurrences of each pair of first name and last name, then filter for the pairs that occur more than once. This will give us data points that share the same name, but may differ in address or credit score.</p>
<p><strong>12. Finding partial duplicates</strong></p>
<p>We can save this as a data frame called dup_ids and then filter to take a look at all the rows that have a duplicate. This gives us a list of the full duplicates and the partial duplicates in the dataset.</p>
<p><strong>13. Handling partial duplicates: dropping</strong></p>
<p>One way to handle partial duplicates is to</p>
<p><strong>14. Handling partial duplicates: dropping</strong></p>
<p>drop all duplicates</p>
<p><strong>15. Handling partial duplicates: dropping</strong></p>
<p>and keep only one of them.</p>
<p><strong>16. Dropping partial duplicates</strong></p>
<p>In R, we can also use the distinct function to drop partial duplicates, but this time, we pass in the column names that duplicates should be matched on. Here, it’s first name and last name. We also set the dot-keep_all argument to TRUE, which will keep all columns of the data frame instead of only first_name and last_name.</p>
<p><strong>17. Handling partial duplicates: summarizing</strong></p>
<p>Another way to handle partial duplicates is to summarize them using a summary statistic, like the mean or max. Since the credit scores differ in our example,</p>
<p><strong>18. Handling partial duplicates: summarizing</strong></p>
<p>we can take the mean credit score for each individual</p>
<p><strong>19. Handling partial duplicates: summarizing</strong></p>
<p>keeping only one copy of each duplicate,</p>
<p><strong>20. Handling partial duplicates: summarizing</strong></p>
<p>and use the mean as the value for credit score.</p>
<p><strong>21. Handling partial duplicates: summarizing</strong></p>
<p><strong>22. Summarizing partial duplicates</strong></p>
<p>To summarize partial duplicates, we group by first_name and last_name, and then mutate, adding a column containing the mean credit score for each name. Since we’ve grouped before mutating, the mean_score column contains the mean score for each person.</p>
<p><strong>23. Summarizing partial duplicates</strong></p>
<p>We can pipe all of this into distinct, using first and last name and setting dot-keep_all to TRUE to remove the extra duplicates. We can also remove the old credit_score column to clean things up.</p>
<p><strong>24. Let’s practice!</strong></p>
<p>Time to dive in to some duplicated data!</p>
<section id="full-duplicates" class="level4">
<h4 class="anchored" data-anchor-id="full-duplicates">Full duplicates</h4>
<p>Whats a full duplicate?</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>First name</th>
<th>Last name</th>
<th>Address</th>
<th>Credit Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Miriam</td>
<td>Day</td>
<td>6042 Sollicitudin Avenue</td>
<td>313</td>
</tr>
<tr class="even">
<td>2</td>
<td>Miriam</td>
<td>Day</td>
<td>6042 Sollicitudin Avenue</td>
<td>313</td>
</tr>
</tbody>
</table>
<p>You’ve been notified that an update has been made to the bike sharing data pipeline to make it more efficient, but that duplicates are more likely to be generated as a result. To make sure that you can continue using the same scripts to run your weekly analyses about ride statistics, you’ll need to ensure that any duplicates in the dataset are removed first.</p>
<p>When multiple rows of a data frame share the same values for all columns, they’re <em>full duplicates</em> of each other. Removing duplicates like this is important, since having the same value repeated multiple times can alter summary statistics like the mean and median. Each ride, including its <code>ride_id</code> should be unique.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code><a href="http://sfirke.github.io/janitor/articles/janitor.html">janitor</a></code></li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Find full duplicates</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Modify data</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>bike_share_rides_mod <span class="ot">&lt;-</span> bike_share_rides <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  </span>
<span id="cb14-4"><a href="#cb14-4"></a>                            <span class="co"># Add duplicates</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>                            <span class="fu">add_row</span>(bike_share_rides <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">17278</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6"></a>                            <span class="fu">add_row</span>(bike_share_rides <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">27208</span>))</span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co"># 1. Finding duplicates</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>bike_share_rides_mod <span class="sc">|&gt;</span> </span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="fu">filter</span>(bike_share_rides_mod <span class="sc">|&gt;</span> <span class="fu">duplicated</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Alternative</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Libraries</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">library</span>(janitor)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># 1. Finding duplicates</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>bike_share_rides_mod <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="fu">get_dupes</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Get the total number of full duplicates in <code>bike_share_rides</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># 2. Count the number of full duplicates</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">sum</span>(<span class="fu">duplicated</span>(bike_share_rides_mod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Remove all full duplicates from <code>bike_share_rides</code> and save the new data frame as <code>bike_share_rides_unique.</code></li>
<li>Get the total number of full duplicates in the new <code>bike_share_rides_unique</code> data frame.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># 3. Remove duplicates</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>bike_share_rides_unique <span class="ot">&lt;-</span> <span class="fu">distinct</span>(bike_share_rides_mod)</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co"># 4. Count the full duplicates in bike_share_rides_unique</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="fu">sum</span>(<span class="fu">duplicated</span>(bike_share_rides_unique))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dazzling duplicate removal! Removing full duplicates will ensure that summary statistics aren’t altered by repeated data points.</p>
</section>
<section id="partial-duplicates" class="level4">
<h4 class="anchored" data-anchor-id="partial-duplicates">Partial duplicates</h4>
<p>Whats a partial duplicate?</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>First name</th>
<th>Last name</th>
<th>Address</th>
<th>Credit Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Tamekah</td>
<td>Forbes</td>
<td>P.O. Box 147, 511 Velit St</td>
<td>356</td>
</tr>
<tr class="even">
<td>2</td>
<td>Tamekah</td>
<td>Forbes</td>
<td>P.O. Box 147, 511 Velit St</td>
<td>342</td>
</tr>
</tbody>
</table>
<section id="removing-partial-duplicates" class="level5">
<h5 class="anchored" data-anchor-id="removing-partial-duplicates">Removing partial duplicates</h5>
<p>Now that you’ve identified and removed the full duplicates, it’s time to check for partial duplicates. Partial duplicates are a bit tricker to deal with than full duplicates. In this section, you’ll first identify any partial duplicates and then practice the most common technique to deal with them, which involves dropping all partial duplicates, keeping only the first.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the number of occurrences of each <code>ride_id</code>.</li>
<li>Filter for <code>ride_id</code>s that occur multiple times.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Modify data</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>bike_share_rides_mod <span class="ot">&lt;-</span> bike_share_rides <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  </span>
<span id="cb18-4"><a href="#cb18-4"></a>                            <span class="co"># Add duplicates</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>                            <span class="fu">add_row</span>(bike_share_rides <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6"></a>                                        <span class="fu">slice</span>(<span class="dv">33237</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7"></a>                                        <span class="fu">mutate</span>(<span class="at">duration_mins =</span> <span class="fl">5.8</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-8"><a href="#cb18-8"></a>                            <span class="fu">add_row</span>(bike_share_rides <span class="sc">|&gt;</span> </span>
<span id="cb18-9"><a href="#cb18-9"></a>                                        <span class="fu">slice</span>(<span class="dv">17657</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-10"><a href="#cb18-10"></a>                                        <span class="fu">mutate</span>(<span class="at">duration_mins =</span> <span class="fl">13.6</span>))</span>
<span id="cb18-11"><a href="#cb18-11"></a></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co"># Find duplicated ride_ids</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>bike_share_rides_mod <span class="sc">%&gt;%</span> </span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="co"># 1. Count the number of occurrences of each ride_id</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  <span class="fu">count</span>(ride_id) <span class="sc">%&gt;%</span> </span>
<span id="cb18-16"><a href="#cb18-16"></a>  <span class="co"># 2. Filter for rows with a count &gt; 1</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Alternative</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># 1. Find duplicated ride_ids</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>bike_share_rides_mod <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3"></a>    janitor<span class="sc">::</span><span class="fu">get_dupes</span>(ride_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Remove full and partial duplicates from <code>bike_share_rides</code> based on <code>ride_id</code> only, keeping all columns.</li>
<li>Store this as <code>bike_share_rides_unique</code>.</li>
<li>Find the duplicated <code>ride_id</code>s in <code>bike_share_rides_unique</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># 3. / 4. Remove full and partial duplicates</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>bike_share_rides_unique <span class="ot">&lt;-</span> bike_share_rides_mod <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="co"># Only based on ride_id instead of all cols</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">distinct</span>(ride_id, <span class="at">.keep_all =</span> T)</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co"># 5. Find duplicated ride_ids in bike_share_rides_unique</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>bike_share_rides_unique <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="co"># Count the number of occurrences of each ride_id</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">count</span>(ride_id) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="co"># Filter for rows with a count &gt; 1</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect partial duplicate removing! It’s important to consider the data you’re working with before removing partial duplicates, since sometimes it’s expected that there will be partial duplicates in a dataset, such as if the same customer makes multiple purchases.</p>
</section>
<section id="aggregating-partial-duplicates" class="level5">
<h5 class="anchored" data-anchor-id="aggregating-partial-duplicates">Aggregating partial duplicates</h5>
<p>Another way of handling partial duplicates is to compute a summary statistic of the values that differ between partial duplicates, such as mean, median, maximum, or minimum. This can come in handy when you’re not sure how your data was collected and want an average, or if based on domain knowledge, you’d rather have too high of an estimate than too low of an estimate (or vice versa).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Group <code>bike_share_rides</code> by <code>ride_id</code> and <code>date</code>.</li>
<li>Add a column called <code>duration_min_avg</code> that contains the mean ride duration for the row’s <code>ride_id</code> and <code>date</code>.</li>
<li>Remove duplicates based on <code>ride_id</code> and <code>date</code>, keeping all columns of the data frame.</li>
<li>Remove the <code>duration_min</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>bike_share_rides_mod <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="co"># 1. Group by ride_id and date</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">group_by</span>(ride_id, date) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="co"># 2. Add duration_min_avg column</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">mutate</span>(<span class="at">duration_min_avg =</span> <span class="fu">mean</span>(duration_mins) ) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="co"># 3. Remove duplicates based on ride_id and date, keep all cols</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">distinct</span>(ride_id, date, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>  <span class="co"># 4. Remove duration_min column</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="fu">select</span>(<span class="sc">-</span>duration_mins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Awesome aggregation! Aggregation of partial duplicates allows you to keep some information about all data points instead of keeping information about just one data point.</p>
</section>
</section>
</section>
</section>
</section>
<section id="categorical-and-text-data" class="level1">
<h1>2. Categorical and Text Data</h1>
<p>Categorical and text data can often be some of the messiest parts of a dataset due to their unstructured nature. In this chapter, you’ll learn how to fix whitespace and capitalization inconsistencies in category labels, collapse multiple categories into one, and reformat strings for consistency.</p>
<section id="checking-membership" class="level2">
<h2 class="anchored" data-anchor-id="checking-membership">Checking membership</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Checking membership</strong></p>
<p>Nice work on Chapter 1! In Chapter 2, we’ll discuss problems that arise in text and categorical data. Let’s get started!</p>
<p><strong>2. Categorical data</strong></p>
<p>A variable is categorical when it can only take on values from a predefined set of values. Categorical variables represent distinct groups. Marriage status, household income category, and t-shirt size are all examples of categorical variables. As we discussed in Chapter 1, categories are stored as factors in R.</p>
<p><strong>3. Factors</strong></p>
<p>Under the hood, factors are stored as numbers, where one number represents each category. Each number has a corresponding label to make it easier for humans to read and understand output. For example, marriage status has two categories. Category 1 is labeled as unmarried, and category 2 is labeled as married.</p>
<p><strong>4. Factor levels</strong></p>
<p>Factors have something called levels, which are all the different possible values that a factor can hold. Here, we see that there are four possible values that tshirt_size can have: small, medium, large, and extra-large.</p>
<p><strong>5. Values that don’t belong</strong></p>
<p>Since factors have these predefined levels, they cannot have values that fall outside of those levels. For example, if we asked people what t-shirt size they want, and someone responds with small-slash-medium, we won’t be able to process that order since our vendor doesn’t make that size.</p>
<p><strong>6. How do we end up with these values?</strong></p>
<p>How do we end up with values that aren’t members of the predefined set of categories? Inconsistencies like this can arise due to data entry errors where data is inputted using free text instead of a multiple-choice system, as well as data parsing errors.</p>
<p><strong>7. Filtering joins: a quick review</strong></p>
<p>Recall that filtering joins are a type of join that keeps or removes observations from the first table, but doesn’t add any new columns. The first kind of filtering join is a semi-join, which answers the question, “What observations of X are also in Y?”</p>
<p><strong>8. Filtering joins: a quick review</strong></p>
<p>The other kind is an anti-join, which answers the question, “What observations of X are not in Y?” We can use these filtering joins to find and remove values of categorical variables that don’t belong.</p>
<p><strong>9. Blood type example</strong></p>
<p>Let’s take a look at an example. We have a data frame called study_data, which contains data from a study about babies’ blood types. study_data has the name, birthday, and blood type of each child. We also have a data frame called blood_types that contains all the possible blood types that a human can have.</p>
<p><strong>10. Blood type example</strong></p>
<p>Notice the problem here? Jennifer has blood type Z-positive, which is not a real blood type. Luckily, we can use the blood_types data frame as our ground truth to fix this.</p>
<p><strong>11. Finding non-members</strong></p>
<p>To find invalid blood types in our study data, we want to find all the blood types in study_data that are NOT in the blood_types data frame. This means we’ll need an anti-join.</p>
<p><strong>12. Anti-join</strong></p>
<p>We can use dplyr’s anti_join function to get the rows of study_data with a blood type not in the blood_types data frame.</p>
<p><strong>13. Removing non-members</strong></p>
<p>To remove the invalid blood types from our study_data, we want to find all the rows with a blood type in the official blood_types data frame. This means we’ll need to use a semi-join.</p>
<p><strong>14. Semi-join</strong></p>
<p>We can use dplyr’s semi-join function to get the rows of study_data that have a blood type contained in the official blood_types data frame. This removes the data with the Z-positive blood type.</p>
</section>
<section id="membership-constraints" class="level2">
<h2 class="anchored" data-anchor-id="membership-constraints">Membership constraints</h2>
<p>So far, you’ve learned about a number of different problems you can run into when you have dirty data, including</p>
<ul>
<li>data type constraints,</li>
<li>range constraints,</li>
<li>uniqueness constraints,</li>
<li>and membership constraints.</li>
</ul>
<p>Categorical variables have a fixed and known set of possible values. In a <code>factor</code>, each category is stored as a number and has a corresponding label. <code>factor</code>s cannot have values that fall outside of the predefined ones.</p>
<table class="table">
<thead>
<tr class="header">
<th>Data</th>
<th>Labels</th>
<th>Numeric representaion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Marriage status</td>
<td><code>unmarried</code>, <code>married</code></td>
<td><code>1</code>, <code>2</code></td>
</tr>
<tr class="even">
<td>Household income category</td>
<td><code>0-20K</code>, <code>20-40K</code>, …</td>
<td><code>1</code>, <code>2</code>, …</td>
</tr>
<tr class="odd">
<td>T-Shirt size</td>
<td><code>S</code>, <code>M</code>, <code>L</code>, <code>XL</code></td>
<td><code>1</code>, <code>2</code>, <code>3</code>, <code>4</code></td>
</tr>
</tbody>
</table>
<p>It’s important to be able to correctly identify the type of problem you’re dealing with so that you can treat it correctly.</p>
<p><strong>Example:</strong> Classification based on whether it’s a membership constraint issue or a different type of issue:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Membership constraint</th>
<th>Other constraint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A <code>has_loan</code> column with the value <code>25</code>.</td>
<td>A <code>revenue</code> column represented as a string.</td>
</tr>
<tr class="even">
<td>A <code>month</code> column with the value <code>14</code>.</td>
<td>A <code>birthdate</code> column with values in the future.</td>
</tr>
<tr class="odd">
<td>A <code>GPA</code> column containing a <code>Z-</code> grade (Grades are traditionally A through F).</td>
<td>An <code>age</code> column with values above <code>130</code>.</td>
</tr>
<tr class="even">
<td>A <code>day_of_week</code> column with the value <code>12</code></td>
<td></td>
</tr>
</tbody>
</table>
<section id="filtering-joins-a-quick-review" class="level3">
<h3 class="anchored">Filtering Joins: a quick review</h3>
<p>Keeps or removes observations from the first table without adding columns</p>
<p><img src="readme_files/joins.png" class="img-fluid" style="width:50.0%"></p>
<p>The following example is a good illustration of how that works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>study_data  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/study_data.rds"</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a>study_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>blood_types <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/blood_types.rds"</span>) </span>
<span id="cb23-2"><a href="#cb23-2"></a>blood_types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Anti_join: Finding non members</strong></p>
<p><img src="readme_files/anti-join.png" class="img-fluid" style="width:50.0%"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>study_data <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">anti_join</span>(blood_types, <span class="at">by =</span> <span class="st">"blood_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Semi-Join: Removing non members</strong></p>
<p><img src="readme_files/semi-join.png" class="img-fluid" style="width:50.0%"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>study_data <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">semi_join</span>(blood_types, <span class="at">by =</span> <span class="st">"blood_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Data</strong></p>
<ul>
<li><code>sfo_survey</code> / <code>sfo_survey_mod</code></li>
</ul>
<p>Now that we can identify membership constraint problems, it’s time to fix these problems in a new dataset. Throughout this section, you’ll be working with a dataset called <code>sfo_survey</code>, containing survey responses from passengers taking flights from San Francisco International Airport (SFO). Participants were asked questions about the airport’s cleanliness, wait times, safety, and their overall satisfaction.</p>
<p>There were a few issues during data collection that resulted in some inconsistencies in the dataset (<code>sfo_survey_mod</code>). In the following steps, you’ll be working with the <code>dest_size</code> column, which categorizes the size of the destination airport that the passengers were flying to. A data frame called <code>dest_sizes</code> will be created that contains all the possible destination sizes. Your mission is to find rows with invalid <code>dest_size</code>s and remove them from the data frame.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the number of occurrences of each <code>dest_size</code> in <code>sfo_survey_mod</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>sfo_survey_mod <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/sfo_survey_mod.rds"</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co"># 1. Count the number of occurrences of dest_size</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="fu">count</span>(dest_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-1" class="anchored" data-anchor-id="filtering-joins-a-quick-review"><em>Question</em></h2>
<p>Take a closer look at your output. Which <code>dest_size</code> values appear to violate membership constraints?<br> <br> ⬜ <code>"huge"</code>, <code>"Small"</code>, <code>"Large  "</code>, and <code>"Hub"</code>.<br> ✅ <code>"huge"</code>, <code>"  Small  "</code>, <code>"Large  "</code>, and <code>" Hub"</code>.<br> ⬜ <code>"Small"</code>, <code>"Medium"</code>, <code>"Large"</code>, and <code>"Hub"</code>.<br></p>
</blockquote>
<ol start="2" type="1">
<li>Use the correct type of filtering join on the <code>sfo_survey</code> data frame and the <code>dest_sizes</code> data frame to get the rows of <code>sfo_survey</code> with invalid <code>dest_size</code> values.</li>
<li>Get the <code>id</code>, <code>airline</code>, <code>destination</code>, and <code>dest_size</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>dest_sizes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="at">dest_size          =</span> <span class="fu">c</span>(<span class="st">"Small"</span>, <span class="st">"Medium"</span>, <span class="st">"Large"</span>, <span class="st">"Hub"</span>),</span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="at">passengers_per_day =</span> <span class="fu">c</span>(<span class="st">"0-20K"</span>, <span class="st">"20K-70K"</span>, <span class="st">"70K-100K"</span>, <span class="st">"100K+"</span>)</span>
<span id="cb27-4"><a href="#cb27-4"></a>)</span>
<span id="cb27-5"><a href="#cb27-5"></a></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co"># Find bad dest_size rows</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>sfo_survey_mod <span class="sc">%&gt;%</span> </span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="co"># 2. Join with dest_sizes data frame to get bad dest_size rows</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="fu">anti_join</span>(dest_sizes) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="co"># 3. Select id, airline, destination, and dest_size cols</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>  <span class="fu">select</span>(id, airline, destination, dest_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Use the correct filtering join on <code>sfo_survey</code> and <code>dest_sizes</code> to get the rows of <code>sfo_survey</code> that have a valid <code>dest_size</code>.</li>
<li>Count the number of times that each <code>dest_size</code> occurs to make sure there are no invalid values left behind.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Remove bad dest_size rows</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="co"># 4. Join with dest_sizes</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">semi_join</span>(dest_sizes) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="co"># 5. Count the number of each dest_size</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">count</span>(dest_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great joining! Anti-joins can help you identify the rows that are causing issues, and semi-joins can remove the issue-causing rows. In the next lesson, you’ll learn about other ways to deal with bad values so that you don’t have to lose rows of data.</p>
</section>
</section>
<section id="categorical-data-problems" class="level2">
<h2 class="anchored" data-anchor-id="categorical-data-problems">Categorical data problems</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Categorical data problems</strong></p>
<p>Now that we’ve discussed membership constraints, we’ll take a deeper dive into categorical data and discuss other ways to address those pesky values that don’t belong besides removing them.</p>
<p><strong>2. Categorical data problems</strong></p>
<p>There are two specific types of dirty categorical data that we’ll discuss. The first is when there is inconsistency within a category. For example, “Lizard” with a capital “L” and “lizard” with a lowercase “L” should be mapped to the same category even though their capitalization differs. The other type is when there are too many categories. If we only have one data point with “Pug”, one data point with “Lab”, and one data point with “Boxer”, those categories might not be so useful on their own. It will be easier to work with our data if we collapse them all into one category, “Dog”.</p>
<p><strong>3. Example: animal classification</strong></p>
<p>Let’s start out with an example. We have a data frame called animals which contains different characteristics of animals and their type, such as mammal, fish, or bird.</p>
<p><strong>4. Checking categories</strong></p>
<p>We can explore all the different type categories in the data using count. At a glance, we can see if there are any categories that need correction. Right off the bat, we can see that there are multiple categories for mammal, including ” mammal ” with extra spaces before and after the word, “MAMMAL” in all caps,and “Mammal” with one capital letter and an extra space.</p>
<p><strong>5. Case inconsistency</strong></p>
<p>To fix the case inconsistency between the different mammal categories, we can use the str_to_lower function from the stringr package. Looking at row 3, we can see that the mammal with a capital M has been converted to all lowercase.</p>
<p><strong>6. Case inconsistency</strong></p>
<p>If we now count the type_lower category, we can see that there are nine categories instead of ten since the all caps “MAMMAL” was converted to lowercase “mammal”.</p>
<p><strong>7. Case inconsistency</strong></p>
<p>We could also convert everything to uppercase using the str_to_upper function.</p>
<p><strong>8. Whitespace inconsistency</strong></p>
<p>To address the inconsistency in the white space around the word “mammal”, we can use the stringr function str_trim. This will remove any white space from the beginning of the string and the end of the string, but not the middle of the string. Now the category in row 3 matches the category in row 1.</p>
<p><strong>9. Whitespace inconsistency</strong></p>
<p>If we now look at the different categories, there’s only one mammal category, so all of the mammals in the dataset have been mapped to the same category.</p>
<p><strong>10. Too many categories</strong></p>
<p>Take a look at the categories we have now. Notice that most of our dataset is comprised of mammals and birds. There are only two amphibians, two fish, one bug, one invertebrate, and one reptile. That’s 5 extra categories for only 7 data points, and summary statistics for these groups won’t be very useful since they only contain one or two observations.</p>
<p><strong>11. Collapsing categories</strong></p>
<p>We can solve this problem by collapsing these categories into a new, broader category called “other”. First, we’ll create a vector called other_categories that stores the categories we want to collapse together. Next, we’ll load the forcats package and add a new column to the animals data frame called type_collapsed. To create this column, we’ll use the fct_collapse function. We pass type_trimmed to fct_collapse since this is the factor we want to base our new column on, and then we use other equals other_categories. This will tell the function that all the categories contained in the other_categories vector should be renamed to “other”. Now, row 4 has the type “other” instead of “fish”.</p>
<p><strong>12. Collapsing categories</strong></p>
<p>If we count the categories in our data frame now, there are only three! This makes it easier to compare all other animals to birds and mammals.</p>
</section>
<section id="identifying-inconsistent-categorical-data" class="level2">
<h2 class="anchored" data-anchor-id="identifying-inconsistent-categorical-data">Identifying inconsistent categorical data</h2>
<p>Different kinds of inconsistencies that can occur within categories, making it look like a variable has more categories than it should:</p>
<ul>
<li>Case inconsistency</li>
<li>whitespace inconsistency</li>
<li>too many categories</li>
<li>…</li>
</ul>
<p><strong>Data</strong></p>
<p>In this section, you’ll continue working with the <code>sfo_survey_mod</code> dataset. You’ll examine the <code>dest_size</code> column again as well as the <code>cleanliness</code> column and determine what kind of issues, if any, these two categorical variables face.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the number of occurrences of each category of the <code>dest_size</code> variable of <code>sfo_survey</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Count dest_size</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">count</span>(dest_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-2" class="anchored"><em>Question</em></h2>
<p>Select the statement that most accurately describes the categories in the dest_size variable of sfo_survey.<br> <br> ⬜ The categories in <code>dest_size</code> have no inconsistencies.<br> ⬜ The categories in <code>dest_size</code> have inconsistent capitalization.<br> ✅ The categories in <code>dest_size</code> have inconsistent white space.<br> ⬜ The categories in <code>dest_size</code> have inconsistent capitalization and white space.<br></p>
</blockquote>
<ol start="2" type="1">
<li>Count the number of occurrences of each category of the <code>cleanliness</code> variable of <code>sfo_survey</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Count cleanliness</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">count</span>(cleanliness)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-3" class="anchored"><em>Question</em></h2>
<p>Select the statement that most accurately describes the categories in the cleanliness variable of sfo_survey.<br> <br> ⬜ The categories in <code>cleanliness</code> have no inconsistencies.<br> ✅ The categories in <code>cleanliness</code> have inconsistent capitalization.<br> ⬜ The categories in <code>cleanliness</code> have inconsistent white space.<br> ⬜ The categories in <code>cleanliness</code> have inconsistent capitalization and white space.<br></p>
</blockquote>
<p>Incredible identification! In the next exercise, you’ll fix these inconsistencies to get more accurate counts.</p>
</section>
<section id="correcting-inconsistent-categorical-data" class="level2">
<h2 class="anchored" data-anchor-id="correcting-inconsistent-categorical-data">Correcting inconsistent categorical data</h2>
<section id="trimming-case-sensitivity" class="level3">
<h3 class="anchored" data-anchor-id="trimming-case-sensitivity">Trimming &amp; Case Sensitivity</h3>
<p>Now that we’ve identified that <code>dest_size</code> has whitespace inconsistencies and <code>cleanliness</code> has capitalization inconsistencies, you’ll use the new tools at your disposal to fix the inconsistent values in <code>sfo_survey</code> instead of removing the data points entirely, which could add bias to your dataset if more than 5% of the data points need to be dropped.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a column to <code>sfo_survey</code> called <code>dest_size_trimmed</code> that contains the values in the <code>dest_size</code> column with all leading and trailing whitespace removed.</li>
<li>Add another column called <code>cleanliness_lower</code> that contains the values in the <code>cleanliness</code> column converted to all lowercase.</li>
<li>Count the number of occurrences of each category in <code>dest_size_trimmed</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Add new columns to sfo_survey</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>sfo_survey_mod <span class="ot">&lt;-</span> sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="co"># 1. dest_size_trimmed: dest_size without whitespace</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="fu">mutate</span>(<span class="at">dest_size_trimmed =</span> <span class="fu">str_trim</span>(dest_size),</span>
<span id="cb31-5"><a href="#cb31-5"></a>         <span class="co"># 2. cleanliness_lower: cleanliness converted to lowercase</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>         <span class="at">cleanliness_lower =</span> <span class="fu">str_to_lower</span>(cleanliness))</span>
<span id="cb31-7"><a href="#cb31-7"></a></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co"># 3. Count values of dest_size_trimmed</span></span>
<span id="cb31-9"><a href="#cb31-9"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10"></a>  <span class="fu">count</span>(dest_size_trimmed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Count the number of occurrences of each category in <code>cleanliness_lower</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># 4. Count values of cleanliness_lower</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">count</span>(cleanliness_lower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lovely lowercase conversion and terrific trimming! You were able to convert seven-category data into four-category data, which will help your analysis go more smoothly.</p>
</section>
<section id="collapsing-categories" class="level3">
<h3 class="anchored">Collapsing categories</h3>
<p>One of the tablets that participants filled out the <code>sfo_survey</code> on was not properly configured, allowing the response for <code>dest_region</code> to be free text instead of a dropdown menu. This resulted in some inconsistencies in the <code>dest_region</code> variable that you’ll need to correct in this exercise to ensure that the numbers you report to your boss are as accurate as possible.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the categories of <code>dest_region</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># 1. Count categories of dest_region</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">count</span>(dest_region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-4" class="anchored" data-anchor-id="collapsing-categories"><em>Question</em></h2>
<p>From your output from step 1, which categories need to be collapsed?<br> <br> ⬜ <code>"EU"</code> and <code>"Europ"</code> need to be collapsed to <code>"Europe"</code>.<br> ✅ <code>"EU"</code>, <code>"eur"</code>, and <code>"Europ"</code> need to be collapsed to <code>"Europe"</code>.<br> ⬜ <code>"East US"</code>, <code>"Midwest US"</code>, and <code>"West US"</code> need to be collapsed to <code>"US"</code>.<br> ⬜ <code>"Asia"</code> and <code>"Central/South America"</code> should be collapsed to <code>"Asia and Central/South America"</code>.<br></p>
</blockquote>
<ol start="2" type="1">
<li>Create a vector called <code>europe_categories</code> containing the three values of <code>dest_region</code> that need to be collapsed.</li>
<li>Add a new column to <code>sfo_survey</code> called <code>dest_region_collapsed</code> that contains the values from the <code>dest_region</code> column, except the categories stored in <code>europe_categories</code> should be collapsed to <code>Europe</code>.</li>
<li>Count the categories of <code>dest_region_collapsed</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># 2. Categories to map to Europe</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>europe_categories <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"EU"</span>, <span class="st">"Europ"</span>, <span class="st">"eur"</span>)</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># 3. Add a new col dest_region_collapsed</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>  <span class="co"># Map all categories in europe_categories to Europe</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="fu">mutate</span>(<span class="at">dest_region_collapsed =</span> <span class="fu">fct_collapse</span>(dest_region, </span>
<span id="cb34-8"><a href="#cb34-8"></a>                                     <span class="at">Europe =</span> europe_categories)) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9"></a>  <span class="co"># 4. Count categories of dest_region_collapsed</span></span>
<span id="cb34-10"><a href="#cb34-10"></a>  <span class="fu">count</span>(dest_region_collapsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Clean collapsing! You’ve reduced the number of categories from 12 to 9, and you can now be confident that 401 of the survey participants were heading to Europe.</p>
</section>
</section>
<section id="cleaning-text-data" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-text-data">Cleaning text data</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Cleaning text data</strong></p>
<p>In the last lesson of this chapter, we’ll talk about different ways to address dirty text data.</p>
<p><strong>2. What is text data?</strong></p>
<p>Before we dive in, let’s take a look at some examples of text data. Names, phone numbers, email addresses, and passwords are all text data.Text data is very common, but it can be difficult to work with since it can be unstructured.</p>
<p><strong>3. Unstructured data problems</strong></p>
<p>Because text data doesn’t usually have a consistent structure, there are a number of problems that we can run into while working with it. The first is formatting inconsistencies, since there are often multiple ways of formatting the same information. For example, phone numbers can be written in a variety of ways with or without spaces, parentheses, hyphens, and other punctuation, and credit card numbers can be written with or without spaces.Information inconsistency happens when different data points offer different amounts of information. For example, one phone number could include a country code, while others may not, or one person might fill in a “name” field using their first and last name, while another might use only their first name. Data entered can also be invalid, such as a phone number with only 4 digits or a zip code that doesn’t exist.</p>
<p><strong>4. Customer data</strong></p>
<p>To learn about addressing these problems, we’ll look at an example dataset of customers that contains customer names, companies, and credit card numbers. Notice that some rows have spaces in the credit card number while others have hyphens.Dirty text data like this can interfere with pipelines and processes that rely on this data. For example, sales software might only be able to process credit card numbers that are consistently formatted.</p>
<p><strong>5. Detecting hyphenated credit card numbers</strong></p>
<p>To clean up this text data, we can use functions from the stringr package.Before we can clean this data, we’ll need to find which values need cleaning. This can be done using the str_detect function, which takes in a character vector, in this case the name column of the customers data frame, and the pattern that you want to detect, which is a hyphen. This will return a logical vector indicating whether a hyphen is found in the credit_card column in each row.</p>
<p><strong>6. Replacing hyphens</strong></p>
<p>Now that we’ve identified where our issues lie, we can use the str_replace_all function, which takes in the column of text data, the string we want to replace, and the replacement string. In this example, we want to replace all of the hyphens in the credit_card column with spaces so that all of the credit card numbers have consistent formatting.</p>
<p><strong>7. Removing hyphens and spaces</strong></p>
<p>An alternative solution is to remove the hyphens and spaces from the credit card numbers so that they contain numbers only. This can be done using the str_remove_all function. Here, we take the credit_card column, remove all hyphens, and then remove all spaces. We can add this to our data frame using mutate.</p>
<p><strong>8. Finding invalid credit cards</strong></p>
<p>Now that we’ve removed all the hyphens and spaces, all of the credit card numbers should have exactly 16 numbers. We can find invalid credit cards using the str_length function, which returns the length of each string in a column. str_length can be used in combination with a filter to find all the customers whose credit_card number does not contain exactly 16 characters.</p>
<p><strong>9. Removing invalid credit cards</strong></p>
<p>We can remove these invalid numbers from the dataset by filtering for rows that have a credit card with a length of 16. Now we’ll be able to charge customers with ease!</p>
<p><strong>10. More complex text problems</strong></p>
<p>To deal with more complex text data problems, regular expressions can be used. A regular expression is a sequence of characters that allows for robust searching within a string. For example, we could search for all credit cards that have a 4 as their first digit.In regular expressions, there are certain characters that get treated differently. All the stringr functions we learned about use regular expressions, so when searching for or replacing one of these special characters, the fixed function needs to be wrapped around the text, like this.We won’t discuss regular expressions any further, but check out these courses to learn more about them.</p>
<p><strong>11. Let’s practice!</strong></p>
<p>Time to practice cleaning some text data!</p>
</section>
<section id="detecting-inconsistent-text-data" class="level2">
<h2 class="anchored" data-anchor-id="detecting-inconsistent-text-data">Detecting inconsistent text data</h2>
<p>You’ve recently received some news that the customer support team wants to ask the SFO survey participants some follow-up questions. However, the auto-dialer that the call center uses isn’t able to parse all of the phone numbers since they’re all in different formats. After some investigation, you found that some phone numbers are written with hyphens (<code>-</code>) and some are written with parentheses (<code>(</code>,<code>)</code>). In this exercise, you’ll figure out which phone numbers have these issues so that you know which ones need fixing.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter for rows with phone numbers that contain <code>"-"</code>s.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># 1. Filter for rows with "-" in the phone column</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">filter</span>(phone <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">"-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Filter for rows with phone numbers that contain <code>"("</code>, or <code>")"</code>. Remember to use <code>fixed()</code> when searching for parentheses.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># 2. Filter for rows with "(" or ")" in the phone column</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(phone, <span class="fu">fixed</span>(<span class="st">"("</span>)) <span class="sc">|</span> <span class="fu">str_detect</span>(phone, <span class="fu">fixed</span>(<span class="st">")"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Delightful detection! Now that you’ve identified the inconsistencies in the <code>phone</code> column, it’s time to remove unnecessary characters to make the follow-up survey go as smoothly as possible.</p>
</section>
<section id="correcting-inconsistent-text-data" class="level2">
<h2 class="anchored" data-anchor-id="correcting-inconsistent-text-data">Correcting inconsistent text data</h2>
<section id="replacing-and-removing" class="level3">
<h3 class="anchored" data-anchor-id="replacing-and-removing">Replacing and removing</h3>
<p>In the last section, you saw that the <code>phone</code> column of <code>sfo_data</code> is plagued with unnecessary parentheses and hyphens. The customer support team has requested that all phone numbers be in the format <code>"123 456 7890"</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Remove opening and closing parentheses from the <code>phone</code> column. Store this as a variable called <code>phone_no_parens</code>. Remember to use <code>fixed()</code>!</li>
<li>Add a new column to <code>sfo_survey</code> called <code>phone_no_parens</code> that contains the contents of <code>phone_no_parens</code>.</li>
<li>Create a new column of <code>sfo_survey</code> called <code>phone_clean</code> containing the values of <code>phone_no_parens</code> with all hyphens replaced with spaces.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># 1. Remove parentheses from phone column</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>phone_no_parens <span class="ot">&lt;-</span> sfo_survey_mod<span class="sc">$</span>phone <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="co"># Remove "("s</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>  <span class="fu">str_remove_all</span>(<span class="fu">fixed</span>(<span class="st">"("</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>  <span class="co"># Remove ")"s</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>  <span class="fu">str_remove_all</span>(<span class="fu">fixed</span>(<span class="st">")"</span>))</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="co"># 2. Add phone_no_parens as column</span></span>
<span id="cb37-9"><a href="#cb37-9"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10"></a>  <span class="fu">mutate</span>(<span class="at">phone_no_parens =</span> phone_no_parens,</span>
<span id="cb37-11"><a href="#cb37-11"></a>  <span class="co"># 3. Replace all hyphens in phone_no_parens with spaces</span></span>
<span id="cb37-12"><a href="#cb37-12"></a>         <span class="at">phone_clean =</span> <span class="fu">str_replace_all</span>(phone_no_parens, <span class="st">"-"</span>, <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Radical replacing and removing! Now that your phone numbers are all in a single format, the machines in the call center will be able to auto-dial the numbers, making it easier to ask participants follow-up questions.</p>
</section>
<section id="invalid-format" class="level3">
<h3 class="anchored" data-anchor-id="invalid-format">Invalid format</h3>
<p>The customer support team is grateful for your work so far, but during their first day of calling participants, they ran into some phone numbers that were invalid. In this section, you’ll remove any rows with invalid phone numbers so that these faulty numbers don’t keep slowing the team down.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Examine the invalid <code>phone</code> numbers by filtering for numbers whose length is not equal to 12.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># 1. Check out the invalid numbers</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(phone_no_parens) <span class="sc">!=</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Remove the rows with invalid numbers by filtering for numbers with a length of exactly 12.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Remove rows with invalid numbers</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>sfo_survey_mod <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(phone_no_parens) <span class="sc">==</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mission accomplished! Thanks to your savvy string skills, the follow-up survey will be done in no time!</p>
</section>
</section>
<section id="uniformity" class="level2">
<h2 class="anchored" data-anchor-id="uniformity">Uniformity</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Uniformity</strong></p>
<p>Great work on Chapter 2! In this chapter, we’ll focus on more advanced data cleaning problems.</p>
<p><strong>2. Uniformity</strong></p>
<p>The first problem we’ll tackle is uniformity. Uniformity issues are when continuous data points have different units or different formats. For example, temperature can be written in degrees Celsius or Fahrenheit, weight can be measured in kilograms, grams, or pounds, money can be in US dollars, UK pounds, or even Japanese yen, and dates can be written in different orders.</p>
<p><strong>3. Where do uniformity issues come from?</strong></p>
<p>Uniformity issues arise when you’re using multiple data sources that may store data in different ways, or from unstructured data entry that doesn’t require specific units or formatting.</p>
<p><strong>4. Finding uniformity issues</strong></p>
<p>Let’s take a look at the nyc_temps dataset, which contains daily average temperatures in New York City during April of 2019.</p>
<p><strong>5. Finding uniformity issues</strong></p>
<p>Since outliers can be a sign of uniformity issues, it’s usually helpful to do some basic plotting to identify any outliers.Let’s create a scatter plot of the dataset. This doesn’t look quite right - there are three unusually high temperatures. An outdoor temperature of over 50 degrees Celsius would be very concerning.</p>
<p><strong>6. What to do?</strong></p>
<p>There’s no one best option for dealing with this data. In order to figure out what to do, we’ll need to do some deeper research into the dataset.There were no big climate events in New York during this month, so there’s probably something else up with these values. After speaking with the person in charge of temperature data collection, we learn that on these three days, the thermometer was broken and data needed to be pulled in from another source. However, this other source measured temperature in Fahrenheit instead of Celsius.</p>
<p><strong>7. Unit conversion</strong></p>
<p>Since we know exactly why these data points aren’t uniform, we can adjust them to fit with the rest of the data points. Here, we have the formula to convert temperature in Fahrenheit to Celsius. We only want to apply this formula to the ones that are in Fahrenheit. To do this, we’ll use the ifelse function. ifelse takes in a condition, the value to use if the condition is true, and the value to use if the condition is false. Let’s add a column to nyc_temps called temp_c.&nbsp;ifelse will check if the original temperature is over 50, convert it to Celsius if it is, and keep the original temperature otherwise. The first temperature was already in Celsius, so temp_c contains the same value, but 58-point-5 got converted to 14-point-7.</p>
<p><strong>8. Unit conversion</strong></p>
<p>If we create the same scatterplot as before using the temp_c column, the temperatures all range between 4 and 20, which matches what we expected.</p>
<p><strong>9. Date uniformity</strong></p>
<p>Dates can also pose uniformity problems, since there are lots of different ways to write them. In this example, dates are written in three different ways.We can use special formatting strings to convert them to uniform Date objects so they’re all written in the same way. These are the ones we’ll need for this dataset, but there are so many others like these - you can always type this in your R console to get a list of all available date formats.</p>
<p><strong>10. Parsing multiple formats</strong></p>
<p>To convert these all to Date objects, we’ll use the parse_date_time function from the lubridate package. We pass in the vector of dates to convert, and a vector of format strings to the “orders” argument. This contains the three different formats that we saw in our data frame.Just like that, all of the dates are in the exact same format!If we try to parse a date that’s not in one of the formats we specified, NA will be returned instead.</p>
<p><strong>11. Ambiguous dates</strong></p>
<p>Sometimes dates can be ambiguous and you won’t be able to tell what format they follow.For example, is this date in February or April? As with other cleaning tasks, this is highly dependent on your data and where it came from. One option is to treat these dates as missing. If your data comes from multiple sources, you may notice that one source uses one format and another source uses a different format. From there, you’ll be able to make an educated guess about the format of the date based on which source it came from. You can also try and figure out what the format is based on other dates in the dataset. If you know there should be one data point per date, you might be able to figure it out.</p>
<p><strong>12. Let’s practice!</strong></p>
<p>Time to practice unit and date conversions!</p>
<p>In this section, you’ll dive into more advanced data cleaning problems, such as ensuring that weights are all written in kilograms instead of pounds. You’ll also gain invaluable skills that will help you verify that values have been added correctly and that missing values don’t negatively impact your analyses.</p>
<p>Different units or formats:</p>
<ul>
<li><strong>Temperature</strong>: <code>°C</code> vs.&nbsp;<code>°F</code><br>
</li>
<li><strong>Weight</strong>: <code>kg</code> vs.&nbsp;<code>g</code> vs.&nbsp;<code>lb</code></li>
<li><strong>Money</strong>: USD <code>$</code> vs.&nbsp;GBP <code>£</code> vs.&nbsp;JPY <code>¥</code></li>
<li><strong>Date</strong>: <code>DD-MM-YYYY</code> vs.&nbsp;<code>MM-DD-YYYY</code> vs.&nbsp;<code>YYYY-MM-DD</code></li>
</ul>
<section id="date-uniformity" class="level3">
<h3 class="anchored">Date uniformity</h3>
<p><strong>Data</strong></p>
<ul>
<li><code>accounts</code></li>
</ul>
<p>You work at an asset management company and you’ll be working with the <code>accounts</code> dataset, which contains information about each customer, the amount in their account, and the date their account was opened. Your boss has asked you to calculate some summary statistics about the average value of each account and whether the age of the account is associated with a higher or lower account value. Before you can do this, you need to make sure that the <code>accounts</code> dataset you’ve been given doesn’t contain any uniformity problems. In this section, you’ll investigate the <code>date_opened</code> column and clean it up so that all the dates are in the same format.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code>lubridate</code></li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Take a look at the head of <code>accounts</code> to get a sense of the data you’re working with.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>accounts <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/accounts.rds"</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a></span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="co"># 1. Check out the accounts data frame</span></span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="fu">head</span>(accounts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-5" class="anchored" data-anchor-id="date-uniformity"><em>Question</em></h2>
<p>Try running <code>as.Date(accounts$date_opened)</code> in the console and examine the output. Notice that you end up with a lot of <code>NAs</code>. Why is this?<br> <br> ⬜ <code>as.Date()</code> needs to be explicitly told the formats of every single date, including which dates are in which format.<br> ✅ By default, <code>as.Date()</code> can’t convert “Month DD, YYYY” formats.<br> ⬜ <code>as.Date()</code> can’t convert <code>character</code>s to <code>Date</code>s.<br></p>
</blockquote>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Convert the dates in the <code>date_opened</code> column to the same format using the <code>formats</code> vector and store this as a new column called <code>date_opened_clean</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># 1.1 Define the date formats</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>formats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"%Y-%m-%d"</span>, <span class="st">"%B %d, %Y"</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co"># 1.2 Convert dates to the same format</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>accounts <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>  <span class="fu">mutate</span>(<span class="at">date_opened_clean =</span> <span class="fu">parse_date_time</span>(date_opened,  <span class="at">orders =</span> formats))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cunning calendar cleaning! Now that the <code>date_opened</code> dates are in the same format, you’ll be able to use them for some plotting in the next exercise.</p>
</section>
<section id="currency-uniformity" class="level3">
<h3 class="anchored" data-anchor-id="currency-uniformity">Currency uniformity</h3>
<p>Now that your dates are in order, you’ll need to correct any unit differences. When you first plot the data, you’ll notice that there’s a group of very high values, and a group of relatively lower values. The bank has two different offices - one in New York, and one in Tokyo, so you suspect that the accounts managed by the Tokyo office are in Japanese yen instead of U.S. dollars. Luckily, you have a data frame called <code>account_offices</code> that indicates which office manages each customer’s account, so you can use this information to figure out which <code>total</code>s need to be converted from yen to dollars.</p>
<p>The formula to convert yen to dollars is <code>USD = JPY / 104</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a scatter plot with <code>date_opened</code> on the x-axis and <code>total</code> on the y-axis.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># 1. Scatter plot of opening date and total amount</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>accounts <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_opened, <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Left join <code>accounts</code> and <code>account_offices</code> by their <code>id</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>account_offices <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/account_offices.rds"</span>)</span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co"># 2. Left join accounts and account_offices by id</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>accounts <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>  <span class="fu">left_join</span>(account_offices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Convert the <code>total</code>s from the Tokyo office from yen to dollars, and keep the <code>total</code> from the New York office in dollars. Store this as a new column called <code>total_usd</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Left join accounts to account_offices by id</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>accounts <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="fu">left_join</span>(account_offices, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="co"># 3. Convert totals from the Tokyo office to USD</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="fu">mutate</span>(<span class="at">total_usd =</span> <span class="fu">ifelse</span>(total <span class="sc">&gt;</span> <span class="dv">5000000</span>, total <span class="sc">/</span> <span class="dv">104</span>, total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Create a scatter plot of your new uniform data using <code>date_opened</code> on the x-axis and <code>total_usd</code> on the y-axis.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Left join accounts to account_offices by id</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>accounts <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">left_join</span>(account_offices, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>  <span class="co"># Convert totals from the Tokyo office to USD</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>  <span class="fu">mutate</span>(<span class="at">total_usd =</span> <span class="fu">ifelse</span>(office <span class="sc">==</span> <span class="st">"Tokyo"</span>, total <span class="sc">/</span> <span class="dv">104</span>, total)) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>  <span class="co"># 4. Scatter plot of opening date vs total_usd</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_opened, <span class="at">y =</span> total_usd)) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Crafty currency conversion! The points in your last scatter plot all fall within a much smaller range now and you’ll be able to accurately assess the differences between accounts from different countries.</p>
</section>
</section>
<section id="cross-field-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-field-validation">Cross field validation</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Cross field validation</strong></p>
<p>In this lesson, we’ll talk about using cross field validation to find dirty data.</p>
<p><strong>2. What is cross field validation?</strong></p>
<p>Cross field validation is essentially a sanity check on your data to check that one value makes sense based on other values in your dataset.Here, 52% and 58% add up to 110%, which doesn’t make sense in this context, so we know that one or more of these values are wrong.</p>
<p><strong>3. Credit card data</strong></p>
<p>Here’s a data frame called credit_cards, which contains information on credit card accounts, including the date it was opened, the amount of cash back the account has received on dining, groceries, and gas, as well as the total cash back and the age of the account.</p>
<p><strong>4. Validating numbers</strong></p>
<p>For this type of credit card, there are only three categories of purchases that you can earn cash back on, so we know that the three categories should add up to the total.</p>
<p><strong>5. Validating numbers</strong></p>
<p>To find any accounts where the categories don’t sum up to the total, we can first create a new column called theoretical_total, which contains the sum of dining, grocery, and gas cash back. Then, we can filter for rows where the theoretical_total is not equal to the total_cb, or the actual total. We have two rows that don’t add up correctly.</p>
<p><strong>6. Validating date and age</strong></p>
<p>We can also validate dates and ages in a similar way, since we know that the difference between today’s date and the date_opened should be the account’s age.</p>
<p><strong>7. Calculating age</strong></p>
<p>To calculate age in years, we take the origin date, in this case Sept 9, 2015, and use the percent-minus-minus-percent operator followed by the today function. This will calculate how much time has passed between the origin date and today.However, this returns a special data type, so we’ll need to convert it to numeric using as-dot-numeric. We’ll pass “years” in quotes as the second argument to convert the time interval into a number of years.Finally, if we want only the number of years, we can use the floor function to get rid of the decimals.</p>
<p><strong>8. Validating age</strong></p>
<p>We can use the same mutate and filter strategy as we used when validating the cash back totals. We’ll create a column called theor_age to hold the calculated age, and compare it to the account age.We have two accounts that have mismatched ages.</p>
<p><strong>9. What next?</strong></p>
<p>Once we find this invalid data, what do we do with it? Just like other data cleaning problems, there is no one-size-fits-all solution, since finding the best solution is dependent on the dataset.We can decide to drop inconsistent data, set it to missing and impute it, or apply some rules using domain knowledge, but in order to know what the best approach is, we have to have a good understanding of where the dataset comes from and the different sources feeding into it.</p>
<p><strong>10. Let’s practice!</strong></p>
<p>Time to do some cross field validation on your own!</p>
<ul>
<li>Cross field validation = sanity check</li>
<li>Does this value makes senese based on another values?</li>
</ul>
<p><img src="readme_files/cross_field_validation.jpg" class="img-fluid"> <sup>https://www.buzzfeednews.com/article/katienotopoulos/graphs-that-lied-to-us</sup></p>
<section id="validating-totals" class="level3">
<h3 class="anchored" data-anchor-id="validating-totals">Validating totals</h3>
<p>You’ll continue to work with the <code>accounts</code> data frame, but this time, you have a bit more information about each account. There are three different funds that account holders can store their money in. In this section, you’ll validate whether the <code>total</code> amount in each account is equal to the sum of the amount in <code>fund_A</code>, <code>fund_B</code>, and <code>fund_C</code>. If there are any accounts that don’t match up, you can look into them further to see what went wrong in the bookkeeping that led to inconsistencies.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a new column called <code>theoretical_total</code> that contains the sum of the amounts in each fund.</li>
<li>Find the accounts where the <code>total</code> doesn’t match the <code>theoretical_total</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>accounts_mod <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/accounts_mod.rds"</span>)</span>
<span id="cb46-2"><a href="#cb46-2"></a></span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="co"># Find invalid totals</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>accounts_mod <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="co"># 1. theoretical_total: sum of the three funds</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>  <span class="fu">mutate</span>(<span class="at">theoretical_total =</span> fund_A <span class="sc">+</span> fund_B <span class="sc">+</span> fund_C) <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>  <span class="co"># 2. Find accounts where total doesn't match theoretical_total</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>  <span class="fu">filter</span>(theoretical_total <span class="sc">!=</span> total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great job! By using cross field validation, you’ve been able to detect values that don’t make sense. How you choose to handle these values will depend on the dataset.</p>
</section>
<section id="validating-age" class="level3">
<h3 class="anchored" data-anchor-id="validating-age">Validating age</h3>
<p>Now that you found some inconsistencies in the <code>total</code> amounts, you’re suspicious that there may also be inconsistencies in the <code>acct_age</code>column, and you want to see if these inconsistencies are related. Using the skills you learned from the video exercise, you’ll need to validate the age of each account and see if rows with inconsistent <code>acct_age</code>s are the same ones that had inconsistent <code>total</code>s</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a new column called <code>theoretical_age</code> that contains the age of each account based on the <code>date_opened</code>.</li>
<li>Find the accounts where the <code>acct_age</code> doesn’t match the <code>theoretical_age</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Find invalid acct_age</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>accounts_mod <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="co"># 1. theoretical_age: age of acct based on date_opened</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="fu">mutate</span>(<span class="at">theoretical_age =</span> <span class="fu">floor</span>(<span class="fu">as.numeric</span>(date_opened <span class="sc">%--%</span> <span class="fu">today</span>(), <span class="st">"years"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="co"># 2. Filter for rows where acct_age is different from theoretical_age</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>  <span class="fu">filter</span>(acct_age <span class="sc">!=</span> theoretical_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vigorous validating! There are three accounts that all have ages off by one year, but none of them are the same as the accounts that had <code>total</code> inconsistencies, so it looks like these two bookkeeping errors may not be related.</p>
</section>
</section>
<section id="completeness" class="level2">
<h2 class="anchored" data-anchor-id="completeness">Completeness</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Completeness</strong></p>
<p>Welcome back! In this lesson, we’ll talk about completeness and missing data.</p>
<p><strong>2. What is missing data?</strong></p>
<p>Missing data is one of the most common and most important data cleaning problems. Data is considered “missing” when there is no value stored for a variable in an observation. Missing data is most commonly represented as NA or NaN, but can take on arbitrary values like 0, 99, or a dot.</p>
<p><strong>3. What is missing data?</strong></p>
<p>Like a lot of the problems that we’ve seen so far, missing data can happen due to technical</p>
<p><strong>4. What is missing data?</strong></p>
<p>and human errors.Missing data can take many forms, so let’s take a look at an example.</p>
<p><strong>5. Air quality</strong></p>
<p>Let’s take a look at the airquality dataset. It contains ozone, solar radiation, wind, and temperature measurements for different days of the year.</p>
<p><strong>6. Air quality</strong></p>
<p>Here, we have some missing values, which are represented as NA in R.</p>
<p><strong>7. Finding missing values</strong></p>
<p>We can find missing values in a dataset using the is-dot-na function, which returns TRUE if a value is missing and FALSE if it’s not, for every value in a data frame.</p>
<p><strong>8. Counting missing values</strong></p>
<p>If we wrap is-dot-na with sum, we get the total number of NAs in the entire dataset. However, this isn’t separated by column, so we don’t know where exactly our missing values are.</p>
<p><strong>9. Visualizing missing values</strong></p>
<p>That’s where visualization comes in. We can use the vis_miss function from the visdat package. This will give us a plot that shows missing values in black, and present values in gray. We can look down a column of the plot to see how many missing values there are in each column, and can look from left to right to get a sense if there are a lot of rows with multiple missing values. Here, the Ozone column has the most missing values. Solar radiation also has some missing values, but not as many. None of the other columns have missing data.It looks like the missingness is pretty random, but let’s take a deeper look.</p>
<p><strong>10. Investigating missingness</strong></p>
<p>Let’s see if there are any differences between the rows with missing and non-missing ozone values.We’ll create a new column called miss_ozone, using is-dot-na to determine if the row is missing the ozone value or not. Then, we group by miss_ozone and use summarize_all, taking the median of each variable. We also set na-dot-rm to TRUE so that the median function ignores any missing values.The first row has the median of each variable for all rows with non-missing ozone values, and the second row has the median of each variable for all rows with missing ozone. Most of the medians look quite similar, but there’s about a thirty degree difference in temperature! This suggests that Ozone is missing for days that had high temperatures.</p>
<p><strong>11. Investigating missingness</strong></p>
<p>If we sort the observations by temperature, then use vis_miss, we can see that all the missing values of Ozone are clustered in last observations, which are the observations with the highest temperatures. Something must break in the sensor when it gets too hot out!</p>
<p><strong>12. Types of missing data</strong></p>
<p>Let’s talk about the types of missing data. Data can be missing completely at random, missing at random, or missing not at random.</p>
<p><strong>13. Types of missing data</strong></p>
<p>When data is missing completely at random, there is no pattern to the missingness and no relationship between missing data and any other values. This could happen from something like data entry errors.</p>
<p><strong>14. Types of missing data</strong></p>
<p>When data is missing at random, there is a systematic relationship between missing data and other observed values in the dataset. This is just like what we observed with the air quality data where there was a relationship between missingness and temperature. “Missing at random” is actually a misleading name, since there’s nothing random about this type of missing data.</p>
<p><strong>15. Types of missingness</strong></p>
<p>When data is missing not at random, there is a systematic relationship between the missing data and unobserved values. For example, when it’s really hot outside, the thermometer might stop working, so we don’t have temperature measurements for days with high temperatures. However, we have no way to tell this just from looking at the data since we can’t actually see what the missing temperatures are.</p>
<p><strong>16. Dealing with missing data</strong></p>
<p>There are lots of ways to deal with missing data. We can remove any rows that contain missing data. We can also impute, or fill in, missing values using statistical measures or domain knowledge.There are also more complicated algorithmic approaches or ones that require some machine learning. Each missingness type requires a specific approach, and each type of approach has pros and cons. To learn more, check out these courses!</p>
<p><strong>17. Dropping missing values</strong></p>
<p>We can remove rows with missing values by filtering for rows where the Ozone value is not NA and the Solar radiation value is not NA.</p>
<p><strong>18. Replacing missing values</strong></p>
<p>We can replace missing values using mutate combined with ifelse. We create a new column called ozone_filled. If the Ozone value is missing, we use the mean Ozone value. If the Ozone value isn’t missing, we use the original value.</p>
<p><strong>19. Let’s practice!</strong></p>
<p>Now that you know how to tackle missing data, time to practice!</p>
<section id="types-of-missingness" class="level3">
<h3 class="anchored" data-anchor-id="types-of-missingness">Types of missingness</h3>
<p>The three flavors of missing data:</p>
<p><img src="readme_files/types_of_missingness.png" class="img-fluid"></p>
<p><strong>Example:</strong> Types of missingness.</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Missing completely at random</th>
<th>Missing at random</th>
<th>Missing not at random</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Questionnaires were randomly lost in the mail.</td>
<td>Younger people were less likely to get their blood pressure checked at the doctor, so their medical records were missing blood pressure data.</td>
<td>Blood samples tested during the night shift were more likely to be contaminated, creating missing test results, but time of testing wasn’t recorded.</td>
</tr>
<tr class="even">
<td></td>
<td>Test scores are missing for students from a certain school district, but not the others.</td>
<td>A scale has a limit of 30 lbs, so shipments above 30 lbs don’t have a recorded weight.</td>
</tr>
</tbody>
</table>
</section>
<section id="visualizing-missing-data" class="level3">
<h3 class="anchored">Visualizing missing data</h3>
<p>Dealing with missing data is one of the most common tasks in data science. There are a variety of types of missingness, as well as a variety of types of solutions to missing data.</p>
<p><strong>Data</strong></p>
<ul>
<li><code>accounts_new</code></li>
</ul>
<p>You just received a new version of the <code>accounts</code> data frame containing data on the amount held and amount invested for new and existing customers. However, there are rows with missing <code>inv_amount</code> values.</p>
<p>You know for a fact that most customers below 25 do not have investment accounts yet, and suspect it could be driving the missingness.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code><a href="https://docs.ropensci.org/visdat/">visdat</a></code></li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Visualize the missing values in <code>accounts</code> by column using a function from the <code>visdat</code> package.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>accounts_new <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/accounts_new.rds"</span>)</span>
<span id="cb48-2"><a href="#cb48-2"></a></span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="co">#library</span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="fu">library</span>(visdat)</span>
<span id="cb48-5"><a href="#cb48-5"></a></span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="co"># 1. Visualize the missing values by column</span></span>
<span id="cb48-7"><a href="#cb48-7"></a>accounts_new <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8"></a>    <span class="fu">vis_miss</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Add a logical column to <code>accounts</code> called <code>missing_inv</code> that indicates whether each row is missing the <code>inv_amount</code> or not.</li>
<li>Group by <code>missing_inv</code>.</li>
<li>Calculate the mean age for each group of <code>missing_inv</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>accounts_new <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>  <span class="co"># 2. missing_inv: Is inv_amount missing?</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">mutate</span>(<span class="at">missing_inv =</span> <span class="fu">is.na</span>(inv_amount)) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="co"># 3. Group by missing_inv</span></span>
<span id="cb49-5"><a href="#cb49-5"></a>  <span class="fu">group_by</span>(missing_inv) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>  <span class="co"># 4. Calculate mean age for each missing_inv group</span></span>
<span id="cb49-7"><a href="#cb49-7"></a>  <span class="fu">summarise</span>(<span class="at">avg_age =</span> <span class="fu">mean</span>(age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-6" class="anchored" data-anchor-id="visualizing-missing-data"><em>Question</em></h2>
<p>Take a look at the mean age for each group of <code>missing_inv</code>. What’s going on here?<br> <br> ⬜ The data is missing completely at random and there are no drivers behind the missingness.<br> ✅ Since the average age for <code>TRUE</code> <code>missing_inv</code> is 22 and the average age for <code>FALSE</code> <code>missing_inv</code> is 44, it is likely that the <code>inv_amount</code> variable is missing mostly in young customers.<br> ⬜ Since the average age for <code>FALSE</code> <code>missing_inv</code> is 22 and the average age for <code>TRUE</code> <code>missing_inv</code> is 44, it is likely that the <code>inv_amount</code> variable is missing mostly in older customers.<br></p>
</blockquote>
<ol start="5" type="1">
<li>Sort <code>accounts</code> by <code>age</code>.</li>
<li>Visualize missing data by column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># 5. / 6. Sort by age and visualize missing vals</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>accounts_new <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="fu">arrange</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>  <span class="fu">vis_miss</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fabulous visualizations! Investigating summary statistics based on missingness is a great way to determine if data is missing completely at random or missing at random.</p>
</section>
<section id="treating-missing-data" class="level3">
<h3 class="anchored" data-anchor-id="treating-missing-data">Treating missing data</h3>
<p>Simple Approaches</p>
<ol type="1">
<li>Drop missing data</li>
<li>Impute (fill in) with statistical measures (mean, median, mode, …) or domain knowledge</li>
</ol>
<p>More complex approaches</p>
<ol type="1">
<li>Impute using an algorithmic approach</li>
<li>Impute with machine learning models</li>
</ol>
<p><strong>Data</strong></p>
<ul>
<li><code>accounts_new2</code></li>
</ul>
<p>In this section, you’re working with another version of the <code>accounts</code> data that contains missing values for both the <code>cust_id</code> and <code>acct_amount</code> columns.</p>
<p>You want to figure out how many unique customers the bank has, as well as the average amount held by customers. You know that rows with missing <code>cust_id</code> don’t really help you, and that on average, the <code>acct_amount</code> is usually 5 times the amount of <code>inv_amount</code>.</p>
<p>In this task, you will drop rows of <code>accounts</code> with missing <code>cust_id</code>s, and impute missing values of <code>inv_amount</code> with some domain knowledge. <code>dplyr</code> and <code>assertive</code> are loaded and <code>accounts</code> is available.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter <code>accounts</code> to remove rows with missing <code>cust_id</code>s and save as <code>accounts_clean</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>accounts_new2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/accounts_new2.rds"</span>)</span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co"># 1. Create accounts_clean</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>accounts_clean <span class="ot">&lt;-</span> accounts_new2 <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>  <span class="co"># Filter to remove rows with missing cust_id</span></span>
<span id="cb51-6"><a href="#cb51-6"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cust_id))</span>
<span id="cb51-7"><a href="#cb51-7"></a></span>
<span id="cb51-8"><a href="#cb51-8"></a>accounts_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Create a new column called <code>acct_amount_filled</code>, which contains the values of <code>acct_amount</code>, except all <code>NA</code> values should be replaced with 5 times the amount in <code>inv_amount</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># 2. Create accounts_clean</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>accounts_clean <span class="ot">&lt;-</span> accounts_new2 <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="co"># Filter to remove rows with missing cust_id</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cust_id)) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="co"># Add new col acct_amount_filled with replaced NAs</span></span>
<span id="cb52-6"><a href="#cb52-6"></a>  <span class="fu">mutate</span>(<span class="at">acct_amount_filled =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(acct_amount), <span class="dv">5</span> <span class="sc">*</span> inv_amount, acct_amount))</span>
<span id="cb52-7"><a href="#cb52-7"></a></span>
<span id="cb52-8"><a href="#cb52-8"></a>accounts_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Assert that there are no missing values in the <code>cust_id</code> column of <code>accounts_clean</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># 3. Assert that cust_id has no missin</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="fu">assert_all_are_not_na</span>(accounts_clean<span class="sc">$</span>cust_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Assert that there are no missing values in the <code>acct_amount_filled</code> column of <code>accounts_clean</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># 4. Assert that acct_amount_filled has no missing vals</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="fu">assert_all_are_not_na</span>(accounts_clean<span class="sc">$</span>acct_amount_filled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great job! Since your assertions passed, there’s no missing data left, and you can definitely <em>bank</em> on nailing your analysis!</p>
</section>
</section>
</section>
<section id="record-linkage" class="level1">
<h1>3. Record Linkage</h1>
<section id="comparing-strings" class="level2">
<h2 class="anchored" data-anchor-id="comparing-strings">Comparing strings</h2>
<p><strong>1. Comparing strings</strong></p>
<p>Welcome to the final chapter of the course! In this chapter, we’ll be focusing on string matching and record linkage.</p>
<p><strong>2. Measuring distance between values</strong></p>
<p>If we have two values, a 3 and a 10,</p>
<p><strong>3. Measuring distance between values</strong></p>
<p>we can measure the distance between them</p>
<p><strong>4. Measuring distance between values</strong></p>
<p>using subtraction. The distance between them is 10 minus 3, which is 7. Comparing numbers is easy, but how do we compare strings? Before we dive into record linkage, we need to learn about how to measure distance between strings.</p>
<p><strong>5. Minimum edit distance</strong></p>
<p>Edit distance is a way of measuring how different two strings are from each other, based on the four basic kinds of typos, which are inserting a character,</p>
<p><strong>6. Minimum edit distance</strong></p>
<p>deleting a character,</p>
<p><strong>7. Minimum edit distance</strong></p>
<p>substituting one character for another,</p>
<p><strong>8. Minimum edit distance</strong></p>
<p>and transposing, or swapping the positions of, two characters. Minimum edit distance is the fewest number of typos you’d need to convert one string to another.</p>
<p><strong>9. Edit distance = 1</strong></p>
<p>Here are some examples. To turn “dog” into “dogs”, we insert an “s”.</p>
<p><strong>10. Edit distance = 1</strong></p>
<p>To turn “bath” into “bat”, we remove the “h”.</p>
<p><strong>11. Edit distance = 1</strong></p>
<p>To turn “cats” into “rats”, we substitute an “r” for the “c”.</p>
<p><strong>12. Edit distance = 1</strong></p>
<p>To turn “sing” into “sign”, we swap the positions of the “n” and the “g”. Since all of these pairs require only one edit, they all have an edit distance of 1.</p>
<p><strong>13. A more complex example</strong></p>
<p>Let’s look at a more complex example and calculate the edit distance between “baboon” and “typhoon”.</p>
<p><strong>14. A more complex example</strong></p>
<p>First, we’ll need to insert an “h”.</p>
<p><strong>15. A more complex example</strong></p>
<p>Then, we’ll need to substitute “t” for “b”,</p>
<p><strong>16. A more complex example</strong></p>
<p>substitute “y” for “a”,</p>
<p><strong>17. A more complex example</strong></p>
<p>and substitute “p” for “b”. This gives us a total of 4 actions, or an edit distance of 4.</p>
<p><strong>18. Types of edit distance</strong></p>
<p>There are multiple types of edit distance that each calculate distance between strings a little differently. The Damerau-Levenshtein distance is what you just learned. The Levenshtein distance does not count transposition as a single action - instead, it counts as 2: a deletion and an insertion. The Longest Common Subsequence, or LCS, distance considers only insertion and deletion as actions. There are also other more complex ways of calculating string distance, such as Jaro-Winkler or Jaccard distance. Each method has a relative advantage in different circumstances, but going into the details of when to use each one is out of the scope of the course. However, feel free to experiment with the different methods and use the one that gives you the best results.</p>
<p><strong>19. String distance in R</strong></p>
<p>Let’s go back to our baboon-typhoon example. To calculate edit distances in R, you can use stringdist from the stringdist package, passing it the two strings to compare and the method you want to use. In this case, we’re using “dl”, which stands for Damerau-Levenshtein.</p>
<p><strong>20. Other methods</strong></p>
<p>Using the method argument, we can also calculate different types of distances that we’ve discussed. The output of Jaccard is on a scale of 0 to 1, where numbers closer to 0 indicate that the strings are more similar.</p>
<p><strong>21. Comparing strings to clean data</strong></p>
<p>In chapter 2, you collapsed multiple categories into one using manually defined categories. But if there are too many variations to type out, we can use string distance to map them to the correct category.</p>
<p><strong>22. Comparing strings to clean data</strong></p>
<p>Here’s a survey where participants in New York, Chicago, Los Angeles, and Seattle were asked where they currently live, and how likely they are to consider moving away on a scale of 1 to 5. The survey had free text entry, so the city column is riddled with typos. To map them to the correct spelling, we can compare the distance between each survey response and the set of possible answers, and choose the one that’s closest.</p>
<p><strong>23. Remapping using string distance</strong></p>
<p>The fuzzyjoin package allows us to do joins based on string distance. We can use stringdist_left_join to join the survey data to cities. Just like the stringdist function, we can pass in the method we want to use for string distance.</p>
<p><strong>24. Remapping using string distance</strong></p>
<p>We can also use the max_dist argument to adjust how close we want the strings to be in order to consider them a match. Notice how we get an NA, since the typo in row 8 wasn’t close enough to any of the cities to be assigned to one.</p>
<hr>
<p>Record linkage is a powerful technique used to merge multiple datasets together, used when values have typos or different spellings. In this section, you’ll learn how to link records by calculating the similarity between strings—you’ll then use your new skills to join two restaurant review datasets into one clean master dataset.</p>
<p><strong>Link or join?</strong></p>
<p>Similar to joins, record linkage is the act of linking data from different sources regarding the same entity. But unlike joins, record linkage does not require exact matches between different pairs of data, and instead can find close matches using string similarity. This is why record linkage is effective when there are no common unique keys between the data sources you can rely upon when linking data sources such as a unique identifier.</p>
<p><strong>Example:</strong> Which problems require record linkage and which problems can be approached using a standard join.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Record Linkage</th>
<th>Regular joins</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two customer data frames containing names and address, one with a unique identifier per customer, one without.</td>
<td>Consolidating two data frames containing details on DataCamp courses, with each DataCamp course having its own unique identifier.</td>
</tr>
<tr class="even">
<td>Using an <code>address</code> column to join two data frames, with the address in each data frame formatted slightly differently.</td>
<td>Two basketball DataFrames with a common unique identifier per game.</td>
</tr>
<tr class="odd">
<td>Merging two basketball data frames, with columns <code>team_A</code>, <code>team_B</code>, and <code>time</code> and differently formatted team names between each data frame.</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="stringdist-calculating-distance" class="level2">
<h2 class="anchored" data-anchor-id="stringdist-calculating-distance">stringdist(): Calculating distance</h2>
<p>The Damerau-Levenshtein distance can be used to identify how similar two strings are. As a reminder, Damerau-Levenshtein distance is the <ins>minimum number of steps</ins> needed to get from <strong><em>String A</em></strong> to <strong><em>String B</em></strong>, using these operations:</p>
<ul>
<li><strong>Insertion</strong> of a new character.</li>
<li><strong>Deletion</strong> of an existing character.</li>
<li><strong>Substitution</strong> of an existing character.</li>
<li><strong>Transposition</strong> of two existing consecutive characters.</li>
</ul>
<p><strong>Example:</strong> Distance = 1 (method = “dl”)</p>
<p><img src="readme_files/distance.png" class="img-fluid"></p>
<blockquote class="blockquote">
<h2 id="question-7" class="anchored"><em>Question</em></h2>
<p>What is the Damerau-Levenshtein distance between the words <code>"puffin"</code> and <code>"muffins"</code> and which operation(s) gets you there?<br> <br> ⬜ 1 by substituting <code>"m"</code> for <code>"p"</code>.<br> ⬜ 2 by inserting <code>"m"</code> and inserting <code>"s"</code>.<br> ✅ 2 by substituting <code>"m"</code> for <code>"p"</code> and inserting <code>"s"</code>.<br> ⬜ 3 by deleting <code>"p"</code>, adding <code>"m"</code>, and adding <code>"s"</code>.<br></p>
</blockquote>
<p>Crafty calculations! Substituting and inserting is the best way to get from “puffin” to “muffins”.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code>stringdist</code></li>
</ul>
<p>There are multiple ways to calculate how similar or different two strings are. Now we’ll practice using the <code>stringdist</code> package to compute string distances using various methods. It’s important to be familiar with different methods, as some methods work better on certain datasets, while others work better on other datasets.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the Damerau-Levenshtein distance between <code>"las angelos"</code> and <code>"los angeles"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">library</span>(stringdist)</span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co"># 1. Calculate Damerau-Levenshtein distance</span></span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="fu">stringdist</span>(<span class="st">"las angelos"</span>, <span class="st">"los angeles"</span>, <span class="at">method =</span> <span class="st">"dl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calculate the Longest Common Substring (LCS) distance between <code>"las angelos"</code> and <code>"los angeles"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># 2. Calculate LCS distance</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="fu">stringdist</span>(<span class="st">"las angelos"</span>, <span class="st">"los angeles"</span>, <span class="at">method =</span> <span class="st">"lcs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Calculate the Jaccard distance between <code>"las angelos"</code> and <code>"los angeles"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># 3. Calculate Jaccard distance</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="fu">stringdist</span>(<span class="st">"las angelos"</span>, <span class="st">"los angeles"</span>, <span class="at">method =</span> <span class="st">"jaccard"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h2 id="question-8" class="anchored"><em>Question</em></h2>
<p>Why is the LCS distance higher than the Damerau-Levenshtein distance between “las angelos” and “los angeles”?<br> <br> ⬜ Damerau-Levenshtein distance is smaller because it’s always a better method.<br> ✅ LCS distance only uses insertion and deletion, so it takes more operations to change a string to another.<br> ⬜ LCS distance only uses insertion, deletion, and substitution, so it takes more operations to change a string to another<br></p>
</blockquote>
<p>Superb <code>stringdist()</code> skills! In the next exercise, you’ll use Damerau-Levenshtein distance to map typo-ridden cities to their true spellings.</p>
</section>
<section id="fuzzyjoin-fixing-typos-with-string-distance" class="level2">
<h2 class="anchored" data-anchor-id="fuzzyjoin-fixing-typos-with-string-distance">fuzzyjoin(): Fixing typos with string distance</h2>
<p><strong>Data</strong></p>
<ul>
<li><code>zagat</code></li>
<li><code>fodors</code></li>
</ul>
<p>In this section, one of the datasets you’ll be working with, <code>zagat</code>, is a set of restaurants in New York, Los Angeles, Atlanta, San Francisco, and Las Vegas. The data is from Zagat, a company that collects restaurant reviews, and includes the restaurant names, addresses, phone numbers, as well as other restaurant information.</p>
<p>The <code>city</code> column contains the name of the city that the restaurant is located in. However, there are a number of typos throughout the column. Your task is to map each <code>city</code> to one of the five correctly-spelled cities contained in the <code>cities</code> data frame.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code>fuzzyjoin</code></li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the number of each variation of <code>city</code> name in <code>zagat</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>zagat_mod <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/zagat_mod.rds"</span>)</span>
<span id="cb58-2"><a href="#cb58-2"></a></span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="co"># 1. Count the number of each city variation</span></span>
<span id="cb58-4"><a href="#cb58-4"></a>zagat_mod <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5"></a>  <span class="fu">count</span>(city)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Left join <code>zagat</code> and <code>cities</code> based on string distance using the <code>city</code> and <code>city_actual</code> columns.</li>
<li>Select the <code>name</code>, <code>city</code>, and <code>city_actual</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Library</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="fu">library</span>(fuzzyjoin)</span>
<span id="cb59-3"><a href="#cb59-3"></a></span>
<span id="cb59-4"><a href="#cb59-4"></a>cities <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">city_actual =</span> <span class="fu">c</span>(<span class="st">"new york"</span>, <span class="st">"los angeles"</span>, <span class="st">"atlanta"</span>, <span class="st">"san francisco"</span>, <span class="st">"las vegas"</span>))</span>
<span id="cb59-5"><a href="#cb59-5"></a></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="co"># Join zagat and cities and look at results</span></span>
<span id="cb59-7"><a href="#cb59-7"></a>zagat_mod <span class="sc">%&gt;%</span></span>
<span id="cb59-8"><a href="#cb59-8"></a>  <span class="co"># 2. Left join based on stringdist using city and city_actual cols</span></span>
<span id="cb59-9"><a href="#cb59-9"></a>  <span class="fu">stringdist_left_join</span>(cities, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"city"</span> <span class="ot">=</span> <span class="st">"city_actual"</span>), <span class="at">method =</span> <span class="st">"dl"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-10"><a href="#cb59-10"></a>  <span class="co"># 3. Select the name, city, and city_actual cols</span></span>
<span id="cb59-11"><a href="#cb59-11"></a>  <span class="fu">select</span>(name, city, city_actual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fabulous fixing! Now that you’ve created consistent spelling for each city, it will be much easier to compute summary statistics by city.</p>
</section>
<section id="generating-and-comparing-pairs" class="level2">
<h2 class="anchored" data-anchor-id="generating-and-comparing-pairs">Generating and comparing pairs</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Generating and comparing pairs</strong></p>
<p>Now that we know how to compare strings to each other, let’s talk about record linkage.</p>
<p><strong>2. When joins won’t work</strong></p>
<p>Here, we have two tables showing basketball game schedules from different television networks. If we want to get a full list of the basketball games being televised, we need to combine these two tables.</p>
<p><strong>3. When joins won’t work</strong></p>
<p>However, some of the games in the second table are duplicates of games already listed in the first table. Since there’s no consistent identifier between the two tables, a regular join won’t work. This is where record linkage comes in.</p>
<p><strong>4. What is record linkage?</strong></p>
<p>Record linkage involves linking data together that comes from multiple sources that don’t share a common identifier, but contain data on the same entity.</p>
<p><strong>5. What is record linkage?</strong></p>
<p>Generally, we start by cleaning the different datasets.</p>
<p><strong>6. What is record linkage?</strong></p>
<p>Then, we find pairs of records, or rows, that we want to compare.</p>
<p><strong>7. What is record linkage?</strong></p>
<p>We compare those records to each other,</p>
<p><strong>8. What is record linkage?</strong></p>
<p>and score them based on how similar they are.</p>
<p><strong>9. What is record linkage?</strong></p>
<p>Finally, we link the most similar pairs together.Our string comparison skills will come in handy for the third step, which is comparing the pairs.</p>
<p><strong>10. What is record linkage?</strong></p>
<p>But before we can do this, we need to generate pairs.</p>
<p><strong>11. Pairs of records</strong></p>
<p>Here, we have two data frames, A and B, and we want to use record linkage to identify if any of the records in Table A are referring to the same person as any records in Table B.</p>
<p><strong>12. Generating pairs</strong></p>
<p>In order to figure out whether any of the rows are matches, we’ll need to compare every single row in table A with every single row in table B.</p>
<p><strong>13. Generating pairs in R</strong></p>
<p>To generate pairs of rows in R, we can use the reclin package. The pair_blocking function takes in our two data frames and returns an object that contains every possible pair of records.</p>
<p><strong>14. Too many pairs</strong></p>
<p>But imagine if we had a thousand rows in each table. That means we’d have a million possible pairs of records, so this approach isn’t scalable.</p>
<p><strong>15. Blocking</strong></p>
<p>To solve this problem, what if we only choose pairs that have a matching state? This drastically reduces the number of possible pairs - now we only have 8 instead of 25.This technique is called blocking: we only consider pairs when they agree on the blocking variable. In this case, the blocking variable is state.</p>
<p><strong>16. Pair blocking in R</strong></p>
<p>To use blocking, we can use the same pair_blocking function, but this time use the blocking_var argument, which takes in a column name as a string. Just as we expected, we get 8 pairs instead of 25.</p>
<p><strong>17. Comparing pairs</strong></p>
<p>Now that we have our pairs, we’ll need to compare them to see which pairs are the most similar.</p>
<p><strong>18. Comparing pairs</strong></p>
<p>We can do this by piping the output of pair_blocking to the compare_pairs function. We use the by argument to indicate that the name column of each data frame should be compared, and the default_comparator argument to indicate how strings should be compared. Here, we’re using the longest common subsequence method. Notice that there’s a set of parentheses after lcs since we’re calling a function.The output shows a table with each pair and the corresponding score between the name of each pair.</p>
<p><strong>19. Comparing multiple columns</strong></p>
<p>We can also compare multiple columns of the data frames by passing a vector of columns to the by argument.Now, we get a score for the name column and the zip column.</p>
<p><strong>20. Different comparators</strong></p>
<p>We can also use different methods to compare strings, such as Jaccard or Jaro-Winkler.</p>
<p><strong>21. Let’s practice!</strong></p>
<p>It’s time to compare and generate some pairs!</p>
</section>
<section id="reclin-linking-records-with-pair-blocking" class="level2">
<h2 class="anchored" data-anchor-id="reclin-linking-records-with-pair-blocking">reclin: Linking records with Pair Blocking</h2>
<section id="pair-blocking" class="level3">
<h3 class="anchored" data-anchor-id="pair-blocking">Pair Blocking</h3>
<hr>
<p><strong>Record Linkage</strong></p>
<p><img src="readme_files/record_linkage.png" class="img-fluid" style="width:50.0%"></p>
<p><strong>Too many pairs</strong></p>
<p><img src="readme_files/pairs_all.png" class="img-fluid" style="width:50.0%"></p>
<p><strong>Blocking</strong></p>
<p><img src="readme_files/pairs_blocked.png" class="img-fluid" style="width:50.0%"></p>
<hr>
<p>Zagat and Fodor’s are both companies that gather restaurant reviews. The <code>zagat</code> and <code>fodors</code> datasets both contain information about various restaurants, including addresses, phone numbers, and cuisine types. Some restaurants appear in both datasets, but don’t necessarily have the same exact name or phone number written down. In this section, you’ll work towards figuring out which restaurants appear in both datasets.</p>
<p>The first step towards this goal is to generate pairs of records so that you can compare them. You’ll first generate all possible pairs, and then use your newly-cleaned <code>city</code> column as a blocking variable.</p>
<p><strong>Packages</strong></p>
<ul>
<li><code><a href="https://github.com/djvanderlaan/reclin">reclin</a></code></li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Generate all possible pairs of records between the <code>zagat</code> and <code>fodors</code> datasets (no blocking used).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>zagat  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/zagat.rds"</span>)</span>
<span id="cb60-2"><a href="#cb60-2"></a>fodors <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/fodors.rds"</span>)</span>
<span id="cb60-3"><a href="#cb60-3"></a></span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="co"># Load reclin</span></span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="fu">library</span>(reclin)</span>
<span id="cb60-6"><a href="#cb60-6"></a></span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="co"># 1. Generate all possible pairs</span></span>
<span id="cb60-8"><a href="#cb60-8"></a><span class="fu">pair_blocking</span>(zagat, fodors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use pair blocking to generate only pairs that have matching values in the <code>city</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># 2. Generate pairs with same city</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">pair_blocking</span>(zagat, fodors, <span class="at">blocking_var =</span> <span class="st">"city"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect pairings! By using <code>city</code> as a blocking variable, you were able to reduce the number of pairs you’ll need to compare from 165,230 pairs to 40,532.</p>
</section>
<section id="comparing-pairs" class="level3">
<h3 class="anchored" data-anchor-id="comparing-pairs">Comparing pairs</h3>
<p>Now that you’ve generated the pairs of restaurants, it’s time to compare them. You can easily customize how you perform your comparisons using the <code>by</code> and <code>default_comparator</code> arguments. There’s no right answer as to what each should be set to, so in this exercise, you’ll try a couple options out.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Compare pairs by <code>name</code> using <code>lcs()</code> distance.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Generate pairs</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="fu">pair_blocking</span>(zagat, fodors, <span class="at">blocking_var =</span> <span class="st">"city"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3"></a>  <span class="co"># 1. Compare pairs by name using lcs()</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>  <span class="fu">compare_pairs</span>(<span class="at">by =</span> <span class="st">"name"</span>,</span>
<span id="cb62-5"><a href="#cb62-5"></a>      <span class="at">default_comparator =</span> <span class="fu">lcs</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Compare pairs by <code>name</code>, <code>phone</code>, and <code>addr</code> using <code>jaro_winkler()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Generate pairs</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="fu">pair_blocking</span>(zagat, fodors, <span class="at">blocking_var =</span> <span class="st">"city"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3"></a>  <span class="co"># 2. Compare pairs by name, phone, addr</span></span>
<span id="cb63-4"><a href="#cb63-4"></a>  <span class="fu">compare_pairs</span>(<span class="at">by =</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"phone"</span>, <span class="st">"addr"</span>),</span>
<span id="cb63-5"><a href="#cb63-5"></a>      <span class="at">default_comparator =</span> <span class="fu">jaro_winkler</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Crafty comparisons! Choosing a comparator and the columns to compare is highly dataset-dependent, so it’s best to try out different combinations to see which works best on the dataset you’re working with. Next, you’ll build on your string comparison skills and learn about record linkage!</p>
</section>
</section>
<section id="scoring-and-linking" class="level2">
<h2 class="anchored" data-anchor-id="scoring-and-linking">Scoring and linking</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Scoring and linking</strong></p>
<p>Now that we’ve compared our pairs, it’s time to score them and link the data together.</p>
<p><strong>2. Last lesson</strong></p>
<p>In the last lesson, we worked with these two data frames</p>
<p><strong>3. Where we left off</strong></p>
<p>and learned how to create and compare pairs of records. Remember that the x and y columns contain the row numbers of each pair. However, all of the comparison results are separated by column, so we’ll need to combine them.</p>
<p><strong>4. Scoring pairs</strong></p>
<p>That’s where scoring comes in.</p>
<p><strong>5. Scoring with sums</strong></p>
<p>One way that we could combine the separate scores is by adding them together.</p>
<p><strong>6. Summing</strong></p>
<p>We can do this using score_simsum, which will create a new column called simsum that holds the total score for each row.</p>
<p><strong>7. Summing</strong></p>
<p>We can see that the highest score is between row 2 in df_A and row 3 in df_B, which both referred to someone named Keaton Snyder.</p>
<p><strong>8. Disadvantages of summing</strong></p>
<p>However, summing doesn’t account for the fact that having a very similar name is a stronger indicator that the records refer to the same person, while having the same sex doesn’t tell us as much.Instead of summing, we can use a probabilistic way of scoring that accounts for these differences between variables.</p>
<p><strong>9. Scoring probabilistically</strong></p>
<p>We can use the score_problink function, which gives us a weight for each row. The higher the weight, the more similar the pair is.The highest weight is again between Keaton Z Snyder and Keaton Snyder.</p>
<p><strong>10. Linking pairs</strong></p>
<p>Now that we’ve scored each pair, how do we pick which ones are matches?</p>
<p><strong>11. Selecting matches</strong></p>
<p>We can select the pairs that we consider matches using select_n_to_m. This will select the matches with the highest scores, ensuring that any record in one data frame is only linked to one record in the other data frame at most.Here, the only pair considered a match is row 2 of df_A and row 3 of df_B.</p>
<p><strong>12. Linking the data</strong></p>
<p>Now that we’ve selected which pairs are matches, we can finally link the two data frames together using the link function.</p>
<p><strong>13. Linked data</strong></p>
<p>The left side holds the data from df_A, and the right side holds the data from df_B. The first row has data for both sides, since that’s the match we found, while the rest of the people were found only in one of the two data frames.</p>
<p><strong>14. Let’s practice!</strong></p>
<p>Now that you’ve learned how to link data, let’s practice!</p>
<section id="score-then-select-or-select-then-score" class="level3">
<h3 class="anchored" data-anchor-id="score-then-select-or-select-then-score">Score then select or select then score?</h3>
<p>Record linkage requires a number of steps that can be difficult to keep straight. In this section, you’ll solidify your knowledge of the record linkage process so that it’s a breeze when you code it yourself!</p>
<p>Steps of the record linkage process:</p>
<ol type="1">
<li>Clean the datasets.</li>
<li>Generate pairs of records.</li>
<li>Compare separate columns of each pair.</li>
<li>Score pairs using summing or probability.</li>
<li>Select pairs that are matches based on their score.</li>
<li>Link the datasets together.</li>
</ol>
</section>
<section id="putting-it-together" class="level3">
<h3 class="anchored" data-anchor-id="putting-it-together">Putting it together</h3>
<p>Above, you’ve cleaned up the <code>city</code> column of <code>zagat</code> using string similarity, as well as generated and compared pairs of restaurants from <code>zagat</code> and <code>fodors</code>. The end is near - all that’s left to do is score and select pairs and link the data together, and you’ll be able to begin your analysis in no time!</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Score the pairs of records probabilistically.</li>
<li>Select the pairs that are considered matches.</li>
<li>Link the two data frames together.</li>
</ol>
<p>Note: comparing pairs by just one column only works with <code>reclin</code> 0.1.1. Current version is 0.1.2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Create pairs</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="fu">pair_blocking</span>(zagat, fodors, <span class="at">blocking_var =</span> <span class="st">"city"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3"></a>  <span class="co"># Compare pairs</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>  <span class="fu">compare_pairs</span>(<span class="at">by =</span> <span class="st">"name"</span>, <span class="at">default_comparator =</span> <span class="fu">jaro_winkler</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5"></a>  <span class="co"># 1. Score pairs</span></span>
<span id="cb64-6"><a href="#cb64-6"></a>  <span class="fu">score_problink</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-7"><a href="#cb64-7"></a>  <span class="co"># 2. Select pairs</span></span>
<span id="cb64-8"><a href="#cb64-8"></a>  <span class="fu">select_n_to_m</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9"></a>  <span class="co"># 3. Link data </span></span>
<span id="cb64-10"><a href="#cb64-10"></a>  <span class="fu">link</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="#cb64-11"></a>  <span class="co"># Convert to tibble</span></span>
<span id="cb64-12"><a href="#cb64-12"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-13"><a href="#cb64-13"></a>  <span class="fu">select</span>(id.x, name.x, city.x, id.y, name.y, city.y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lovely linking! Now that your two datasets are merged, you can use the data to figure out if there are certain characteristics that make a restaurant more likely to be reviewed by Zagat or Fodor’s.</p>
</section>
</section>
<section id="congratulations" class="level2">
<h2 class="anchored" data-anchor-id="congratulations">Congratulations!</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Congratulations!</strong></p>
<p>Congrats on finishing the course! You’re now equipped with data cleaning skills.</p>
<p><strong>2. What you learned</strong></p>
<p>In this course, you learned how to diagnose dirty data, what the side effects of dirty data are and how they can impact an analysis, and how to clean data to prevent these side effects.</p>
<p><strong>3. Chapter 1: Common Data Problems</strong></p>
<p>In chapter 1, you learned about type constraints, range constraints and uniqueness constraints.</p>
<p><strong>4. Chapter 2: Text and Categorical Data</strong></p>
<p>In chapter 2, you learned about problems specific to text and categorical data, including membership constraints, cleaning categorical variables, and cleaning text data.</p>
<p><strong>5. Chapter 3: Advanced Data Problems</strong></p>
<p>In chapter 3, you looked at more advanced data problems, like unifying inconsistently formatted data, cross field validation, and dealing with missing data.</p>
<p><strong>6. Chapter 4: Record Linkage</strong></p>
<p>In chapter 4, you learned how to use record linkage to link datasets when traditional joins can’t be used.</p>
<p><strong>7. Expand and build upon your new skills</strong></p>
<p>There is still much more to learn to become a data cleaning expert! Check out these courses where you can learn more about working with categorical data, manipulating text data, and writing clean R code to prevent dirty data in the first place.</p>
<p><strong>8. Congratulations!</strong></p>
<p>Don’t forget to apply the valuable skills you’ve learned to your own data tasks. Congratulations, and have fun learning!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2022 by <a href="https://www.startupengineer.io/authors/schwarz/">Joschka Schwarz</a> <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/jwarz/jwarz.github.io">View the source at GitHub</a></div>
  </div>
</footer>



<script src="../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>