<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joschka Schwarz">

<title>Joschka Schwarz - Case Study: Exploratory Data Analysis in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" rel="next">
<link href="../../../../../content/R/topics/03_data_wrangling/exploratory_data_analysis_in_r/exploratory_data_analysis_in_r.html" rel="prev">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Joschka Schwarz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-science" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Science</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-science">    
        <li>
    <a class="dropdown-item" href="../../../../../content/R/index.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/python/index.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/sql/index.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../../slides/index.html">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../resumes/index.html">
 <span class="menu-text">Resumes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jwarz/"><i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/j-schwarz"><i class="bi bi-linkedin" role="img" aria-label="Quarto LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Case Study: Exploratory Data Analysis in R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Topics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <b><i>Programming Basics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/01_programming_beginner/01_programming_beginner.html" class="sidebar-item-text sidebar-link">1: Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/02_programming_intermediate/02_programming_intermediate.html" class="sidebar-item-text sidebar-link">2: Intermediate R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/03_programming_tidyverse/03_programming_tidyverse.html" class="sidebar-item-text sidebar-link">3: Introduction to the tidyverse</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Importing Data</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/01_importing_data_beginner/01_importing_data_beginner.html" class="sidebar-item-text sidebar-link">4: Introduction to Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/02_importing_data_intermediate/02_importing_data_intermediate.html" class="sidebar-item-text sidebar-link">5: Intermediate Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/03_working_with_web_data/03_working_with_web_data.html" class="sidebar-item-text sidebar-link">6: Working with web data</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Data Wrangling</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/exploratory_data_analysis_in_r/exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">7: Exploratory Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/case_study_exploratory_data_analysis_in_r/case_study_exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link active">8: Case Study: EDA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" class="sidebar-item-text sidebar-link">9: Cleaning Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/data_manipulation_with_datatable/data_manipulation_with_datatable.html" class="sidebar-item-text sidebar-link">10: Data Manipulation with data.table</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/joining_data_with_datatable/joining_data_with_datatable.html" class="sidebar-item-text sidebar-link">11: Joining Data with data.table</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Data Visualization</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/data_visualization_with_ggplot2_intermediate/ggplot2_intermediate.html" class="sidebar-item-text sidebar-link">2: Intermediate Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/03-content.html" class="sidebar-item-text sidebar-link">3: R Installation and Administration</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">R Manuals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/test.html" class="sidebar-item-text sidebar-link">1: An Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/02-content.html" class="sidebar-item-text sidebar-link">2: R Data Import/Export</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/03-content.html" class="sidebar-item-text sidebar-link">3: R Installation and Administration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/04-content.html" class="sidebar-item-text sidebar-link">4: Writing R Extensions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/05-content.html" class="sidebar-item-text sidebar-link">5: R Language Definition</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/06-content.html" class="sidebar-item-text sidebar-link">6: R Internals</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#data-cleaning-and-summarizing-with-dplyr" id="toc-data-cleaning-and-summarizing-with-dplyr" class="nav-link active" data-scroll-target="#data-cleaning-and-summarizing-with-dplyr">1. Data cleaning and summarizing with dplyr</a>
  <ul class="collapse">
  <li><a href="#the-united-nations-voting-dataset" id="toc-the-united-nations-voting-dataset" class="nav-link" data-scroll-target="#the-united-nations-voting-dataset">The United Nations Voting Dataset</a></li>
  <li><a href="#filtering-rows" id="toc-filtering-rows" class="nav-link" data-scroll-target="#filtering-rows">Filtering rows</a></li>
  <li><a href="#adding-a-year-column" id="toc-adding-a-year-column" class="nav-link" data-scroll-target="#adding-a-year-column">Adding a year column</a></li>
  <li><a href="#adding-a-country-column" id="toc-adding-a-country-column" class="nav-link" data-scroll-target="#adding-a-country-column">Adding a country column</a></li>
  <li><a href="#grouping-and-summarizing" id="toc-grouping-and-summarizing" class="nav-link" data-scroll-target="#grouping-and-summarizing">Grouping and summarizing</a></li>
  <li><a href="#summarizing-the-full-dataset" id="toc-summarizing-the-full-dataset" class="nav-link" data-scroll-target="#summarizing-the-full-dataset">Summarizing the full dataset</a></li>
  <li><a href="#summarizing-by-year" id="toc-summarizing-by-year" class="nav-link" data-scroll-target="#summarizing-by-year">Summarizing by year</a></li>
  <li><a href="#summarizing-by-country" id="toc-summarizing-by-country" class="nav-link" data-scroll-target="#summarizing-by-country">Summarizing by country</a></li>
  <li><a href="#sorting-and-filtering-summarized-data" id="toc-sorting-and-filtering-summarized-data" class="nav-link" data-scroll-target="#sorting-and-filtering-summarized-data">Sorting and filtering summarized data</a></li>
  <li><a href="#sorting-by-percentage-of-yes-votes" id="toc-sorting-by-percentage-of-yes-votes" class="nav-link" data-scroll-target="#sorting-by-percentage-of-yes-votes">Sorting by percentage of “yes” votes</a></li>
  <li><a href="#filtering-summarized-output" id="toc-filtering-summarized-output" class="nav-link" data-scroll-target="#filtering-summarized-output">Filtering summarized output</a></li>
  </ul></li>
  <li><a href="#data-visualization-with-ggplot2" id="toc-data-visualization-with-ggplot2" class="nav-link" data-scroll-target="#data-visualization-with-ggplot2">2. Data visualization with ggplot2</a>
  <ul class="collapse">
  <li><a href="#visualization-with-ggplot2" id="toc-visualization-with-ggplot2" class="nav-link" data-scroll-target="#visualization-with-ggplot2">Visualization with ggplot2</a></li>
  <li><a href="#choosing-an-aesthetic" id="toc-choosing-an-aesthetic" class="nav-link" data-scroll-target="#choosing-an-aesthetic">Choosing an aesthetic</a></li>
  <li><a href="#plotting-a-line-over-time" id="toc-plotting-a-line-over-time" class="nav-link" data-scroll-target="#plotting-a-line-over-time">Plotting a line over time</a></li>
  <li><a href="#other-ggplot2-layers" id="toc-other-ggplot2-layers" class="nav-link" data-scroll-target="#other-ggplot2-layers">Other ggplot2 layers</a></li>
  <li><a href="#visualizing-by-country" id="toc-visualizing-by-country" class="nav-link" data-scroll-target="#visualizing-by-country">Visualizing by country</a></li>
  <li><a href="#summarizing-by-year-and-country" id="toc-summarizing-by-year-and-country" class="nav-link" data-scroll-target="#summarizing-by-year-and-country">Summarizing by year and country</a></li>
  <li><a href="#plotting-just-the-uk-over-time" id="toc-plotting-just-the-uk-over-time" class="nav-link" data-scroll-target="#plotting-just-the-uk-over-time">Plotting just the UK over time</a></li>
  <li><a href="#plotting-multiple-countries" id="toc-plotting-multiple-countries" class="nav-link" data-scroll-target="#plotting-multiple-countries">Plotting multiple countries</a></li>
  <li><a href="#faceting-by-country" id="toc-faceting-by-country" class="nav-link" data-scroll-target="#faceting-by-country">Faceting by country</a></li>
  <li><a href="#faceting-the-time-series" id="toc-faceting-the-time-series" class="nav-link" data-scroll-target="#faceting-the-time-series">Faceting the time series</a></li>
  <li><a href="#faceting-with-free-y-axis" id="toc-faceting-with-free-y-axis" class="nav-link" data-scroll-target="#faceting-with-free-y-axis">Faceting with free y-axis</a></li>
  <li><a href="#choose-your-own-countries" id="toc-choose-your-own-countries" class="nav-link" data-scroll-target="#choose-your-own-countries">Choose your own countries</a></li>
  </ul></li>
  <li><a href="#tidy-modeling-with-broom" id="toc-tidy-modeling-with-broom" class="nav-link" data-scroll-target="#tidy-modeling-with-broom">3. Tidy modeling with broom</a>
  <ul class="collapse">
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear regression</a></li>
  <li><a href="#linear-regression-on-the-united-states" id="toc-linear-regression-on-the-united-states" class="nav-link" data-scroll-target="#linear-regression-on-the-united-states">Linear regression on the United States</a></li>
  <li><a href="#finding-the-slope-of-a-linear-regression" id="toc-finding-the-slope-of-a-linear-regression" class="nav-link" data-scroll-target="#finding-the-slope-of-a-linear-regression">Finding the slope of a linear regression</a></li>
  <li><a href="#finding-the-p-value-of-a-linear-regression" id="toc-finding-the-p-value-of-a-linear-regression" class="nav-link" data-scroll-target="#finding-the-p-value-of-a-linear-regression">Finding the p-value of a linear regression</a></li>
  <li><a href="#tidying-models-with-broom" id="toc-tidying-models-with-broom" class="nav-link" data-scroll-target="#tidying-models-with-broom">Tidying models with broom</a></li>
  <li><a href="#tidying-a-linear-regression-model" id="toc-tidying-a-linear-regression-model" class="nav-link" data-scroll-target="#tidying-a-linear-regression-model">Tidying a linear regression model</a></li>
  <li><a href="#combining-models-for-multiple-countries" id="toc-combining-models-for-multiple-countries" class="nav-link" data-scroll-target="#combining-models-for-multiple-countries">Combining models for multiple countries</a></li>
  <li><a href="#nesting-for-multiple-models" id="toc-nesting-for-multiple-models" class="nav-link" data-scroll-target="#nesting-for-multiple-models">Nesting for multiple models</a></li>
  <li><a href="#nesting-a-data-frame" id="toc-nesting-a-data-frame" class="nav-link" data-scroll-target="#nesting-a-data-frame">Nesting a data frame</a></li>
  <li><a href="#list-columns" id="toc-list-columns" class="nav-link" data-scroll-target="#list-columns">List columns</a></li>
  <li><a href="#unnesting" id="toc-unnesting" class="nav-link" data-scroll-target="#unnesting">Unnesting</a></li>
  <li><a href="#fitting-multiple-models" id="toc-fitting-multiple-models" class="nav-link" data-scroll-target="#fitting-multiple-models">Fitting multiple models</a></li>
  <li><a href="#performing-linear-regression-on-each-nested-dataset" id="toc-performing-linear-regression-on-each-nested-dataset" class="nav-link" data-scroll-target="#performing-linear-regression-on-each-nested-dataset">Performing linear regression on each nested dataset</a></li>
  <li><a href="#tidy-each-linear-regression-model" id="toc-tidy-each-linear-regression-model" class="nav-link" data-scroll-target="#tidy-each-linear-regression-model">Tidy each linear regression model</a></li>
  <li><a href="#unnesting-a-data-frame" id="toc-unnesting-a-data-frame" class="nav-link" data-scroll-target="#unnesting-a-data-frame">Unnesting a data frame</a></li>
  <li><a href="#working-with-many-tidy-models" id="toc-working-with-many-tidy-models" class="nav-link" data-scroll-target="#working-with-many-tidy-models">Working with many tidy models</a></li>
  <li><a href="#filtering-model-terms" id="toc-filtering-model-terms" class="nav-link" data-scroll-target="#filtering-model-terms">Filtering model terms</a></li>
  <li><a href="#filtering-for-significant-countries" id="toc-filtering-for-significant-countries" class="nav-link" data-scroll-target="#filtering-for-significant-countries">Filtering for significant countries</a></li>
  <li><a href="#sorting-by-slope" id="toc-sorting-by-slope" class="nav-link" data-scroll-target="#sorting-by-slope">Sorting by slope</a></li>
  </ul></li>
  <li><a href="#joining-and-tidying" id="toc-joining-and-tidying" class="nav-link" data-scroll-target="#joining-and-tidying">4. Joining and tidying</a>
  <ul class="collapse">
  <li><a href="#joining-datasets" id="toc-joining-datasets" class="nav-link" data-scroll-target="#joining-datasets">Joining datasets</a></li>
  <li><a href="#joining-datasets-with-inner_join" id="toc-joining-datasets-with-inner_join" class="nav-link" data-scroll-target="#joining-datasets-with-inner_join">Joining datasets with inner_join</a></li>
  <li><a href="#filtering-the-joined-dataset" id="toc-filtering-the-joined-dataset" class="nav-link" data-scroll-target="#filtering-the-joined-dataset">Filtering the joined dataset</a></li>
  <li><a href="#visualizing-colonialism-votes" id="toc-visualizing-colonialism-votes" class="nav-link" data-scroll-target="#visualizing-colonialism-votes">Visualizing colonialism votes</a></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy data</a></li>
  <li><a href="#tidy-data-observations" id="toc-tidy-data-observations" class="nav-link" data-scroll-target="#tidy-data-observations">Tidy data observations</a></li>
  <li><a href="#using-gather-to-tidy-a-dataset" id="toc-using-gather-to-tidy-a-dataset" class="nav-link" data-scroll-target="#using-gather-to-tidy-a-dataset">Using gather to tidy a dataset</a></li>
  <li><a href="#recoding-the-topics" id="toc-recoding-the-topics" class="nav-link" data-scroll-target="#recoding-the-topics">Recoding the topics</a></li>
  <li><a href="#summarize-by-country-year-and-topic" id="toc-summarize-by-country-year-and-topic" class="nav-link" data-scroll-target="#summarize-by-country-year-and-topic">Summarize by country, year, and topic</a></li>
  <li><a href="#visualizing-trends-in-topics-for-one-country" id="toc-visualizing-trends-in-topics-for-one-country" class="nav-link" data-scroll-target="#visualizing-trends-in-topics-for-one-country">Visualizing trends in topics for one country</a></li>
  <li><a href="#tidy-modeling-by-topic-and-country" id="toc-tidy-modeling-by-topic-and-country" class="nav-link" data-scroll-target="#tidy-modeling-by-topic-and-country">Tidy modeling by topic and country</a></li>
  <li><a href="#nesting-by-topic-and-country" id="toc-nesting-by-topic-and-country" class="nav-link" data-scroll-target="#nesting-by-topic-and-country">Nesting by topic and country</a></li>
  <li><a href="#interpreting-tidy-models" id="toc-interpreting-tidy-models" class="nav-link" data-scroll-target="#interpreting-tidy-models">Interpreting tidy models</a></li>
  <li><a href="#steepest-trends-by-topic" id="toc-steepest-trends-by-topic" class="nav-link" data-scroll-target="#steepest-trends-by-topic">Steepest trends by topic</a></li>
  <li><a href="#checking-models-visually" id="toc-checking-models-visually" class="nav-link" data-scroll-target="#checking-models-visually">Checking models visually</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jwarz/jwarz.github.io/edit/main/content/R/topics/03_data_wrangling/case_study_exploratory_data_analysis_in_r/case_study_exploratory_data_analysis_in_r.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jwarz/jwarz.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Case Study: Exploratory Data Analysis in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joschka Schwarz </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><strong>Short Description</strong></p>
<p>Use data manipulation and visualization skills to explore the historical voting of the United Nations General Assembly.</p>
<p><strong>Long Description</strong></p>
<p>Once you’ve started learning tools for data manipulation and visualization like dplyr and ggplot2, this course gives you a chance to use them in action on a real dataset. You'll explore the historical voting of the United Nations General Assembly, including analyzing differences in voting between countries, across time, and among international issues. In the process you'll gain more practice with the dplyr and ggplot2 packages, learn about the broom package for tidying model output, and experience the kind of start-to-finish exploratory analysis common in data science.</p>
<section id="data-cleaning-and-summarizing-with-dplyr" class="level1">
<h1>1. Data cleaning and summarizing with dplyr</h1>
<p>The best way to learn data wrangling skills is to apply them to a specific case study. Here you’ll learn how to clean and filter the United Nations voting dataset using the dplyr package, and how to summarize it into smaller, interpretable units.</p>
<section id="the-united-nations-voting-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-united-nations-voting-dataset">The United Nations Voting Dataset</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. The United Nations Voting Dataset</strong></p>
<p>Hi, I’m Dave Robinson and I’ll be your instructor for this course. I’m a data scientist and I really enjoy using R to dive into a dataset and discover interesting things. In this course, we’re going to be using some of my favorite R packages, such as dplyr and ggplot2, to explore and draw conclusions from a real-world dataset. If you’ve used these packages before, this will be a great opportunity to practice using them in an analysis.</p>
<p><strong>2. UN Voting Dataset</strong></p>
<p>Let’s introduce the dataset, which contains the historical voting data from the General Assembly of the United Nations. In the General Assembly every member nation gets a vote, which makes this a great opportunity to explore the history of international relations.In our data analysis vocabulary, rows of a dataset are called “observations” and columns are called “variables”. In this dataset, each observation represents one combination of a roll call vote and a country</p>
<p><strong>3. UN Voting Dataset</strong></p>
<p>The first variable, rcid, is the “roll call ID”.</p>
<p><strong>4. UN Voting Dataset</strong></p>
<p>describing one round of voting, such as to approve a UN resolution. The session variable represents which year-long session in the UN’s history the vote was cast. Note that to keep the dataset at a reasonable size, only sessions from alternating years are included.</p>
<p><strong>5. UN Voting Dataset</strong></p>
<p>The vote column represents that country’s choice.</p>
<p><strong>6. UN Voting Dataset</strong></p>
<p>For example, 1 means a yes vote, and 9 means a country was not a member of the United Nations. The ccode column is a country code</p>
<p><strong>7. UN Voting Dataset</strong></p>
<p>that uniquely specifies the country.</p>
<p><strong>8. Votes in dplyr</strong></p>
<p>To work with this in R, we’d start by loading the dplyr package, which offers tools for manipulating data. Then we can view the votes dataset by simply typing “votes” into the R prompt. Here you can see each of the columns of the table , as well as the table’s size - 508 thousand rows.As with almost any dataset you’ll run into, you’ll need to clean this data before we can start analyzing it. Let’s review one of the most important tools for performing multiple sequential steps on data: the pipe operator.</p>
<p><strong>9. The pipe operator</strong></p>
<p>The pipe, typed as “percent greater than percent”, tells R to pass one object in as the first argument of the next function,</p>
<p><strong>10. The pipe operator</strong></p>
<p>which lets us perform multiple operations in a series. While it may seem complicated if you haven’t used it much before, you’ll quickly get comfortable with it.</p>
<p><strong>11. dplyr verbs</strong></p>
<p>The operations we’ll usually be composing are dplyr’s “verbs”- functions that perform a single, simple action on a dataset. Recall that the “filter” verb subsets observations from a dataset, to remove rows that aren’t interesting to us.</p>
<p><strong>12. dplyr verbs</strong></p>
<p>The “mutate” verb adds a variable or changes an existing variable.Here’s an example of each.</p>
<p><strong>13. Original data</strong></p>
<p>In our original dataset, the vote column has five possible values : 1 for yes, 2 for abstain, 3 for no, 8 meaning the country wasn’t present, and 9 meaning the country was not a member. We only care about the first three values- yes, no and abstain.</p>
<p><strong>14. dplyr verbs: filter</strong></p>
<p>To remove the others, we pipe the dataset into the filter function. Within that filter we describe a condition: vote &lt;= 3. The resulting data frame is smaller - it only kept the observations where our condition was met.</p>
<p><strong>15. dplyr verbs: mutate</strong></p>
<p>You’ll also be using the mutate function. The session variable is hard to interpret, but if you know the first session of the United Nations was held in 1946, you can use it to get the year each vote was cast, which is much more interpretable. To do this you could pipe the data into the “mutate” function, where you can define your new “year” column as 1945 + the session. Notice the new “year” column with the result. In your exercises, you’ll also clean up the country column to include full country names instead of IDs.</p>
<p><strong>16. Chaining operations in data cleaning</strong></p>
<p>The pipe operator lets you chain these simple actions together in a sequence. You’ll get into the habit of piping many small, simple operations together to perform a richer analysis.</p>
<p><strong>17. Let’s practice!</strong></p>
</section>
<section id="filtering-rows" class="level2">
<h2 class="anchored" data-anchor-id="filtering-rows">Filtering rows</h2>
<p>The <code>vote</code> column in the dataset has a number that represents that country’s vote:</p>
<ul>
<li><strong>1</strong> = Yes</li>
<li><strong>2</strong> = Abstain</li>
<li><strong>3</strong> = No</li>
<li><strong>8</strong> = Not present</li>
<li><strong>9</strong> = Not a member</li>
</ul>
<p>One step of data cleaning is removing observations (rows) that you’re not interested in. In this case, you want to remove “Not present” and “Not a member”.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Take a look at the <code>votes</code> table.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load the dplyr package</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># 1. Print the votes dataset</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>votes <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/votes.rds"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>votes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Filter out rows where the vote recorded is “not present” or “not a member”, leaving cases where it is “yes”, “abstain”, or “no”.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># 2. Filter for votes that are "yes", "abstain", or "no"</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>votes <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3"></a> <span class="fu">filter</span>(vote <span class="sc">&lt;=</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-a-year-column" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-year-column">Adding a year column</h2>
<p>The next step of data cleaning is manipulating your variables (columns) to make them more informative.</p>
<p>In this case, you have a <code>session</code> column that is hard to interpret intuitively. But since the UN started voting in 1946, and holds one session per year, you can get the year of a UN resolution by adding 1945 to the <code>session</code> number.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>mutate()</code> to add a <code>year</code> column by adding 1945 to the <code>session</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># 1. Add another %&gt;% step to add a year column</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>votes <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">filter</span>(vote <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> session <span class="sc">+</span> <span class="dv">1945</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-a-country-column" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-country-column">Adding a country column</h2>
<p>The country codes in the <code>ccode</code> column are what’s called <a href="http://cow.dss.ucdavis.edu/data-sets/cow-country-codes" target="_blank" rel="noopener noreferrer">Correlates of War codes</a>. This isn’t ideal for an analysis, since you’d like to work with recognizable country names.</p>
<p>You can use the <code>countrycode</code> package to translate. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># Translate the country code 2</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="fu">countrycode</span>(<span class="dv">2</span>, <span class="st">"cown"</span>, <span class="st">"country.name"</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; [1] "United States"</span></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># Translate multiple country codes</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="fu">countrycode</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">20</span>, <span class="dv">40</span>), <span class="st">"cown"</span>, <span class="st">"country.name"</span>)</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; [1] "United States" "Canada"        "Cuba"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><sup>Created on 2022-02-27 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v2.0.1)</sup></p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the <code>countrycode</code> package.</li>
<li>Add a new <code>country</code> column in your <code>mutate()</code> statement containing country names, using the <code>countrycode()</code> function to translate from the <code>ccode</code> column. Save the result to <code>votes_processed</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># 1. Load the countrycode package</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># 2. Add a country column within the mutate: votes_processed</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>votes_processed <span class="ot">&lt;-</span> votes <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">filter</span>(vote <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> session <span class="sc">+</span> <span class="dv">1945</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>         <span class="at">votes_processed =</span> <span class="fu">countrycode</span>(ccode, <span class="st">"cown"</span>, <span class="st">"country.name"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grouping-and-summarizing" class="level2">
<h2 class="anchored" data-anchor-id="grouping-and-summarizing">Grouping and summarizing</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Grouping and summarizing</strong></p>
<p>In your last exercises you cleaned up the raw data into create a processed set of votes,</p>
<p><strong>2. Processed votes</strong></p>
<p>which looked like this. Now we can start trying to pull real insights out of the data.There are far too many observations in this dataset to extract anything interpretable by looking through it manually, so we’ll need to choose a way to summarize it that’s interesting to us. Here I’ll propose a simple metric we’ll be using a lot in this course:</p>
<p><strong>3. Using “% of Yes votes” as a summary</strong></p>
<p>“percentage of yes votes.” If a country votes yes on most resolutions, we might infer that it tends to agree with the international consensus, while if it votes no we could assume that it tends to go against it.</p>
<p><strong>4. dplyr verb: summarize</strong></p>
<p>To calculate this you’ll use another dplyr verb: summarize. Summarize takes many rows and turns them into one - while calculating overall metrics, such as an average or total.</p>
<p><strong>5. dplyr verbs: summarize</strong></p>
<p>For example, we can pipe the votes_processed data into a summarize operation, telling it to create a new variable called total. n is a special function within a summarize that means “the number of rows.” The result is a one-row data frame telling us the total number of rows - 353 thousand.</p>
<p><strong>6. dplyr verbs: summarize</strong></p>
<p>We can add another variable to this summary with our “percentage yes” variable. Since 1 is “yes” in our dataset, we want the percentage of the rows where the vote variable is equal to 1. The way to calculate this in R is “mean vote equals equals 1”. (If you’d like to know why, this is because it first compares each vote to 1 to get true or false, then treats true cases as “ones” and falses as “zeroes”.). By calculating this, we see that about 79-point-9 percent of United Nations votes in history were “yes” votes.This overall summary isn’t much information. We may want to know whether this percentage has changed over time.</p>
<p><strong>7. dplyr verb: group_by</strong></p>
<p>So we introduce another verb- group_by. When done before a summarize operation, this tells the summarize to create one row for each sub-group, instead of one row overall.</p>
<p><strong>8. dplyr verbs: group_by</strong></p>
<p>For example, here we perform the same summary, but first group by year before summarizing. Now instead of getting one row overall, we get one row for each year: we see that 56-point-9% of votes in 1947 were yes, but only 43-point-8% in 1949. In later lessons you’ll use this to visualize the trend in the percentage over time.Summarizing by subgroups is a powerful way to turn large datasets into smaller ones that you can interpret. In your exercises, you’ll try grouping by country instead of year, which shows you which countries are more prone to voting “yes” or “no”.</p>
</section>
<section id="summarizing-the-full-dataset" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-the-full-dataset">Summarizing the full dataset</h2>
<p>In this analysis, you’re going to focus on “% of votes that are yes” as a metric for the “agreeableness” of countries.</p>
<p>You’ll start by finding this summary for the entire dataset: the fraction of all votes in their history that were “yes”. Note that within your call to <code>summarize()</code>, you can use <code>n()</code> to find the total number of votes and <code>mean(vote == 1)</code> to find the fraction of “yes” votes.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the <code>votes_processed</code> dataset that you created in the previous exercise.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># 1. Print votes_processed</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>votes_processed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li><p>Summarize the dataset using the <code>summarize()</code> function to create two columns:</p>
<ul>
<li><code>total</code>: with the number of votes</li>
<li><code>percent_yes</code>: the percentage of “yes” votes</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># 2. Find total and fraction of "yes" votes</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>votes_processed <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb7-4"><a href="#cb7-4"></a>              <span class="at">percent_yes =</span> <span class="fu">mean</span>(vote <span class="sc">==</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarizing-by-year" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-by-year">Summarizing by year</h2>
<p>The <code>summarize()</code> function is especially useful because it can be used within <em>groups</em>.</p>
<p>For example, you might like to know how much the average “agreeableness” of countries changed from year to year. To examine this, you can use <code>group_by()</code> to perform your summary not for the entire dataset, but within each year.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a <code>group_by()</code> to your code to <code>summarize()</code> within each year.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># 1. Change this code to summarize by year</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>votes_processed <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb8-5"><a href="#cb8-5"></a>            <span class="at">percent_yes =</span> <span class="fu">mean</span>(vote <span class="sc">==</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarizing-by-country" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-by-country">Summarizing by country</h2>
<p>In the last exercise, you performed a summary of the votes within each year. You could instead <code>summarize()</code> within each country, which would let you compare voting patterns between countries.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Change the code in the editor to <code>summarize()</code> within each country rather than within each year. Save the result as <code>by_country</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># 1. Summarize by country: by_country</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>by_country <span class="ot">&lt;-</span> votes_processed <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">group_by</span>(<span class="at">country =</span> votes_processed) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb9-5"><a href="#cb9-5"></a>            <span class="at">percent_yes =</span> <span class="fu">mean</span>(vote <span class="sc">==</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sorting-and-filtering-summarized-data" class="level2">
<h2 class="anchored" data-anchor-id="sorting-and-filtering-summarized-data">Sorting and filtering summarized data</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Sorting and filtering summarized data</strong></p>
<p>In your last exercise,</p>
<p><strong>2. by_country dataset</strong></p>
<p>you created a dataset called by_country, containing one row for each country with the total number of votes and the percentage of votes that were yes. Now you might be interested in knowing which country voted yes the most or least often.</p>
<p><strong>3. dplyr verb: arrange()</strong></p>
<p>To discover this we’ll introduce one more dplyr verb: arrange. Arrange sorts a dataset based on one of its variables, in either ascending or descending order. This is useful for pulling a few interesting conclusions out of your data.</p>
<p><strong>4. arrange()</strong></p>
<p>Here, we could pipe by_country to the arrange operation, telling it to sort by the percent_yes column. We’d see that Zanzibar is the country that voted yes the least often in our dataset, followed by the United States. But we might also notice that Zanzibar only had two votes in our entire dataset, which means that 0% is basically meaningless! This is a very common way that summarized data can trip you up, and why you have to be careful about interpreting your results too quickly.To fix this, in your exercises you’ll have to filter the dataset to remove countries with a low total, just like you earlier used filter to remove vote rows we didn’t care about.</p>
<p><strong>5. Transforming tidy data</strong></p>
<p>Notice therefore that filter isn’t just useful for cleaning your raw data, but also for manipulating your summarized data. It’s therefore important to get comfortable using each of these dplyr verbs at all the stages of an analysis.</p>
<p><strong>6. Let’s practice!</strong></p>
</section>
<section id="sorting-by-percentage-of-yes-votes" class="level2">
<h2 class="anchored" data-anchor-id="sorting-by-percentage-of-yes-votes">Sorting by percentage of “yes” votes</h2>
<p>Now that you’ve summarized the dataset by country, you can start examining it and answering interesting questions.</p>
<p>For example, you might be especially interested in the countries that voted “yes” least often, or the ones that voted “yes” most often.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the <code>by_country</code> dataset created in the last step.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># 1. Print the by_country dataset</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>by_country</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use <code>arrange()</code> to sort the countries in ascending order of <code>percent_yes</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># 2. Sort in ascending order of percent_yes</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>by_country <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">arrange</span>(percent_yes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Arrange the countries by the same variable, but in descending order.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># 3. Now sort in descending order</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>by_country <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>percent_yes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-summarized-output" class="level2">
<h2 class="anchored" data-anchor-id="filtering-summarized-output">Filtering summarized output</h2>
<p>In the last exercise, you may have noticed that the country that voted least frequently, Zanzibar, had only 2 votes in the entire dataset. You certainly can’t make any substantial conclusions based on that data!</p>
<p>Typically in a progressive analysis, when you find that a few of your observations have very little data while others have plenty, you set some threshold to filter them out.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>filter()</code> to remove from the sorted data countries that have fewer than 100 votes.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># 1. Filter out countries with fewer than 100 votes</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>by_country <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">arrange</span>(percent_yes) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">filter</span>(total <span class="sc">&gt;=</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-visualization-with-ggplot2" class="level1">
<h1>2. Data visualization with ggplot2</h1>
<p>Once you’ve cleaned and summarized data, you’ll want to visualize them to understand trends and extract insights. Here you’ll use the ggplot2 package to explore trends in United Nations voting within each country over time.</p>
<section id="visualization-with-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="visualization-with-ggplot2">Visualization with ggplot2</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Visualization with ggplot2</strong></p>
<p>In the last chapter,</p>
<p><strong>2. By-year data</strong></p>
<p>you created a dataset showing the percentage of yes votes in each year. While this isn’t a “large” dataset by typical standards, it’s still difficult to read through it and get a sense of a trend over time, or to communicate that trend to others. Instead, you want to visualize the data, into a line plot like this</p>
<p><strong>3. Visualizing by-year data</strong></p>
<ul>
<li>which makes it easy to see the change over time. Data visualization thus makes up the next part of our exploratory data analysis.</li>
</ul>
<p><strong>4. Visualizing by-year data</strong></p>
<p>We’ll use the ggplot2 package, which uses the ggplot function to construct a graph. A call to ggplot has three parts. First is the data frame, which we’ve already constructed as by_country.Second is the mapping of variables in that data frame, such as year and percent yes, to the visual dimensions of the plot like the x and y axes, which we call “aesthetics”. This is done in an “aes” call, where we chose to put year on the x axis and percent_yes on the y-axis.The third part of a ggplot call is to add layers onto the plot. Here we add geom_line - where geom_ means we’re choosing which geometric objects to add to the plot. In your exercises you’ll try changing the layer you add, such as creating a scatter plot with points rather than a line plot.</p>
</section>
<section id="choosing-an-aesthetic" class="level2">
<h2 class="anchored" data-anchor-id="choosing-an-aesthetic">Choosing an aesthetic</h2>
<p>You’re going to create a line graph to show the trend over time of how many votes are “yes”.</p>
<blockquote class="blockquote">
<h2 id="question" class="anchored"><em>Question</em></h2>
<p>Which of the following aesthetics should you map the <code>year</code> variable to?<br> <br> ⬜ Color<br> ⬜ Width<br> ✅ X-axis<br> ⬜ Y-axis<br></p>
</blockquote>
<p>Right! To plot a line graph to show the trend over time, the year variable should be on the x-axis.</p>
</section>
<section id="plotting-a-line-over-time" class="level2">
<h2 class="anchored" data-anchor-id="plotting-a-line-over-time">Plotting a line over time</h2>
<p>In the last section, you learned how to <code>summarize()</code> the votes dataset by year, particularly the percentage of votes in each year that were “yes”.</p>
<p>You’ll now use the <code>ggplot2</code> package to turn your results into a visualization of the percentage of “yes” votes over time.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>The <code>by_year</code> dataset has the number of votes and percentage of “yes” votes each year.</p>
<ul>
<li>Load the <code>ggplot2</code> package.</li>
<li>Use <code>ggplot()</code> with the <code>geom_line</code> layer to create a line plot with <code>year</code> on the x-axis and <code>percent_yes</code> on the y-axis.</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># 1. Define by_year</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>by_year <span class="ot">&lt;-</span> votes_processed <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb14-5"><a href="#cb14-5"></a>            <span class="at">percent_yes =</span> <span class="fu">mean</span>(vote <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># 2. Load the ggplot2 package</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb14-9"><a href="#cb14-9"></a></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co"># 3. Create line plot</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="fu">ggplot</span>(by_year, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> percent_yes)) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="other-ggplot2-layers" class="level2">
<h2 class="anchored" data-anchor-id="other-ggplot2-layers">Other ggplot2 layers</h2>
<p>A line plot is one way to display this data. You could also choose to display it as a scatter plot, with each year represented as a single point. This requires changing the <em>layer</em> (i.e.&nbsp;<code>geom_line()</code> to <code>geom_point()</code>).</p>
<p>You can also add additional layers to your graph, such as a smoothing curve with <code>geom_smooth()</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Change the plot to a scatter plot and add a smoothing curve.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># 1. Change to scatter plot and add smoothing curve</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">ggplot</span>(by_year, <span class="fu">aes</span>(year, percent_yes)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-by-country" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-by-country">Visualizing by country</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Visualizing by country</strong></p>
<p>You’ve been able to plot the trend of percentage_yes over time, but only for the United Nations as a whole. Mixing all countries into one trend doesn’t tell us much about international relations</p>
<p><strong>2. Examining by country and year</strong></p>
<p>What if we wanted to plot the trend only for one country, such as the United States, to find out how its relationship with the United Nations has changed over time?First you’ll have to change our summary operation to structure our data appropriately.</p>
<p><strong>3. Summarizing by country and year</strong></p>
<p>You’ve summarized by year before, and by country. Now, you’re going to summarize by both, by adding year and country to the group_by operation. This gets a data frame with one row for each unique combination of year and country- for example, just for Afghanistan in 1947.</p>
<p><strong>4. Filtering for one country</strong></p>
<p>Once we have this data, you can extract the votes for just one country- such as the United States- with a filter operation. This data is then easy to visualize the same way you visualized overall trends in the last exercises.This by_year_country data gives us even more options, though: instead of plotting one country at a time, we can plot multiple.</p>
<p><strong>5. The %in% operator</strong></p>
<p>Let’s introduce the %in% operator, written as percent in percent. This lets us take one vector and determine which of its items are in another vector. For example, here it would determine that the second and fifth elements, B and E, are in the second vector.</p>
<p><strong>6. Filtering for multiple countries</strong></p>
<p>The %in% operator thus lets us filter for multiple countries- here you are filtering only for the United States and France, which end up as the only rows in our data frame. Don’t forget “c” in our designation of United States and France: that’s just the R way of defining a vector.</p>
<p><strong>7. Visualizing vote trends by country</strong></p>
<p>Once you’ve created the dataset you’ll want to visualize them with ggplot2. To show both countries on the same plot and distinguish them, you’ll need to add another aesthetic besides x and y to your aes call. In this case a good choice is color. By adding “color = country” to our aesthetics, you can plot both lines on one graph, with a legend distinguishing the two. This makes it easy to compare and contrast the two trends. You could use this flexible approach of filtering and graphing to compare any number of countries.</p>
</section>
<section id="summarizing-by-year-and-country" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-by-year-and-country">Summarizing by year and country</h2>
<p>You’re more interested in trends of voting within specific countries than you are in the overall trend. So instead of summarizing just by year, summarize by both year <em>and</em> country, constructing a dataset that shows what fraction of the time each country votes “yes” in each year.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Change the code in the editor to group by both year and country rather than just by year. Save the result as <code>by_year_country</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Group by year and country: by_year_country</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>by_year_country <span class="ot">&lt;-</span> votes_processed <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">group_by</span>(year, <span class="at">country =</span> votes_processed) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb16-5"><a href="#cb16-5"></a>            <span class="at">percent_yes =</span> <span class="fu">mean</span>(vote <span class="sc">==</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-just-the-uk-over-time" class="level2">
<h2 class="anchored" data-anchor-id="plotting-just-the-uk-over-time">Plotting just the UK over time</h2>
<p>Now that you have the percentage of time that each country voted “yes” within each year, you can plot the trend for a particular country. In this case, you’ll look at the trend for just the United Kingdom.</p>
<p>This will involve using <code>filter()</code> on your data before giving it to <code>ggplot2</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the <code>by_year_country</code> dataset.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># 1. Print by_year_country</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>by_year_country</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Create a filtered version of the dataset called <code>UK_by_year</code>.</li>
<li>Create a line plot of the percentage of “yes” votes over time for the United Kingdom.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Create a filtered version: UK_by_year</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>UK_by_year <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>                  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co"># Line plot of percent_yes over time for UK only</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="fu">ggplot</span>(UK_by_year, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> percent_yes)) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-multiple-countries" class="level2">
<h2 class="anchored" data-anchor-id="plotting-multiple-countries">Plotting multiple countries</h2>
<p>Plotting just one country at a time is interesting, but you really want to compare trends <em>between</em> countries. For example, suppose you want to compare voting trends for the United States, the UK, France, and India.</p>
<p>You’ll have to filter to include all <em>four</em> of these countries and use another aesthetic (not just x- and y-axes) to distinguish the countries on the resulting visualization. Instead, you’ll use the color aesthetic to represent different countries.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a filtered version of <code>by_year_country</code> called <code>filtered_4_countries</code> with just the countries listed in the editor (you may find the <code>%in%</code> operator useful here).</li>
<li>Show the trend for each of these countries on the same graph, using color to distinguish each country.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Vector of four countries to examine</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"United States"</span>, <span class="st">"United Kingdom"</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>               <span class="st">"France"</span>, <span class="st">"India"</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co"># 1. Filter by_year_country: filtered_4_countries</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>filtered_4_countries <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>                          <span class="fu">filter</span>(country <span class="sc">%in%</span> countries)</span>
<span id="cb19-8"><a href="#cb19-8"></a></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co"># 2. Line plot of % yes in four countries</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="fu">ggplot</span>(filtered_4_countries, <span class="fu">aes</span>(year, percent_yes, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="faceting-by-country" class="level2">
<h2 class="anchored" data-anchor-id="faceting-by-country">Faceting by country</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Faceting by country</strong></p>
<p>In the last exercise you learned to plot multiple countries, distinguishing them by color. This is great for two or three countries,</p>
<p><strong>2. Graphing many countries</strong></p>
<p>but consider this graph where the trends of six countries are compared to each other. I don’t know about you, but I find this hard to interpret- the overlapping lines are difficult to distinguish, and I find myself forgetting which color represents which country.Instead, let’s introduce an alternative approach: faceting,</p>
<p><strong>3. Graphing many countries</strong></p>
<p>or creating “sub-plots” for each country. To facet, add an additional option with + to the end of the plot: facet_wrap. Here you’ll use a tilde country: in R the tilde means “explained by”, which says that we want to divide the graph into one subplot by country. When the six countries are divided onto separate subplots, it becomes a lot easier to understand each country’s trend.You might notice that all six graphs have the same y-axis, even though they cover different ranges. This leads to “wasted space” within each graph, where the trend in particular countries is compressed because of the patterns in other countries.</p>
<p><strong>4. Graphing on separate scales</strong></p>
<p>To avoid this, you can add a second argument, scales = “free_y”. This lets the y-axis vary between each subplot, and use all the space</p>
<p><strong>5. Graphing on separate scales</strong></p>
<p>it has available</p>
<p><strong>6. Graphing on separate scales</strong></p>
<p>There are advantages and disadvantages to this approach - while there’s less wasted space within each subplot, it can also be misleading while comparing between them- but it’s an option worth being aware of.Faceting is a powerful tool, and in the exercises you’ll see that it is capable of plotting and comparing even a large number of countries.</p>
<p><strong>7. Let’s practice!</strong></p>
</section>
<section id="faceting-the-time-series" class="level2">
<h2 class="anchored" data-anchor-id="faceting-the-time-series">Faceting the time series</h2>
<p>Now you’ll take a look at six countries. While in the previous exercise you used color to represent distinct countries, this gets a little too crowded with six.</p>
<p>Instead, you will <em>facet</em>, giving each country its own sub-plot. To do so, you add a <code>facet_wrap()</code> step after all of your layers.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a filtered version that contains these six countries called <code>filtered_6_countries</code>.</li>
<li>Use the filtered dataset (containing summarized data for six countries) to create a plot with one facet for each country.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Vector of six countries to examine</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"United States"</span>, <span class="st">"United Kingdom"</span>,</span>
<span id="cb20-3"><a href="#cb20-3"></a>               <span class="st">"France"</span>, <span class="st">"Japan"</span>, <span class="st">"Brazil"</span>, <span class="st">"India"</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co"># Filtered by_year_country: filtered_6_countries</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>filtered_6_countries <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>                            <span class="fu">filter</span>(country <span class="sc">%in%</span> countries)</span>
<span id="cb20-8"><a href="#cb20-8"></a></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co"># Line plot of % yes over time faceted by country</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="fu">ggplot</span>(filtered_6_countries, <span class="fu">aes</span>(year, percent_yes)) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="faceting-with-free-y-axis" class="level2">
<h2 class="anchored" data-anchor-id="faceting-with-free-y-axis">Faceting with free y-axis</h2>
<p>In the previous plot, all six graphs had the same axis limits. This made the changes over time hard to examine for plots with relatively little change.</p>
<p>Instead, you may want to let the plot choose a different y-axis for each facet.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Change the faceted plot so that the y-axis is freely chosen for each facet, rather than being the same for all six.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Vector of six countries to examine</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"United States"</span>, <span class="st">"United Kingdom"</span>,</span>
<span id="cb21-3"><a href="#cb21-3"></a>               <span class="st">"France"</span>, <span class="st">"Japan"</span>, <span class="st">"Brazil"</span>, <span class="st">"India"</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># Filtered by_year_country: filtered_6_countries</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>filtered_6_countries <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> countries)</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co"># Line plot of % yes over time faceted by country</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="fu">ggplot</span>(filtered_6_countries, <span class="fu">aes</span>(year, percent_yes)) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> country, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choose-your-own-countries" class="level2">
<h2 class="anchored" data-anchor-id="choose-your-own-countries">Choose your own countries</h2>
<p>The purpose of an exploratory data analysis is to ask questions and answer them with data. Now it’s your turn to ask the questions.</p>
<p>You’ll choose some countries whose history you are interested in and add them to the graph. If you want to look up the full list of countries, enter <code>by_country$country</code> in the console.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add <em>three</em> more countries to the <code>countries</code> vector and therefore to the faceted graph.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Add three more countries to this list</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"United States"</span>, <span class="st">"United Kingdom"</span>,</span>
<span id="cb22-3"><a href="#cb22-3"></a>               <span class="st">"France"</span>, <span class="st">"Japan"</span>, <span class="st">"Brazil"</span>, <span class="st">"India"</span>, <span class="st">"Germany"</span>, <span class="st">"Austria"</span>, <span class="st">"Denmark"</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># Filtered by_year_country: filtered_countries</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>filtered_countries <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> countries)</span>
<span id="cb22-8"><a href="#cb22-8"></a></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co"># Line plot of % yes over time faceted by country</span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="fu">ggplot</span>(filtered_countries, <span class="fu">aes</span>(year, percent_yes)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> country, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="tidy-modeling-with-broom" class="level1">
<h1>3. Tidy modeling with broom</h1>
<p>While visualization helps you understand one country at a time, statistical modeling lets you quantify trends across many countries and interpret them together. Here you’ll learn to use the tidyr, purrr, and broom packages to fit linear models to each country, and understand and compare their outputs.</p>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">Linear regression</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Linear regression</strong></p>
<p>In the last chapter,</p>
<p><strong>2. Quantifying trends</strong></p>
<p>you learned to visualize the trend of the “% yes” metric over time for individual countries, and see that Afghanistan’s agreement has generally going up while the United States has been going down. However, while it’s easy to recognize this trend visually, we haven’t yet quantified it. In this chapter, we’re going to learn to model this trend with a linear regression,</p>
<p><strong>3. Linear regression</strong></p>
<p>finding a “best fit” line for each country. For example, here we can see that</p>
<p><strong>4. Linear regression</strong></p>
<p>Afghanistan has a positive slope</p>
<p><strong>5. Linear regression</strong></p>
<p>and the US a negative slope.</p>
<p><strong>6. Fitting model to Afghanistan</strong></p>
<p>First, you can use filter to extract the per-year data for one country, in this case Afghanistan, into its own data frame.</p>
<p><strong>7. Fitting model to Afghanistan</strong></p>
<p>You can then use the lm function, short for “linear model”, to fit the line. We describe the model as “percent yes, tilde, year.”</p>
<p><strong>8. Fitting model to Afghanistan</strong></p>
<p>Percent yes is our dependent variable, on the y-axis. Next is the tilde- in R this means “explained by”. Then we have “year”,</p>
<p><strong>9. Fitting model to Afghanistan</strong></p>
<p>the independent variable, on the x-axis. This says we’re modeling “percent yes explained by year.”</p>
<p><strong>10. Fitting model to Afghanistan</strong></p>
<p>We can examine this model using the summary function, run on the model object we created with lm. There’s a lot of output- and if you have experience in R you may recognize some of it- but we’re going to focus on the CLICK coefficient table in the middle. Each row here represents a term that’s been estimated- a y-intercept and a slope. The term we’re most interested in is the year term, also known as the slope, showing how much the year affects percent_yes. First we have an estimated slope term. In R the e-3 describes scientific notation, meaning 10 to the negative three- this makes the slope point-006. This describes a positive slope of point-6% increase in % yes each year. We may also care about the p-value, which tests for statistical significance. We won’t talk much about the details of p-values in this course, but low p-values, such as this one, generally mean we can rule out that the effect is due to chance.Quantifying the trend is important,</p>
<p><strong>11. Visualization can surprise you, but it doesn’t scale well.</strong></p>
<p>because in the words of Hadley Wickham, “Visualization can surprise you, but it doesn’t scale well. Modeling scales well, but it can’t surprise you.” Now that you’ve visualized a few examples and know what you’re looking for, you can apply a model. In the course of this chapter we’ll learn to “scale” this analysis</p>
<p><strong>12. Let’s practice!</strong></p>
<p>to compare all countries in our dataset at once.</p>
</section>
<section id="linear-regression-on-the-united-states" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-on-the-united-states">Linear regression on the United States</h2>
<p>A linear regression is a model that lets us examine how one variable changes with respect to another by fitting a best fit line. It is done with the <code>lm()</code> function in R.</p>
<p>Here, you’ll fit a linear regression to just the percentage of “yes” votes from the United States.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the <code>US_by_year</code> data to the console.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Percentage of yes votes from the US by year: US_by_year</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>US_by_year <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"United States"</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co"># 1. Print the US_by_year data</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>US_by_year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Using just the US data in <code>US_by_year</code>, use <code>lm()</code> to run a linear regression predicting <code>percent_yes</code> from <code>year</code>. Save this to a variable <code>US_fit</code>.</li>
<li>Summarize <code>US_fit</code> using the <code>summary()</code> function.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Perform a linear regression of percent_yes by year: US_fit</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>US_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, <span class="at">data =</span> US_by_year)</span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co"># Perform summary() on the US_fit object</span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="fu">summary</span>(US_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finding-the-slope-of-a-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-slope-of-a-linear-regression">Finding the slope of a linear regression</h2>
<p>The <code>US_fit</code> object you created in the previous exercise is available in your workspace. Calling <code>summary()</code> on this gives you lots of useful information about the linear model.</p>
<blockquote class="blockquote">
<h2 id="question-1" class="anchored"><em>Question</em></h2>
<p>What is the estimated slope of this relationship? Said differently, what’s the estimated change each year of the probability of the US voting “yes”?<br> <br> ⬜ 12.664<br> ✅ -0.006<br> ⬜ 8.48e-08<br> ⬜ 1.37e-07<br></p>
</blockquote>
</section>
<section id="finding-the-p-value-of-a-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-p-value-of-a-linear-regression">Finding the p-value of a linear regression</h2>
<p>Not all positive or negative slopes are necessarily real. A p-value is a way of assessing whether a trend could be due to chance. Generally, data scientists set a threshold by declaring that, for example, p-values below .05 are significant.</p>
<blockquote class="blockquote">
<h2 id="question-2" class="anchored"><em>Question</em></h2>
<p>In this linear model, what is the p-value of the relationship between <code>year</code> and <code>percent_yes</code>?<br> <br> ⬜ 12.664<br> ⬜ -0.006<br> ⬜ 8.48e-08<br> ✅ 1.37e-07<br></p>
</blockquote>
</section>
<section id="tidying-models-with-broom" class="level2">
<h2 class="anchored" data-anchor-id="tidying-models-with-broom">Tidying models with broom</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Tidying models with broom</strong></p>
<p>In our last section,</p>
<p><strong>2. A model fit is a “messy” object</strong></p>
<p>you learned to perform a linear regression and interpret the results, noticing in particular the estimate of the slope and the p-value in this coefficients table. However, while we were able to see these values in the printed output, we didn’t discuss how to extract them out within R.This is particularly important when combining multiple models.</p>
<p><strong>3. Models are difficult to combine</strong></p>
<p>If we had a linear regression for Afghanistan, for the United States, and for Canada, we wouldn’t have an easy way to combine these models, compare them, or visualize them.It’s possible to get these values out using built-in functions, but if you’re familiar with R you may recognize that there are some pitfalls that can make it unexpectedly difficult. There’s a tool that makes it particularly easy: my own broom package.</p>
<p><strong>4. broom turns a model into a data frame</strong></p>
<p>The broom package offers a function, tidy, that turns a linear model into a data frame of coefficients. In this case, the tidied coefficients have one row for the intercept and one for the slope, the ones we are interested in . Importantly, since this is a data frame, it is easy to extract values from it, and we’ll be able to use all our standard dplyr tools on it.In particular, this makes it possible to combine multiple models.</p>
<p><strong>5. Tidy models can be combined</strong></p>
<p>If you have two linear models, one for Afghanistan and one for the US, you could tidy each of them, and since the tidied models are the same shape they can be combined with dplyr’s bind_rows function. In the following sections you’ll build one model for each country and combine all of them.</p>
</section>
<section id="tidying-a-linear-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="tidying-a-linear-regression-model">Tidying a linear regression model</h2>
<p>In the last section, you fit a linear model. Now, you’ll use the <code>tidy()</code> function in the <code>broom</code> package to turn that model into a tidy data frame.</p>
<p><strong>Steps</strong></p>
<p>The <code>US_fit</code> linear model is available in your workspace.</p>
<ol type="1">
<li>Load the <code>broom</code> package.</li>
<li>Use the <code>tidy()</code> function from <code>broom</code> on the model object to turn it into a tidy data frame. Don’t store the result; just print the output to the console.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Load the broom package</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">library</span>(broom)</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co"># Call the tidy() function on the US_fit object</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="fu">tidy</span>(US_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-models-for-multiple-countries" class="level2">
<h2 class="anchored" data-anchor-id="combining-models-for-multiple-countries">Combining models for multiple countries</h2>
<p>One important advantage of changing models to tidied data frames is that they can be combined.</p>
<p>In an earlier section, you fit a linear model to the percentage of “yes” votes for each year in the United States. Now you’ll fit the same model for the United Kingdom and combine the results from both countries.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Fit a model for the United Kingdom similar to the one you fit for the US and save it as <code>UK_fit</code>.</li>
<li>Tidy <code>US_fit</code> into a data frame called <code>US_tidied</code> and the UK model into <code>UK_tidied</code>.</li>
<li>Use <code>bind_rows()</code> from <code>dplyr</code> to combine the two tidied models, printing the result to the console.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># 1. Fit model for the United Kingdom</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>UK_by_year <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a>UK_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, UK_by_year)</span>
<span id="cb26-5"><a href="#cb26-5"></a></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co"># 2. Create US_tidied and UK_tidied</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>US_tidied <span class="ot">&lt;-</span> <span class="fu">tidy</span>(US_fit)</span>
<span id="cb26-8"><a href="#cb26-8"></a>UK_tidied <span class="ot">&lt;-</span> <span class="fu">tidy</span>(UK_fit)</span>
<span id="cb26-9"><a href="#cb26-9"></a></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co"># 3. Combine the two tidied models</span></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="fu">bind_rows</span>(US_tidied, UK_tidied)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Awesome! We can easily compare the two models now.</p>
</section>
<section id="nesting-for-multiple-models" class="level2">
<h2 class="anchored" data-anchor-id="nesting-for-multiple-models">Nesting for multiple models</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Nesting for multiple models</strong></p>
<p>In these next two sections, we’re going to discuss fitting many models: in particular,</p>
<p><strong>2. One model for each country</strong></p>
<p>fitting one model for each country. This will allow us to find the countries whose level of agreement with the rest of the United Nations is increasing or decreasing most dramatically.Fitting multiple models requires several steps.</p>
<p><strong>3. Start with one row per country</strong></p>
<p>First, we start with the by_year_country dataset, containing one row for each combination of year and country. We need to separate this data out by country so we can model them individually. But instead of just pulling out one, as we’ve done before, we’re going to split it into many small datasets, one for each country.</p>
<p><strong>4. nest() turns it into one row per country</strong></p>
<p>To do this, we use nest from the tidyr package. Using nest-negative country means to nest all the columns besides country. which means we end up with a data frame with one row for each country. All the other columns- year, total, and percent_yes- have been nested into a column called data. This is a list column, which we haven’t seen before. It allows each item in the column to itself be a data frame (specifically a tibble, dplyr’s version of a data frame)- containing the other columns. This means we now have a filtered version for Afghanistan, a filtered version for Argentina, and so on. In the next lesson this will allow us to fit a model to each.</p>
<p><strong>5. unnest() does the opposite</strong></p>
<p>Later we’ll want to take a nested list column and bring the rows from each individual back into the “top level” of the data frame. This is done with the function unnest. Pipe the table in, saying you want to unnest the data column, and it takes each of those sub-tables and puts their rows back into the main table, where we get to the data we started from.You might be wondering why we nested the data frame only to reverse it right after. In the next lesson we’ll add a step between the nesting and unnesting, where we fit a model to each sub-table and tidy it, that will make this process useful</p>
</section>
<section id="nesting-a-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="nesting-a-data-frame">Nesting a data frame</h2>
<p>Right now, the <code>by_year_country</code> data frame has one row per country-vote pair. So that you can model each country individually, you’re going to “nest” all columns besides <code>country</code>, which will result in a data frame with one row per country. The data for each individual country will then be stored in a <strong>list column</strong> called <code>data</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the <code>tidyr</code> package.</li>
<li>Use the <code>nest()</code> function to nest all the columns in <code>by_year_country</code> except <code>country</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># 1. Load the tidyr package</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co"># 2.Nest all columns besides country</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>    <span class="fu">nest</span>(<span class="sc">-</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="list-columns" class="level2">
<h2 class="anchored" data-anchor-id="list-columns">List columns</h2>
<p>This “nested” data has an interesting structure. The second column, <code>data</code>, is a <strong>list</strong>, a type of R object that hasn’t yet come up in this course that allows complicated objects to be stored within each row. This is because each item of the <code>data</code> column is itself a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># A tibble: 200 × 2</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>                           country              data</span>
<span id="cb28-3"><a href="#cb28-3"></a>                             <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>            <span class="er">&lt;</span>list<span class="sc">&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="dv">1</span>                      Afghanistan <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="dv">2</span>                        Argentina <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="dv">3</span>                        Australia <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="dv">4</span>                          Belarus <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="dv">5</span>                          Belgium <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="dv">6</span>  Bolivia, Plurinational State of <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="dv">7</span>                           Brazil <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="dv">8</span>                           Canada <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="dv">9</span>                            Chile <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span>
<span id="cb28-13"><a href="#cb28-13"></a><span class="dv">10</span>                        Colombia <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">3</span>]<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can use <code>nested$data</code> to access this list column and double brackets to access a particular element. For example, <code>nested$data[[1]]</code> would give you the data frame with Afghanistan’s voting history (the <code>percent_yes</code> per year), since Afghanistan is the first row of the table.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the data frame from the <code>data</code> column that contains the data for Brazil.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># All countries are nested besides country</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>nested <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">nest</span>(<span class="sc">-</span>country)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="co"># Print the nested data for Brazil</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>nested<span class="sc">$</span>data[[<span class="dv">7</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unnesting" class="level2">
<h2 class="anchored" data-anchor-id="unnesting">Unnesting</h2>
<p>The opposite of the <code>nest()</code> operation is the <code>unnest()</code> operation. This takes each of the data frames in the list column and brings those rows back to the main data frame.</p>
<p>In this exercise, you are just undoing the <code>nest()</code> operation. In the next section, you’ll learn how to fit a model in between these nesting and unnesting steps that makes this process useful.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Unnest the <code>data</code> list column, so that the table again has one row for each country-year pair, much like <code>by_year_country</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># 1. Unnest the data column to return it to its original form</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>nested <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitting-multiple-models" class="level2">
<h2 class="anchored" data-anchor-id="fitting-multiple-models">Fitting multiple models</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Fitting multiple models</strong></p>
<p>In the last exercises you nested a data frame</p>
<p><strong>2. nest() turns data into one row per country</strong></p>
<p>to create many smaller data frames, one for each country. Recall, for example, that the first item in the data column was a table of Afghanistan’s per-year data.Now you want fit a model on each of these one-country datasets- fitting one linear model for Afghanistan’s data, one for Argentina, and so on.To fit a model for each item in a list column, you’ll use the purrr package, which offers tools for working with functions and lists. In particular, you’ll use the map function.</p>
<p><strong>3. map() applies an operation to each item in a list</strong></p>
<p>map lets you apply an operation to each item in a list. For example, if you had a list v with values 1, 2, and 3, you could use map and the expression “tilde dot times 10”. The tilde and dot combination is a way of defining an operation, where the dot represents each item in the list- first 1, then 2, then 3. Thus the expression means “multiply each item by 10”- turning 1, 2, 3 into 10, 20, 30.Map is therefore useful any time you want to do something to each item of a list.</p>
<p><strong>4. map() fits a model to each dataset</strong></p>
<p>Here we want to fit a linear model into a new column based on each sub-data frame. We use mutate to define the new column “model”, and use map to apply a linear regression to each item of “data”. We describe the linear regression with tilde then our linear regression, the same kind we’d run on one data field, with dot as the data. This creates a new column of linear models - one for each sub-data frame. So the first item would contain the slope just for Afghanistan. It’s nice that we’ve fit these models, but we can’t combine them, manipulate them, or visualize them. That’s why we return to the broom package,</p>
<p><strong>5. tidy turns each model into a data frame</strong></p>
<p>which takes each model and turns it into a tidy data frame of coefficients. We use map one more time to create another list column, calling this one “tidied”. So now for each country, we have three columns: one with the original data, one with a linear model, and one with the tidied model.Tidied versions of statistical models are easy to combine, so</p>
<p><strong>6. unnest() combines the tidied models</strong></p>
<p>just like in the last lesson we can use unnest to bring them all into the top level. Now we have a table of coefficients, where the first two rows represent the slope and intercept for Afghanistan, the next two rows for Argentina, the next two for Australia, and so on: all of the details of each model in one place.This was four steps: nest by country, map to fit a model to each dataset, map to tidy each model, unnest to a table of coefficients. It’s a complicated process, but it let us get information about each country- how it was changing over time - in a way much more complicated than our earlier group by and summarize allowed.</p>
</section>
<section id="performing-linear-regression-on-each-nested-dataset" class="level2">
<h2 class="anchored" data-anchor-id="performing-linear-regression-on-each-nested-dataset">Performing linear regression on each nested dataset</h2>
<p>Now that you’ve divided the data for each country into a separate dataset in the <code>data</code> column, you need to fit a linear model to each of these datasets.</p>
<p>The <code>map()</code> function from <code>purrr</code> works by applying a formula to each item in a list, where <code>.</code> represents the individual item. For example, you could add one to each of a list of numbers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">map</span>(numbers, <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This means that to fit a model to each dataset, you can do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, <span class="at">data =</span> .))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where <code>.</code> represents each individual item from the <code>data</code> column in <code>by_year_country</code>. Recall that each item in the <code>data</code> column is a dataset that pertains to a specific country.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the <code>tidyr</code> and <code>purrr</code> packages.</li>
<li>After nesting, use the <code>map()</code> function within a <code>mutate()</code> to perform a linear regression on each dataset (i.e.&nbsp;each item in the <code>data</code> column in <code>by_year_country</code>) modeling <code>percent_yes</code> as a function of <code>year</code>. Save the results to the <code>model</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Load tidyr and purrr</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="fu">library</span>(purrr)</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="co"># Perform a linear regression on each item in the data column</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>  <span class="fu">nest</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, <span class="at">data =</span> .)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidy-each-linear-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="tidy-each-linear-regression-model">Tidy each linear regression model</h2>
<p>You’ve now performed a linear regression on each nested dataset and have a linear model stored in the list column <code>model</code>. But you can’t recombine the models until you’ve <em>tidied</em> each into a table of coefficients. To do that, you’ll need to use <code>map()</code> one more time and the <code>tidy()</code> function from the <code>broom</code> package.</p>
<p>Recall that you can simply give a function to <code>map()</code> (e.g.&nbsp;<code>map(models, tidy)</code>) in order to apply that function to each item of a list.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the <code>broom</code> package.</li>
<li>Use the <code>map()</code> function to apply the <code>tidy()</code> function to each linear model in the <code>model</code> column, creating a new column called <code>tidied</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Load the broom package</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="fu">library</span>(broom)</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># Add another mutate that applies tidy() to each model</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>  <span class="fu">nest</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, <span class="at">data =</span> .))) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8"></a>  <span class="fu">mutate</span>(<span class="at">tidied =</span> <span class="fu">map</span>(model, tidy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unnesting-a-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="unnesting-a-data-frame">Unnesting a data frame</h2>
<p>You now have a tidied version of each model stored in the <code>tidied</code> column. You want to combine all of those into a large data frame, similar to how you combined the US and UK tidied models earlier. Recall that the <code>unnest()</code> function from <code>tidyr</code> achieves this.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add an <code>unnest()</code> step to unnest the tidied models stored in the <code>tidied</code> column. Save the result as <code>country_coefficients</code>.</li>
<li>Print the resulting <code>country_coefficients</code> object to the console.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Add one more step that unnests the tidied column</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>country_coefficients <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">nest</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, <span class="at">data =</span> .)),</span>
<span id="cb35-5"><a href="#cb35-5"></a>         <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="fu">unnest</span>(tidied)</span>
<span id="cb35-7"><a href="#cb35-7"></a></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="co"># Print the resulting country_coefficients variable</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>country_coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="working-with-many-tidy-models" class="level2">
<h2 class="anchored" data-anchor-id="working-with-many-tidy-models">Working with many tidy models</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Working with many tidy models</strong></p>
<p>In the last exercises</p>
<p><strong>2. We have a model for each country</strong></p>
<p>you created a combined dataset, called country_coefficients, of the details of each per-country model, with rows for the slope and intercept for each country. Since the data is tidy, you can manipulate these coefficients with dplyr operations just like you did the original voting data.For example, in this analysis we’re interested in how countries change over time (the slope) not where they started- the intercept. So</p>
<p><strong>3. Filter for the year term (slope)</strong></p>
<p>we can use dplyr’s filter to get only the cases where term equals year- the ones describing how year affected percent_yes. Thus- filter for term == “year”. Not all of these slopes can be trusted- some may be due to random noise. We may want to get only the models that were statistically significant. Recall that the p-value of a model is a common metric for whether it is due to noise- we often require that the p-value be less than point-05 to call a trend significant.Here we run into a common issue you may be familiar with- when we run many statistical tests and evaluate their p-values, we need to do a multiple hypothesis correction. This is a complicated problem that is outside the scope of this course, but the basic issue is that if you try many tests, some p-values will be less than point-05 by chance, meaning we need to be more restrictive.R provides a useful built-in function for p-value correction, called p-dot-adjust.</p>
<p><strong>4. Filtered by adjusted p-value</strong></p>
<p>By filtering for cases where the adjusted p-value is less than point-05, we can feel more safe in our assumptions, and get a set of country trends that we believe are real.Using dplyr operations to work with many model outputs is a powerful way to draw conclusions out of a large dataset. In your exercises you’ll also use arrange to find the countries with the strongest upward and downward trends over time.</p>
</section>
<section id="filtering-model-terms" class="level2">
<h2 class="anchored" data-anchor-id="filtering-model-terms">Filtering model terms</h2>
<p>You currently have both the intercept and slope terms for each by-country model. You’re probably more interested in how each is changing over time, so you want to focus on the slope terms.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the <code>country_coefficients</code> data frame to the console.</li>
<li>Perform a <code>filter()</code> step that extracts only the slope (not intercept) terms.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Print the country_coefficients dataset</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>country_coefficients</span>
<span id="cb36-3"><a href="#cb36-3"></a></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="co"># Filter for only the slope terms</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>country_coefficients <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6"></a> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-for-significant-countries" class="level2">
<h2 class="anchored" data-anchor-id="filtering-for-significant-countries">Filtering for significant countries</h2>
<p>Not all slopes are significant, and you can use the p-value to guess which are and which are not.</p>
<p>However, when you have lots of p-values, like one for each country, you run into the problem of multiple hypothesis testing, where you have to set a stricter threshold. The <a href="https://www.rdocumentation.org/packages/stats/topics/p.adjust" target="_blank" rel="noopener noreferrer"><code>p.adjust()</code></a> function is a simple way to correct for this, where <code>p.adjust(p.value)</code> on a vector of p-values returns a set that you can trust.</p>
<p>Here you’ll add two steps to process the <code>slope_terms</code> dataset: use a <code>mutate</code> to create the new, adjusted p-value column, and <code>filter</code> to filter for those below a .05 threshold.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use the <code>p.adjust()</code> function to adjust the <code>p.value</code> column, saving the result into a new <code>p.adjusted</code> column. Then, filter for cases where <code>p.adjusted</code> is less than .05.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Filter for only the slope terms</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>slope_terms <span class="ot">&lt;-</span> country_coefficients <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>)</span>
<span id="cb37-4"><a href="#cb37-4"></a></span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="co"># Add p.adjusted column, then filter</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>slope_terms <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7"></a>  <span class="fu">mutate</span>(<span class="at">p.adjusted =</span> <span class="fu">p.adjust</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8"></a>  <span class="fu">filter</span>(p.adjusted <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great work! Notice that there are now only 61 countries with significant trends.</p>
</section>
<section id="sorting-by-slope" class="level2">
<h2 class="anchored" data-anchor-id="sorting-by-slope">Sorting by slope</h2>
<p>Now that you’ve filtered for countries where the trend is probably not due to chance, you may be interested in countries whose percentage of “yes” votes is changing most quickly over time. Thus, you want to find the countries with the highest and lowest slopes; that is, the <code>estimate</code> column.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using <code>arrange()</code> and <code>desc()</code>, sort the filtered countries to find the countries whose percentage “yes” is most quickly increasing over time.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># Filter by adjusted p-values</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>filtered_countries <span class="ot">&lt;-</span> country_coefficients <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="fu">mutate</span>(<span class="at">p.adjusted =</span> <span class="fu">p.adjust</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>  <span class="fu">filter</span>(p.adjusted <span class="sc">&lt;</span> .<span class="dv">05</span>)</span>
<span id="cb38-6"><a href="#cb38-6"></a></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="co"># Sort for the countries increasing most quickly</span></span>
<span id="cb38-8"><a href="#cb38-8"></a>filtered_countries <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9"></a>  <span class="fu">arrange</span>(estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Using <code>arrange()</code>, sort to find the countries whose percentage “yes” is most quickly decreasing.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># 2. Sort for the countries decreasing most quickly</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>filtered_countries <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="joining-and-tidying" class="level1">
<h1>4. Joining and tidying</h1>
<p>In this chapter, you’ll learn to combine multiple related datasets, such as incorporating information about each resolution’s topic into your vote analysis. You’ll also learn how to turn untidy data into tidy data, and see how tidy data can guide your exploration of topics and countries over time.</p>
<section id="joining-datasets" class="level2">
<h2 class="anchored" data-anchor-id="joining-datasets">Joining datasets</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Joining datasets</strong></p>
<p>So far in our course on United Nations exploratory data analysis,</p>
<p><strong>2. Processed votes</strong></p>
<p>you’ve been working with this votes_processed dataset, where each row, or observation, represents a pairing of a roll call vote and country. You’ve been treating these roll call votes as interchangeable, paying attention to only the year, country and vote, and summarizing them to draw conclusions. But these resolutions cover a vast range of political and historical issues. In this chapter, you’re going to bring in some context about each resolution, specifically topic information. You’ll do this with the descriptions dataset</p>
<p><strong>3. Descriptions dataset</strong></p>
<ul>
<li>a second, separate data frame with new information about each roll call vote. Let’s look at the variables in this table. You see you have the rcid - or roll call ID- and session variables, which are the same columns used to describe each roll call in the votes_processed dataset. The difference is that here, instead of each observation being a country-roll call pair, here there’s just one observation for each roll call- the first observation is the vote on September 4th, as you can see in the date variable, the second is a vote on October 5th, and so on. The descriptions dataset also contains the United Nations resolution it was related to, in unres, and most importantly topic information, about whether each vote related to one of six topics. For example, the second roll call vote has a 1 in the hr column, which means it relates to human rights. This dataset doesn’t tell us anything about countries or their votes, so you want to combine it with the votes_processed dataset</li>
</ul>
<p><strong>4. inner_join()</strong></p>
<p>to examine how different countries voted on different topics. This is done with dplyr’s inner_join function. You use the “by” argument to note the two columns they have in common: rcid and session- which are used to match rows together between the tables. You then have all the variables from the original votes_processed dataset included in the new table, including vote, year, and country. You also have all the variables from the descriptions dataset - date, unres, and the topic columns. inner_join combined the information in these two tables so we can examine them together.</p>
<p><strong>5. Let’s practice!</strong></p>
<p>In your exercises, you’ll manipulate this combined dataset using other dplyr operations, such as filtering for all votes related to human rights issues.</p>
</section>
<section id="joining-datasets-with-inner_join" class="level2">
<h2 class="anchored" data-anchor-id="joining-datasets-with-inner_join">Joining datasets with inner_join</h2>
<p>In the first chapter, you created the <code>votes_processed</code> dataset, containing information about each country’s votes. You’ll now combine that with the new <code>descriptions</code> dataset, which includes topic information about each country, so that you can analyze votes within particular topics.</p>
<p>To do this, you’ll make use of the <code>inner_join()</code> function from <code>dplyr</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the <code>votes_processed</code> dataset.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># 1. Print the votes_processed dataset</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>votes_processed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Print the new <code>descriptions</code> dataset.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># 2. Print the descriptions dataset</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>descriptions <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/descriptions.rds"</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a>descriptions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Join the two datasets using dplyr’s <code>inner_join()</code>, using the <code>rcid</code> and <code>session</code> columns to match them. Save as <code>votes_joined</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># 3. Join them together based on the "rcid" and "session" columns</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>votes_joined <span class="ot">&lt;-</span> votes_processed <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>    <span class="fu">inner_join</span>(descriptions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"rcid"</span>, <span class="st">"session"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-4"><a href="#cb42-4"></a>    <span class="fu">rename</span>(<span class="at">country =</span> <span class="st">"votes_processed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-the-joined-dataset" class="level2">
<h2 class="anchored" data-anchor-id="filtering-the-joined-dataset">Filtering the joined dataset</h2>
<p>There are six columns in the <code>descriptions</code> dataset (and therefore in the new joined dataset) that describe the topic of a resolution:</p>
<ul>
<li><strong>me</strong>: Palestinian conflict</li>
<li><strong>nu</strong>: Nuclear weapons and nuclear material</li>
<li><strong>di</strong>: Arms control and disarmament</li>
<li><strong>hr</strong>: Human rights</li>
<li><strong>co</strong>: Colonialism</li>
<li><strong>ec</strong>: Economic development</li>
</ul>
<p>Each contains a <code>1</code> if the resolution is related to this topic and a <code>0</code> otherwise.</p>
<p><strong>Steps</strong></p>
<p>Filter the <code>votes_joined</code> dataset for votes relating to colonialism.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Filter for votes related to colonialism</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>votes_joined <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="fu">filter</span>(co <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-colonialism-votes" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-colonialism-votes">Visualizing colonialism votes</h2>
<p>In an earlier exercise, you graphed the percentage of votes each year where the US voted “yes”. Now you’ll create that same graph, but only for votes related to colonialism.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter the <code>votes_joined</code> dataset for only votes by the United States relating to colonialism, then <code>summarize()</code> the percentage of votes that are “yes” within each <code>year</code>. Name the resulting column <code>percent_yes</code> and save the entire data frame as <code>US_co_by_year</code>.</li>
<li>Add a <code>geom_line()</code> layer to your <code>ggplot()</code> call to create a line graph of the percentage of “yes” votes on colonialism (<code>percent_yes</code>) cast by the US over time.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># 1. Filter, then summarize by year: US_co_by_year</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>US_co_by_year <span class="ot">&lt;-</span> votes_joined <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>                    <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"United States"</span>,</span>
<span id="cb44-4"><a href="#cb44-4"></a>                           co      <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>                    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>                    <span class="fu">summarise</span>(<span class="at">percent_yes =</span> <span class="fu">mean</span>(vote <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb44-7"><a href="#cb44-7"></a></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="co"># 2. Graph the % of "yes" votes over time</span></span>
<span id="cb44-9"><a href="#cb44-9"></a><span class="fu">ggplot</span>(US_co_by_year, <span class="fu">aes</span>(year, percent_yes)) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data">Tidy data</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Tidy data</strong></p>
<p>Consider this</p>
<p><strong>2. United Kingdom</strong></p>
<p>graph of UN voting trends over time. Like other graphs you’ve made, it maps</p>
<p><strong>3. United Kingdom</strong></p>
<p>“year” to the x-axis,</p>
<p><strong>4. United Kingdom</strong></p>
<p>“percentage yes” to the y-axis,</p>
<p><strong>5. United Kingdom</strong></p>
<p>and “country” to color. This graph, however, is faceted across the six topics, using one sub-graph for each topic. For instance,</p>
<p><strong>6. United Kingdom</strong></p>
<p>one single point on this graph represents</p>
<p><strong>7. United Kingdom</strong></p>
<p>the votes of the United Kingdom on the topic of colonialism in 2001. This useful kind of analysis is possible only with a particular structure of data:</p>
<p><strong>8. Tidy data: topic is a variable</strong></p>
<p>one where each observation, or row, represents a single combination of</p>
<p><strong>9. Tidy data: topic is a variable</strong></p>
<p>country, year, and topic. This allows every observation</p>
<p><strong>10. Tidy data: topic is a variable</strong></p>
<p>in the data to map to one point in your plot. Notice that this data includes a variable called “topic”,</p>
<p><strong>11. Tidy data: topic is a variable</strong></p>
<p>which specifies for each observation whether it relates to colonialism, nuclear weapons, and so on. We call this arrangement “tidy”.</p>
<p><strong>12. Topic is spread across six columns</strong></p>
<p>In the votes_joined dataset you used in the previous exercises, you don’t have a single topic variable, but rather one column for each of the six topics containing a zero or a one. This means there’s no easy way to use dplyr to summarize by topic, or to visualize the results for six topics on the same graph.In order to do that, we need to bring topic into a single variable.</p>
<p><strong>13. Use gather() to bring columns into two</strong></p>
<p>This can be done with the gather function in the tidyr package. gather is a reshaping operation that takes any number of columns and collects them into two: key,</p>
<p><strong>14. Use gather() to bring columns into two</strong></p>
<p>with the original column names, and value,</p>
<p><strong>15. Use gather() to bring columns into two</strong></p>
<p>with the contents of those columns. Notice that this typically increases the number of rows in the data.</p>
<p><strong>16. Use gather() to bring columns into two variables</strong></p>
<p>You can apply the gather function on the votes_joined data to collect topic into one variable. First, you specify that you want to join the m-e through e-c columns : those are the six topic columns in the joined dataset. You then specify the names of the key and value columns: use “topic” to store the key, which then contains the column names, and “has_topic” for the value, which is either 0 or 1. This achieves your goal of constructing a “topic” variable with six possible values. Notice that there are now 6 rows for each vote, one for each topic.In this case, you don’t actually care about rows where “has_topic” is zero. For example, these rows are effectively saying that a roll call vote was not related to m-e, the Palestinian conflict.</p>
<p><strong>17. Use gather() to bring columns into one variable</strong></p>
<p>Thus, you should add one more step where you filter for all the cases where has_topic is 1. Thus, the topic column now describes each of the votes it is associated with. Note that votes with multiple topics may appear multiple times in the dataset.By constructing a country-vote-topic dataset, you’ve now made it possible to group and summarize the data by topic, or to compare all six in the same visualization.</p>
<p><strong>18. Let’s practice!</strong></p>
<p>Many analyses will require this kind of manipulation and restructuring of your data using tidyr and other tools.</p>
</section>
<section id="tidy-data-observations" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data-observations">Tidy data observations</h2>
<p>Insert plot (comes later)</p>
<blockquote class="blockquote">
<h2 id="question-3" class="anchored"><em>Question</em></h2>
<p>According to the tidy data framework, which of the following counts as an observation in this graph?<br> <br> ⬜ A country<br> ⬜ A vote<br> ⬜ A country-vote combination<br> ⬜ A country-topic combination<br> ✅ A country-vote-topic combination<br></p>
</blockquote>
</section>
<section id="using-gather-to-tidy-a-dataset" class="level2">
<h2 class="anchored" data-anchor-id="using-gather-to-tidy-a-dataset">Using gather to tidy a dataset</h2>
<p>In order to represent the joined vote-topic data in a tidy form so we can analyze and graph by topic, we need to transform the data so that each row has one combination of country-vote-topic. This will change the data from having six columns (<code>me</code>, <code>nu</code>, <code>di</code>, <code>hr</code>, <code>co</code>, <code>ec</code>) to having two columns (<code>topic</code> and <code>has_topic</code>).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Gather the six topic columns in <code>votes_joined</code> into one column called <code>topic</code> (containing one of <code>me</code>, <code>nu</code>, etc.) and a column called <code>has_topic</code> (containing 0 or 1). Print the result without saving it.</li>
<li>You don’t actually care about the cases where <code>has_topic</code> is 0. Perform the <code>pivot_longer()</code> / <code>gather()</code> operation again, but this time also filter for only the rows where the topic in <code>topic</code> describes the vote. Save the result as <code>votes_gathered</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># 1. Gather the six me/nu/di/hr/co/ec columns</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="co"># votes_joined %&gt;% gather(topic, has_topic, me:ec)</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>votes_joined <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"topic"</span>, <span class="at">values_to =</span> <span class="st">"has_topic"</span>, <span class="at">cols =</span> <span class="fu">c</span>(me<span class="sc">:</span>ec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># 2. Perform gather again, then filter</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>votes_gathered <span class="ot">&lt;-</span> votes_joined <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3"></a>                    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"topic"</span>, <span class="at">values_to =</span> <span class="st">"has_topic"</span>, <span class="at">cols =</span> <span class="fu">c</span>(me<span class="sc">:</span>ec)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4"></a>                    <span class="fu">filter</span>(has_topic <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recoding-the-topics" class="level2">
<h2 class="anchored" data-anchor-id="recoding-the-topics">Recoding the topics</h2>
<p>There’s one more step of data cleaning to make this more interpretable. Right now, topics are represented by two-letter codes:</p>
<ul>
<li><strong>me</strong>: Palestinian conflict</li>
<li><strong>nu</strong>: Nuclear weapons and nuclear material</li>
<li><strong>di</strong>: Arms control and disarmament</li>
<li><strong>hr</strong>: Human rights</li>
<li><strong>co</strong>: Colonialism</li>
<li><strong>ec</strong>: Economic development</li>
</ul>
<p>So that you can interpret the data more easily, recode the data to replace these codes with their full name. You can do that with <code>dplyr</code>’s <code>recode()</code> function, which replaces values with ones you specify:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>example <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"apple"</span>, <span class="st">"orange"</span>)</span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="fu">recode</span>(example,</span>
<span id="cb47-3"><a href="#cb47-3"></a>       <span class="at">apple  =</span> <span class="st">"plum"</span>,</span>
<span id="cb47-4"><a href="#cb47-4"></a>       <span class="at">banana =</span> <span class="st">"grape"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use the <code>recode()</code> function from <code>dplyr</code> in a <code>mutate()</code> to replace each two-letter code in the <code>votes_gathered</code> data frame with the corresponding full name. Save this as <code>votes_tidied</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Replace the two-letter codes in topic: votes_tidied</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>votes_tidied <span class="ot">&lt;-</span> votes_gathered <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">mutate</span>(<span class="at">topic =</span> <span class="fu">recode</span>(topic,</span>
<span id="cb48-4"><a href="#cb48-4"></a>                        <span class="at">me =</span> <span class="st">"Palestinian conflict"</span>,</span>
<span id="cb48-5"><a href="#cb48-5"></a>                        <span class="at">nu =</span> <span class="st">"Nuclear weapons and nuclear material"</span>,</span>
<span id="cb48-6"><a href="#cb48-6"></a>                        <span class="at">di =</span> <span class="st">"Arms control and disarmament"</span>,</span>
<span id="cb48-7"><a href="#cb48-7"></a>                        <span class="at">hr =</span> <span class="st">"Human rights"</span>,</span>
<span id="cb48-8"><a href="#cb48-8"></a>                        <span class="at">co =</span> <span class="st">"Colonialism"</span>,</span>
<span id="cb48-9"><a href="#cb48-9"></a>                        <span class="at">ec =</span> <span class="st">"Economic development"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarize-by-country-year-and-topic" class="level2">
<h2 class="anchored" data-anchor-id="summarize-by-country-year-and-topic">Summarize by country, year, and topic</h2>
<p>In previous exercises, you summarized the votes dataset by country, by year, and by country-year combination.</p>
<p>Now that you have <code>topic</code> as an additional variable, you can summarize the votes for each combination of country, year, <em>and</em> topic (e.g.&nbsp;for the United States in 2013 on the topic of nuclear weapons.)</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the <code>votes_tidied</code> dataset to the console.</li>
<li>In a single <code>summarize()</code> call, compute both the total number of votes (<code>total</code>) and the percentage of “yes” votes (<code>percent_yes</code>) for each combination of country, year, and topic. Save this as <code>by_country_year_topic</code>. Make sure that you <code>ungroup()</code> after summarizing.</li>
<li>Print the <code>by_country_year_topic</code> dataset to the console.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># 1. Print votes_tidied</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>votes_tidied</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># 2. Summarize the percentage "yes" per country-year-topic</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>by_country_year_topic <span class="ot">&lt;-</span> votes_tidied <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3"></a> <span class="fu">group_by</span>(country, year, topic) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4"></a> <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb50-5"><a href="#cb50-5"></a>           <span class="at">percent_yes =</span> <span class="fu">mean</span>(vote <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-6"><a href="#cb50-6"></a> <span class="fu">ungroup</span>()</span>
<span id="cb50-7"><a href="#cb50-7"></a></span>
<span id="cb50-8"><a href="#cb50-8"></a><span class="co"># 3- Print by_country_year_topic</span></span>
<span id="cb50-9"><a href="#cb50-9"></a>by_country_year_topic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-trends-in-topics-for-one-country" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-trends-in-topics-for-one-country">Visualizing trends in topics for one country</h2>
<p>You can now visualize the trends in percentage “yes” over time for all six topics side-by-side. Here, you’ll visualize them just for the United States.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter the <code>by_country_year_topic</code> dataset for just the United States and save the result as <code>US_by_country_year_topic</code>.</li>
<li>Use this dataset to graph the percentage “yes” over time for the United States, faceting by topic.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># 1. Filter by_country_year_topic for just the US</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>US_by_country_year_topic <span class="ot">&lt;-</span> by_country_year_topic <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>    <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"United States"</span>)</span>
<span id="cb51-4"><a href="#cb51-4"></a></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="co"># 2. Plot % yes over time for the US, faceting by topic</span></span>
<span id="cb51-6"><a href="#cb51-6"></a>US_by_country_year_topic <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7"></a> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> percent_yes)) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>topic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidy-modeling-by-topic-and-country" class="level2">
<h2 class="anchored" data-anchor-id="tidy-modeling-by-topic-and-country">Tidy modeling by topic and country</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Tidy modeling by topic and country</strong></p>
<p>In Chapter 3, you used the broom package to fit a separate linear model for each country that measured the trend of percentage of yes votes over time. This let you find the countries whose rate of agreement was increasing or decreasing most quickly.</p>
<p><strong>2. Detecting a trend by topic</strong></p>
<p>With the new datasets you’ve built in this chapter, you fit these trends within each country <em>and</em> within each topic. For example, you could fit trends for the United Kingdom’s voting behavior within each of these six topics, as seen here.</p>
<p><strong>3. Tidy modeling by country</strong></p>
<p>Recall that there were several steps to fitting a model for each country. You FIRST nested all columns besides country into their own sub-datasets in a list column. You then used map CLICK to fit a linear model to each of these sub-datasets, and then tidied each of them into a table of coefficients. Finally, you used unnest to bring those coefficients back into the main data frame, resulting in a combined table of slopes and intercepts.Now that you have a topic column in your by_year_country_topic summary, there’s only one change you need to make to this workflow to fit a model within each country/topic combination.</p>
<p><strong>4. Tidy modeling by country and topic</strong></p>
<p>In the nest statement, simply nest all columns besides country and topic. The other steps are identical. What results is a table with the estimated coefficients for each specific topic for each country. For example, these rows</p>
<p><strong>5. Tidy modeling by country and topic</strong></p>
<p>where the term equals “year” show the estimated slopes on the topics of Colonialism, Economic development, human rights, and so on within Afghanistan. This dataset will let you explore which countries had the sharpest strongest within particular topics- for example, which country had most changed its voting pattern on the topic of colonialism.This analysis demonstrates the flexibility of the nest, model, and unnest pattern in exploratory analysis. You could have chosen to slice your data in many other ways using alternative data sources, and the tidyr, dplyr, and broom packages will always give you the tools to answer the questions you’re interested in.</p>
<p><strong>6. Let’s practice!</strong></p>
</section>
<section id="nesting-by-topic-and-country" class="level2">
<h2 class="anchored" data-anchor-id="nesting-by-topic-and-country">Nesting by topic and country</h2>
<p>In the last chapter, you constructed a linear model for each country by nesting the data in each country, fitting a model to each dataset, then tidying each model with <code>broom</code> and unnesting the coefficients. The code looked something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>country_coefficients <span class="ot">&lt;-</span> by_year_country <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="fu">nest</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="fu">mutate</span>(<span class="at">model  =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, <span class="at">data =</span> .)),</span>
<span id="cb52-4"><a href="#cb52-4"></a>         <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="fu">unnest</span>(tidied)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, you’ll again be modeling change in “percentage” yes over time, but instead of fitting one model for each country, you’ll fit one for each combination of country and topic.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the <code>purrr</code>, <code>tidyr</code>, and <code>broom</code> packages.</li>
<li>Print the <code>by_country_year_topic</code> dataset to the console.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Load purrr, tidyr, and broom</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="fu">library</span>(purrr)</span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="fu">library</span>(broom)</span>
<span id="cb53-5"><a href="#cb53-5"></a></span>
<span id="cb53-6"><a href="#cb53-6"></a><span class="co"># Print by_country_year_topic</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>by_country_year_topic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Fit a linear model within each country and topic in this dataset, saving the result as <code>country_topic_coefficients</code>. You can use the provided code as a starting point.</li>
<li>Print the <code>country_topic_coefficients</code> dataset to the console.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Fit model on the by_country_year_topic dataset</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>country_topic_coefficients <span class="ot">&lt;-</span> by_country_year_topic <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3"></a>    <span class="fu">nest</span>(<span class="sc">-</span>country, <span class="sc">-</span>topic) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(percent_yes <span class="sc">~</span> year, <span class="at">data =</span> .)),</span>
<span id="cb54-5"><a href="#cb54-5"></a>          <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>          <span class="fu">unnest</span>(tidied)</span>
<span id="cb54-7"><a href="#cb54-7"></a></span>
<span id="cb54-8"><a href="#cb54-8"></a><span class="co"># Print country_topic_coefficients</span></span>
<span id="cb54-9"><a href="#cb54-9"></a>country_topic_coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great work! You can ignore the warning messages in the console for now.</p>
</section>
<section id="interpreting-tidy-models" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-tidy-models">Interpreting tidy models</h2>
<p>Now you have both the slope and intercept terms for each model. Just as you did in the last chapter with the tidied coefficients, you’ll need to filter for only the slope terms.</p>
<p>You’ll also have to extract only cases that are statistically significant, which means adjusting the p-value for the number of models, and then filtering to include only significant changes.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter the <code>country_topic_coefficients</code> data to include only the slope term.</li>
<li>Add a <code>p.adjusted</code> column containing adjusted p-values (using the <code>p.adjust()</code> function).</li>
<li>Filter for only adjusted p-values less than .05.</li>
<li>Save the result as <code>country_topic_filtered</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Create country_topic_filtered</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>country_topic_filtered <span class="ot">&lt;-</span> country_topic_coefficients <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>                                <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>                                <span class="fu">mutate</span>(<span class="at">p.adjusted =</span> <span class="fu">p.adjust</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>                                <span class="fu">filter</span>(p.adjusted <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="steepest-trends-by-topic" class="level2">
<h2 class="anchored" data-anchor-id="steepest-trends-by-topic">Steepest trends by topic</h2>
<blockquote class="blockquote">
<h2 id="question-4" class="anchored"><em>Question</em></h2>
<p>Which combination of country and topic has the steepest downward trend?<br> <br> ⬜ Afghanistan on colonialism<br> ⬜ Malawi on the Palestinian conflict<br> ⬜ Vanuatu on colonialism<br> ✅ Vanuatu on the Palestinian conflict<br></p>
</blockquote>
</section>
<section id="checking-models-visually" class="level2">
<h2 class="anchored" data-anchor-id="checking-models-visually">Checking models visually</h2>
<p>In the last exercise, you found that over its history, Vanuatu (an island nation in the Pacific Ocean) sharply changed its pattern of voting on the topic of Palestinian conflict.</p>
<p>Let’s examine this country’s voting patterns more closely. Recall that the <code>by_country_year_topic</code> dataset contained one row for each combination of country, year, and topic. You can use that to create a plot of Vanuatu’s voting, faceted by topic.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter the <code>by_country_year_topic</code> variable for only Vanuatu’s votes to create a <code>vanuatu_by_country_year_topic</code> object.</li>
<li>Create a plot with <code>year</code> on the x-axis and <code>percent_yes</code> on the y-axis, and facet by topic.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Create vanuatu_by_country_year_topic</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>vanuatu_by_country_year_topic <span class="ot">&lt;-</span> by_country_year_topic <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3"></a>          <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"Vanuatu"</span>)</span>
<span id="cb56-4"><a href="#cb56-4"></a></span>
<span id="cb56-5"><a href="#cb56-5"></a><span class="co"># Plot of percentage "yes" over time, faceted by topic</span></span>
<span id="cb56-6"><a href="#cb56-6"></a><span class="fu">ggplot</span>(vanuatu_by_country_year_topic, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> percent_yes)) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>topic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p><strong>1. Conclusion</strong></p>
<p>I hope you’ve enjoyed this exploration of the United Nations dataset,</p>
<p><strong>2. Insert title here…</strong></p>
<p>where we cleaned, visualized, and modeled historical data to uncover interesting trends. Note that we barely scratched the surface of what can be discovered from this data.</p>
<p><strong>3. Insert title here…</strong></p>
<p>Beyond looking at the percentage of yes votes, you could analyze what countries tended to agree or disagree with each other. You could use machine learning to predict a country’s vote on a particular resolution. I encourage you to take this voting data and try your own analyses. The best way to improve your skills with these tools and to build good analysis habits is to answer questions that are interesting to you.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../../../content/R/topics/03_data_wrangling/exploratory_data_analysis_in_r/exploratory_data_analysis_in_r.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">7: Exploratory Data Analysis</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" class="pagination-link">
        <span class="nav-page-text">9: Cleaning Data</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2022 by <a href="https://www.startupengineer.io/authors/schwarz/">Joschka Schwarz</a> <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/jwarz/jwarz.github.io">View the source at GitHub</a></div>
  </div>
</footer>



<script src="../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>