<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joschka Schwarz">

<title>Joschka Schwarz - Data Manipulation with data.table in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../../content/R/topics/03_data_wrangling/joining_data_with_datatable/joining_data_with_datatable.html" rel="next">
<link href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" rel="prev">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Joschka Schwarz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-science" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Science</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-science">    
        <li>
    <a class="dropdown-item" href="../../../../../content/R/index.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/python/index.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/sql/index.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../../slides/index.html">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../resumes/index.html">
 <span class="menu-text">Resumes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jwarz/"><i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/j-schwarz"><i class="bi bi-linkedin" role="img" aria-label="Quarto LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Data Manipulation with data.table in R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Topics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <b><i>Programming Basics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/01_programming_beginner/01_programming_beginner.html" class="sidebar-item-text sidebar-link">1: Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/02_programming_intermediate/02_programming_intermediate.html" class="sidebar-item-text sidebar-link">2: Intermediate R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/03_programming_tidyverse/03_programming_tidyverse.html" class="sidebar-item-text sidebar-link">3: Introduction to the tidyverse</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Importing Data</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/01_importing_data_beginner/01_importing_data_beginner.html" class="sidebar-item-text sidebar-link">4: Introduction to Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/02_importing_data_intermediate/02_importing_data_intermediate.html" class="sidebar-item-text sidebar-link">5: Intermediate Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/03_working_with_web_data/03_working_with_web_data.html" class="sidebar-item-text sidebar-link">6: Working with web data</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Data Wrangling</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/exploratory_data_analysis_in_r/exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">7: Exploratory Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/case_study_exploratory_data_analysis_in_r/case_study_exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">8: Case Study: EDA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" class="sidebar-item-text sidebar-link">9: Cleaning Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/data_manipulation_with_datatable/data_manipulation_with_datatable.html" class="sidebar-item-text sidebar-link active">10: Data Manipulation with data.table</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/joining_data_with_datatable/joining_data_with_datatable.html" class="sidebar-item-text sidebar-link">11: Joining Data with data.table</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Data Visualization</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/data_visualization_with_ggplot2_intermediate/ggplot2_intermediate.html" class="sidebar-item-text sidebar-link">12: Intermediate Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Statistics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/01_statistics_beginner/01_statistics_beginner.html" class="sidebar-item-text sidebar-link">13: Introduction to Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/02_fundamentals_of_bayesian_data_analysis/02_fundamentals_of_bayesian_data_analysis.html" class="sidebar-item-text sidebar-link">14: Fundamentals of Bayesian Data Analysis</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Regression</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/06_regression/01_regression_beginner/01_regression_beginner.html" class="sidebar-item-text sidebar-link">15: Introduction to Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/06_regression/02_regression_intermediate/02_regression_intermediate.html" class="sidebar-item-text sidebar-link">16: Intermediate Regression</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>Machine Learning</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/01_supervised_learning_classification/01_supervised_learning_classification.html" class="sidebar-item-text sidebar-link">17: Supervised Learning: Classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/02_supervised_learning_regression/02_supervised_learning_regression.html" class="sidebar-item-text sidebar-link">18: Supervised Learning: Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/03_unsupervised_learning/03_unsupervised_learning.html" class="sidebar-item-text sidebar-link">19: Unsupervised Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/04_machine_learning_in_the_tidyverse/04_machine_learning_in_the_tidyverse.html" class="sidebar-item-text sidebar-link">20: Machine Learning in the tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/05_cluster_analysis/05_cluster_analysis.html" class="sidebar-item-text sidebar-link">21: Cluster Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/06_machine_learning_with_caret/06_machine_learning_with_caret.html" class="sidebar-item-text sidebar-link">22: Cluster Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/07_modeling_with_tidymodels/07_modeling_with_tidymodels.html" class="sidebar-item-text sidebar-link">23: Modeling with tidymodels</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/08_machine_learning_with_tree-based_models/08_machine_learning_with_tree-based_models.html" class="sidebar-item-text sidebar-link">24: Machine Learning with tree-based Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/09_support_vector_machines/09_support_vector_machines.html" class="sidebar-item-text sidebar-link">25: Support Vector Machines</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/10_topic_modeling/10_topic_modeling.html" class="sidebar-item-text sidebar-link">26: Topic Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/11_hyperparameter_tuning/11_hyperparameter_tuning.html" class="sidebar-item-text sidebar-link">27: Hyperparameter Tuning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/12_bayesian_regression_modeling_with_rstanarm/12_bayesian_regression_modeling_with_rstanarm.html" class="sidebar-item-text sidebar-link">28: Bayesian Regression Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/13_spark_with_sparklyr_in_R/13_spark_with_sparklyr_in_R.html" class="sidebar-item-text sidebar-link">29: Introduction to Spark</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">R Manuals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/test.html" class="sidebar-item-text sidebar-link">1: An Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/02-content.html" class="sidebar-item-text sidebar-link">2: R Data Import/Export</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/03-content.html" class="sidebar-item-text sidebar-link">3: R Installation and Administration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/04-content.html" class="sidebar-item-text sidebar-link">4: Writing R Extensions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/05-content.html" class="sidebar-item-text sidebar-link">5: R Language Definition</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/06-content.html" class="sidebar-item-text sidebar-link">6: R Internals</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction-to-data.table" id="toc-introduction-to-data.table" class="nav-link active" data-scroll-target="#introduction-to-data.table"><span class="toc-section-number">1</span>  1. Introduction to data.table</a>
  <ul class="collapse">
  <li><a href="#welcome-to-the-course" id="toc-welcome-to-the-course" class="nav-link" data-scroll-target="#welcome-to-the-course"><span class="toc-section-number">1.1</span>  Welcome to the course!</a></li>
  <li><a href="#data.table-pop-quiz" id="toc-data.table-pop-quiz" class="nav-link" data-scroll-target="#data.table-pop-quiz"><span class="toc-section-number">1.2</span>  data.table pop quiz</a></li>
  <li><a href="#creating-a-data.table" id="toc-creating-a-data.table" class="nav-link" data-scroll-target="#creating-a-data.table"><span class="toc-section-number">1.4</span>  Creating a data.table</a></li>
  <li><a href="#introducing-bikes-data" id="toc-introducing-bikes-data" class="nav-link" data-scroll-target="#introducing-bikes-data"><span class="toc-section-number">1.5</span>  Introducing bikes data</a></li>
  <li><a href="#filtering-rows-in-a-data.table" id="toc-filtering-rows-in-a-data.table" class="nav-link" data-scroll-target="#filtering-rows-in-a-data.table"><span class="toc-section-number">1.6</span>  Filtering rows in a data.table</a></li>
  <li><a href="#filtering-rows-using-positive-integers" id="toc-filtering-rows-using-positive-integers" class="nav-link" data-scroll-target="#filtering-rows-using-positive-integers"><span class="toc-section-number">1.7</span>  Filtering rows using positive integers</a></li>
  <li><a href="#filtering-rows-using-negative-integers" id="toc-filtering-rows-using-negative-integers" class="nav-link" data-scroll-target="#filtering-rows-using-negative-integers"><span class="toc-section-number">1.8</span>  Filtering rows using negative integers</a></li>
  <li><a href="#filtering-rows-using-logical-vectors" id="toc-filtering-rows-using-logical-vectors" class="nav-link" data-scroll-target="#filtering-rows-using-logical-vectors"><span class="toc-section-number">1.9</span>  Filtering rows using logical vectors</a></li>
  <li><a href="#helpers-for-filtering" id="toc-helpers-for-filtering" class="nav-link" data-scroll-target="#helpers-for-filtering"><span class="toc-section-number">1.10</span>  Helpers for filtering</a></li>
  <li><a href="#i-like-data.tables" id="toc-i-like-data.tables" class="nav-link" data-scroll-target="#i-like-data.tables"><span class="toc-section-number">1.11</span>  I %like% data.tables</a></li>
  <li><a href="#filtering-with-in" id="toc-filtering-with-in" class="nav-link" data-scroll-target="#filtering-with-in"><span class="toc-section-number">1.12</span>  Filtering with %in%</a></li>
  <li><a href="#filtering-with-between-and-chin" id="toc-filtering-with-between-and-chin" class="nav-link" data-scroll-target="#filtering-with-between-and-chin"><span class="toc-section-number">1.13</span>  Filtering with %between% and %chin%</a></li>
  </ul></li>
  <li><a href="#selecting-and-computing-on-columns" id="toc-selecting-and-computing-on-columns" class="nav-link" data-scroll-target="#selecting-and-computing-on-columns"><span class="toc-section-number">2</span>  2. Selecting and Computing on Columns</a>
  <ul class="collapse">
  <li><a href="#selecting-columns-from-a-data.table" id="toc-selecting-columns-from-a-data.table" class="nav-link" data-scroll-target="#selecting-columns-from-a-data.table"><span class="toc-section-number">2.1</span>  Selecting columns from a data.table</a></li>
  <li><a href="#selecting-a-single-column" id="toc-selecting-a-single-column" class="nav-link" data-scroll-target="#selecting-a-single-column"><span class="toc-section-number">2.2</span>  Selecting a single column</a></li>
  <li><a href="#selecting-columns-by-name" id="toc-selecting-columns-by-name" class="nav-link" data-scroll-target="#selecting-columns-by-name"><span class="toc-section-number">2.4</span>  Selecting columns by name</a></li>
  <li><a href="#deselecting-specific-columns" id="toc-deselecting-specific-columns" class="nav-link" data-scroll-target="#deselecting-specific-columns"><span class="toc-section-number">2.5</span>  Deselecting specific columns</a></li>
  <li><a href="#computing-on-columns-the-data.table-way" id="toc-computing-on-columns-the-data.table-way" class="nav-link" data-scroll-target="#computing-on-columns-the-data.table-way"><span class="toc-section-number">2.6</span>  Computing on columns the data.table way</a></li>
  <li><a href="#computing-in-j-i" id="toc-computing-in-j-i" class="nav-link" data-scroll-target="#computing-in-j-i"><span class="toc-section-number">2.7</span>  Computing in j (I)</a></li>
  <li><a href="#computing-in-j-ii" id="toc-computing-in-j-ii" class="nav-link" data-scroll-target="#computing-in-j-ii"><span class="toc-section-number">2.8</span>  Computing in j (II)</a></li>
  <li><a href="#advanced-computations-in-j" id="toc-advanced-computations-in-j" class="nav-link" data-scroll-target="#advanced-computations-in-j"><span class="toc-section-number">2.9</span>  Advanced computations in j</a></li>
  <li><a href="#computing-in-j-iii" id="toc-computing-in-j-iii" class="nav-link" data-scroll-target="#computing-in-j-iii"><span class="toc-section-number">2.10</span>  Computing in j (III)</a></li>
  <li><a href="#combining-i-and-j" id="toc-combining-i-and-j" class="nav-link" data-scroll-target="#combining-i-and-j"><span class="toc-section-number">2.11</span>  Combining i and j</a></li>
  </ul></li>
  <li><a href="#groupwise-operations" id="toc-groupwise-operations" class="nav-link" data-scroll-target="#groupwise-operations"><span class="toc-section-number">3</span>  3. Groupwise Operations</a>
  <ul class="collapse">
  <li><a href="#computations-by-groups" id="toc-computations-by-groups" class="nav-link" data-scroll-target="#computations-by-groups"><span class="toc-section-number">3.1</span>  Computations by groups</a></li>
  <li><a href="#computing-stats-by-groups-i" id="toc-computing-stats-by-groups-i" class="nav-link" data-scroll-target="#computing-stats-by-groups-i"><span class="toc-section-number">3.2</span>  Computing stats by groups (I)</a></li>
  <li><a href="#computing-stats-by-groups-ii" id="toc-computing-stats-by-groups-ii" class="nav-link" data-scroll-target="#computing-stats-by-groups-ii"><span class="toc-section-number">3.3</span>  Computing stats by groups (II)</a></li>
  <li><a href="#computing-multiple-stats" id="toc-computing-multiple-stats" class="nav-link" data-scroll-target="#computing-multiple-stats"><span class="toc-section-number">3.4</span>  Computing multiple stats</a></li>
  <li><a href="#chaining-data.table-expressions" id="toc-chaining-data.table-expressions" class="nav-link" data-scroll-target="#chaining-data.table-expressions"><span class="toc-section-number">3.5</span>  Chaining data.table expressions</a></li>
  <li><a href="#ordering-rows" id="toc-ordering-rows" class="nav-link" data-scroll-target="#ordering-rows"><span class="toc-section-number">3.6</span>  Ordering rows</a></li>
  <li><a href="#what-are-the-top-5-destinations" id="toc-what-are-the-top-5-destinations" class="nav-link" data-scroll-target="#what-are-the-top-5-destinations"><span class="toc-section-number">3.7</span>  What are the top 5 destinations?</a></li>
  <li><a href="#what-is-the-most-popular-destination-from-each-start-station" id="toc-what-is-the-most-popular-destination-from-each-start-station" class="nav-link" data-scroll-target="#what-is-the-most-popular-destination-from-each-start-station"><span class="toc-section-number">3.8</span>  What is the most popular destination from each start station?</a></li>
  <li><a href="#combining-i-j-and-by-i" id="toc-combining-i-j-and-by-i" class="nav-link" data-scroll-target="#combining-i-j-and-by-i"><span class="toc-section-number">3.9</span>  Combining i, j, and by (I)</a></li>
  <li><a href="#computations-in-j-using-.sd" id="toc-computations-in-j-using-.sd" class="nav-link" data-scroll-target="#computations-in-j-using-.sd"><span class="toc-section-number">3.10</span>  Computations in j using .SD</a></li>
  <li><a href="#using-.sd-i" id="toc-using-.sd-i" class="nav-link" data-scroll-target="#using-.sd-i"><span class="toc-section-number">3.11</span>  Using .SD (I)</a></li>
  <li><a href="#using-.sd-ii" id="toc-using-.sd-ii" class="nav-link" data-scroll-target="#using-.sd-ii"><span class="toc-section-number">3.12</span>  Using .SD (II)</a></li>
  </ul></li>
  <li><a href="#reference-semantics" id="toc-reference-semantics" class="nav-link" data-scroll-target="#reference-semantics"><span class="toc-section-number">4</span>  4. Reference Semantics</a>
  <ul class="collapse">
  <li><a href="#adding-and-updating-columns-by-reference" id="toc-adding-and-updating-columns-by-reference" class="nav-link" data-scroll-target="#adding-and-updating-columns-by-reference"><span class="toc-section-number">4.1</span>  Adding and updating columns by reference</a></li>
  <li><a href="#adding-a-new-column" id="toc-adding-a-new-column" class="nav-link" data-scroll-target="#adding-a-new-column"><span class="toc-section-number">4.2</span>  Adding a new column</a></li>
  <li><a href="#updating-an-existing-column-i" id="toc-updating-an-existing-column-i" class="nav-link" data-scroll-target="#updating-an-existing-column-i"><span class="toc-section-number">4.3</span>  Updating an existing column (I)</a></li>
  <li><a href="#updating-an-existing-column-ii" id="toc-updating-an-existing-column-ii" class="nav-link" data-scroll-target="#updating-an-existing-column-ii"><span class="toc-section-number">4.4</span>  Updating an existing column (II)</a></li>
  <li><a href="#grouped-aggregations" id="toc-grouped-aggregations" class="nav-link" data-scroll-target="#grouped-aggregations"><span class="toc-section-number">4.5</span>  Grouped aggregations</a></li>
  <li><a href="#adding-columns-by-group" id="toc-adding-columns-by-group" class="nav-link" data-scroll-target="#adding-columns-by-group"><span class="toc-section-number">4.6</span>  Adding columns by group</a></li>
  <li><a href="#updating-columns-by-group" id="toc-updating-columns-by-group" class="nav-link" data-scroll-target="#updating-columns-by-group"><span class="toc-section-number">4.7</span>  Updating columns by group</a></li>
  <li><a href="#advanced-aggregations" id="toc-advanced-aggregations" class="nav-link" data-scroll-target="#advanced-aggregations"><span class="toc-section-number">4.8</span>  Advanced aggregations</a></li>
  <li><a href="#adding-multiple-columns-i" id="toc-adding-multiple-columns-i" class="nav-link" data-scroll-target="#adding-multiple-columns-i"><span class="toc-section-number">4.9</span>  Adding multiple columns (I)</a></li>
  <li><a href="#adding-multiple-columns-ii" id="toc-adding-multiple-columns-ii" class="nav-link" data-scroll-target="#adding-multiple-columns-ii"><span class="toc-section-number">4.10</span>  Adding multiple columns (II)</a></li>
  <li><a href="#combining-i-j-and-by-ii" id="toc-combining-i-j-and-by-ii" class="nav-link" data-scroll-target="#combining-i-j-and-by-ii"><span class="toc-section-number">4.11</span>  Combining i, j, and by (II)</a></li>
  </ul></li>
  <li><a href="#importing-and-exporting-data" id="toc-importing-and-exporting-data" class="nav-link" data-scroll-target="#importing-and-exporting-data"><span class="toc-section-number">5</span>  5. Importing and Exporting Data</a>
  <ul class="collapse">
  <li><a href="#fast-data-reading-with-fread" id="toc-fast-data-reading-with-fread" class="nav-link" data-scroll-target="#fast-data-reading-with-fread"><span class="toc-section-number">5.1</span>  Fast data reading with fread()</a></li>
  <li><a href="#fast-reading-from-disk" id="toc-fast-reading-from-disk" class="nav-link" data-scroll-target="#fast-reading-from-disk"><span class="toc-section-number">5.2</span>  Fast reading from disk</a></li>
  <li><a href="#importing-a-csv-file" id="toc-importing-a-csv-file" class="nav-link" data-scroll-target="#importing-a-csv-file"><span class="toc-section-number">5.3</span>  Importing a CSV file</a></li>
  <li><a href="#importing-selected-columns" id="toc-importing-selected-columns" class="nav-link" data-scroll-target="#importing-selected-columns"><span class="toc-section-number">5.4</span>  Importing selected columns</a></li>
  <li><a href="#importing-selected-rows" id="toc-importing-selected-rows" class="nav-link" data-scroll-target="#importing-selected-rows"><span class="toc-section-number">5.5</span>  Importing selected rows</a></li>
  <li><a href="#advanced-file-reading" id="toc-advanced-file-reading" class="nav-link" data-scroll-target="#advanced-file-reading"><span class="toc-section-number">5.6</span>  Advanced file reading</a></li>
  <li><a href="#reading-large-integers" id="toc-reading-large-integers" class="nav-link" data-scroll-target="#reading-large-integers"><span class="toc-section-number">5.7</span>  Reading large integers</a></li>
  <li><a href="#specifying-column-classes" id="toc-specifying-column-classes" class="nav-link" data-scroll-target="#specifying-column-classes"><span class="toc-section-number">5.8</span>  Specifying column classes</a></li>
  <li><a href="#dealing-with-empty-and-incomplete-lines" id="toc-dealing-with-empty-and-incomplete-lines" class="nav-link" data-scroll-target="#dealing-with-empty-and-incomplete-lines"><span class="toc-section-number">5.9</span>  Dealing with empty and incomplete lines</a></li>
  <li><a href="#dealing-with-missing-values" id="toc-dealing-with-missing-values" class="nav-link" data-scroll-target="#dealing-with-missing-values"><span class="toc-section-number">5.10</span>  Dealing with missing values</a></li>
  <li><a href="#fast-data-writing-with-fwrite" id="toc-fast-data-writing-with-fwrite" class="nav-link" data-scroll-target="#fast-data-writing-with-fwrite"><span class="toc-section-number">5.11</span>  Fast data writing with fwrite()</a></li>
  <li><a href="#writing-files-to-disk" id="toc-writing-files-to-disk" class="nav-link" data-scroll-target="#writing-files-to-disk"><span class="toc-section-number">5.12</span>  Writing files to disk</a></li>
  <li><a href="#writing-date-and-time-columns" id="toc-writing-date-and-time-columns" class="nav-link" data-scroll-target="#writing-date-and-time-columns"><span class="toc-section-number">5.13</span>  Writing date and time columns</a></li>
  <li><a href="#fast-writing-to-disk" id="toc-fast-writing-to-disk" class="nav-link" data-scroll-target="#fast-writing-to-disk"><span class="toc-section-number">5.14</span>  Fast writing to disk</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jwarz/jwarz.github.io/edit/main/content/R/topics/03_data_wrangling/data_manipulation_with_datatable/data_manipulation_with_datatable.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jwarz/jwarz.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Data Manipulation with data.table in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joschka Schwarz </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><strong>Short Description</strong></p>
<p>Master core concepts about data manipulation such as filtering, selecting and calculating groupwise statistics using data.table.</p>
<p><strong>Long Description</strong></p>
<p>The data.table package provides a high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed. This course shows you how to create, subset, and manipulate data.tables. You’ll also learn about the database-inspired features of data.tables, including built-in groupwise operations. The course concludes with fast methods of importing and exporting tabular text data such as CSV files. Upon completion of the course, you will be able to use data.table in R for a more efficient manipulation and analysis process. Throughout the course you’ll explore the San Francisco Bay Area bike share trip dataset from 2014.</p>
<section id="introduction-to-data.table" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 1. Introduction to data.table</h1>
<p>This chapter introduces data.tables as a drop-in replacement for data.frames and shows how to use data.table’s <i>i</i> argument to filter rows.</p>
<section id="welcome-to-the-course" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="welcome-to-the-course"><span class="header-section-number">1.1</span> Welcome to the course!</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Welcome to the course!</strong></p>
<p>Welcome to the new and renewed introductory course on R’s data table package. I am Arun Srinivasan, a data scientist in the Finance industry.</p>
<p><strong>2. What is a data.table?</strong></p>
<p>We hope that you are already familiar with data frames at this point. A data table is also a data frame but does so much more. Like data frames, they are columnar data structures and all columns must be of equal length. So why do you need data tables?</p>
<p><strong>3. Why use data.table?</strong></p>
<p>A data table is a 2-D data structure, the two dimensions being rows and columns. However, most data analysis tasks require performing operations by groups. It is quite common to consider grouping as a virtual third dimension. The data table syntax is quite powerful because it provides quick access to these dimensions in the form of placeholders for operations on rows, columns, and groups. The first argument, ‘i’ allows for filtering of required rows by accepting an expression or simply the required row numbers. If the ‘i’ argument is empty, then no rows are filtered. The second argument, ‘j’ operates on columns. In addition to just selecting columns as in a data frame, it also allows for directly computing on the columns as you will see in the next chapters. The last argument ‘by’ allows you to operate on columns by groups.</p>
<p><strong>4. Why use data.table?</strong></p>
<p>data table is also very fast - many operations are parallelized including filtering, ordering, grouping, file reading, writing etc. Check out this link for up-to-date benchmarks on data table’s performance against other common packages.</p>
<p><strong>5. Why use data.table?</strong></p>
<p>Finally, data table has many additional powerful features including rolling, overlapping and non-equi joins, updating tables by reference, fast reshaping, parallel file reading/writing, primary key based joins, automatic creation of secondary keys for faster filtering and joins etc. We will not cover joins in this course, but they are covered in great detail in the Joining Data in R with data table course here on DataCamp.</p>
<p><strong>6. Creating a data.table</strong></p>
<p>There are at least three ways in which you can create data tables. In this video, we will cover the first two - using the data table and as data table functions. We will cover fread() in the final chapter of this course.</p>
<p><strong>7. Creating a data.table</strong></p>
<p>You can use the data table function to create a data table from scratch the same way you would use the data frame function. All you need to do is pass vectors of the same length to the data table function.</p>
<p><strong>8. Creating a data.table</strong></p>
<p>To convert an existing R object to a data table, you can use the as data table function. As you can see here, we converted the list y to a data table.</p>
<p><strong>9. data.tables and data.frames (I)</strong></p>
<p>As mentioned earlier, a data table is also a data frame and you can confirm that here from the output of class().</p>
<p><strong>10. data.tables and data.frames (II)</strong></p>
<p>And thus you can use all the functions you would use on a data frame on a data table. nrow(), ncol(), and dim(), for example, return the number of rows, columns, and dimensions of a data table, as it would on a data frame.</p>
<p><strong>11. data.tables and data.frames (III)</strong></p>
<p>However, there are a few enhancements. Unlike a data frame, a data table doesn’t automatically convert characters to factors thus preventing bugs by avoiding unexpected behavior.</p>
<p><strong>12. data.tables and data.frames (IV)</strong></p>
<p>Also, a data table never sets or uses the row names. Finally, a minor but useful feature is that when you print a data table, a colon (:) is added after the row number to visually separate it from the first column.</p>
<p><strong>13. Let’s practice!</strong></p>
<p>Now it’s your turn to create data tables!</p>
</section>
<section id="data.table-pop-quiz" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="data.table-pop-quiz"><span class="header-section-number">1.2</span> data.table pop quiz</h2>
<blockquote class="blockquote">
<h2 id="question" data-number="1.3" class="anchored"><span class="header-section-number">1.3</span> <em>Question</em></h2>
<p>Which of the following statements are true about <code>data.table</code>s?<br> <br> 1. A data.table is a data.frame. It inherits and builds on top of it.<br> 2. data.tables can have columns of different lengths.<br> 3. Columns of data.tables cannot be of data type list.<br> 4. data.tables never use or need row names.<br> <br> ⬜ 1 and 3<br> ✅ 1 and 4<br> ⬜ 2 and 3<br> ⬜ 2 and 4<br></p>
</blockquote>
<p>Correct! These are two of the several advantages of using <code>data.table</code>s in R!</p>
</section>
<section id="creating-a-data.table" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="creating-a-data.table"><span class="header-section-number">1.4</span> Creating a data.table</h2>
<p>Just like how the <code>data.frame()</code> function can be used to create a data frame, you can create a <code>data.table</code> using the <code>data.table()</code> function. In this exercise, you will create the following <code>data.table</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>X</span>
<span id="cb1-2"><a href="#cb1-2"></a>   id value</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="dv">1</span><span class="sc">:</span>  a   <span class="fl">0.5</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="dv">2</span><span class="sc">:</span>  b   <span class="fl">1.0</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="dv">3</span><span class="sc">:</span>  c   <span class="fl">1.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the <code>data.table</code> package.</li>
<li>Create the data.table <code>X</code> shown above. Note that the column <code>id</code> is of type <code>character</code> and <code>value</code> is of type <code>numeric</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Load data.table</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Create the data.table X</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>X <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">value =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>))</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># View X</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well done! Check out the other arguments of <code>data.table()</code> to gain a better understanding of how <code>data.table</code>s work.</p>
</section>
<section id="introducing-bikes-data" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="introducing-bikes-data"><span class="header-section-number">1.5</span> Introducing bikes data</h2>
<p>Throughout the rest of the course, you will use the <code>batrips</code> dataset from the <a href="https://www.rdocumentation.org/packages/bikeshare14"><code>bikeshare14</code></a> package, which contains anonymous bike share data on bicycle trips around San Francisco in 2014. Type <code>batrips</code> in the console and hit enter. Note how <code>data.table</code> automatically limits printing to just the top 5 and bottom 5 rows of the dataset along with column names and row numbers.</p>
<p>Recall that since a <code>data.table</code> is a <code>data.frame</code>, you can use base R functions like <code>ncol()</code>, <code>nrow()</code>, <code>head()</code>, <code>tail()</code> and <code>str()</code> for exploring <code>data.table</code>s.</p>
<p>Unless otherwise mentioned, assume that both <code>data.table</code> and <code>batrips</code> are loaded in your exercises.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Get the number of columns in <code>batrips</code> and store it in <code>col_number</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Load package for the dataset</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(bikeshare14)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">data</span>(<span class="st">"batrips"</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>batrips <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(batrips)</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co"># Get number of columns in batrips</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>col_number <span class="ot">&lt;-</span> <span class="fu">ncol</span>(batrips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Print the first eight rows of <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Print the first 8 rows</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">head</span>(batrips, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Print the last eight rows using <code>tail()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Print the last 8 rows</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">tail</span>(batrips, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Print the structure of <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Print the structure of batrips</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">str</span>(batrips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Amazing job! Make sure you are familiar with this dataset. We will be using this throughout the course!</p>
</section>
<section id="filtering-rows-in-a-data.table" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="filtering-rows-in-a-data.table"><span class="header-section-number">1.6</span> Filtering rows in a data.table</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Filtering rows in a data.table</strong></p>
<p>In this lesson, we will look at how to subset or filter rows from a data table using row numbers and logical expressions.</p>
<p><strong>2. General form of data.table syntax</strong></p>
<p>The general form of a data table is DT square brackets, i, comma, j, comma, by. It is read out loud as, “Take DT, filter rows in”i”, then compute “j” grouped by “by”. We will look at the first argument “i” here. The functionality is similar to data frames but more convenient and enhanced.</p>
<p><strong>3. Row numbers</strong></p>
<p>Rows can be filtered using row numbers as you would do in a data frame, except the first argument is always interpreted as a row operation irrespective of whether or not you specify a comma. For example, to subset the third and fourth rows, you can use the code as shown here. If you want to exclude a set of rows, you can use the negative sign or the exclamation mark as shown here.</p>
<p><strong>4. Special symbol .N</strong></p>
<p>data table contains a few handy special symbols (or variables) that make many operations efficient. One such symbol is dot N which is an integer vector of length one. When used in the “i” argument, it returns the total number of rows in the data table. To get the last row, for example, you can simply do batrips square brackets dot N. Similarly, to get all but the last 10 rows, you can specify the “i” argument as 1 colon dot N minus 10. Since dot N is the total numbers of rows, you are essentially creating a continuous sequence of integers from 1 to the required row number.</p>
<p><strong>5. Logical expressions (I)</strong></p>
<p>You can also construct expressions resulting in a logical vector in the “i” argument. This returns only those rows that evaluate to TRUE. However, note how we refer to the columns in data table as if they are variables. This is because within the scope of data table, that is, within the two square brackets, columns are seen as if they are variables. This avoids unnecessary repetition of the dollar sign when referring to column names while constructing expressions and therefore avoids subtle and hard to track bugs. Also, the resulting expression is much cleaner and easier to read.</p>
<p><strong>6. Logical expressions (II)</strong></p>
<p>Here’s another example. In this example, we filter for rows where start_terminal is 58 and end_terminal is not 65. Again, note the concise and clear syntax of data table.</p>
<p><strong>7. Logical expressions (III)</strong></p>
<p>As mentioned in the first video, data table is fast! It automatically creates an index (or key) of the columns used to subset the data so that any subsequent operations on that column are incredibly faster. You can have a look at all such indices using the indices() function. Let’s look at an example. First, we create a data table dt with 10 million rows. When we call indices() on dt, we can see that the result is NULL. Thus, at this point, the data table has no indices. When we perform a subset operation for the first time, we can see that it takes about 0-point-2 seconds. Now when we run indices of dt again, notice that x is an index. So when we perform the same operation again, it takes only about 0-point-002 seconds.</p>
<p><strong>8. Let’s practice!</strong></p>
<p>It’s time for you to practice subsetting data tables.</p>
</section>
<section id="filtering-rows-using-positive-integers" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="filtering-rows-using-positive-integers"><span class="header-section-number">1.7</span> Filtering rows using positive integers</h2>
<p>You can filter the required rows from a <code>data.table</code> by providing the row indices to its first argument (<code>i</code>), just like when working with a <code>data.frame</code>. However, unlike a <code>data.frame</code>, you don’t need to add a comma (<code>,</code>) when filtering rows.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter the third row from <code>batrips</code>, storing the result in <code>row_3</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Filter third row</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>row_3 <span class="ot">&lt;-</span> batrips[<span class="dv">3</span>]</span>
<span id="cb7-3"><a href="#cb7-3"></a>row_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Filter rows 10 through 20 (including both) from <code>batrips</code>, storing the result in <code>rows_10_20</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Filter rows 10 through 20</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>rows_10_20 <span class="ot">&lt;-</span> batrips[<span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb8-3"><a href="#cb8-3"></a>rows_10_20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Filter the 1st, 6th and 10th rows, in that order, from <code>batrips</code>. Store the result in <code>rows_1_6_10</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Filter the 1st, 6th and 10th rows</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>rows_1_6_10 <span class="ot">&lt;-</span> batrips[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">10</span>)]</span>
<span id="cb9-3"><a href="#cb9-3"></a>rows_1_6_10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nicely done! See how easy it is to filter rows using positive integers?</p>
</section>
<section id="filtering-rows-using-negative-integers" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="filtering-rows-using-negative-integers"><span class="header-section-number">1.8</span> Filtering rows using negative integers</h2>
<p>Sometimes, instead of selecting all of the rows you want individually, it makes sense to deselect the rows you do not want to include. Recall that this can be done using either the <code>!</code> or the <code>-</code> operators.</p>
<p>For example, <code>dt[-(1:5)]</code> returns all rows <em>except</em> the first five.</p>
<p>Note: <code>dt[-(1:5)]</code> is equivalent to <code>dt[!(1:5)]</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use negative indexing to exclude the first two rows in <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Select all rows except the first two</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>not_first_two <span class="ot">&lt;-</span> batrips[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]</span>
<span id="cb10-3"><a href="#cb10-3"></a>not_first_two</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use negative indexing to exclude rows 1 through 5 and 10 through 15 in <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Select all rows except 1 through 5 and 10 through 15</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>exclude_some <span class="ot">&lt;-</span> batrips[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)]</span>
<span id="cb11-3"><a href="#cb11-3"></a>exclude_some</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Use negative indexing to exclude the first and last rows in <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Select all rows except the first and last</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>not_first_last <span class="ot">&lt;-</span> batrips[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, .N)] <span class="co"># Or batrips[-c(1, nrow(batrips))]</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>not_first_last</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wohoo! You now know how to select and drop rows using positive and negative integers.</p>
</section>
<section id="filtering-rows-using-logical-vectors" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="filtering-rows-using-logical-vectors"><span class="header-section-number">1.9</span> Filtering rows using logical vectors</h2>
<p>In this exercise, you’ll use expressions that evaluate to a <em>logical</em> vector to filter rows in a <code>data.table</code>. All rows that evaluate to <code>TRUE</code> will be returned.</p>
<p>Note that you can refer to column names directly, without the need for the <code>$</code> operator.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter all the rows where <code>start_station</code> is <code>"MLK Library"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Filter all rows where start_station is "MLK Library"</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>trips_mlk <span class="ot">&lt;-</span> batrips[start_station <span class="sc">==</span> <span class="st">"MLK Library"</span>]</span>
<span id="cb13-3"><a href="#cb13-3"></a>trips_mlk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Filter all rows where <code>start_station</code> is <code>"MLK Library"</code> <em>and</em> <code>duration</code> is greater than 1600.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Filter all rows where start_station is "MLK Library" AND duration &gt; 1600</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>trips_mlk_1600 <span class="ot">&lt;-</span> batrips[start_station <span class="sc">==</span> <span class="st">"MLK Library"</span> <span class="sc">&amp;</span> duration <span class="sc">&gt;</span> <span class="dv">1600</span>]</span>
<span id="cb14-3"><a href="#cb14-3"></a>trips_mlk_1600</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Filter all rows where the column <code>subscription_type</code> is not <code>"Subscriber"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Filter all rows where `subscription_type` is not `"Subscriber"` </span></span>
<span id="cb15-2"><a href="#cb15-2"></a>customers <span class="ot">&lt;-</span> batrips[subscription_type <span class="sc">!=</span> <span class="st">"Subscriber"</span>]</span>
<span id="cb15-3"><a href="#cb15-3"></a>customers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Filter all rows where <code>start_station</code> is <code>"Ryland Park"</code> and <code>subscription_type</code> is not <code>"Customer"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Filter all rows where start_station is "Ryland Park" AND subscription_type is not "Customer"</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>ryland_park_subscribers <span class="ot">&lt;-</span> batrips[start_station <span class="sc">==</span> <span class="st">"Ryland Park"</span> <span class="sc">&amp;</span> subscription_type <span class="sc">!=</span> <span class="st">"Customer"</span>]</span>
<span id="cb16-3"><a href="#cb16-3"></a>ryland_park_subscribers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are phenomenal! Filtering rows using boolean expressions is extremely common and you aced it.</p>
</section>
<section id="helpers-for-filtering" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="helpers-for-filtering"><span class="header-section-number">1.10</span> Helpers for filtering</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Helpers for filtering</strong></p>
<p>In this lesson, we will look at three functions that make subsetting operations far more convenient in data tables.</p>
<p><strong>2. %like%</strong></p>
<p>A commonly occurring subsetting operation is to look for all rows that match a pattern in a column. data table provides a convenience function percent like percent that is concise and also makes the actual operation easier to understand. In this example, we are looking for all the rows where start_station starts with the string San Francisco. The meta-character caret (^) specifies that you are looking for a pattern at the beginning of a string.</p>
<p><strong>3. %between%</strong></p>
<p>Percent between percent is a helper function that works on numeric columns. It searches for all values in the closed interval val1 and val2, that is, it finds all values that are greater than or equal to val1 and less than or equal to val2. It is also internally optimized to run in parallel wherever possible. Here we subset all rows where duration is between 2000 and 3000.</p>
<p><strong>4. %chin%</strong></p>
<p>Percent chin percent is another helper function which is a much more efficient version of percent in percent but only for character vectors. You can use it to look for specific strings in a vector. For example, here we subset all rows where start_station is either “Japantown”, “Mezes Park”, or “MLK Library”.</p>
<p><strong>5. Let’s practice!</strong></p>
<p>Go ahead and practice using these helper functions.</p>
</section>
<section id="i-like-data.tables" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="i-like-data.tables"><span class="header-section-number">1.11</span> I %like% data.tables</h2>
<p><code>%like%</code> is a very useful function to filter rows from <code>data.table</code>s that match a pattern, as opposed to <em>exact</em> matches as seen in the previous exercise. It can be used independently on a vector as well, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"aaba"</span>, <span class="st">"aaba"</span>, <span class="st">"baca"</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co"># Search for "aa" anywhere in the string</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>x <span class="sc">%like%</span> <span class="st">"aa"</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>[<span class="dv">1</span>]  <span class="cn">TRUE</span>  <span class="cn">TRUE</span> <span class="cn">FALSE</span></span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co"># Search for "ba" at the end of a string</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>x <span class="sc">%like%</span> <span class="st">"ba$"</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>[<span class="dv">1</span>]  <span class="cn">TRUE</span>  <span class="cn">TRUE</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The metacharacter <code>$</code> indicates that you are searching for the string that ends with a specific pattern.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>%like%</code> to filter all rows where <code>end_station</code> contains the text <code>"Market"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Filter all rows where end_station contains "Market"</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>any_markets <span class="ot">&lt;-</span> batrips[end_station <span class="sc">%like%</span> <span class="st">"Market"</span>]</span>
<span id="cb18-3"><a href="#cb18-3"></a>any_markets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use <code>%like%</code> to filter all rows where <code>end_station</code> <em>ends</em> the text <code>"Market"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Filter all rows where end_station ends with "Market"</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>end_markets <span class="ot">&lt;-</span> batrips[end_station <span class="sc">%like%</span> <span class="st">"Market$"</span>]</span>
<span id="cb19-3"><a href="#cb19-3"></a>end_markets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Excellent! By the way, there are many more things to %like% about data tables.</p>
</section>
<section id="filtering-with-in" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="filtering-with-in"><span class="header-section-number">1.12</span> Filtering with %in%</h2>
<p><code>%in%</code> allows selecting rows that exactly matches one or more values, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"a"</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a>[<span class="dv">1</span>]  <span class="cn">TRUE</span> <span class="cn">FALSE</span> <span class="cn">FALSE</span>  <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Filter all rows where <code>trip_id</code> is equal to 588841, 139560, or 139562.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Filter all rows where trip_id is 588841, 139560, or 139562</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>filter_trip_ids <span class="ot">&lt;-</span> batrips[trip_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">588841</span>, <span class="dv">139560</span>, <span class="dv">139562</span>)]</span>
<span id="cb21-3"><a href="#cb21-3"></a>filter_trip_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are tremendous! Although you can <code>%in%</code> it to filter character columns as well, <code>data.table</code> provides a much faster version of <code>%in%</code> for characters which you will see in the next exercise.</p>
</section>
<section id="filtering-with-between-and-chin" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="filtering-with-between-and-chin"><span class="header-section-number">1.13</span> Filtering with %between% and %chin%</h2>
<p>Two other functions that can come in handy when filtering rows are <code>%between%</code> and <code>%chin%</code>.</p>
<ul>
<li><code>%between%</code> works only on numeric columns and can be used to filter values in the closed interval [val1, val2].</li>
<li><code>%chin%</code> works only on character columns and is an efficient version of <code>%in%</code>. You can use it to look for specific strings in a vector.</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>%between%</code> to filter all rows where <code>duration</code> is between [5000, 6000].</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Filter all rows where duration is between [5000, 6000]</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>duration_5k_6k <span class="ot">&lt;-</span> batrips[duration <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">6000</span>)]</span>
<span id="cb22-3"><a href="#cb22-3"></a>duration_5k_6k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use <code>%chin%</code> to filter all rows where <code>start_station</code> is either <code>"San Francisco City Hall"</code> or <code>"Embarcadero at Sansome"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Filter all rows with specific start stations</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>two_stations <span class="ot">&lt;-</span> batrips[start_station <span class="sc">%chin%</span> <span class="fu">c</span>(<span class="st">"San Francisco City Hall"</span>, <span class="st">"Embarcadero at Sansome"</span>)]</span>
<span id="cb23-3"><a href="#cb23-3"></a>two_stations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This marks the end of chapter 1! Now that you know how to filter rows, in the next chapter, you will see how to select and compute on columns in <code>data.table</code>s.</p>
</section>
</section>
<section id="selecting-and-computing-on-columns" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 2. Selecting and Computing on Columns</h1>
<p>Just as the <i>i</i> argument lets you filter rows, the <i>j</i> argument of data.table lets you select columns and also perform computations. The syntax is far more convenient and flexible when compared to data.frames.</p>
<section id="selecting-columns-from-a-data.table" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="selecting-columns-from-a-data.table"><span class="header-section-number">2.1</span> Selecting columns from a data.table</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Selecting columns from a data.table</strong></p>
<p><strong>2. General form of data.table syntax (Recap)</strong></p>
<p>Here’s the general form of the data table syntax, shown again for convenience. It is read out loud as “Take DT, filter rows in”i”, then compute “j” grouped by “by”. In this chapter, you will work with the “j” argument which is used for selecting and computing on columns.data table provides several convenient ways for both selecting and directly computing on columns which makes it easier to write and perform complex calculations with much cleaner code. Additionally, you can also use the data frame syntax for selecting columns from a data table.</p>
<p><strong>3. Using column names to select columns</strong></p>
<p>Similar to data frames, you can pass a character vector of column names as the second argument to data table to select the relevant columns.</p>
<p><strong>4. Using column names to select columns</strong></p>
<p>One thing to note here is the difference in result when selecting a single column from a data frame vs a data table. When you select a single column from a data frame, the result is no longer a data frame, but a vector. Whereas when you select a single column from a data table, the result is still a data table. This consistency in the output avoids accidental errors in code.</p>
<p><strong>5. Using column numbers to select columns</strong></p>
<p>You can also select columns using column numbers. Here we select the second and fourth columns in batrips. However, we do not recommend this approach except when having a quick look at the data interactively. Using column numbers is considered bad practice. A typical project consists of one or more packages with lots of R code that is constantly updated and/or improved, and also typically by multiple contributors. An inadvertent change to the original column structure can lead to incorrect results and bugs.Hence, you should always use column names wherever possible.</p>
<p><strong>6. Deselecting columns with character vectors</strong></p>
<p>You can use a negative sign prefix with a character vector to exclude a set of columns from your result. You can also use the not-operator to obtain the same result.</p>
<p><strong>7. Selecting columns the data.table way</strong></p>
<p>So far you have selected columns using the data frame way. One limitation of this approach is that it only allows you to select columns. However, in order to compute on columns and perform advanced data manipulations, you will have to tweak the “j” argument using the data table approach. Recall how you could filter rows in “i” by referring to columns directly as if they are variables? You can do the same in “j”. Since we usually need to select more than one column, “j” accepts a list of columns. For example, you can select “trip_id” and “duration” columns as shown here. Notice that there are no quotes around column names. Also note that since “j” accepts a list, we can also rename columns while selecting, e.g., “duration” column is renamed to “dur”.</p>
<p><strong>8. Selecting columns the data.table way</strong></p>
<p>If you want to select only one column, you can choose to return the result as a 1-column data table or a vector. Wrapping the column name within “list()” always returns a data table. If you provide just a single column name in “j”, it will return a vector.</p>
<p><strong>9. Selecting columns the data.table way</strong></p>
<p>Since we like to write concise, convenient and clear code in data table, we created dot parentheses as an alias for “list()”. They both behave in exactly the same way, but the dot parentheses results in less typing and helps you focus on the actual columns being selected.</p>
<p><strong>10. Let’s practice!</strong></p>
<p>Time for you to select columns from a data table!</p>
</section>
<section id="selecting-a-single-column" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="selecting-a-single-column"><span class="header-section-number">2.2</span> Selecting a single column</h2>
<blockquote class="blockquote">
<h2 id="question-1" data-number="2.3" class="anchored"><span class="header-section-number">2.3</span> <em>Question</em></h2>
<p>Which of the following options <em>does not return</em> a <code>data.table</code>? (<em>Note: <code>batrips</code> is a <code>data.table</code>.</em>)<br> <br> ⬜ <code>batrips[, "duration"]</code><br> ⬜ <code>batrips[, .(duration)]</code><br> ⬜ <code>batrips[, list(duration)]</code><br> ✅ <code>batrips[, duration]</code><br></p>
</blockquote>
<p>Well done! If you don’t wrap the column name either in quotes or inside <code>list()</code>, the result is a vector.</p>
</section>
<section id="selecting-columns-by-name" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="selecting-columns-by-name"><span class="header-section-number">2.4</span> Selecting columns by name</h2>
<p><code>DT[, c("col1", "col2")]</code> returns a <code>data.table</code> with two columns, just like a <code>data.frame</code>.</p>
<p>Alternatively, you can also select columns by passing a <code>list</code> with each element referring to the column name as if it were a variable, i.e., <code>DT[, .(col1, col2)]</code>. Note the absence of quotes, i.e., <code>""</code> around column names here.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use a character vector to select the <code>bike_id</code> and <code>trip_id</code> columns (in that order) from <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Select bike_id and trip_id using a character vector</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>df_way <span class="ot">&lt;-</span> batrips[, <span class="fu">c</span>(<span class="st">"bike_id"</span>, <span class="st">"trip_id"</span>)]</span>
<span id="cb24-3"><a href="#cb24-3"></a>df_way</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li><em>Without</em> using a character vector, select the <code>start_station</code> and <code>end_station</code> columns (in that order) from <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Select start_station and end_station cols without a character vector</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>dt_way <span class="ot">&lt;-</span> batrips[, .(start_station, end_station)]</span>
<span id="cb25-3"><a href="#cb25-3"></a>dt_way</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nice. As you saw, selecting columns from a <code>data.table</code> is <em>easy</em>!</p>
</section>
<section id="deselecting-specific-columns" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="deselecting-specific-columns"><span class="header-section-number">2.5</span> Deselecting specific columns</h2>
<p>You can also drop or deselect columns by prepending the character vector of column names with the <code>-</code> or <code>!</code> operators. For e.g., <code>dt[, -c("col1", "col2")]</code> or <code>dt[, !c("col1", "col2")]</code> would both return all columns <em>except</em> <code>col1</code> and <code>col2</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Deselect the columns <code>start_terminal</code> and <code>end_terminal</code> from <code>batrips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Deselect start_terminal and end_terminal columns</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>drop_terminal_cols <span class="ot">&lt;-</span> batrips[, <span class="sc">!</span><span class="fu">c</span>(<span class="st">"start_terminal"</span>, <span class="st">"end_terminal"</span>)]</span>
<span id="cb26-3"><a href="#cb26-3"></a>drop_terminal_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are an expert in selecting and dropping columns! Now it’s time to perform computations in <code>j</code>.</p>
</section>
<section id="computing-on-columns-the-data.table-way" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="computing-on-columns-the-data.table-way"><span class="header-section-number">2.6</span> Computing on columns the data.table way</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Computing on columns the data.table way</strong></p>
<p>In this lesson, we will see the advantages of being able to use column names as variables in “j”, which makes data analysis operations intuitive and succinct.</p>
<p><strong>2. Computing on columns</strong></p>
<p>The reason “j” is extended to allow column names to be seen as variables is so that we can perform computations on columns directly in “j”.For example, if you want to compute the mean of “duration” column, all you need to do is to write “mean(duration)” in “j”. mean() returns a single value. If you recall from the last lesson, since “j” is not wrapped inside “list()”, the result is a vector.Now compare this to how you would do this in the data frame way. You will first select the column and then pass the result to the mean() function as an argument. The data table way of computing directly on columns allows for clear, convenient and concise code and can be easily extended to calculate statistics on multiple columns, which you will see in the next video.</p>
<p><strong>3. Computing on rows and columns</strong></p>
<p>You filtered rows using the “i” argument in the last chapter. Let’s say you would like to compute the mean duration for those trips where start station is “Japantown”. You can now do this combining the “i” and “j” arguments as shown here. First, you filter rows where start_station equals “Japantown” in “i” and then compute the mean duration in “j”.This is possible because “j” is computed on the rows returned by the filtering operation.</p>
<p><strong>4. Special symbol .N in j</strong></p>
<p>Remember the special symbol dot N you used in the “i” argument that holds the number of rows in a data table in the last chapter? You can use it in “j” too. Suppose you want to calculate the number of trips that started from Japantown. You can do this by filtering rows where start_station == “Japantown” and then specifying dot N in the “j” argument. Since “j” is calculated on the result of “i”, you get the total number of rows in the filtered data table. In other words, it returns the total trips that were made from Japantown. To get an idea of how convenient and efficient the data table way is, let’s compare this to the data frame equivalent. This code shows the most common way of performing the same operation. In this approach, you first return all the columns for the filtered data only to compute the total number of rows. Imagine if your original data was 50GB! The filtering operation alone would take incredible amount of memory and be very slow.In the data table version, no column is actually selected. The expression in “i” helps identify the rows to be extracted. Looking at “j” it is clear that no columns are required but only the total number of rows filtered and therefore it is very efficient both in terms of memory and run time.</p>
<p><strong>5. Let’s practice!</strong></p>
<p>Go ahead and practice computing in “j”!</p>
</section>
<section id="computing-in-j-i" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="computing-in-j-i"><span class="header-section-number">2.7</span> Computing in j (I)</h2>
<p>Since columns can be treated as variables inside <code>data.table</code>’s square brackets (<code>[ ]</code>), you can compute on the columns directly in <code>j</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using the <code>j</code> argument, find the median <code>duration</code> (the result should be a vector of length 1).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Calculate median duration using the j argument</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>median_duration <span class="ot">&lt;-</span> batrips[, <span class="fu">median</span>(duration)]</span>
<span id="cb27-3"><a href="#cb27-3"></a>median_duration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Now, find the median <code>duration</code> where <code>end_station</code> is <code>"Market at 10th"</code> for all subscribers.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Get median duration after filtering</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>median_duration_filter <span class="ot">&lt;-</span> batrips[end_station <span class="sc">==</span> <span class="st">"Market at 10th"</span> <span class="sc">&amp;</span> subscription_type <span class="sc">==</span> <span class="st">"Subscriber"</span>, <span class="fu">median</span>(duration)]</span>
<span id="cb28-3"><a href="#cb28-3"></a>median_duration_filter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are fabulous! Remember that <code>data.table</code> first filters the rows in <code>i</code> and then computes in <code>j</code>.</p>
</section>
<section id="computing-in-j-ii" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="computing-in-j-ii"><span class="header-section-number">2.8</span> Computing in j (II)</h2>
<p>In the last exercise, you performed computations in <code>j</code> which returned only a single value, a vector of length one. However, you often perform computations which return more than one value. The good news is that the syntax for these calculations is still the same!</p>
<p>You will use the <a href="https://www.rdocumentation.org/packages/base/topics/difftime"><code>difftime()</code></a> function in this exercise to calculate the difference in minutes between the trips. <code>difftime()</code> needs two required arguments, <code>time1</code> and <code>time2</code> to calculate the difference (<code>time1 - time2</code>). To calculate the difference in minutes, set the <code>units</code> argument to <code>"min"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>date1 <span class="ot">&lt;-</span> <span class="st">"2018-12-20 11:30:00 EST"</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>date2 <span class="ot">&lt;-</span> <span class="st">"2018-12-20 11:20:00 EST"</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="fu">difftime</span>(date1, date2, <span class="at">units =</span> <span class="st">"min"</span>)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a>Time difference of <span class="dv">10</span> mins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the difference in minutes between <code>end_date</code> and <code>start_date</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Compute duration of all trips</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>trip_duration <span class="ot">&lt;-</span> batrips[, <span class="fu">difftime</span>(end_date, start_date, <span class="at">units =</span> <span class="st">"min"</span>)]</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="fu">head</span>(trip_duration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isn’t this amazing? You can perform any computations you want inside <code>data.table</code>’s square brackets.</p>
</section>
<section id="advanced-computations-in-j" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="advanced-computations-in-j"><span class="header-section-number">2.9</span> Advanced computations in j</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Advanced computations in j</strong></p>
<p>In this lesson, you will see how you can perform multiple computations in “j”.</p>
<p><strong>2. Compute in j and return a data.table</strong></p>
<p>Remember you can select and rename multiple columns using dot parentheses? You can use this approach to perform computations too. As an example, here we compute the mean and median of duration column. You can perform any computation you would like on any number of columns using this approach within the dot parentheses.</p>
<p><strong>3. Question</strong></p>
<p>If you are curious, try and figure out how you would perform this computation using the data frame way. How do you find that approach? Is your code straightforward and clear?</p>
<p><strong>4. Combining with i</strong></p>
<p>Even when you have multiple computations or selections, you can combine it with “i” the same way as before. data table will restrict the computation or selection to only those rows filtered in “i”. Remember, “j” operates on the rows after “i” is processed.In order to compute the mean and median of trips that start from “Japantown”, you can simply provide the expression to filter those rows in “i” and then compute the mean and median of duration in “j”, as shown here.</p>
<p><strong>5. Question</strong></p>
<p>Once again, think about how you’d go about accomplishing this task with a data frame!Being able to manipulate on the rows and columns within the square brackets, makes the code much more clearer, straightforward and efficient. It also results in much less typing.</p>
<p><strong>6. Let’s practice!</strong></p>
<p>It’s your turn to practice multiple computations the data table way.</p>
</section>
<section id="computing-in-j-iii" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="computing-in-j-iii"><span class="header-section-number">2.10</span> Computing in j (III)</h2>
<p>In the previous exercise, you were able to pass expressions in <code>j</code> that returned a vector. Recall that if you want to return a <code>data.table</code> instead, wrap the expression with <code>list()</code> (or it’s alias, <code>.()</code>). This lets you:</p>
<ul>
<li>Rename the column result</li>
<li>Compute more than one expression on a column</li>
<li>Compute on more than one column</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the average <code>duration</code> as a one-column <code>data.table</code> with the column name <code>mean_durn</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Calculate the average duration as mean_durn</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>mean_duration <span class="ot">&lt;-</span> batrips[, .(<span class="at">mean_durn =</span> <span class="fu">mean</span>(duration))]</span>
<span id="cb31-3"><a href="#cb31-3"></a>mean_duration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calculate the minimum and maximum <code>duration</code> (don’t rename the columns).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Get the min and max duration values</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>min_max_duration <span class="ot">&lt;-</span> batrips[, .(<span class="fu">min</span>(duration), <span class="fu">max</span>(duration))]</span>
<span id="cb32-3"><a href="#cb32-3"></a>min_max_duration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Find the average duration and the date of the last ride (using the <code>end_date</code> column). Name these columns <code>mean_duration</code> and <code>last_ride</code>, respectively.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Calculate the average duration and the date of the last ride</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>other_stats <span class="ot">&lt;-</span> batrips[, .(<span class="at">mean_duration =</span> <span class="fu">mean</span>(duration), </span>
<span id="cb33-3"><a href="#cb33-3"></a>                           <span class="at">last_ride =</span> <span class="fu">max</span>(end_date))]</span>
<span id="cb33-4"><a href="#cb33-4"></a>other_stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You now know that calculating multiple stats is as easy as calculating one!</p>
</section>
<section id="combining-i-and-j" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="combining-i-and-j"><span class="header-section-number">2.11</span> Combining i and j</h2>
<p>As you saw in an earlier exercise when you combine <code>i</code> and <code>j</code>, <code>data.table</code> first filters the rows in <code>i</code> and then applies the computation in <code>j</code>. This applies when calculating multiple stats as well.</p>
<p>Additionally, you can also specify <code>plot()</code>, <code>hist()</code> or any other plotting functions in the <code>j</code> argument.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the minimum and maximum <code>duration</code> for all trips where the <code>start_station</code> is <code>"Townsend at 7th"</code> and the <code>duration</code> is less than 500. Rename these columns to <code>min_dur</code> and <code>max_dur</code>, respectively.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>duration_stats <span class="ot">&lt;-</span> batrips[start_station <span class="sc">==</span> <span class="st">"Townsend at 7th"</span> <span class="sc">&amp;</span> duration <span class="sc">&lt;</span> <span class="dv">500</span>, </span>
<span id="cb34-2"><a href="#cb34-2"></a>                          .(<span class="at">min_dur =</span> <span class="fu">min</span>(duration), </span>
<span id="cb34-3"><a href="#cb34-3"></a>                            <span class="at">max_dur =</span> <span class="fu">max</span>(duration))]</span>
<span id="cb34-4"><a href="#cb34-4"></a>duration_stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Now for the same subset of data, plot a histogram of <code>duration</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Plot the histogram of duration based on conditions</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>batrips[start_station <span class="sc">==</span> <span class="st">"Townsend at 7th"</span> <span class="sc">&amp;</span> duration <span class="sc">&lt;</span> <span class="dv">500</span>, <span class="fu">hist</span>(duration)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are doing great! You can filter rows, select columns, and perform computations with columns. What’s next? Computations <em>by groups</em>!</p>
</section>
</section>
<section id="groupwise-operations" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 3. Groupwise Operations</h1>
<p>This chapter introduces data.table’s <i>by</i> argument that lets you perform computations <i>by groups</i>. By the end of this chapter, you will master the concise <b>DT[i, j, by]</b> syntax of data.table.</p>
<section id="computations-by-groups" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="computations-by-groups"><span class="header-section-number">3.1</span> Computations by groups</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Computations by groups</strong></p>
<p>In this lesson, you will put together all the things you have seen so far to perform computations by group. You will now fully realize the potential of data table’s [i, j, by] syntax.</p>
<p><strong>2. The by argument</strong></p>
<p>Most data wrangling tasks require doing the same computation on several groups of data. For example, how would you calculate the total number of trips for each start_station? This can be done using the “by” argument data table provides. Specifying by equals start_station groups the data by that column. The expression in “j”, here dot-N, is computed for each group. Dot-N is the special symbol that contains the total number of rows, if you recall. When performing a grouping operation, it contains the number of rows for each group.Note the columns in the resulting data table. Firstly, the column corresponding to the total rows computed using the special symbol dot-N is automatically named capital “N”, for convenience. Additionally, the column used in “by” is retained in the result. Also note that the column by which you group your data is always returned as the first column.</p>
<p><strong>3. The by argument</strong></p>
<p>In the previous example, we provided a character vector to the “by” argument, but it also accepts a list of variables/expressions as shown here.Once again, dot parenthesis and list parenthesis are both identical. Dot parenthesis is used here for convenience.By equals start_station from the previous slide and by equals dot parenthesis start_station are just different ways to obtain the same result.</p>
<p><strong>4. The by argument</strong></p>
<p>However, just as we saw in the earlier chapter, dot parenthesis has its advantages. It allows for naming the columns in the resulting data table on the fly. As shown in here, by equals dot parenthesis start equals start_station results in the grouping column being renamed to “start”. Similarly, dot parenthesis no_trips equals dot N results in the column being named as “no_trips”. If no name was provided, it would have been automatically renamed to “N” as shown in the last example.</p>
<p><strong>5. Expressions in by</strong></p>
<p>You should be quite familiar now that dot parenthesis notation, in addition to naming the columns on the fly, also allows for computations to be performed on the columns on the fly.Suppose you’d like to get the total trips from each start_station, but additionally, for every month, how would you go about it? The month column does not exist in batrips. However, it can be extracted from the start_date column using the month() function available in the data table package. Since dot parenthesis allows for expressions to be provided directly within, by equals dot parenthesis start_station comma mon equals month(start_date) groups by the required columns. In addition, we also renamed the column in the result to “mon”.Since there was no name provided to “j” expression, it is automatically named “N”. With a single line of code, we’ve computed the total trips for each start station for each month.If you’re curious, think about how you would get the total trips for every start station, but only for the month of March.</p>
<p><strong>6. Let’s practice!</strong></p>
<p>Now it’s time for you to use the “by” argument.</p>
</section>
<section id="computing-stats-by-groups-i" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="computing-stats-by-groups-i"><span class="header-section-number">3.2</span> Computing stats by groups (I)</h2>
<p>So far you have worked with the two dimensions, rows and columns of a <code>data.table</code>. It’s now time to consider the <em>virtual</em> third dimension by dividing rows into groups to calculate statistics.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Compute the mean duration for every <code>start_station</code>, calling the aggregated column <code>mean_duration</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Compute the mean duration for every start_station</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>mean_start_stn <span class="ot">&lt;-</span> batrips[, .(<span class="at">mean_duration =</span> <span class="fu">mean</span>(duration)), by <span class="ot">=</span> start_station]</span>
<span id="cb36-3"><a href="#cb36-3"></a>mean_start_stn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great job! Let’s move on to grouping by multiple columns.</p>
</section>
<section id="computing-stats-by-groups-ii" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="computing-stats-by-groups-ii"><span class="header-section-number">3.3</span> Computing stats by groups (II)</h2>
<p>When grouping a <code>data.table</code> by multiple columns, you need to specify the <code>by</code> argument as either a character vector or a list. In this exercise, you will calculate the mean of <code>duration</code> for:</p>
<ul>
<li>Each unique combination of <code>start_station</code> and <code>end_station</code></li>
<li>Each <code>start_station</code> for each month <strong>Steps</strong></li>
</ul>
<ol type="1">
<li>Compute the mean duration for each unique combination <code>start_station</code> <em>and</em> <code>end_station</code>. Call the aggregated column <code>mean_duration</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Compute the mean duration for every start and end station</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>mean_station <span class="ot">&lt;-</span> batrips[, .(<span class="at">mean_duration =</span> <span class="fu">mean</span>(duration)), by <span class="ot">=</span> .(start_station, end_station)]</span>
<span id="cb37-3"><a href="#cb37-3"></a>mean_station</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Compute the mean duration for each <code>start_station</code> and for each month in <code>start_date</code>. Call the aggregated column <code>mean_duration</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># Compute the mean duration grouped by start_station and month</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>mean_start_station <span class="ot">&lt;-</span> batrips[, .(<span class="at">mean_duration =</span> <span class="fu">mean</span>(duration)), by <span class="ot">=</span> .(start_station, <span class="fu">month</span>(start_date))]</span>
<span id="cb38-3"><a href="#cb38-3"></a>mean_start_station</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well done! Can you calculate multiple statistics in <code>j</code>?</p>
</section>
<section id="computing-multiple-stats" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="computing-multiple-stats"><span class="header-section-number">3.4</span> Computing multiple stats</h2>
<p>Let’s now combine everything from the past two exercises to find multiple summary statistic with multiple groups in <code>batrips</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Group by <code>start_station</code> and <code>end_station</code> to calculate the mean duration and the total number of trips. Name these columns <code>mean_duration</code> and <code>total_trips</code>, respectively.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Compute mean of duration and total trips grouped by start and end stations</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>aggregate_mean_trips <span class="ot">&lt;-</span> batrips[, .(<span class="at">mean_duration =</span> <span class="fu">mean</span>(duration), </span>
<span id="cb39-3"><a href="#cb39-3"></a>                                    <span class="at">total_trips =</span> .N), </span>
<span id="cb39-4"><a href="#cb39-4"></a>                                by <span class="ot">=</span> .(start_station, end_station)]</span>
<span id="cb39-5"><a href="#cb39-5"></a>aggregate_mean_trips</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Group by <code>start_station</code>, <code>end_station</code>, and for each month in <code>start_date</code> to calculate the minimum and maximum duration. Name these columns <code>min_duration</code> and <code>max_duration</code>, respectively.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Compute min and max duration grouped by start station, end station, and month</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>aggregate_min_max <span class="ot">&lt;-</span> batrips[, .(<span class="at">min_duration =</span> <span class="fu">min</span>(duration), </span>
<span id="cb40-3"><a href="#cb40-3"></a>                                 <span class="at">max_duration =</span> <span class="fu">max</span>(duration)), </span>
<span id="cb40-4"><a href="#cb40-4"></a>                             by <span class="ot">=</span> .(start_station, end_station, </span>
<span id="cb40-5"><a href="#cb40-5"></a>                                    <span class="fu">month</span>(start_date))]</span>
<span id="cb40-6"><a href="#cb40-6"></a>aggregate_min_max</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are tremendous! In the next lesson, you will learn how to chain <code>data.table</code> expressions to avoid intermediate objects.</p>
</section>
<section id="chaining-data.table-expressions" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="chaining-data.table-expressions"><span class="header-section-number">3.5</span> Chaining data.table expressions</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Chaining data.table expressions</strong></p>
<p>In this lesson, we will see another powerful feature of data table, chaining expressions together.</p>
<p><strong>2. Chaining expressions</strong></p>
<p>What does chaining expressions mean? What it means is that instead of assigning the output data table to an intermediate object and then performing some operation on it, you can successively perform operations on the outputs. Let’s look at this example where we find the three shortest trips that are over 1 hour, that is, 3600 seconds. We first filter batrips such that duration is greater than 3600 and then arrange the resulting data table by ordering the duration column and finally subset the first three rows.</p>
<p><strong>3. Chaining expressions</strong></p>
<p>Let’s move on to a more advanced example. Suppose you want to find the top three start stations which have the lowest mean duration. This task requires several steps. First you would have to compute the mean duration of all start stations and store the result in a variable. Then, you would need to order() the mean duration column in increasing order and choose the first three rows from that result. Instead, you can do all this in a single step without using temporary variables by simply chaining expressions together as shown here. Chaining essentially comes for free. You can also chain data frame operations together. However the number of things you can do with a data frame is so little that there is no real use in chaining data frame operations.</p>
<p><strong>4. uniqueN()</strong></p>
<p>Let’s move on to another useful helper function, uniqueN(), which is particularly helpful when used with “by”. The unique() function from base R returns all the unique values of the input object. uniqueN() from data table simply returns the count of unique elements of the input object. It works on vectors, data frames and data tables all alike. The vector id has two unique values so the result of uniqueN() is 2. When you pass a data table to uniqueN(), it looks at all the columns by default. Since there are no duplicate rows, the result is 4, which is the same as the total number of rows in x. You can also use the “by” argument in uniqueN() to search for the number of unique values in a specific column of a data table. Again, as the id column consists of only 2 unique values, the result is 2.</p>
<p><strong>5. uniqueN() together with by</strong></p>
<p>uniqueN() can be a very handy function, particularly when used with the “by” argument of data table. Let’s say you’d like to compute the number of unique bike ids for each month. You can do this by first grouping batrips by month. Remember you can use the month() function on the start_date column in the “by” argument to do this. Then you can use the uniqueN() function on bike_id in the “j” argument thus calculating the number of unique bike ids for each month.</p>
<p><strong>6. Let’s practice!</strong></p>
<p>Now let’s try some examples.</p>
</section>
<section id="ordering-rows" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="ordering-rows"><span class="header-section-number">3.6</span> Ordering rows</h2>
<p>Ordering aggregated data is quite a common operation. This can be elegantly accomplished by simply chaining <code>data.table</code> expressions together.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Compute the total number of trips grouped by <code>start_station</code> and <code>end_station</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Compute the total trips grouped by start_station and end_station</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>trips_dec <span class="ot">&lt;-</span> batrips[, .N, by <span class="ot">=</span> .(start_station, </span>
<span id="cb41-3"><a href="#cb41-3"></a>                                  end_station)]</span>
<span id="cb41-4"><a href="#cb41-4"></a>trips_dec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>After computing the total number of trips grouped by <code>start_station</code> and <code>end_station</code>, order the results (total number of trips) in descending order.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Arrange the total trips grouped by start_station and end_station in decreasing order</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>trips_dec <span class="ot">&lt;-</span> batrips[, .N, by <span class="ot">=</span> .(start_station, </span>
<span id="cb42-3"><a href="#cb42-3"></a>                                  end_station)][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb42-4"><a href="#cb42-4"></a>trips_dec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isn’t it easy to order rows? In the upcoming exercises, you will see how <em>chaining</em> can make your life easier.</p>
</section>
<section id="what-are-the-top-5-destinations" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="what-are-the-top-5-destinations"><span class="header-section-number">3.7</span> What are the top 5 destinations?</h2>
<p>When analyzing data, it is often useful to know the key top/popular stats such as the most popular cities or the most famous restaurants etc. In this exercise, you will find the five most popular destinations (i.e., the five most popular <code>end_station</code>s).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Chain the following three <code>data.table</code> expressions:the total number of trips to each <code>end_station</code>. the total number of trips for each <code>end_station</code> in descending order. the top 5 rows.</li>
<li>Find the total number of trips to each <code>end_station</code>.</li>
<li>Arrange the total number of trips for each <code>end_station</code> in descending order.</li>
<li>Filter the top 5 rows.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Top five most popular destinations</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>top_5 <span class="ot">&lt;-</span> batrips[, .N, by <span class="ot">=</span> end_station][<span class="fu">order</span>(<span class="sc">-</span>N)][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb43-3"><a href="#cb43-3"></a>top_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Brilliant! Data Scientists answer questions like these everyday. Let’s see if you can answer a slightly complicated one.</p>
</section>
<section id="what-is-the-most-popular-destination-from-each-start-station" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="what-is-the-most-popular-destination-from-each-start-station"><span class="header-section-number">3.8</span> What is the most popular destination from each start station?</h2>
<p>In the last exercise, you created <code>trips_dec</code>, which consists of the total number of trips grouped by <code>start_station</code> and <code>end_station</code> in descending order. This gives you an opportunity to calculate the most popular end station for each start station. You can do this by simply extracting the first <code>end_station</code> for each <code>start_station</code>.</p>
<p><code>trips_dec</code> is available in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Group <code>trips_dec</code> by <code>start_station</code> and extract the first <code>end_station</code> to find the most popular end station for each start station.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Compute most popular end station for every start station</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>popular_end_station <span class="ot">&lt;-</span> trips_dec[, .(<span class="at">end_station =</span> end_station[<span class="dv">1</span>]), </span>
<span id="cb44-3"><a href="#cb44-3"></a>                                 by <span class="ot">=</span> start_station]</span>
<span id="cb44-4"><a href="#cb44-4"></a>popular_end_station</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nicely done! You are on your way to mastering data.tables. Can you combine the three important arguemnts of data.table, <code>i</code>, <code>j</code>, and <code>by</code> in one operation?</p>
</section>
<section id="combining-i-j-and-by-i" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="combining-i-j-and-by-i"><span class="header-section-number">3.9</span> Combining i, j, and by (I)</h2>
<p>In this exercise, you will combine the <code>i</code>, <code>j</code>, and <code>by</code> arguments to find the <em>first and last ride for each start station</em>. Recall that <code>data.table</code> first filters the rows in <code>i</code>, and then groups the rows using <code>by</code>, and finally compute the expression in <code>j</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Arrange <code>batrips</code> using the <code>start_date</code> column in ascending order.<br>
</li>
<li>Group the rows by <code>start_station</code>.</li>
<li>Extract the first and last rows of <code>start_date</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Find the first and last ride for each start_station</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>first_last <span class="ot">&lt;-</span> batrips[<span class="fu">order</span>(start_date), </span>
<span id="cb45-3"><a href="#cb45-3"></a>                      .(<span class="at">start_date =</span> start_date[<span class="fu">c</span>(<span class="dv">1</span>, .N)]), </span>
<span id="cb45-4"><a href="#cb45-4"></a>                      by <span class="ot">=</span> start_station]</span>
<span id="cb45-5"><a href="#cb45-5"></a>first_last</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Whoo! That was quite an involved task, wasn’t it? You did great!</p>
</section>
<section id="computations-in-j-using-.sd" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="computations-in-j-using-.sd"><span class="header-section-number">3.10</span> Computations in j using .SD</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Computations in j using .SD</strong></p>
<p>In this lesson, you will look at another special symbol, dot-SD, which stands for Subset of Data. It makes computations even more easier and powerful as we will see in a moment.</p>
<p><strong>2. Subset of Data, .SD</strong></p>
<p>dot-SD is an extremely powerful symbol. Understanding it can help you do complex data wrangling in a straightforward manner. As mentioned earlier, dot-SD stands for ‘Subset of Data’. When grouping, it holds the intermediate data corresponding to each group while results for that group are being computed. It contains all the columns except the grouping column itself, by default. Let’s see dot-SD in action using this data table x.</p>
<p><strong>3. Subset of Data, .SD</strong></p>
<p>You can see that dot-SD contains “val1” and “val2” columns for each unique value of “id”. It contains all the rows of those columns corresponding to the group for which results are being computed. The “id” column itself is not included. Also note that these groups are data tables! This means we can perform subsets, selects, computations on the intermediate data table within each group! This is why dot-SD is very powerful.</p>
<p><strong>4. Subset of Data, .SD</strong></p>
<p>So how can you use dot-SD to find the first row for each id? While grouping by “id” column, you now know that dot-SD would contain all the columns except the grouping column, id, and all the rows. And also that dot-SD is by itself a data table. Therefore dot-SD[1] in “j” returns the first row for each group.</p>
<p><strong>5. Subset of Data, .SD</strong></p>
<p>Similarly, you can use .SD in combination with .N to obtain the last row for each unique id.</p>
<p><strong>6. .SDcols</strong></p>
<p>In the previous examples, dot-SD[1] and dot-SD[dot-N] returned the first and last rows for each “id”. However, it returned ALL the columns - “val1” and “val2”. What if you would like to just return “val1”? In other words, how can you control the columns that are available to dot-SD?Using dot-SDcols! It takes a character vector of column names that decides the columns to be included in dot-SD. In the first example here, dot-SD[1] returns the first row for every start station, with ALL the columns.In the second example, for every start station, only the first row and trip_id and duration columns are returned.</p>
<p><strong>7. .SDcols</strong></p>
<p>Of course, you can also prefix the character vector with a negative sign or the not operator to return ALL the columns EXCEPT the ones provided to dot-SDcols.</p>
<p><strong>8. Let’s practice!</strong></p>
<p>Time to put this into practice.</p>
</section>
<section id="using-.sd-i" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="using-.sd-i"><span class="header-section-number">3.11</span> Using .SD (I)</h2>
<p><code>.SD</code> together with <code>.SDcols</code> is an incredibly powerful feature that makes computing on multiple columns so much easier.</p>
<ul>
<li><code>.SD</code> is a special symbol which stands for <strong>S</strong>ubset of <strong>D</strong>ata</li>
<li><code>.SDcols</code> holds the columns that should be included in <code>.SD</code> <strong>Steps</strong></li>
</ul>
<ol type="1">
<li>For each month, find the row corresponding to the shortest trip (by using <code>which.min()</code> on <code>duration</code>).</li>
<li>The result should contain the <code>month</code>, <code>start_station</code>, <code>end_station</code>, <code>start_date</code>, <code>end_date</code>, and <code>duration</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>relevant_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"start_station"</span>, <span class="st">"end_station"</span>, </span>
<span id="cb46-2"><a href="#cb46-2"></a>                   <span class="st">"start_date"</span>, <span class="st">"end_date"</span>, <span class="st">"duration"</span>)</span>
<span id="cb46-3"><a href="#cb46-3"></a></span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="co"># Find the row corresponding to the shortest trip per month</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>shortest <span class="ot">&lt;-</span> batrips[, .SD[<span class="fu">which.min</span>(duration)], </span>
<span id="cb46-6"><a href="#cb46-6"></a>                    by <span class="ot">=</span> <span class="fu">month</span>(start_date), </span>
<span id="cb46-7"><a href="#cb46-7"></a>                    .SDcols <span class="ot">=</span> relevant_cols]</span>
<span id="cb46-8"><a href="#cb46-8"></a>shortest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are terrific! <code>.SD</code> and <code>.SDcols</code> are especially useful when you are dealing with large data.tables. Do you really know how to use them? Let’s find out.</p>
</section>
<section id="using-.sd-ii" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="using-.sd-ii"><span class="header-section-number">3.12</span> Using .SD (II)</h2>
<p>You can also apply a single function to every column specified in <code>.SDcols</code> using <code>lapply()</code>. In this exercise, you will calculate the number of unique start stations and zip codes for each month using <a href="https://www.rdocumentation.org/packages/data.table/topics/duplicated"><code>uniqueN()</code></a>. <code>uniqueN()</code> returns the number of unique elements in a column/vector/<code>data.table</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Find the total number of unique start stations and zip codes <em>for each</em> month, using <code>start_date</code> to extract the month.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Find the total number of unique start stations and zip codes per month</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>unique_station_month <span class="ot">&lt;-</span> batrips[, <span class="fu">lapply</span>(.SD, uniqueN), </span>
<span id="cb47-3"><a href="#cb47-3"></a>                                by <span class="ot">=</span> <span class="fu">month</span>(start_date), </span>
<span id="cb47-4"><a href="#cb47-4"></a>                                .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"start_station"</span>, <span class="st">"zip_code"</span>)]</span>
<span id="cb47-5"><a href="#cb47-5"></a>unique_station_month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looks like you know your way around data.tables! Well done! However, to truly master the basics of data.table, there is one more thing to you need to know: <em>reference semantics</em>. This will be the focus of the next chapter.</p>
</section>
</section>
<section id="reference-semantics" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 4. Reference Semantics</h1>
<p>You will learn about a unique feature of data.table in this chapter: modifying existing data.tables in place. Modifying data.tables in place makes your operations <i>incredibly fast</i> and is easy to learn.</p>
<section id="adding-and-updating-columns-by-reference" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="adding-and-updating-columns-by-reference"><span class="header-section-number">4.1</span> Adding and updating columns by reference</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Adding and updating columns by reference</strong></p>
<p>In this lesson, you will look at a very unique feature of data table, reference semantics, which allows you to add, update and delete columns of a data table in place.</p>
<p><strong>2. data.frame internals</strong></p>
<p>Suppose you have a data frame “df” as shown here and you would like to change the second row of column “y” to 10 instead of 7.You can do something like this.</p>
<p><strong>3. data.frame internals</strong></p>
<p>Now how does R handle this internally? In versions of R prior to 3-point-1-point-0, this operation resulted in deep copying of the entire data frame.That is, the entire data frame “df” was copied in memory to a completely different location and assigned a temporary variable name, say “tmp”. The new value was updated on “tmp” and the result was then assigned back to “df”.Now think about how much memory you will require if your data frame is 10GB. You will need at least 10GB more of free RAM just to replace a single value of a single column! This was obviously not memory efficient.</p>
<p><strong>4. data.frame internals</strong></p>
<p>Improvements were made in version 3-point-1-point-0 to not deep copy the entire data frame while updating columns.This example data frame df has four columns. Say you would like to replace all “even” values with NA in the first two columns, you can do that as shown here. From version 3-point-1-point-0 on, only columns “a” and “b” are deep copied instead of the entire data frame. This is a great improvement.However, the columns being updated are still deep copied. Imagine your data frame is 10GB with 100 columns and you are updating 50 columns. You would still need 5GB of extra space to update those columns.Surely, deep copying just the columns used is a welcoming improvement but by no means the most efficient way of updating columns.So how does data table handle this efficiently?</p>
<p><strong>5. data.table internals</strong></p>
<p>The data table package does not deep copy objects or create any temporary variables. It simply updates the original data table by reference.Since the original data table is directly updated, there is no need to assign the result back to a variable. It is therefore extremely fast and memory efficient.data table uses a new operator colon equal to (:=) to perform this.</p>
<p><strong>6. LHS := RHS form</strong></p>
<p>There are two ways of using data table’s colon equal to operator.The first is the left-hand-side colon equal to right-hand-side form. It takes a character vector of column names on the left-hand-side of the “:=” operator and a LIST of values on the right-hand-side of the “:=” operator, corresponding to each of the column names.In the example shown, two columns are being added to the original data table batrips. The first one is TRUE if the duration is greater than 1 hour and the second is the weekday of each trip.For convenience, you can skip the quotes around column names on the left-hand-side if a single column is added or updated.Note that the result is not assigned to a new variable. The original data table batrips will now have these two columns added to it.</p>
<p><strong>7. Functional form</strong></p>
<p>The second way of using the “:=” operator is the functional form. It takes the form “col1 = val1”, “col2 = val2” etc.. as arguments to function “:=()”. Note that when you are using operators as functions, they need to wrapped inside backticks. Assigning NULL to a column deletes that column by reference. Here, “is_dur_gt_1hour” column is deleted. In addition, “start_station” column is updated by reference to all upper case.It is perfectly fine if you prefer to stick to one method over the other.</p>
<p><strong>8. Let’s practice!</strong></p>
<p>Now it’s your time to use the colon equal to operator.</p>
</section>
<section id="adding-a-new-column" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="adding-a-new-column"><span class="header-section-number">4.2</span> Adding a new column</h2>
<p>As mentioned in the video, <code>data.table</code> does not have to deep copy objects in order to modify them. It can modify objects <em>by reference</em> (inplace) to save memory and runtime using the <code>:=</code> operator. When you update a <code>data.table</code> <em>by reference</em>, you don’t have to assign the result to a new object as the original <code>data.table</code> is modified directly.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a new column <code>duration_hour</code> to <code>batrips</code> <em>by reference</em>, by dividing the <code>duration</code> column by 3600.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Add a new column, duration_hour</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>batrips[, duration_hour <span class="sc">:</span><span class="er">=</span> duration <span class="sc">/</span> <span class="dv">3600</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Did you notice you didn’t have to assign the result to any object? The new column was simply <em>added</em> to your existing <code>data.table</code>.</p>
</section>
<section id="updating-an-existing-column-i" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="updating-an-existing-column-i"><span class="header-section-number">4.3</span> Updating an existing column (I)</h2>
<p>Being able to efficiently update existing columns is particularly useful when cleaning data. In this exercise, you will work with a new <code>data.table</code>, <code>untidy</code>, which is almost identical to <code>batrips</code>, except we introduced a typo in the second row of the <code>start_station</code> column.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>untidy <span class="ot">&lt;-</span> batrips</span>
<span id="cb49-2"><a href="#cb49-2"></a>untidy[<span class="dv">2</span>, start_station <span class="sc">:</span><span class="er">=</span> <span class="st">"Sen Francisco City Hall"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print the first two rows of <code>untidy</code> to see if you can spot the typo.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Print untidy</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="fu">head</span>(untidy, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Now update the second row of the <code>start_station</code> column to fix the typo. The correct spelling should be <code>"San Francisco City Hall"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Fix spelling in the second row of start_station using the LHS := RHS form</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>untidy[<span class="dv">2</span>, start_station <span class="sc">:</span><span class="er">=</span> <span class="st">"San Francisco City Hall"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Updating <code>data.table</code>s is incredibly useful when you are cleaning data. Instead of creating several objects and cluttering up your workspace, you can modify your original <code>data.table</code> directly. This is both cleaner and faster!</p>
</section>
<section id="updating-an-existing-column-ii" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="updating-an-existing-column-ii"><span class="header-section-number">4.4</span> Updating an existing column (II)</h2>
<p>In the previous exercise, you updated only one value and you knew the exact location that had to be updated, i.e., the <em>second</em> row of the <code>start_station</code> column. However, in your day-to-day work, you often want to update several values and you won’t know the locations in advance.</p>
<p>You can use the filtering expressions in <code>i</code> the same way you did in chapter 1 to update the columns by reference.</p>
<p>In this exercise, you will work with a new <code>data.table</code>, <code>untidy</code>, which is almost identical to <code>batrips</code>, except we randomly introduced some negative values in the <code>duration</code> column.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Replace all rows where <code>duration</code> is less than 0 with <code>NA</code>s.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Replace negative duration values with NA</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>untidy[duration <span class="sc">&lt;</span> <span class="dv">0</span>, duration <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also update <code>data.table</code>s when performing <em>grouped</em> aggregations. Do you know how? Check out the next lesson!</p>
</section>
<section id="grouped-aggregations" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="grouped-aggregations"><span class="header-section-number">4.5</span> Grouped aggregations</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Grouped aggregations</strong></p>
<p>Suppose you want to filter batrips so that it contains data for only those zip codes with greater than 1000 trips. How would you do that?</p>
<p><strong>2. Combining “:=” with by</strong></p>
<p>In the previous video, you saw how to add or update columns by reference to the original data table using the new “:=” operator. You will now add and update columns for different groups in your data table using the “by” argument.As you can see here, a new column “n_zip_code” is added to batrips which contains the total trips made for each “zip_code”. When you update a data table by reference, it is updated silently. Nothing is printed to the console. Checking the number of columns before and after you can see that the number of columns increased by 1. To view the results as soon you update a data table by reference, you can simply chain a pair of empty square brackets, which will print the updated data table.</p>
<p><strong>3. Combining “:=” with by</strong></p>
<p>Now all you need to do is use the “n_zip_code” column to filter batrips. Of course, you don’t really need the column “n_zip_code” in your final result,</p>
<p><strong>4. Combining “:=” with by</strong></p>
<p>so you can delete it by reference by chaining one more expression as shown here. This is a very common pattern in data analysis. You often need to add intermediate columns to get to the final result, but don’t necessarily need them in the final result.</p>
<p><strong>5. Let’s practice!</strong></p>
<p>Go ahead and practice aggregating data by reference!</p>
</section>
<section id="adding-columns-by-group" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="adding-columns-by-group"><span class="header-section-number">4.6</span> Adding columns by group</h2>
<p>Recall that you can perform computations <em>by group</em> using the <code>by</code> argument of the <code>data.table</code>. In this exercise, you will add new columns <em>by group</em> to the original <code>data.table</code> <em>by reference</em>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a new column <em>by reference</em> called <code>trips_N</code> that is equal to the total number of trips for every <code>start_station</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Add a new column equal to total trips for every start station</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>batrips[, trips_N <span class="sc">:</span><span class="er">=</span> .N, by <span class="ot">=</span> start_station]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Add a new column <em>by reference</em> called <code>duration_mean</code> that is equal to the mean duration of trips for each unique combination of <code>start_station</code> and <code>end_station</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Add new column for every start_station and end_station</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>batrips[, duration_mean <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(duration), by <span class="ot">=</span> .(start_station, end_station)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s right! Adding new columns is not much different. All you need to do is specify the <code>by</code> argument.</p>
</section>
<section id="updating-columns-by-group" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="updating-columns-by-group"><span class="header-section-number">4.7</span> Updating columns by group</h2>
<p>You often need to create new intermediate columns to get to the final result but don’t necessarily need these intermediate columns in the final result. This is a very common pattern in data analysis.</p>
<p>In this exercise, you will work with a new <code>data.table</code>, <code>batrips_new</code>, which is almost identical to <code>batrips</code>, except we randomly introduced some missing values in the <code>duration</code> column.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add a new column (<code>mean_dur</code>) by reference that is the mean duration of all trips grouped by month (based on <code>start_date</code>). <em>Note that the <code>duration</code> column has missing values.</em></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>batrips_new <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/batrips_new.rds"</span>)</span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co"># Calculate the mean duration for each month</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>batrips_new[, mean_dur <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb55-5"><a href="#cb55-5"></a>            by <span class="ot">=</span> <span class="fu">month</span>(start_date)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Chain a new <code>data.table</code> expression that replaces all missing values in <code>duration</code> with the corresponding <code>mean_dur</code> value.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Replace NA values in duration with the mean value of duration for that month</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>batrips_new[, mean_dur <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb56-3"><a href="#cb56-3"></a>            by <span class="ot">=</span> <span class="fu">month</span>(start_date)][<span class="fu">is.na</span>(duration), </span>
<span id="cb56-4"><a href="#cb56-4"></a>                                    duration <span class="sc">:</span><span class="er">=</span> mean_dur]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Delete the <code>mean_dur</code> column by reference.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Delete the mean_dur column by reference</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>batrips_new[, mean_dur <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb57-3"><a href="#cb57-3"></a>            by <span class="ot">=</span> <span class="fu">month</span>(start_date)][<span class="fu">is.na</span>(duration), </span>
<span id="cb57-4"><a href="#cb57-4"></a>                                    duration <span class="sc">:</span><span class="er">=</span> mean_dur][, mean_dur <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nicely done! Are you ready for more advanced aggregations?</p>
</section>
<section id="advanced-aggregations" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="advanced-aggregations"><span class="header-section-number">4.8</span> Advanced aggregations</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Advanced aggregations</strong></p>
<p>In this lesson, you will use the colon equal to operator for more advanced aggregations.</p>
<p><strong>2. Recap</strong></p>
<p>In the previous videos, you learned how to use the colon equal to operator in two ways: a) LHS := RHS form and b) the functional form, to add and update columns in a data table by reference.In addition, you also saw how to combine the “:=” operator with the “by” argument to add a single column while grouping. Now let’s see how you can add multiple columns by reference while using the “by” argument.</p>
<p><strong>3. Adding multiple columns by reference by group</strong></p>
<p>You can provide all the columns to be added/updated along with their values in either of the two forms: LHS:=RHS or functional form, and add the “by” argument to group by those columns.As you can see here, for each “end_station”, the first and last duration values are assigned to the two new columns. Note that you would have identical first and last values of duration for all rows corresponding to the same end station.</p>
<p><strong>4. Binning values</strong></p>
<p>We will now create a new column based on the median duration for each unique combination of start_station and end_station as shown here. As you might have guessed, you can use if-else statements to accomplish this.</p>
<p><strong>5. Multi-line expressions in j</strong></p>
<p>The “j” argument can also handle complex multi-line expressions. To do this, you can use the left-hand-side := right-hand-side form and wrap the expressions inside curly brackets in the right-hand-side. As you can see here, we first calculate the median duration for each group, med_dur. Then, we use a series of if-else statements to create the new column trip_category by reference.</p>
<p><strong>6. Alternative way</strong></p>
<p>Alternatively, you can create a user-defined function to accomplish the same task. The bin_median_duration() function does exactly the same job as the multi-line expression on the previous slide.</p>
<p><strong>7. All together - i, j and by</strong></p>
<p>So far you have used the “j” and “by” arguments to add/update columns by reference. Now let’s combine all three - “i”, “j”, and “by” together.In the example shown here, data table first evaluates the expression in “i” which returns all the rows where duration is greater than 500. Then on those rows, the “by” argument is applied by creating groups for each unique combination of “start_station” and “end_station”. Finally, for each of those groups the expression in “j” is evaluated. We thereby obtain the smallest duration greater than 500 for each specified group. If all values for a particular group are less than 500, there are no rows to group by, so the result would be NA, as shown in the first two rows of output here.</p>
<p><strong>8. Let’s practice!</strong></p>
<p>Now it’s your turn to practice advanced aggregations.</p>
</section>
<section id="adding-multiple-columns-i" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="adding-multiple-columns-i"><span class="header-section-number">4.9</span> Adding multiple columns (I)</h2>
<p>More often than not, you may want to add/update multiple columns by reference. There are two ways to do this in <code>data.table</code>:</p>
<ul>
<li>LHS := RHS form</li>
<li>Functional form In this exercise, you will add columns using the <strong>LHS := RHS</strong> form. In the LHS, you specify column names as a character vector and in the RHS, you specify values/expressions to be added inside <code>list()</code> (or the alias, <code>.()</code>).</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add two new columns (<code>mean_duration</code> and <code>median_duration</code>) <em>by reference</em> using the <code>LHS := RHS</code> form that calculates the mean and median of the <code>duration</code> column for every <code>start_station</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Add columns using the LHS := RHS form</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>batrips[, <span class="fu">c</span>(<span class="st">"mean_duration"</span>, </span>
<span id="cb58-3"><a href="#cb58-3"></a>            <span class="st">"median_duration"</span>) <span class="sc">:</span><span class="er">=</span> .(<span class="fu">mean</span>(duration), <span class="fu">median</span>(duration)), </span>
<span id="cb58-4"><a href="#cb58-4"></a>        by <span class="ot">=</span> start_station]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great job! In the next exercise, you will compute the same columns again, but this time using the <em>functional form</em>.</p>
</section>
<section id="adding-multiple-columns-ii" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="adding-multiple-columns-ii"><span class="header-section-number">4.10</span> Adding multiple columns (II)</h2>
<p>In this exercise, you will add the same columns as in the previous exercise, using the <strong>functional</strong> form. In the functional form, you use the colon equal to operator (<code>:=</code>) as a function. Recall that when using operators as functions, they should be wrapped inside backticks, <strong><code>:=</code>()</strong>. Inside the function call, you pass comma-separated <code>col_name = expression</code> values.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Add two new columns (<code>mean_duration</code> and <code>median_duration</code>) <em>by reference</em> using the <em>functional form</em> that calculates the mean and median of the <code>duration</code> column for every <code>start_station</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Add columns using the functional form</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>batrips[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">mean_duration =</span> <span class="fu">mean</span>(duration), </span>
<span id="cb59-3"><a href="#cb59-3"></a>               <span class="at">median_duration =</span> <span class="fu">median</span>(duration)), </span>
<span id="cb59-4"><a href="#cb59-4"></a>        by <span class="ot">=</span> start_station]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! You can check that the results are same whether you use <em>LHS := RHS</em> or the <em>functional form</em>. Is there a preferred way? No.&nbsp;Pick your favorite.</p>
</section>
<section id="combining-i-j-and-by-ii" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="combining-i-j-and-by-ii"><span class="header-section-number">4.11</span> Combining i, j, and by (II)</h2>
<p>As you did in the last chapter, you will combine the <code>i</code>, <code>j</code>, and <code>by</code> arguments, but this time modify the existing <code>data.table</code> by reference in <code>j</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>For all rows where <code>duration</code> is greater than 600, group <code>batrips</code> by <code>start_station</code> and <code>end_station</code> to add a new column (<code>mean_duration</code>) <em>by reference</em> which calculates the mean duration of all trips.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Add the mean_duration column</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>batrips[duration <span class="sc">&gt;</span> <span class="dv">600</span>, mean_duration <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(duration), </span>
<span id="cb60-3"><a href="#cb60-3"></a>        by <span class="ot">=</span> .(start_station, end_station)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are stunning! Congratulations on mastering the basics of <code>data.table</code>. In the next chapter, you will import and export flat files using <code>data.table</code>’s <em>amazing</em> <code>fread()</code> and <code>fwrite()</code> functions!</p>
</section>
</section>
<section id="importing-and-exporting-data" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 5. Importing and Exporting Data</h1>
<p>Not only does the data.table package help you perform incredibly fast computations, it can also help you read and write data to disk with amazing speeds. This chapter focuses on data.table’s fread() and fwrite() functions which let you import and export flat files <i>quickly</i> and <i>easily</i>!</p>
<section id="fast-data-reading-with-fread" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="fast-data-reading-with-fread"><span class="header-section-number">5.1</span> Fast data reading with fread()</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Fast data reading with fread()</strong></p>
<p>You maybe familiar with read dot csv() or read dot table() functions which import flat files into R. In this chapter, you will use data table’s high-performance function fread() to import flat files. So what distinguishes fread() from the other file readers?</p>
<p><strong>2. Blazing FAST!</strong></p>
<p>fread() is blazing FAST! It can import files in parallel on machines where multi-core processors are available. By default, fread() uses ALL available threads. You can use the argument nThread to control the number of threads fread() uses.</p>
<p><strong>3. User-friendly</strong></p>
<p>fread() is also very user friendly. You can read local files from disk, files from URLs, and strings that need to be parsed using the same syntax! It can automatically guess column types, skip lines if necessary which is useful when reading files that contain comments or metadata about the file, handle quotes, separators, white spaces etc. One thing to note though is that at the moment, date and datetime columns are read in as character columns. These columns can be converted later using the excellent fasttime or the more recent anytime packages.</p>
<p><strong>4. Fast and friendly file reader</strong></p>
<p>On this slide we show how the same dataset in three different formats can be imported into R using fread(). As you can see fread() automatically detects if it is a file name, URL or string for you. Note how the header is automatically detected as well. If there’s no header, fread() automatically names them “V1”, “V2” etc. Similar to the data table() function. This example shows how you can import data using a filename, URL, or a string. That’s it. Everything else is taken care of automatically. If you would like to know what’s going on under the hood, set the verbose argument to TRUE. In the rest of this chapter, we will use fread() to import data only through strings so you can see how the data looks like.</p>
<p><strong>5. nrows and skip arguments</strong></p>
<p>Although fread() is clever enough to guess the column types and other details in most cases, there are times when you might appreciate a finer control when importing your data. Let’s see how these finer controls work. The arguments nrows and skip allow you to control which rows or lines of a file are imported. The nrows argument specifies the total number of rows to read, excluding the header row. It takes an integer as input. This is particularly useful when you want to have a quick look at the file by reading, say, just the first 100 rows instead of millions of rows.The skip argument also takes an integer as input and skips that many number of lines before attempting to parse the file. This is particularly useful in handling irregular files, for example, files with comments, or metadata at the beginning of a file. Even though fread() tries to handle this automatically, it might be required to manually specify the skip argument in some special cases.</p>
<p><strong>6. More on nrows and skip arguments</strong></p>
<p>The skip argument can also take a string as input. In this case, fread() searches for the first exact occurrence of that string and parses the file from the line that string occurs. Note how all text before the string “a,b” is skipped.And finally, you can use skip and nrows together to skip a few rows and read a specified number of rows from there as shown here.</p>
<p><strong>7. select and drop arguments</strong></p>
<p>The arguments select and drop allow you to control which columns are imported. Since this is done while parsing, it is very efficient. Both arguments accept a character vector of column names as well as column numbers. By default, all columns are parsed. The select argument parses the file only for the specified columns. The drop argument reads in all columns except the specified ones.Note that you can not combine both the arguments in the same function call.</p>
<p><strong>8. Let’s practice!</strong></p>
<p>Now it’s time for you to import data using fread()!</p>
</section>
<section id="fast-reading-from-disk" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="fast-reading-from-disk"><span class="header-section-number">5.2</span> Fast reading from disk</h2>
<p>In addition to having intelligent defaults, <code>fread()</code> is super fast! In this exercise, you will use the <a href="https://www.rdocumentation.org/packages/base/topics/system.time"><code>system.time()</code></a> function from base R to compare the time it takes to read the <code>batrips.csv</code> file using <code>read.csv()</code> and <code>fread()</code>. All you need to do is pass an expression to <code>system.time()</code>. For example, if you want to calculate how long it takes to import a file called <code>sample.csv</code>, you can use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="fu">system.time</span>(<span class="fu">read.csv</span>(<span class="st">"sample.csv"</span>))</span>
<span id="cb61-2"><a href="#cb61-2"></a>   user  system elapsed </span>
<span id="cb61-3"><a href="#cb61-3"></a>  <span class="fl">3.495</span>   <span class="fl">0.040</span>   <span class="fl">3.547</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generally, you want to consider <code>user</code> time when measuring execution time. So in this case, it took 3.495 seconds to import the file <code>sample.csv</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Import <code>batrips</code> using base R’s <code>read.csv()</code>.</li>
<li>Wrap the call inside <code>system.time()</code> to see how long this operation takes.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Use read.csv() to import batrips</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="fu">system.time</span>(<span class="fu">read.csv</span>(<span class="st">"data/batrips.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Import <code>batrips</code> using <code>data.table</code>’s <code>fread()</code>.</li>
<li>Wrap the call inside <code>system.time()</code> to see how long this operation takes.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Use fread() to import batrips</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="fu">system.time</span>(<span class="fu">fread</span>(<span class="st">"data/batrips.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s right! <code>data.table</code>’s <code>fread()</code> was able to import this file ~5x faster compared to <code>read.csv()</code>.</p>
</section>
<section id="importing-a-csv-file" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="importing-a-csv-file"><span class="header-section-number">5.3</span> Importing a CSV file</h2>
<p>In this exercise, you will import the file <code>sample.csv</code> using both <a href="https://www.rdocumentation.org/packages/utils/topics/read.table"><code>read.csv()</code></a> and <a href="https://www.rdocumentation.org/packages/data.table/topics/fread"><code>fread()</code></a> to compare these functions. Here are the contents of this file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>id,<span class="st">"name"</span>,val</span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="dv">29192</span>,<span class="st">"Robert Whitaker"</span>, <span class="dv">200</span></span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="dv">49301</span> ,<span class="st">"Elisa Waters,190  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The values in the file are separated by a comma. Note the unwanted <em>spaces</em> between entries, and the imbalanced quote in the second row.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Import the file <code>sample.csv</code> available in your workspace using <code>read.csv()</code>. Don’t modify the arguments.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># Import using read.csv()</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>csv_file <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/sample.csv"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">quote =</span> <span class="st">""</span>, </span>
<span id="cb65-3"><a href="#cb65-3"></a>                     <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>, </span>
<span id="cb65-4"><a href="#cb65-4"></a>                     <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-5"><a href="#cb65-5"></a>csv_file</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Import the file <code>sample.csv</code> available in your workspace using <code>fread()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Import using fread()</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>csv_file <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample.csv"</span>)</span>
<span id="cb66-3"><a href="#cb66-3"></a>csv_file</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well done! <code>fread()</code> is not only fast but also makes things a lot easier by guessing sensibly. Unlike the additional arguments which we provided for <code>read.csv()</code>, <code>fread()</code> could handle importing the file by itself. Also note the useful warning <code>fread()</code> provides.</p>
</section>
<section id="importing-selected-columns" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="importing-selected-columns"><span class="header-section-number">5.4</span> Importing selected columns</h2>
<p>It’s time to practice importing <em>only a few columns</em> from a file as opposed to importing the entire file. You will be importing the following file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>id,name,val</span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="dv">29192</span>,Robert Whitaker, <span class="dv">200</span></span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="dv">49301</span> ,Elisa Waters,<span class="dv">190</span>  </span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="dv">34456</span> , Karla Schmidt,<span class="dv">458</span>   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>fread()</code>’s <em>select</em> argument to import only <code>"id"</code> and <code>"val"</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Select "id" and "val" columns</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>select_columns <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample2.csv"</span>, <span class="at">select =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"val"</span>))</span>
<span id="cb68-3"><a href="#cb68-3"></a>select_columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use <code>fread()</code>’s <em>drop</em> argument to drop the <code>"val"</code> column.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># Drop the "val" column</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>drop_column <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample2.csv"</span>, <span class="at">drop =</span> <span class="st">"val"</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a>drop_column</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nice! So you know how to import only the <em>columns</em> you want. Can you now import only the <em>rows</em> you want?</p>
</section>
<section id="importing-selected-rows" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="importing-selected-rows"><span class="header-section-number">5.5</span> Importing selected rows</h2>
<p>It’s time to practice importing <em>only a few rows</em> from a file as opposed to importing the entire file. You will be importing the following file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>id,<span class="st">"name"</span>,val</span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="dv">29192</span>,<span class="st">"Robert Whitaker"</span>, <span class="dv">200</span></span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="dv">49301</span> ,<span class="st">"Elisa Waters,190  </span></span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="st">34456 , Karla Schmidt,458  </span></span>
<span id="cb70-5"><a href="#cb70-5"></a></span>
<span id="cb70-6"><a href="#cb70-6"></a><span class="st">END-OF-DATA</span></span>
<span id="cb70-7"><a href="#cb70-7"></a><span class="st">METADATA</span></span>
<span id="cb70-8"><a href="#cb70-8"></a><span class="st">attr;value</span></span>
<span id="cb70-9"><a href="#cb70-9"></a><span class="st">date;"</span><span class="dv">2018-01-01</span><span class="st">"</span></span>
<span id="cb70-10"><a href="#cb70-10"></a><span class="st">data;"</span>cash payment<span class="st">" </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately, files like these <em>do</em> exist in real life.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Import the file <code>sample.csv</code> using <code>fread()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># Import the file</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>entire_file <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample3.csv"</span>)</span>
<span id="cb71-3"><a href="#cb71-3"></a>entire_file</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Did you notice the second warning message? To avoid this message, import only the lines before <code>END-OF-DATA</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># Import the file while avoiding the warning</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>only_data <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample3.csv"</span>, <span class="at">nrows =</span> <span class="dv">3</span>)</span>
<span id="cb72-3"><a href="#cb72-3"></a>only_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Now import the data after the line <code>METADATA</code>. The first line is a header and the other two lines are the rows.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># Import only the metadata</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>only_metadata <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample3.csv"</span>, <span class="at">skip =</span> <span class="dv">7</span>)</span>
<span id="cb73-3"><a href="#cb73-3"></a>only_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Behold! You are not done witnessing the magic of <code>fread()</code>.</p>
</section>
<section id="advanced-file-reading" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="advanced-file-reading"><span class="header-section-number">5.6</span> Advanced file reading</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Advanced file reading</strong></p>
<p>In this lesson, you will look at some of the more advanced features of data table’s fread().</p>
<p><strong>2. Reading big integers using integer64 type</strong></p>
<p>R can only represent numbers less than or equal to 2^31 - 1 = 2147483647 as type “integer”. read dot csv automatically coerces numbers larger than this to numeric type. This might not be appropriate in some cases. data table therefore sets the type of such columns with large integer values to “integer64” type by default using the bit64 package. It is however possible to override the default with numeric or character types if required using the colClasses argument.</p>
<p><strong>3. Specifying column class types with colClasses</strong></p>
<p>If you don’t want to rely on fread()’s default column guessing, colClasses argument can be used to override the column types.colClasses can be a named or unnamed vector of column classes similar to read dot csv.</p>
<p><strong>4. Specifying column class types with colClasses</strong></p>
<p>If named, column classes are assigned to column names provided before parsing. If unnamed, first column is parsed using the first class, second with second class etc.</p>
<p><strong>5. Specifying column class types with colClasses</strong></p>
<p>In addition, you can also provide a named list of vectors where names correspond to the column class and values correspond to the column names or numbers. This is particularly useful when there are too many columns with a limited number of column types. In this example, instead of specifying “numeric” four times corresponding to the first four columns, you can specify numeric = 1:4 to parse the first four columns as numeric type.</p>
<p><strong>6. The fill argument</strong></p>
<p>When reading files with incomplete columns in a file, it is not always possible to parse them unambiguously. The “fill” argument can be used in these cases to explicitly direct fread() to fill the missing entries.In the first example, you can see that fread() has some trouble reading the data correctly. This is because fill is set to FALSE by default.</p>
<p><strong>7. The fill argument</strong></p>
<p>When you set fill to TRUE, fread() can parse the data properly and it fills empty values with empty strings. Empty values for integer, logical and numeric types are filled with NA.</p>
<p><strong>8. The na.strings argument</strong></p>
<p>Not all files encode missing values in the same way. You can use the “na-dot-strings” argument to parse all such values as NAs. na-dot-strings accepts a character vector of values that are replaced with NAs. Since this is done while parsing, it is very memory efficient as well as very fast.</p>
<p><strong>9. Let’s practice!</strong></p>
<p>Now it’s your turn to import more exotic files using fread().</p>
</section>
<section id="reading-large-integers" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="reading-large-integers"><span class="header-section-number">5.7</span> Reading large integers</h2>
<p>When importing massive datasets, it may be desirable to import numbers without decimals as integers since integers take up less space. Base R functions (such as <code>read.csv()</code>, <code>read.table()</code>, etc.) do this by default when the numbers are less than 2^31 - 1 (or 2147483647). However, columns with numbers greater than this are imported as <code>numeric</code> type by default.</p>
<p>If the <code>bit64</code> package is installed, <code>fread()</code> can import these columns with huge numbers as the <code>integer64</code> type which is implemented in <code>bit64</code> package, by default.</p>
<p>You will be importing the following file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>id,name,val</span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="dv">9002019291929192</span>,Robert Whitaker, <span class="dv">200</span></span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="dv">9200129401349301</span> ,Elisa Waters,<span class="dv">190</span>  </span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="dv">9200149429834456</span> , Karla Schmidt,<span class="dv">458</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Import the <code>sample.csv</code> file using <code>fread()</code> and <code>read.csv()</code>.</li>
<li>Print the class of the <code>id</code> columns in <code>fread_import</code> and <code>base_import</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># Import the file using fread </span></span>
<span id="cb75-2"><a href="#cb75-2"></a>fread_import <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample4.csv"</span>)</span>
<span id="cb75-3"><a href="#cb75-3"></a></span>
<span id="cb75-4"><a href="#cb75-4"></a><span class="co"># Import the file using read.csv </span></span>
<span id="cb75-5"><a href="#cb75-5"></a>base_import <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/sample4.csv"</span>)</span>
<span id="cb75-6"><a href="#cb75-6"></a></span>
<span id="cb75-7"><a href="#cb75-7"></a><span class="co"># Check the class of id column</span></span>
<span id="cb75-8"><a href="#cb75-8"></a><span class="fu">class</span>(fread_import<span class="sc">$</span>id)</span>
<span id="cb75-9"><a href="#cb75-9"></a><span class="fu">class</span>(base_import<span class="sc">$</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well done! Whenever possible, you should import your data as integers, especially when your data is big. Doing so results in saving memory in your RAM.</p>
</section>
<section id="specifying-column-classes" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="specifying-column-classes"><span class="header-section-number">5.8</span> Specifying column classes</h2>
<p>The <code>colClasses</code> argument of <code>fread()</code> allows you to explicitly specify the class of the columns. You can specify the class of the columns as a character vector (as is done in base R functions such as <code>read.csv()</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>colClasses <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"integer"</span>, <span class="fu">rep</span>(<span class="st">"factor"</span>, <span class="dv">3</span>), <span class="st">"character"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, this format requires you to specify the classes of <em>all</em> columns. This can be problematic if the file contains several columns and you only want to explicitly specify classes for some columns and leave the rest as default. You can use a more convenient list format for this purpose:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>colClasses <span class="ot">=</span> <span class="fu">list</span>(<span class="at">factor =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the columns two through four are imported as factors and the rest are imported using <code>fread()</code>’s defaults.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Import the <code>sample.csv</code> file using <code>read.csv()</code> and print the <code>str</code>ucture of <code>base_r_defaults</code>. Notice the column classes.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># Import using read.csv with defaults</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>base_r_defaults <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/sample5.csv"</span>)</span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="fu">str</span>(base_r_defaults)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Import the same file, but explicitly specify the column types. The first four columns should be imported as <code>"factor"</code>s, followed by <code>"character"</code>, <code>"integer"</code>, and then four <code>"numeric"</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># Import using read.csv</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>base_r <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/sample5.csv"</span>, </span>
<span id="cb79-3"><a href="#cb79-3"></a>                   <span class="at">colClasses =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"factor"</span>, <span class="dv">4</span>), </span>
<span id="cb79-4"><a href="#cb79-4"></a>                                  <span class="st">"character"</span>, <span class="st">"integer"</span>, </span>
<span id="cb79-5"><a href="#cb79-5"></a>                                  <span class="fu">rep</span>(<span class="st">"numeric"</span>, <span class="dv">4</span>)))</span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="fu">str</span>(base_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Use <code>fread()</code> to import the same file. Import columns 1 through 4 as factors, and columns 7 through 10 as numeric.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># Import using fread</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>import_fread <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample5.csv"</span>, </span>
<span id="cb80-3"><a href="#cb80-3"></a>                      <span class="at">colClasses =</span> <span class="fu">list</span>(<span class="at">factor =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">numeric =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb80-4"><a href="#cb80-4"></a><span class="fu">str</span>(import_fread)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See how convenient it is to expliclity specify column classes?</p>
</section>
<section id="dealing-with-empty-and-incomplete-lines" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="dealing-with-empty-and-incomplete-lines"><span class="header-section-number">5.9</span> Dealing with empty and incomplete lines</h2>
<p>When reading irregular files, i.e., files with varying/missing fields in rows, <code>fread()</code> tries to parse them intelligently. However, it may not be always possible to guess if the irregular lines should be skipped or imported by filling missing fields. For such cases, you can use the <code>fill</code> argument of <code>fread()</code>.</p>
<p>You will be importing the following file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>id,name,val</span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="dv">9002019291929192</span>,Robert Whitaker,</span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="dv">9200129401349301</span> ,Elisa Waters,<span class="dv">190</span>  </span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="dv">9200149429834456</span> , Karla Schmidt  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the first and last lines are incomplete.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Import the <code>sample.csv</code> file using <code>fread()</code> without any additional arguments. <em>Notice the warning it generates.</em></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># Import the file and note the warning message</span></span>
<span id="cb82-2"><a href="#cb82-2"></a>incorrect <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample6.csv"</span>)</span>
<span id="cb82-3"><a href="#cb82-3"></a>incorrect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Did you notice the warning message? <code>fread()</code> considered the last line as a footer and discarded it. Import the file (<code>sample.csv</code>) using <code>fread()</code> again, but this time, use the <code>fill</code> argument to ensure all rows are imported correctly.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Import the file correctly</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>correct <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample6.csv"</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-3"><a href="#cb83-3"></a>correct</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well done! These issues are common when dealing with real-world data.</p>
</section>
<section id="dealing-with-missing-values" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="dealing-with-missing-values"><span class="header-section-number">5.10</span> Dealing with missing values</h2>
<p>Missing values are often encoded differently. In some files, -9999 mean missing values and in others, they may be encoded as <code>#$##</code>. You can use the <code>na.strings</code> argument to tell <code>fread()</code> which values should be treated as missing values.</p>
<p>You will be importing the following file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>id,name,val1,val2</span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="dv">9002019291929192</span>,Robert Whitaker,,<span class="dv">44</span></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="dv">9200129401349301</span> ,Elisa Waters,<span class="dv">289</span>,<span class="do">##</span></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="dv">9200149429834456</span> , Karla Schmidt,<span class="dv">458</span>,<span class="dv">29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>The missing values are encoded as <code>"##"</code>. Note that <code>fread()</code> handles an empty field <code>,,</code> by default as <code>NA</code>.</em></p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Import the file <code>sample.csv</code> properly to ensure that <code>"##"</code> is treated as a missing values and is imported as <code>NA</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># Import the file using na.strings</span></span>
<span id="cb85-2"><a href="#cb85-2"></a>missing_values <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/sample7.csv"</span>, <span class="at">na.strings =</span> <span class="st">"##"</span>)</span>
<span id="cb85-3"><a href="#cb85-3"></a>missing_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Good job! Handling missing values is one of the most important steps in ensuring your data is well prepared.</p>
</section>
<section id="fast-data-writing-with-fwrite" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="fast-data-writing-with-fwrite"><span class="header-section-number">5.11</span> Fast data writing with fwrite()</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Fast data writing with fwrite()</strong></p>
<p>In this final lesson of the course, you will look at data table’s high-performance parallel file writer, fwrite().</p>
<p><strong>2. fwrite</strong></p>
<p>Similar to fread(), fwrite() is a fast and parallel file WRITER. By default, it uses all available threads to write to file. You can control the number of threads to use using the “nThread” argument.fwrite() provides intelligent defaults so that in most cases, only the data and file name arguments are required. It also has the ability to write columns of type “list” by flattening the list column with a secondary separator which is the symbol for the OR operator (“|”) by default.</p>
<p><strong>3. date and datetime columns (ISO)</strong></p>
<p>fwrite() also provides multiple ways to write date and datetime columns using the argument “dateTimeAs” which defaults to the ISO format. This results in representing datetime values in international standard thereby avoiding ambiguity while writing to or reading back from file.</p>
<p><strong>4. Date and times</strong></p>
<p>Let’s use this data table dt to look at these formats. Note that each column is a different type, date, time, and datetime. The as dot IDate() and as dot ITime() functions from data table extract the relevant portions from the timestamp.</p>
<p><strong>5. date and datetime columns (ISO)</strong></p>
<p>Have a look at the “datetime” column that is being read back using fread(). This is exactly the way fwrite() wrote the column to file. Also note that writing in ISO format not only avoids ambiguity but is also extremely fast to write to file.</p>
<p><strong>6. date and datetime columns (Squash)</strong></p>
<p>You can also set the dateTimeAs argument to “squash” which, as the name suggests, squashes the values together. This results in removing the hyphen (-) and colon (:) separators. Thus, the columns are read back by default as integers.</p>
<p><strong>7. date and datetime columns (Squash)</strong></p>
<p>This is particularly useful for columns whose primary purpose is to allow for extraction of year, month, date, hour, minute, seconds etc. which is quite useful in grouping operations. For example, using integer division as shown here, you can extract the year very efficiently.</p>
<p><strong>8. date and datetime columns (Epoch)</strong></p>
<p>You can also set the dateTimeAs argument to “epoch” which counts the number of days or seconds since the relevant epoch which is Jan 1, 1970, midnight, and Jan 1, 1970 midnight for date, time and datetime, respectively. dates, times, datetimes lesser than these respective epochs would have negative values.The options “iso”, “squash” and “epoch” are all extremely fast due to specialized C code and are extensively tested for correctness and also allow for unambiguous and fast reading of those columns.</p>
<p><strong>9. date and datetime columns (Epoch)</strong></p>
<p>As you can see here, when you write to a file by setting dateTimeAs to “epoch” and read it back the columns are integers denoting the number of days and seconds from the respective epoch.</p>
<p><strong>10. Let’s practice!</strong></p>
<p>Go ahead and use fwrite() to write data to files.</p>
</section>
<section id="writing-files-to-disk" class="level2" data-number="5.12">
<h2 data-number="5.12" class="anchored" data-anchor-id="writing-files-to-disk"><span class="header-section-number">5.12</span> Writing files to disk</h2>
<p><code>fwrite()</code> is a parallel file writer, and like <code>fread()</code>, it also has intelligent defaults.</p>
<p>For example, print <code>dt</code> in your console and notice that the column <code>name</code> has the first and last names separated with a <code>,</code> and the column <code>val</code> is of type <code>list</code>. <code>fwrite()</code> can automatically quote <code>name</code> column and add a secondary separator (the symbol for OR operator, <code>|</code>) for the list column.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Write <code>dt</code> to disk using the file name <code>"fwrite.txt"</code>.</li>
<li>Import the file using <code>readLines()</code> to verify that the <code>name</code> column is quoted automatically and the list column is separated with <code>|</code>.</li>
<li>Import the file using <code>fread()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># read data</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>dt <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/dt.rds"</span>)</span>
<span id="cb86-3"><a href="#cb86-3"></a></span>
<span id="cb86-4"><a href="#cb86-4"></a><span class="co"># Write dt to fwrite.txt</span></span>
<span id="cb86-5"><a href="#cb86-5"></a><span class="fu">fwrite</span>(dt, <span class="st">"data/fwrite.txt"</span>)</span>
<span id="cb86-6"><a href="#cb86-6"></a></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="co"># Import the file using readLines()</span></span>
<span id="cb86-8"><a href="#cb86-8"></a><span class="fu">readLines</span>(<span class="st">"data/fwrite.txt"</span>)</span>
<span id="cb86-9"><a href="#cb86-9"></a></span>
<span id="cb86-10"><a href="#cb86-10"></a><span class="co"># Import the file using fread()</span></span>
<span id="cb86-11"><a href="#cb86-11"></a><span class="fu">fread</span>(<span class="st">"data/fwrite.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Good! Being able to write list columns to file and reading them back properly is a very handy feature of <code>fwrite()</code>.</p>
</section>
<section id="writing-date-and-time-columns" class="level2" data-number="5.13">
<h2 data-number="5.13" class="anchored" data-anchor-id="writing-date-and-time-columns"><span class="header-section-number">5.13</span> Writing date and time columns</h2>
<p><code>fwrite()</code> provides several fast and consistent ways of writing <code>date</code> and <code>datetime</code> columns to files using the <code>dateTimeAs</code> argument. In order for you to clearly understand how this works, you will be working <code>batrips_dates</code>, which consists of two columns and five rows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>            start_date            end_date</span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">14</span><span class="sc">:</span><span class="dv">00</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">21</span><span class="sc">:</span><span class="dv">00</span></span>
<span id="cb87-3"><a href="#cb87-3"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">14</span><span class="sc">:</span><span class="dv">00</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">21</span><span class="sc">:</span><span class="dv">00</span></span>
<span id="cb87-4"><a href="#cb87-4"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">17</span><span class="sc">:</span><span class="dv">00</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">42</span><span class="sc">:</span><span class="dv">00</span></span>
<span id="cb87-5"><a href="#cb87-5"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">23</span><span class="sc">:</span><span class="dv">00</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">50</span><span class="sc">:</span><span class="dv">00</span></span>
<span id="cb87-6"><a href="#cb87-6"></a><span class="dv">5</span><span class="sc">:</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">23</span><span class="sc">:</span><span class="dv">00</span> <span class="dv">2014-01-01</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">50</span><span class="sc">:</span><span class="dv">00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Write the <code>batrips_dates</code> to <code>"iso.txt"</code> file using the <code>"ISO"</code> format.</li>
<li>Import the file back using <code>fread()</code> and print it to understand how the <code>datetime</code> columns were written to file.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># read data</span></span>
<span id="cb88-2"><a href="#cb88-2"></a>batrips_dates <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/batrips_dates.rds"</span>)</span>
<span id="cb88-3"><a href="#cb88-3"></a></span>
<span id="cb88-4"><a href="#cb88-4"></a><span class="co"># Write batrips_dates to file using "ISO" format</span></span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="fu">fwrite</span>(batrips_dates, <span class="st">"data/iso.txt"</span>, <span class="at">dateTimeAs =</span> <span class="st">"ISO"</span>)</span>
<span id="cb88-6"><a href="#cb88-6"></a></span>
<span id="cb88-7"><a href="#cb88-7"></a><span class="co"># Import the file back</span></span>
<span id="cb88-8"><a href="#cb88-8"></a>iso <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/iso.txt"</span>)</span>
<span id="cb88-9"><a href="#cb88-9"></a>iso</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Write <code>batrips_dates</code> to <code>"squash.txt"</code> file using the <code>"squash"</code> format.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># Write batrips_dates to file using "squash" format</span></span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="fu">fwrite</span>(batrips_dates, <span class="st">"data/squash.txt"</span>, <span class="at">dateTimeAs =</span> <span class="st">"squash"</span>)</span>
<span id="cb89-3"><a href="#cb89-3"></a></span>
<span id="cb89-4"><a href="#cb89-4"></a><span class="co"># Import the file back</span></span>
<span id="cb89-5"><a href="#cb89-5"></a>squash <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/squash.txt"</span>)</span>
<span id="cb89-6"><a href="#cb89-6"></a>squash</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Write the <code>batrips_dates</code> to <code>"epoch.txt"</code> file using the <code>"epoch"</code> format.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># Write batrips_dates to file using "epoch" format</span></span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="fu">fwrite</span>(batrips_dates, <span class="st">"data/epoch.txt"</span>, <span class="at">dateTimeAs =</span> <span class="st">"epoch"</span>)</span>
<span id="cb90-3"><a href="#cb90-3"></a></span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="co"># Import the file back</span></span>
<span id="cb90-5"><a href="#cb90-5"></a>epoch <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"data/epoch.txt"</span>)</span>
<span id="cb90-6"><a href="#cb90-6"></a>epoch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are superb! Dates and Datetimes are very common in Data Science and require proper handling.</p>
</section>
<section id="fast-writing-to-disk" class="level2" data-number="5.14">
<h2 data-number="5.14" class="anchored" data-anchor-id="fast-writing-to-disk"><span class="header-section-number">5.14</span> Fast writing to disk</h2>
<p>As mentioned in the video, <code>fwrite()</code> writes data to disk is very fast! Also, just like <code>fread()</code> reads data in parallel, <code>fwrite()</code> also writes to file in <code>parallel</code>. The number of threads to write data to disk can be controlled using <code>nThread</code> argument.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Write <code>batrips</code> to file using base R’s <code>write.table()</code>.</li>
<li>Wrap the call inside <code>system.time()</code> to see how long this operation takes.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># Use write.table() to write batrips</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="fu">system.time</span>(<span class="fu">write.table</span>(batrips, <span class="st">"data/base-r.txt"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Write <code>batrips</code> to file using <code>data.table</code>’s <code>fwrite()</code>.</li>
<li>Wrap the call inside <code>system.time()</code> to see how long this operation takes.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="co"># Use fwrite() to write batrips</span></span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="fu">system.time</span>(<span class="fu">fwrite</span>(batrips, <span class="st">"data/data-table.txt"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You are sensational! Congratulations on completing this introductory course on <code>data.table</code>!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>

<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">9: Cleaning Data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../../../content/R/topics/03_data_wrangling/joining_data_with_datatable/joining_data_with_datatable.html" class="pagination-link">
        <span class="nav-page-text">11: Joining Data with data.table</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2022 by <a href="https://www.startupengineer.io/authors/schwarz/">Joschka Schwarz</a> <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/jwarz/jwarz.github.io">View the source at GitHub</a></div>
  </div>
</footer>



<script src="../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>