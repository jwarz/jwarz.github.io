<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joschka Schwarz">

<title>Joschka Schwarz - Supervised Learning in R: Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../../content/R/topics/07_machine_learning/03_unsupervised_learning/03_unsupervised_learning.html" rel="next">
<link href="../../../../../content/R/topics/07_machine_learning/01_supervised_learning_classification/01_supervised_learning_classification.html" rel="prev">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

<link href="../../../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Joschka Schwarz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-science" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Science</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-science">    
        <li>
    <a class="dropdown-item" href="../../../../../content/R/index.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/python/index.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/sql/index.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../../slides/index.html">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../resumes/index.html">
 <span class="menu-text">Resumes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jwarz/"><i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/j-schwarz"><i class="bi bi-linkedin" role="img" aria-label="Quarto LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Supervised Learning in R: Regression</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Topics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <b><i>1 Programming Basics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/01_programming_beginner/01_programming_beginner.html" class="sidebar-item-text sidebar-link">1.1: Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/02_programming_intermediate/02_programming_intermediate.html" class="sidebar-item-text sidebar-link">1.2: Intermediate R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/03_programming_tidyverse/03_programming_tidyverse.html" class="sidebar-item-text sidebar-link">1.3: Introduction to the tidyverse</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>2 Importing Data</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/01_importing_data_beginner/01_importing_data_beginner.html" class="sidebar-item-text sidebar-link">2.1: Introduction to Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/02_importing_data_intermediate/02_importing_data_intermediate.html" class="sidebar-item-text sidebar-link">2.2: Intermediate Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/03_working_with_web_data/03_working_with_web_data.html" class="sidebar-item-text sidebar-link">2.3: Working with web data</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>3 Data Wrangling</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/01_data_manipulation_with_dplyr/01_data_manipulation_with_dplyr.html" class="sidebar-item-text sidebar-link">3.1: Data Manipulation with dplyr</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/02_joining_data_with_dplyr/02_joining_data_with_dplyr.html" class="sidebar-item-text sidebar-link">3.2: Joining data with dplyr</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/exploratory_data_analysis_in_r/exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">3.3: Exploratory Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/case_study_exploratory_data_analysis_in_r/case_study_exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">3.4: Case Study: EDA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" class="sidebar-item-text sidebar-link">3.5: Cleaning Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/data_manipulation_with_datatable/data_manipulation_with_datatable.html" class="sidebar-item-text sidebar-link">3.6: Data Manipulation with data.table</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/joining_data_with_datatable/joining_data_with_datatable.html" class="sidebar-item-text sidebar-link">3.7: Joining Data with data.table</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>4 Data Visualization</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/introduction_to_data_visualization_with_ggplot2/ggplot2_intro.html" class="sidebar-item-text sidebar-link">4.1: Introduction to Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/data_visualization_with_ggplot2_intermediate/ggplot2_intermediate.html" class="sidebar-item-text sidebar-link">4.2: Intermediate Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>5 Statistics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/01_statistics_beginner/01_statistics_beginner.html" class="sidebar-item-text sidebar-link">5.1: Introduction to Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/02_foundations_of_probability_in_r/02_foundations_of_probability_in_r.html" class="sidebar-item-text sidebar-link">5.2: Foundations of Probability</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/03_regression_beginner/03_regression_beginner.html" class="sidebar-item-text sidebar-link">5.3: Introduction to Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/04_regression_intermediate/04_regression_intermediate.html" class="sidebar-item-text sidebar-link">5.4: Intermediate Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/06_modeling_with_data_in_the_tidyverse/06_modeling_with_data_in_the_tidyverse.html" class="sidebar-item-text sidebar-link">5.5: Modeling with Data in the Tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/09_experimental_design/09_experimental_design.html" class="sidebar-item-text sidebar-link">5.6: Experimental Design</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/10_ab_testing_in_r/10_ab_testing_in_r.html" class="sidebar-item-text sidebar-link">5.7: A/B Testing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/19_fundamentals_of_bayesian_data_analysis/19_fundamentals_of_bayesian_data_analysis.html" class="sidebar-item-text sidebar-link">5.8: Fundamentals of Bayesian Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/21_factor_analysis_in_r/21_factor_analysis_in_r.html" class="sidebar-item-text sidebar-link">5.9: Factor Analysis</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>7 Machine Learning</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/01_supervised_learning_classification/01_supervised_learning_classification.html" class="sidebar-item-text sidebar-link">7.1: Supervised Learning: Classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/02_supervised_learning_regression/02_supervised_learning_regression.html" class="sidebar-item-text sidebar-link active">7.2: Supervised Learning: Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/03_unsupervised_learning/03_unsupervised_learning.html" class="sidebar-item-text sidebar-link">7.3: Unsupervised Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/04_machine_learning_in_the_tidyverse/04_machine_learning_in_the_tidyverse.html" class="sidebar-item-text sidebar-link">7.4: Machine Learning in the tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/05_cluster_analysis/05_cluster_analysis.html" class="sidebar-item-text sidebar-link">7.5: Cluster Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/06_machine_learning_with_caret/06_machine_learning_with_caret.html" class="sidebar-item-text sidebar-link">7.6: Machine Learning with caret</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/07_modeling_with_tidymodels/07_modeling_with_tidymodels.html" class="sidebar-item-text sidebar-link">7.7: Modeling with tidymodels</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/08_machine_learning_with_tree-based_models/08_machine_learning_with_tree-based_models.html" class="sidebar-item-text sidebar-link">7.8: Machine Learning with tree-based Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/09_support_vector_machines/09_support_vector_machines.html" class="sidebar-item-text sidebar-link">7.9: Support Vector Machines</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/10_topic_modeling/10_topic_modeling.html" class="sidebar-item-text sidebar-link">7.10: Topic Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/11_hyperparameter_tuning/11_hyperparameter_tuning.html" class="sidebar-item-text sidebar-link">7.11: Hyperparameter Tuning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/12_bayesian_regression_modeling_with_rstanarm/12_bayesian_regression_modeling_with_rstanarm.html" class="sidebar-item-text sidebar-link">7.12: Bayesian Regression Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/13_spark_with_sparklyr_in_R/13_spark_with_sparklyr_in_R.html" class="sidebar-item-text sidebar-link">7.13: Introduction to Spark</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">R Manuals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/test.html" class="sidebar-item-text sidebar-link">1: An Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/02-content.html" class="sidebar-item-text sidebar-link">2: R Data Import/Export</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/03-content.html" class="sidebar-item-text sidebar-link">3: R Installation and Administration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/04-content.html" class="sidebar-item-text sidebar-link">4: Writing R Extensions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/05-content.html" class="sidebar-item-text sidebar-link">5: R Language Definition</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/06-content.html" class="sidebar-item-text sidebar-link">6: R Internals</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#what-is-regression" id="toc-what-is-regression" class="nav-link active" data-scroll-target="#what-is-regression"><span class="toc-section-number">1</span>  What is Regression?</a>
  <ul class="collapse">
  <li><a href="#welcome-and-introduction" id="toc-welcome-and-introduction" class="nav-link" data-scroll-target="#welcome-and-introduction"><span class="toc-section-number">1.1</span>  Welcome and Introduction</a></li>
  <li><a href="#identify-the-regression-tasks" id="toc-identify-the-regression-tasks" class="nav-link" data-scroll-target="#identify-the-regression-tasks"><span class="toc-section-number">1.2</span>  Identify the regression tasks</a></li>
  <li><a href="#linear-regression---the-fundamental-method" id="toc-linear-regression---the-fundamental-method" class="nav-link" data-scroll-target="#linear-regression---the-fundamental-method"><span class="toc-section-number">1.4</span>  Linear regression - the fundamental method</a></li>
  <li><a href="#code-a-simple-one-variable-regression" id="toc-code-a-simple-one-variable-regression" class="nav-link" data-scroll-target="#code-a-simple-one-variable-regression"><span class="toc-section-number">1.5</span>  Code a simple one-variable regression</a></li>
  <li><a href="#examining-a-model" id="toc-examining-a-model" class="nav-link" data-scroll-target="#examining-a-model"><span class="toc-section-number">1.6</span>  Examining a model</a></li>
  <li><a href="#predicting-once-you-fit-a-model" id="toc-predicting-once-you-fit-a-model" class="nav-link" data-scroll-target="#predicting-once-you-fit-a-model"><span class="toc-section-number">1.7</span>  Predicting once you fit a model</a></li>
  <li><a href="#predicting-from-the-unemployment-model" id="toc-predicting-from-the-unemployment-model" class="nav-link" data-scroll-target="#predicting-from-the-unemployment-model"><span class="toc-section-number">1.8</span>  Predicting from the unemployment model</a></li>
  <li><a href="#multivariate-linear-regression-part-1" id="toc-multivariate-linear-regression-part-1" class="nav-link" data-scroll-target="#multivariate-linear-regression-part-1"><span class="toc-section-number">1.9</span>  Multivariate linear regression (Part 1)</a></li>
  <li><a href="#multivariate-linear-regression-part-2" id="toc-multivariate-linear-regression-part-2" class="nav-link" data-scroll-target="#multivariate-linear-regression-part-2"><span class="toc-section-number">1.10</span>  Multivariate linear regression (Part 2)</a></li>
  <li><a href="#wrapping-up-linear-regression" id="toc-wrapping-up-linear-regression" class="nav-link" data-scroll-target="#wrapping-up-linear-regression"><span class="toc-section-number">1.11</span>  Wrapping up linear regression</a></li>
  </ul></li>
  <li><a href="#training-and-evaluating-regression-models" id="toc-training-and-evaluating-regression-models" class="nav-link" data-scroll-target="#training-and-evaluating-regression-models"><span class="toc-section-number">2</span>  2. Training and Evaluating Regression Models</a>
  <ul class="collapse">
  <li><a href="#evaluating-a-model-graphically" id="toc-evaluating-a-model-graphically" class="nav-link" data-scroll-target="#evaluating-a-model-graphically"><span class="toc-section-number">2.1</span>  Evaluating a model graphically</a></li>
  <li><a href="#graphically-evaluate-the-unemployment-model" id="toc-graphically-evaluate-the-unemployment-model" class="nav-link" data-scroll-target="#graphically-evaluate-the-unemployment-model"><span class="toc-section-number">2.2</span>  Graphically evaluate the unemployment model</a></li>
  <li><a href="#the-gain-curve-to-evaluate-the-unemployment-model" id="toc-the-gain-curve-to-evaluate-the-unemployment-model" class="nav-link" data-scroll-target="#the-gain-curve-to-evaluate-the-unemployment-model"><span class="toc-section-number">2.3</span>  The gain curve to evaluate the unemployment model</a></li>
  <li><a href="#root-mean-squared-error-rmse" id="toc-root-mean-squared-error-rmse" class="nav-link" data-scroll-target="#root-mean-squared-error-rmse"><span class="toc-section-number">2.4</span>  Root Mean Squared Error (RMSE)</a></li>
  <li><a href="#calculate-rmse" id="toc-calculate-rmse" class="nav-link" data-scroll-target="#calculate-rmse"><span class="toc-section-number">2.5</span>  Calculate RMSE</a></li>
  <li><a href="#r-squared" id="toc-r-squared" class="nav-link" data-scroll-target="#r-squared"><span class="toc-section-number">2.6</span>  R-Squared</a></li>
  <li><a href="#calculate-r-squared" id="toc-calculate-r-squared" class="nav-link" data-scroll-target="#calculate-r-squared"><span class="toc-section-number">2.7</span>  Calculate R-squared</a></li>
  <li><a href="#correlation-and-r-squared" id="toc-correlation-and-r-squared" class="nav-link" data-scroll-target="#correlation-and-r-squared"><span class="toc-section-number">2.8</span>  Correlation and R-squared</a></li>
  <li><a href="#properly-training-a-model" id="toc-properly-training-a-model" class="nav-link" data-scroll-target="#properly-training-a-model"><span class="toc-section-number">2.9</span>  Properly Training a Model</a></li>
  <li><a href="#generating-a-random-testtrain-split" id="toc-generating-a-random-testtrain-split" class="nav-link" data-scroll-target="#generating-a-random-testtrain-split"><span class="toc-section-number">2.10</span>  Generating a random test/train split</a></li>
  <li><a href="#train-a-model-using-testtrain-split" id="toc-train-a-model-using-testtrain-split" class="nav-link" data-scroll-target="#train-a-model-using-testtrain-split"><span class="toc-section-number">2.11</span>  Train a model using test/train split</a></li>
  <li><a href="#evaluate-a-model-using-testtrain-split" id="toc-evaluate-a-model-using-testtrain-split" class="nav-link" data-scroll-target="#evaluate-a-model-using-testtrain-split"><span class="toc-section-number">2.12</span>  Evaluate a model using test/train split</a></li>
  <li><a href="#create-a-cross-validation-plan" id="toc-create-a-cross-validation-plan" class="nav-link" data-scroll-target="#create-a-cross-validation-plan"><span class="toc-section-number">2.13</span>  Create a cross validation plan</a></li>
  <li><a href="#evaluate-a-modeling-procedure-using-n-fold-cross-validation" id="toc-evaluate-a-modeling-procedure-using-n-fold-cross-validation" class="nav-link" data-scroll-target="#evaluate-a-modeling-procedure-using-n-fold-cross-validation"><span class="toc-section-number">2.14</span>  Evaluate a modeling procedure using n-fold cross-validation</a></li>
  </ul></li>
  <li><a href="#issues-to-consider" id="toc-issues-to-consider" class="nav-link" data-scroll-target="#issues-to-consider"><span class="toc-section-number">3</span>  3. Issues to Consider</a>
  <ul class="collapse">
  <li><a href="#categorical-inputs" id="toc-categorical-inputs" class="nav-link" data-scroll-target="#categorical-inputs"><span class="toc-section-number">3.1</span>  Categorical inputs</a></li>
  <li><a href="#examining-the-structure-of-categorical-inputs" id="toc-examining-the-structure-of-categorical-inputs" class="nav-link" data-scroll-target="#examining-the-structure-of-categorical-inputs"><span class="toc-section-number">3.2</span>  Examining the structure of categorical inputs</a></li>
  <li><a href="#modeling-with-categorical-inputs" id="toc-modeling-with-categorical-inputs" class="nav-link" data-scroll-target="#modeling-with-categorical-inputs"><span class="toc-section-number">3.3</span>  Modeling with categorical inputs</a></li>
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions"><span class="toc-section-number">3.4</span>  Interactions</a></li>
  <li><a href="#modeling-an-interaction" id="toc-modeling-an-interaction" class="nav-link" data-scroll-target="#modeling-an-interaction"><span class="toc-section-number">3.5</span>  Modeling an interaction</a></li>
  <li><a href="#modeling-an-interaction-2" id="toc-modeling-an-interaction-2" class="nav-link" data-scroll-target="#modeling-an-interaction-2"><span class="toc-section-number">3.6</span>  Modeling an interaction (2)</a></li>
  <li><a href="#transforming-the-response-before-modeling" id="toc-transforming-the-response-before-modeling" class="nav-link" data-scroll-target="#transforming-the-response-before-modeling"><span class="toc-section-number">3.7</span>  Transforming the response before modeling</a></li>
  <li><a href="#relative-error" id="toc-relative-error" class="nav-link" data-scroll-target="#relative-error"><span class="toc-section-number">3.8</span>  Relative error</a></li>
  <li><a href="#modeling-log-transformed-monetary-output" id="toc-modeling-log-transformed-monetary-output" class="nav-link" data-scroll-target="#modeling-log-transformed-monetary-output"><span class="toc-section-number">3.9</span>  Modeling log-transformed monetary output</a></li>
  <li><a href="#comparing-rmse-and-root-mean-squared-relative-error" id="toc-comparing-rmse-and-root-mean-squared-relative-error" class="nav-link" data-scroll-target="#comparing-rmse-and-root-mean-squared-relative-error"><span class="toc-section-number">3.10</span>  Comparing RMSE and root-mean-squared Relative Error</a></li>
  <li><a href="#transforming-inputs-before-modeling" id="toc-transforming-inputs-before-modeling" class="nav-link" data-scroll-target="#transforming-inputs-before-modeling"><span class="toc-section-number">3.11</span>  Transforming inputs before modeling</a></li>
  <li><a href="#input-transforms-the-hockey-stick" id="toc-input-transforms-the-hockey-stick" class="nav-link" data-scroll-target="#input-transforms-the-hockey-stick"><span class="toc-section-number">3.12</span>  Input transforms: the “hockey stick”</a></li>
  <li><a href="#input-transforms-the-hockey-stick-2" id="toc-input-transforms-the-hockey-stick-2" class="nav-link" data-scroll-target="#input-transforms-the-hockey-stick-2"><span class="toc-section-number">3.13</span>  Input transforms: the “hockey stick” (2)</a></li>
  </ul></li>
  <li><a href="#dealing-with-non-linear-responses" id="toc-dealing-with-non-linear-responses" class="nav-link" data-scroll-target="#dealing-with-non-linear-responses"><span class="toc-section-number">4</span>  4. Dealing with Non-Linear Responses</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-to-predict-probabilities" id="toc-logistic-regression-to-predict-probabilities" class="nav-link" data-scroll-target="#logistic-regression-to-predict-probabilities"><span class="toc-section-number">4.1</span>  Logistic regression to predict probabilities</a></li>
  <li><a href="#fit-a-model-of-sparrow-survival-probability" id="toc-fit-a-model-of-sparrow-survival-probability" class="nav-link" data-scroll-target="#fit-a-model-of-sparrow-survival-probability"><span class="toc-section-number">4.2</span>  Fit a model of sparrow survival probability</a></li>
  <li><a href="#predict-sparrow-survival" id="toc-predict-sparrow-survival" class="nav-link" data-scroll-target="#predict-sparrow-survival"><span class="toc-section-number">4.3</span>  Predict sparrow survival</a></li>
  <li><a href="#poisson-and-quasipoisson-regression-to-predict-counts" id="toc-poisson-and-quasipoisson-regression-to-predict-counts" class="nav-link" data-scroll-target="#poisson-and-quasipoisson-regression-to-predict-counts"><span class="toc-section-number">4.4</span>  Poisson and quasipoisson regression to predict counts</a></li>
  <li><a href="#poisson-or-quasipoisson" id="toc-poisson-or-quasipoisson" class="nav-link" data-scroll-target="#poisson-or-quasipoisson"><span class="toc-section-number">4.5</span>  Poisson or quasipoisson</a></li>
  <li><a href="#fit-a-model-to-predict-bike-rental-counts" id="toc-fit-a-model-to-predict-bike-rental-counts" class="nav-link" data-scroll-target="#fit-a-model-to-predict-bike-rental-counts"><span class="toc-section-number">4.7</span>  Fit a model to predict bike rental counts</a></li>
  <li><a href="#predict-bike-rentals-on-new-data" id="toc-predict-bike-rentals-on-new-data" class="nav-link" data-scroll-target="#predict-bike-rentals-on-new-data"><span class="toc-section-number">4.8</span>  Predict bike rentals on new data</a></li>
  <li><a href="#visualize-the-bike-rental-predictions" id="toc-visualize-the-bike-rental-predictions" class="nav-link" data-scroll-target="#visualize-the-bike-rental-predictions"><span class="toc-section-number">4.9</span>  Visualize the bike rental predictions</a></li>
  <li><a href="#gam-to-learn-non-linear-transforms" id="toc-gam-to-learn-non-linear-transforms" class="nav-link" data-scroll-target="#gam-to-learn-non-linear-transforms"><span class="toc-section-number">4.10</span>  GAM to learn non-linear transforms</a></li>
  <li><a href="#writing-formulas-for-gam-models" id="toc-writing-formulas-for-gam-models" class="nav-link" data-scroll-target="#writing-formulas-for-gam-models"><span class="toc-section-number">4.11</span>  Writing formulas for GAM models</a></li>
  <li><a href="#writing-formulas-for-gam-models-2" id="toc-writing-formulas-for-gam-models-2" class="nav-link" data-scroll-target="#writing-formulas-for-gam-models-2"><span class="toc-section-number">4.13</span>  Writing formulas for GAM models (2)</a></li>
  <li><a href="#model-soybean-growth-with-gam" id="toc-model-soybean-growth-with-gam" class="nav-link" data-scroll-target="#model-soybean-growth-with-gam"><span class="toc-section-number">4.15</span>  Model soybean growth with GAM</a></li>
  <li><a href="#predict-with-the-soybean-model-on-test-data" id="toc-predict-with-the-soybean-model-on-test-data" class="nav-link" data-scroll-target="#predict-with-the-soybean-model-on-test-data"><span class="toc-section-number">4.16</span>  Predict with the soybean model on test data</a></li>
  </ul></li>
  <li><a href="#tree-based-methods" id="toc-tree-based-methods" class="nav-link" data-scroll-target="#tree-based-methods"><span class="toc-section-number">5</span>  5. Tree-Based Methods</a>
  <ul class="collapse">
  <li><a href="#the-intuition-behind-tree-based-methods" id="toc-the-intuition-behind-tree-based-methods" class="nav-link" data-scroll-target="#the-intuition-behind-tree-based-methods"><span class="toc-section-number">5.1</span>  The intuition behind tree-based methods</a></li>
  <li><a href="#predicting-with-a-decision-tree" id="toc-predicting-with-a-decision-tree" class="nav-link" data-scroll-target="#predicting-with-a-decision-tree"><span class="toc-section-number">5.2</span>  Predicting with a decision tree</a></li>
  <li><a href="#random-forests" id="toc-random-forests" class="nav-link" data-scroll-target="#random-forests"><span class="toc-section-number">5.4</span>  Random forests</a></li>
  <li><a href="#build-a-random-forest-model-for-bike-rentals" id="toc-build-a-random-forest-model-for-bike-rentals" class="nav-link" data-scroll-target="#build-a-random-forest-model-for-bike-rentals"><span class="toc-section-number">5.5</span>  Build a random forest model for bike rentals</a></li>
  <li><a href="#predict-bike-rentals-with-the-random-forest-model" id="toc-predict-bike-rentals-with-the-random-forest-model" class="nav-link" data-scroll-target="#predict-bike-rentals-with-the-random-forest-model"><span class="toc-section-number">5.6</span>  Predict bike rentals with the random forest model</a></li>
  <li><a href="#visualize-random-forest-bike-model-predictions" id="toc-visualize-random-forest-bike-model-predictions" class="nav-link" data-scroll-target="#visualize-random-forest-bike-model-predictions"><span class="toc-section-number">5.7</span>  Visualize random forest bike model predictions</a></li>
  <li><a href="#one-hot-encoding-categorical-variables" id="toc-one-hot-encoding-categorical-variables" class="nav-link" data-scroll-target="#one-hot-encoding-categorical-variables"><span class="toc-section-number">5.8</span>  One-Hot-Encoding Categorical Variables</a></li>
  <li><a href="#vtreat-on-a-small-example" id="toc-vtreat-on-a-small-example" class="nav-link" data-scroll-target="#vtreat-on-a-small-example"><span class="toc-section-number">5.9</span>  vtreat on a small example</a></li>
  <li><a href="#novel-levels" id="toc-novel-levels" class="nav-link" data-scroll-target="#novel-levels"><span class="toc-section-number">5.10</span>  Novel levels</a></li>
  <li><a href="#vtreat-the-bike-rental-data" id="toc-vtreat-the-bike-rental-data" class="nav-link" data-scroll-target="#vtreat-the-bike-rental-data"><span class="toc-section-number">5.11</span>  vtreat the bike rental data</a></li>
  <li><a href="#gradient-boosting-machines" id="toc-gradient-boosting-machines" class="nav-link" data-scroll-target="#gradient-boosting-machines"><span class="toc-section-number">5.12</span>  Gradient boosting machines</a></li>
  <li><a href="#find-the-right-number-of-trees-for-a-gradient-boosting-machine" id="toc-find-the-right-number-of-trees-for-a-gradient-boosting-machine" class="nav-link" data-scroll-target="#find-the-right-number-of-trees-for-a-gradient-boosting-machine"><span class="toc-section-number">5.13</span>  Find the right number of trees for a gradient boosting machine</a></li>
  <li><a href="#fit-an-xgboost-bike-rental-model-and-predict" id="toc-fit-an-xgboost-bike-rental-model-and-predict" class="nav-link" data-scroll-target="#fit-an-xgboost-bike-rental-model-and-predict"><span class="toc-section-number">5.14</span>  Fit an xgboost bike rental model and predict</a></li>
  <li><a href="#evaluate-the-xgboost-bike-rental-model" id="toc-evaluate-the-xgboost-bike-rental-model" class="nav-link" data-scroll-target="#evaluate-the-xgboost-bike-rental-model"><span class="toc-section-number">5.15</span>  Evaluate the xgboost bike rental model</a></li>
  <li><a href="#visualize-the-xgboost-bike-rental-model" id="toc-visualize-the-xgboost-bike-rental-model" class="nav-link" data-scroll-target="#visualize-the-xgboost-bike-rental-model"><span class="toc-section-number">5.16</span>  Visualize the xgboost bike rental model</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jwarz/jwarz.github.io/edit/main/content/R/topics/07_machine_learning/02_supervised_learning_regression/02_supervised_learning_regression.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jwarz/jwarz.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Supervised Learning in R: Regression</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joschka Schwarz </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>From a machine learning perspective, regression is the task of predicting numerical outcomes from various inputs. In this course, you’ll learn about different regression models, how to train these models in R, how to evaluate the models you train and use them to make predictions.</p>
<section id="what-is-regression" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> What is Regression?</h1>
<p>In this chapter we introduce the concept of regression from a machine learning point of view. We will present the fundamental regression method: linear regression. We will show how to fit a linear regression model and to make predictions from the model.</p>
<section id="welcome-and-introduction" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="welcome-and-introduction"><span class="header-section-number">1.1</span> Welcome and Introduction</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Welcome and Introduction</strong></p>
<p>Hi. This is Nina Zumel and John Mount from Win-Vector LLC. Welcome to our course on regression in machine learning. Regression is the task of</p>
<p><strong>2. What is Regression?</strong></p>
<p>predicting a numerical outcome based on the values of a set of inputs, or independent variables.In the statistical sense, regression is predicting the expected value of an outcome, but in the casual sense, and for the purposes of this course, we’ll define regression as predicting numerical values.This distinguishes regression from classification, which is the task of making discrete predictions.</p>
<p><strong>3. What is Regression?</strong></p>
<p>Predicting how many units of a product will sell, or how much it will sell for, are regression problems.Predicting if a customer will buy a product (yes or no) is a classification problem.Let’s walk through an example regression task.</p>
<p><strong>4. Example: Predict Temperature from Chirp Rate</strong></p>
<p>Here we see a scatterplot of how fast a cricket chirps (chirps per second) on the x axis, and the temperature on the y axis. Let’s say our goal is to predict the temperature by measuring cricket chirp rate. Suppose we fit a linear</p>
<p><strong>5. Predict Temperature from Chirp Rate</strong></p>
<p>regression model to this data (we’ll show you how later in this course). The predictions from this model are shown by the blue line. If we assume that temperature is linearly related to cricket chirp rate, then the blue line is the best fit line through the data, and it predicts what the expected temperature should be, based on the observed chirp rate.</p>
<p><strong>6. Predict Temperature from Chirp Rate</strong></p>
<p>For example, suppose we hear a cricket chirping at 16.5 chirps/second. We see here that this model predicts a temperature of about 80 degrees.</p>
<p><strong>7. Regression from a Machine Learning Perspective</strong></p>
<p>Let’s step back and look at the reasons for modeling. Modeling from a scientific mindset focuses on understanding the process that produced the data: how each variable affects the outcome.Modeling from an engineering or machine learning mindset focuses on predicting future events accurately, and less on the relationship between variables and outcomes.In this course, we will emphasize predicting accurately. You will learn several algorithms for fitting regression models. By the end of this course, you should have a better idea about the advantages and disadvantages of each algorithm.Now let’s do an</p>
<p><strong>8. Let’s practice!</strong></p>
<p>exercise to quickly review what you’ve learned.</p>
</section>
<section id="identify-the-regression-tasks" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="identify-the-regression-tasks"><span class="header-section-number">1.2</span> Identify the regression tasks</h2>
<p>From a machine learning perspective, the term <em>regression</em> generally encompasses the prediction of continuous values. Statistically, these predictions are the <em>expected value</em>, or the average value one would observe for the given input values.</p>
<p>Which of the following tasks are regression problems?</p>
<blockquote class="blockquote">
<h2 id="question" data-number="1.3" class="anchored"><span class="header-section-number">1.3</span> <em>Question</em></h2>
<p>???<br> <br> ⬜ Predict (yes/no) whether a student will pass the final exam, given scores on midterms and homework.<br> ✅ Predict the student’s score (0 - 100) on the final exam, given scores on midterms and homework.<br> ⬜ Predict the student’s final grade (A, B, C, D, F) in the class given scores on midterms and homework (before they’ve taken the final exam).<br></p>
</blockquote>
<p>Yes! On average, a student with these scores should get the predicted final exam score.</p>
</section>
<section id="linear-regression---the-fundamental-method" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="linear-regression---the-fundamental-method"><span class="header-section-number">1.4</span> Linear regression - the fundamental method</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Linear regression - the fundamental method</strong></p>
<p>Let’s start with the most basic regression algorithm: linear regression.</p>
<p><strong>2. Linear Regression</strong></p>
<p>Linear regression assumes that the expected outcome is the weighted sum of all the inputs. It also assumes that the change in y is linearly proportional to the change in any x.This is the simplest of the regression methods.</p>
<p><strong>3. Linear Regression in R: lm()</strong></p>
<p>In our cricket example, linear regression assumes that temperature is directly proportional to cricket chirp rate. In R, you fit a linear regression model using the lm function. This function takes as arguments a formula that describes the model you want to fit, and the data. Here, the data is in the dataframe cricket, withan outcome column temperature and an input column chirps_per_sec.</p>
<p><strong>4. Formulas</strong></p>
<p>A formula in R is designated by a twiddle, or tilde. The left hand side of the formula is the outcome you want to predict, such as temperature or blood_pressure. The right hand side of the formula holds the input variables. You can concatenate multiple input variables with a plus sign.To convert a string into a formula, use the as-dot-formula function.</p>
<p><strong>5. Looking at the Model</strong></p>
<p>Print the model to look at its structure. You will see a report on the coefficients (or betas) of the model. The intercept is beta-zero: the value of the model when all the inputs are zero. The other coefficients are the weights for the weighted sum of the variables. In this example, the coefficient for chirps_per_sec is just over 3. That means two things:First the sign of the coefficient is positive, so temperature should increase as chirp rate increases.Second for every unit increase in chirp rate, the temperature should increase by a little over 3 degrees, if everything else is held constant.</p>
<p><strong>6. More Information about the Model</strong></p>
<p>You can get the model diagnostics by calling summary on the model. Summary includes not only the values of the coefficients, but the standard error in their estimated value, along with other diagnostics.We will cover some of these diagnostics in a later chapter, but for now, just know that they are available.</p>
<p><strong>7. More Information about the Model</strong></p>
<p>To get these diagnostics conveniently packaged in a data frame, use the glance function from the package broom. For the R-squared diagnostic you can also use the function wrapFTest from the package sigr.</p>
<p><strong>8. Let’s practice!</strong></p>
<p>Now let’s do some exercises to review what you’ve learned.</p>
</section>
<section id="code-a-simple-one-variable-regression" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="code-a-simple-one-variable-regression"><span class="header-section-number">1.5</span> Code a simple one-variable regression</h2>
<p>For the first coding exercise, you’ll create a formula to define a one-variable modeling task, and then fit a linear model to the data. You are given the rates of male and female unemployment in the United States over several years (<a href="https://college.cengage.com/mathematics/brase/understandable_statistics/7e/students/datasets/slr/frames/slr04.html">Source</a>).</p>
<p>The task is to predict the rate of female unemployment from the observed rate of male unemployment. The outcome is <code>female_unemployment</code>, and the input is <code>male_unemployment</code>.</p>
<p>The sign of the variable coefficient tells you whether the outcome increases (+) or decreases (-) as the variable increases.</p>
<p>Recall the calling interface for <a href="https://www.rdocumentation.org/packages/stats/topics/lm"><code>lm()</code></a> is:</p>
<p><code>lm(formula, data = ___)</code></p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Define a formula that expresses <code>female_unemployment</code> as a function of <code>male_unemployment</code>. Assign the formula to the variable <code>fmla</code> and print it.</li>
<li>Then use <code>lm()</code> and <code>fmla</code> to fit a linear model to predict female unemployment from male unemployment using the data set <code>unemployment</code>.</li>
<li>Print the model. Is the coefficent for male unemployment consistent with what you would expect? Does female unemployment increase as male unemployment does?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load data</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>unemployment <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/unemployment.rds"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># unemployment is loaded in the workspace</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">summary</span>(unemployment)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt;  male_unemployment female_unemployment</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt;  Min.   :2.900     Min.   :4.000      </span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt;  1st Qu.:4.900     1st Qu.:4.400      </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt;  Median :6.000     Median :5.200      </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt;  Mean   :5.954     Mean   :5.569      </span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt;  3rd Qu.:6.700     3rd Qu.:6.100      </span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt;  Max.   :9.800     Max.   :7.900</span></span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co"># Define a formula to express female_unemployment as a function of male_unemployment</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>fmla <span class="ot">&lt;-</span> female_unemployment <span class="sc">~</span> male_unemployment</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co"># Print it</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>fmla</span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt; female_unemployment ~ male_unemployment</span></span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co"># Use the formula to fit a model: unemployment_model</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>unemployment_model <span class="ot">&lt;-</span>  <span class="fu">lm</span>(fmla, <span class="at">data =</span> unemployment)</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co"># Print it </span></span>
<span id="cb1-25"><a href="#cb1-25"></a>unemployment_model</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">#&gt; </span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">#&gt; Call:</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">#&gt; lm(formula = fmla, data = unemployment)</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">#&gt; </span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">#&gt;       (Intercept)  male_unemployment  </span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#&gt;            1.4341             0.6945</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><sup>Created on 2022-03-09 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v2.0.1)</sup></p>
<p>Good work. The coefficient for male unemployment is positive, so female unemployment increases as male unemployment does. Linear regression is the most basic of regression approaches. You can think of this course as ways to address its limitations.</p>
</section>
<section id="examining-a-model" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="examining-a-model"><span class="header-section-number">1.6</span> Examining a model</h2>
<p>Let’s look at the model <code>unemployment_model</code> that you have just created. There are a variety of different ways to examine a model; each way provides different information. We will use <a href="https://www.rdocumentation.org/packages/base/topics/summary"><code>summary()</code></a>, <a href="https://www.rdocumentation.org/packages/broom/topics/glance"><code>broom::glance()</code></a>, and <a href="https://www.rdocumentation.org/packages/sigr/topics/wrapFTest"><code>sigr::wrapFTest()</code></a>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print <code>unemployment_model</code> again. What information does it report?</li>
<li>Call <code>summary()</code> on <code>unemployment_model</code>. In addition to the coefficient values, you get standard errors on the coefficient estimates, and some goodness-of-fit metrics like R-squared.</li>
<li>Call <code>glance()</code> on the model to see the performance metrics in an orderly data frame. Can you match the information from <code>summary()</code> to the columns of <code>glance()</code>?</li>
<li>Now call <code>wrapFTest()</code> on the model to see the R-squared again.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Load packages</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(broom)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="fu">library</span>(sigr)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># Print unemployment_model</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>unemployment_model</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; </span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; Call:</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; lm(formula = fmla, data = unemployment)</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt;       (Intercept)  male_unemployment  </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;            1.4341             0.6945</span></span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co"># Call summary() on unemployment_model to get more details</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="fu">summary</span>(unemployment_model)</span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; </span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; Call:</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; lm(formula = fmla, data = unemployment)</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; </span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt; -0.77621 -0.34050 -0.09004  0.27911  1.31254 </span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt; </span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt; (Intercept)        1.43411    0.60340   2.377   0.0367 *  </span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#&gt; male_unemployment  0.69453    0.09767   7.111 1.97e-05 ***</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">#&gt; ---</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">#&gt; </span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">#&gt; Residual standard error: 0.5803 on 11 degrees of freedom</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">#&gt; Multiple R-squared:  0.8213, Adjusted R-squared:  0.8051 </span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co">#&gt; F-statistic: 50.56 on 1 and 11 DF,  p-value: 1.966e-05</span></span>
<span id="cb2-35"><a href="#cb2-35"></a></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co"># Call glance() on unemployment_model to see the details in a tidier form</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="fu">glance</span>(unemployment_model)</span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">#&gt; # A tibble: 1 × 12</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="co">#&gt;   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">#&gt; 1     0.821         0.805 0.580      50.6 0.0000197     1  -10.3  26.6  28.3</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="co">#&gt; # … with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span>
<span id="cb2-43"><a href="#cb2-43"></a></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co"># Call wrapFTest() on unemployment_model to see the most relevant details</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="fu">wrapFTest</span>(unemployment_model)</span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="co">#&gt; [1] "F Test summary: (R2=0.8213, F(1,11)=50.56, p=1.966e-05)."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><sup>Created on 2022-03-09 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v2.0.1)</sup></p>
<p>Great! There are several different ways to get diagnostics for your model. Use the one that suits your needs or preferences the best.</p>
</section>
<section id="predicting-once-you-fit-a-model" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="predicting-once-you-fit-a-model"><span class="header-section-number">1.7</span> Predicting once you fit a model</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Predicting once you fit a model</strong></p>
<p>Now that you have learned to fit a linear regression model, let’s learn how to make predictions from the model. As with most model fitting algorithms in R, simply calling predict on the model returns the predictions for the data used to fit the model, or the training data. Here,</p>
<p><strong>2. Predicting From the Training Data</strong></p>
<p>we call predict on our cricket model and add a column of predictions to the training data frame. We can</p>
<p><strong>3. Looking at the Predictions</strong></p>
<p>compare the model’s predictions on the x axis to the actual temperatures in the data on the y axis. If the model predicted perfectly, all the points would lie on the blue line, x = y. This graph gives you a visual idea of how close the model’s predictions are to ground truth.In this course, we will use ggplot to create most of the plots.</p>
<p><strong>4. Predicting on New Data</strong></p>
<p>To apply the model to new data, use the argument newdata. Here, we have a new data frame of cricket observations called newchirps. We apply the model to newchirps and add the predictions as a new column to the data frame.The model predicts that a chirp rate of 16-point-5 chirps per second should correspond to a temperature of almost 80 degrees.Now let’s practice</p>
<p><strong>5. Let’s practice!</strong></p>
<p>fitting linear models and making predictions.</p>
</section>
<section id="predicting-from-the-unemployment-model" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="predicting-from-the-unemployment-model"><span class="header-section-number">1.8</span> Predicting from the unemployment model</h2>
<p>In this exercise, you will use your unemployment model <code>unemployment_model</code> to make predictions from the <code>unemployment</code> data, and compare predicted female unemployment rates to the actual observed female unemployment rates on the training data, <code>unemployment</code>. You will also use your model to predict on the new data in <code>newrates</code>, which consists of only one observation, where male unemployment is 5%.</p>
<p>The <a href="https://www.rdocumentation.org/packages/stats/topics/predict.lm"><code>predict()</code></a> interface for <code>lm</code> models takes the form</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">predict</span>(model, newdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will use the <code>ggplot2</code> package to make the plots, so you will add the prediction column to the <code>unemployment</code> data frame. You will plot outcome versus prediction, and compare them to the line that represents perfect predictions (that is when the outcome is equal to the predicted value).</p>
<p>The <code>ggplot2</code> command to plot a scatterplot of <code>dframe$outcome</code> versus <code>dframe$pred</code> (<code>pred</code> on the <em>x</em> axis, <code>outcome</code> on the <em>y</em> axis), along with a blue line where <em><code>outcome == pred</code></em> is as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">ggplot</span>(dframe, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> outcome)) <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2"></a>       <span class="fu">geom_point</span>() <span class="sc">+</span>  </span>
<span id="cb4-3"><a href="#cb4-3"></a>       <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>predict()</code> to predict female unemployment rates from the <code>unemployment</code> data. Assign it to a new column: <code>prediction</code>.</li>
<li>Use the <code>library()</code> command to load the <code>ggplot2</code> package.</li>
<li>Use <code>ggplot()</code> to compare the predictions to actual unemployment rates. Put the predictions on the <em>x</em> axis. How close are the results to the line of perfect prediction?</li>
<li>Use the data frame <code>newrates</code> to predict expected female unemployment rate when male unemployment is 5%. Assign the answer to the variable <code>pred</code> and print it.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Predict female unemployment in the unemployment data set</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>unemployment<span class="sc">$</span>predictions <span class="ot">&lt;-</span>  <span class="fu">predict</span>(unemployment_model)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># load packages</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="fu">library</span>(tibble)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co"># Make a plot to compare predictions to actual (prediction on x axis)</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="fu">ggplot</span>(unemployment, <span class="fu">aes</span>(<span class="at">x =</span> predictions, <span class="at">y =</span> female_unemployment)) <span class="sc">+</span> </span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Predict female unemployment rate when male unemployment is 5%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>newrates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">male_unemployment =</span> <span class="dv">5</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(unemployment_model, <span class="at">newdata =</span> newrates)</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co"># Print it</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;        1 
#&gt; 4.906757</code></pre>
</div>
</div>
<p>Good job! While all the modeling algorithms in R implement the <code>predict()</code> method, the call may be a little different for each one.</p>
</section>
<section id="multivariate-linear-regression-part-1" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="multivariate-linear-regression-part-1"><span class="header-section-number">1.9</span> Multivariate linear regression (Part 1)</h2>
<p>In this exercise, you will work with the blood pressure dataset (<a href="https://college.cengage.com/mathematics/brase/understandable_statistics/7e/students/datasets/mlr/frames/frame.html">Source</a>), and model <code>blood_pressure</code> as a function of <code>weight</code> and <code>age</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Load data</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>bloodpressure <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/bloodpressure.rds"</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># bloodpressure is in the workspace</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="fu">summary</span>(bloodpressure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  blood_pressure       age            weight   
#&gt;  Min.   :128.0   Min.   :46.00   Min.   :167  
#&gt;  1st Qu.:140.0   1st Qu.:56.50   1st Qu.:186  
#&gt;  Median :153.0   Median :64.00   Median :194  
#&gt;  Mean   :150.1   Mean   :62.45   Mean   :195  
#&gt;  3rd Qu.:160.5   3rd Qu.:69.50   3rd Qu.:209  
#&gt;  Max.   :168.0   Max.   :74.00   Max.   :220</code></pre>
</div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Define a formula that expresses <code>blood_pressure</code> explicitly as a function of <code>age</code> and <code>weight</code>. Assign the formula to the variable <code>fmla</code>.</li>
<li>Use <code>fmla</code> to fit a linear model to predict <code>blood_pressure</code> from <code>age</code> and <code>weight</code> in the data set <code>bloodpressure</code>. Call the model <code>bloodpressure_model</code>.</li>
<li>Print the model and call <code>summary()</code> on it. Does blood pressure increase or decrease with age? With weight?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Create the formula and print it</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>fmla <span class="ot">&lt;-</span> blood_pressure <span class="sc">~</span> age <span class="sc">+</span> weight</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># Fit the model: bloodpressure_model</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>bloodpressure_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla, <span class="at">data =</span> bloodpressure)</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co"># Print bloodpressure_model and call summary()</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>bloodpressure_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = fmla, data = bloodpressure)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)          age       weight  
#&gt;     30.9941       0.8614       0.3349</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">summary</span>(bloodpressure_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = fmla, data = bloodpressure)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -3.4640 -1.1949 -0.4078  1.8511  2.6981 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)   
#&gt; (Intercept)  30.9941    11.9438   2.595  0.03186 * 
#&gt; age           0.8614     0.2482   3.470  0.00844 **
#&gt; weight        0.3349     0.1307   2.563  0.03351 * 
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 2.318 on 8 degrees of freedom
#&gt; Multiple R-squared:  0.9768, Adjusted R-squared:  0.9711 
#&gt; F-statistic: 168.8 on 2 and 8 DF,  p-value: 2.874e-07</code></pre>
</div>
</div>
<p>Good! One of the advantages of linear regression is that you can interpret the effects of each variable on the input – to a certain extent. In this case the coefficients for both age and weight are positive, which indicates that bloodpressure tends to increase as both age and weight increase.</p>
</section>
<section id="multivariate-linear-regression-part-2" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="multivariate-linear-regression-part-2"><span class="header-section-number">1.10</span> Multivariate linear regression (Part 2)</h2>
<p>Now you will make predictions using the blood pressure model <code>bloodpressure_model</code> that you fit in the previous exercise.</p>
<p>You will also compare the predictions to outcomes graphically. <code>ggplot2</code> is already loaded in your workspace. Recall the plot command takes the form:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">ggplot</span>(dframe, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> outcome)) <span class="sc">+</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>     <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>     <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>predict()</code> to predict blood pressure in the <code>bloodpressure</code> dataset. Assign the predictions to the column <code>prediction</code>.</li>
<li>Graphically compare the predictions to actual blood pressures. Put predictions on the x axis. How close are the results to the line of perfect prediction?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># predict blood pressure using bloodpressure_model :prediction</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>bloodpressure<span class="sc">$</span>prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(bloodpressure_model)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># plot the results</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="fu">ggplot</span>(bloodpressure, <span class="fu">aes</span>(<span class="at">x =</span> prediction, <span class="at">y =</span> blood_pressure)) <span class="sc">+</span> </span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good! The results stay fairly close to the line of perfect prediction, indicating that the model fits the training data well. From a prediction perspective, multivariate linear regression behaves much as simple (one-variable) linear regression does.</p>
</section>
<section id="wrapping-up-linear-regression" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="wrapping-up-linear-regression"><span class="header-section-number">1.11</span> Wrapping up linear regression</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Wrapping up linear regression</strong></p>
<p>Now you have the basics of linear regression from a machine learning perspective. Before we move to other algorithms, let’s discuss advantages and limitations of linear regression.</p>
<p><strong>2. Pros and Cons of Linear Regression</strong></p>
<p>Linear regression models are easy to fit and to apply. They are concise, so they don’t need much storage. They are smooth and less prone to overfit than other types of models. This means that their prediction performance on new data is usually quite similar to their performance on the training data.</p>
<p><strong>3. Pros and Cons of Linear Regression</strong></p>
<p>They are also somewhat interpretable. As an example, here we show a model of systolic blood pressure as a function of age and weight. The coefficients of the model are both positive, telling us that blood pressure tends to increase as both age and weight increase.</p>
<p><strong>4. Pros and Cons of Linear Regression</strong></p>
<p>The primary disadvantage of linear regression is that it can’t express complex, non linear or non-additive relationships in the data. In data where the relationships are highly complex, linear regression will not predict as well as other models.</p>
<p><strong>5. Collinearity</strong></p>
<p>One last issue with linear regression is collinear variables.Collinearity is when the input (or independent) variables are partially correlated. In the blood pressure example, weight tends to increase as people age, so weight and age could be partially correlated.</p>
<p><strong>6. Collinearity</strong></p>
<p>When variables are highly correlated, the signs of coefficients may not be what you expect: for example you might get a model where blood pressure appears to decrease with weight. This means you can’t interpret coefficients, but it does not necessarily affect the model’s prediction accuracy. So from a machine learning perspective, collinearity may not be too much of an issue.</p>
<p><strong>7. Collinearity</strong></p>
<p>However, unusually large coefficients or standard errors could indicate high collinearity, leading to an unstable model that gives unreliable predictions.Upcoming chapters will present modeling approaches that are less sensitive to collinearity between variables.</p>
<p><strong>8. Coming Next</strong></p>
<p>In the next chapter, you will learn how to evaluate regression models visually and numerically. You will also learn the proper, safe procedure for training a regression model.</p>
<p><strong>9. Let’s practice!</strong></p>
</section>
</section>
<section id="training-and-evaluating-regression-models" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 2. Training and Evaluating Regression Models</h1>
<p>Now that we have learned how to fit basic linear regression models, we will learn how to evaluate how well our models perform. We will review evaluating a model graphically, and look at two basic metrics for regression models. We will also learn how to train a model that will perform well in the wild, not just on training data. Although we will demonstrate these techniques using linear regression, all these concepts apply to models fit with any regression algorithm.</p>
<section id="evaluating-a-model-graphically" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="evaluating-a-model-graphically"><span class="header-section-number">2.1</span> Evaluating a model graphically</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Evaluating a model graphically</strong></p>
<p>In the first part of this chapter, you will learn some ways to evaluate a model’s prediction performance. We will show these techniques on linear models, but they also apply to other regression approaches. In this lesson, you will review how to evaluate a model graphically.</p>
<p><strong>2. Plotting Ground Truth vs.&nbsp;Predictions</strong></p>
<p>You’ve already seen the plot of ground truth vs prediction. Predictions are on the x-axis, and outcomes are on the y-axis. The line x equals y represents the line of perfect prediction: if the model predicted perfectly, all the points would be along this line.You should look for the points to be evenly above and below the x equals y line, and ideally, close to it, as on the left. This means that the errors are not systematic: they are not correlated with the actual outcome.When a model doesn’t fit well, there can be regions where the points are entirely above or below the line. This demonstrates systematic error: errors that are correlated with the value of the outcome. This can indicate that you don’t yet have all the important variables in your model, or that you need an algorithm that can find more complex relationships in the data.</p>
<p><strong>3. The Residual Plot</strong></p>
<p>The residual plot plots the residuals, or the difference between the outcome and the prediction, against the predictions. In a model with no systematic errors, the errors will be evenly distributed between positive and negative, and have about the same magnitude above and below. When there are systematic errors, there will be clusters of all positive or all negative residuals.</p>
<p><strong>4. The Gain Curve</strong></p>
<p>The gain curve plot is useful when sorting the instances is more important than predicting the exact outcome value. In this example, suppose we have a model that predicts home prices, but we are more interested in identifying higher value homes than in predicting their exact selling price.The x-axis shows the fraction of total houses as sorted by the model. The y-axis shows the fraction of total accumulated dollars.The diagonal line represents the gain curve if the houses are sorted randomly. The green curve we call the “wizard curve.” This is the curve a perfect model would trace out. The blue curve is what our model traces out.</p>
<p><strong>5. Reading the Gain Curve</strong></p>
<p>In this example, the model curve and the wizard curve line up almost perfectly for the first 30% of the data. This means the model correctly identified the top 30% highest value houses, and sorted them by price correctly. After that, the model does not sort quite as well, as shown by the gap between the curves.GainCurve plots are also useful for models that predict probability, as we will see later.We will use the GainCurvePlot function from the WVPlots package, which takes as input a data frame, the names of the prediction and outcome columns, and a title.</p>
<p><strong>6. Let’s practice!</strong></p>
<p>Now that you have seen different ways to visualize model performance, let’s practice.</p>
</section>
<section id="graphically-evaluate-the-unemployment-model" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="graphically-evaluate-the-unemployment-model"><span class="header-section-number">2.2</span> Graphically evaluate the unemployment model</h2>
<p>In this exercise you will graphically evaluate the unemployment model, <code>unemployment_model</code>, that you fit to the <code>unemployment</code> data in the previous chapter. Recall that the model predicts <code>female_unemployment</code> from <code>male_unemployment</code>.</p>
<p>You will plot the model’s predictions against the actual <code>female_unemployment</code>; recall the command is of the form</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">ggplot</span>(dframe, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> outcome)) <span class="sc">+</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>       <span class="fu">geom_point</span>() <span class="sc">+</span>  </span>
<span id="cb16-3"><a href="#cb16-3"></a>       <span class="fu">geom_abline</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then you will calculate the residuals:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>residuals <span class="ot">&lt;-</span> actual outcome <span class="sc">-</span> predicted outcome</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and plot predictions against residuals. The residual graph will take a slightly different form: you compare the residuals to the horizontal line x=0 (using <code>geom_hline()</code>) rather than to the line x=y. The command will be provided.</p>
<p>The data frame <code>unemployment</code> and model <code>unemployment_model</code> are available in the workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>predict()</code> to get the model predictions and add them to <code>unemployment</code> as the column <code>predictions</code>.</li>
<li>Plot predictions (on the x-axis) versus actual female unemployment rates. Are the predictions near the \(x=y\) line?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>unemployment<span class="sc">$</span>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(unemployment_model)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># Fill in the blanks to plot predictions (on x-axis) versus the female_unemployment rates</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">ggplot</span>(unemployment, <span class="fu">aes</span>(<span class="at">x =</span> predictions, <span class="at">y =</span> female_unemployment)) <span class="sc">+</span> </span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">geom_abline</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Calculate the residuals between the predictions and actual unemployment rates. Add these residuals to <code>unemployment</code> as the column <code>residuals</code>.</li>
<li>Fill in the blanks to plot predictions (on the x-axis) versus residuals (on the y-axis). <em>This gives you a different view of the model’s predictions as compared to ground truth.</em></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Calculate residuals</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>unemployment<span class="sc">$</span>residuals <span class="ot">&lt;-</span> unemployment<span class="sc">$</span>female_unemployment <span class="sc">-</span> unemployment<span class="sc">$</span>predictions</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co"># Fill in the blanks to plot predictions (on x-axis) versus the residuals</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="fu">ggplot</span>(unemployment, <span class="fu">aes</span>(<span class="at">x =</span> predictions, <span class="at">y =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="fu">ggtitle</span>(<span class="st">"residuals vs. linear model prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Congratulations! You have now evaluated model predictions by comparing them to ground truth, and by examining prediction error.</p>
</section>
<section id="the-gain-curve-to-evaluate-the-unemployment-model" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="the-gain-curve-to-evaluate-the-unemployment-model"><span class="header-section-number">2.3</span> The gain curve to evaluate the unemployment model</h2>
<p>In the previous exercise you made predictions about <code>female_unemployment</code> and visualized the predictions and the residuals. Now, you will also plot the gain curve of the <code>unemployment_model</code>’s predictions against actual <code>female_unemployment</code> using the <a href="https://www.rdocumentation.org/packages/WVPlots/topics/GainCurvePlot"><code>WVPlots::GainCurvePlot()</code></a> function.</p>
<p>For situations where order is more important than exact values, the gain curve helps you check if the model’s predictions sort in the same order as the true outcome.</p>
<p>Calls to the function <code>GainCurvePlot()</code> look like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">GainCurvePlot</span>(frame, xvar, truthvar, title)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where</p>
<ul>
<li><code>frame</code> is a data frame</li>
<li><code>xvar</code> and <code>truthvar</code> are strings naming the prediction and actual outcome columns of <code>frame</code></li>
<li><code>title</code> is the title of the plot</li>
</ul>
<p>When the predictions sort in exactly the same order, the relative Gini coefficient is 1. When the model sorts poorly, the relative Gini coefficient is close to zero, or even negative.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the package <code>WVPlots</code> using <code>library()</code>.</li>
<li>Plot the gain curve. Give the plot the title “Unemployment model”. Do the model’s predictions sort correctly?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Load the package WVPlots</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">library</span>(WVPlots)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Lade nötiges Paket: wrapr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attache Paket: 'wrapr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Das folgende Objekt ist maskiert 'package:tibble':
#&gt; 
#&gt;     view</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Plot the Gain Curve</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">GainCurvePlot</span>(unemployment, <span class="st">"predictions"</span>, <span class="st">"female_unemployment"</span>, <span class="st">"Unemployment model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Congratulations! A relative gini coefficient close to one shows that the model correctly sorts high unemployment situations from lower ones.</p>
</section>
<section id="root-mean-squared-error-rmse" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="root-mean-squared-error-rmse"><span class="header-section-number">2.4</span> Root Mean Squared Error (RMSE)</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Root Mean Squared Error (RMSE)</strong></p>
<p>In this lesson, you will learn about a key metric for evaluating the prediction performance of a regression model: root mean squared error.</p>
<p><strong>2. What is Root Mean Squared Error (RMSE)?</strong></p>
<p>RMSE is defined as the square root of the mean squared error of the model on a data set. You can think of the RMSE as the “typical” prediction error of your model on that data. Many regression algorithms, like linear regression, are designed to minimize squared error, so it’s a natural metric, in that sense.</p>
<p><strong>3. RMSE of the Home Sales Price Model</strong></p>
<p>Let’s walk through calculating the RMSE of the home sales price model we saw earlier, on the data set houseprices. Assume price is the column of actual sale prices and prediction is the column of predicted prices. First, calculate the error vector.</p>
<p><strong>4. RMSE of the Home Sales Price Model</strong></p>
<p>Then square it.</p>
<p><strong>5. RMSE of the Home Sales Price Model</strong></p>
<p>Take the mean of the squared error and square root. This results in an RMSE of about 58-point-3. You can think of this as a typical prediction error of 58-point-3 thousand dollars.</p>
<p><strong>6. Is the RMSE Large or Small?</strong></p>
<p>Is the RMSE large or small? The answer depends on how accurate you need the prediction to be for your specific problem, but one way to evaluate the RMSE is to compare it to the standard deviation of the outcome. In our example, the standard deviation is about 135 thousand dollars. Think of this as the typical difference between a specific house price in the data and the average house price. The RMSE being smaller than the standard deviation means that the model tends to estimate prices better than simply taking the average.</p>
<p><strong>7. Let’s practice!</strong></p>
<p>Now let’s practice fitting models and calculating the RMSE.</p>
</section>
<section id="calculate-rmse" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="calculate-rmse"><span class="header-section-number">2.5</span> Calculate RMSE</h2>
<p>In this exercise you will calculate the RMSE of your unemployment model. In the previous coding exercises, you added two columns to the <code>unemployment</code> dataset:</p>
<ul>
<li>the model’s predictions (<code>predictions</code> column)</li>
<li>the residuals between the predictions and the outcome (<code>residuals</code> column) You can calculate the RMSE from a vector of residuals, \(res\), as:</li>
</ul>
<p><img src="https://render.githubusercontent.com/render/math?math={\color{red}RMSE = \sqrt{mean(res^2)}}"></p>
<p>You want RMSE to be small. How small is “small”? One heuristic is to compare the RMSE to the standard deviation ofthe outcome. With a good model, the RMSE should be smaller.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Review the <code>unemployment</code> data from the previous exercise.</p></li>
<li><p>For convenience, assign the <code>residuals</code> column from <code>unemployment</code> to the variable <code>res</code>.</p></li>
<li><p>Calculate RMSE: square <code>res</code>, take its mean, and then square root it. Assign this to the variable<code>rmse</code> and print it.: you can do this in one step by wrapping the assignment in parentheses: `(rmse</p>
<ul>
<li>Tip: you can do this in one step by wrapping the assignment in parentheses: `(rmse</li>
</ul></li>
<li><p>Calculate the standard deviation of <code>female_unemployment</code> and assign it to the variable <code>sd_unemployment</code>. Print it.How does the rmse of the model compare to the standard deviation of the data?*</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># For convenience put the residuals in the variable res</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>res <span class="ot">&lt;-</span> unemployment<span class="sc">$</span>residuals</span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co"># Calculate RMSE, assign it to the variable rmse and print it</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>(rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(res<span class="sc">^</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.5337612</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Calculate the standard deviation of female_unemployment and print it</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>(sd_unemployment <span class="ot">&lt;-</span> <span class="fu">sd</span>(unemployment<span class="sc">$</span>female_unemployment))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1.314271</code></pre>
</div>
</div>
<p>Good job! An RMSE much smaller than the outcome’s standard deviation suggests a model that predicts well.</p>
</section>
<section id="r-squared" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="r-squared"><span class="header-section-number">2.6</span> R-Squared</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. R-Squared (<span class="math inline">\(R^2\)</span>)</strong></p>
<p>In this lesson you will learn about another key metric for evaluating regression models: R-squared.</p>
<p><strong>2. What is <span class="math inline">\(R^2\)</span>?</strong></p>
<p>The R-squared is a measure of how well a model fits the data. It is a value between 0 and 1. Values near 1 indicate a model that fits the data well; values near 0 indicate a model that is no better than always predicting the average value of the data.</p>
<p><strong>3. Calculating <span class="math inline">\(R^2\)</span></strong></p>
<p>R-squared is defined as 1 minus the ratio of the residual sum of squares to the total sum of squares. Since the total sum of squares is the variance of the data, R-squared is sometimes called the variance explained by the model. The residual sum of squares is the sum of the squared error of the model’s predictions. If the RSS is small compared to the total sum of squares, then R-squared is large, and the model fits the data well.</p>
<p><strong>4. Calculate <span class="math inline">\(R^2\)</span> of the House Price Model: RSS</strong></p>
<p>Let’s calculate the R-squared of the house price model on its training data. Again, price is the column of actual sale prices and prediction is the column of predicted sale prices.First, calculate the error between the prices and the predictions. Then, take the square of the errors and sum them up. This is the residual sum of squares.</p>
<p><strong>5. Calculate <span class="math inline">\(R^2\)</span> of the House Price Model: <span class="math inline">\(SS_{Tot}\)</span></strong></p>
<p>To calculate the total sum of squares, subtract the mean home price from all the prices, square it and take the sum.</p>
<p><strong>6. Calculate <span class="math inline">\(R^2\)</span> of the House Price Model</strong></p>
<p>Finally, take the ratio of the residual sum of squares to the total sum of squares and subtract it from 1. This is the r-squared.</p>
<p><strong>7. Reading <span class="math inline">\(R^2\)</span> from the lm() model</strong></p>
<p>For lm models, you can read the r-squared from the summary of the model, as we show here. Calling glance on an lm model will also return the r-squared, and other diagnostics, in a data frame.However, not all regression algorithms in R return R-squared, so it’s good to know how to calculate it yourself.</p>
<p><strong>8. Correlation and <span class="math inline">\(R^2\)</span></strong></p>
<p>For models that minimize squared error (like linear regression), the R-squared is the square of the correlation between the outcome and the prediction.</p>
<p><strong>9. Correlation and <span class="math inline">\(R^2\)</span></strong></p>
<p>I like this definition, because it says intuitively what you want to be true of a model: that the predictions and the true outcome are correlated.Note that this correspondence will only be true for the data the model was trained on, not on new data.</p>
<p><strong>10. Let’s practice!</strong></p>
<p>Now let’s practice fitting models and calculating R-squared.</p>
</section>
<section id="calculate-r-squared" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="calculate-r-squared"><span class="header-section-number">2.7</span> Calculate R-squared</h2>
<p>Now that you’ve calculated the RMSE of your model’s predictions, you will examine how well the model fits the data: that is, how much variance does it explain. You can do this using \(R^2\).</p>
<p>Suppose y is the true outcome, p is the prediction from the model, and res = y - p are the residuals of the predictions.</p>
<p>Then the total sum of squares tss (“total variance”) of the data is:</p>
<p><img src="https://render.githubusercontent.com/render/math?math={\color{red}tss = \sum{(y - \overline{y})^2}}"></p>
<p>where overline{y} is the mean value of y.</p>
<p>The residual sum of squared errors of the model, rss is:</p>
<p><img src="https://render.githubusercontent.com/render/math?math={\color{red}rss = \sum{res^2}}"></p>
<p>R^2 (R-squared), the “variance explained” by the model, is then:</p>
<p><img src="https://render.githubusercontent.com/render/math?math={\color{red}1 - \frac{rss}{tss}}"></p>
<p>After you calculate R^2, you will compare what you computed with the R^2 reported by <a href="https://www.rdocumentation.org/packages/broom/topics/glance"><code>glance()</code></a>. <code>glance()</code> returns a one-row data frame; for a linear regression model, one of the columns returned is the R^2 of the model on the training data.</p>
<p>The data frame <code>unemployment</code> is in your workspace, with the columns <code>predictions</code> and <code>residuals</code> that you calculated in a previous exercise.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the mean <code>female_unemployment</code> and assign it to the variable <code>fe_mean</code>.</li>
<li>Calculate the total sum of squares and assign it to the variable <code>tss</code>.</li>
<li>Calculate the residual sum of squares and assign it to the variable <code>rss</code>.</li>
<li>Calculate \(R^2\). Is it a good fit (\(R^2\) near 1)?</li>
<li>Use <code>glance()</code> to get \(R^2\) from the model. <em>Is it the same as what you calculated?</em></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Calculate mean female_unemployment: fe_mean. Print it</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>(fe_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(unemployment<span class="sc">$</span>female_unemployment))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 5.569231</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Calculate total sum of squares: tss. Print it</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>(tss <span class="ot">&lt;-</span> <span class="fu">sum</span>( (unemployment<span class="sc">$</span>female_unemployment <span class="sc">-</span> fe_mean)<span class="sc">^</span><span class="dv">2</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 20.72769</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Calculate residual sum of squares: rss. Print it</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>(rss <span class="ot">&lt;-</span> <span class="fu">sum</span>(unemployment<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 3.703714</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Calculate R-squared: rsq. Print it. Is it a good fit?</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>(rsq <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (rss<span class="sc">/</span>tss))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.8213157</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># Get R-squared from glance. Print it</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>(rsq_glance <span class="ot">&lt;-</span> <span class="fu">glance</span>(unemployment_model)<span class="sc">$</span>r.squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.8213157</code></pre>
</div>
</div>
<p>Excellent! An R-squared close to one suggests a model that predicts well.</p>
</section>
<section id="correlation-and-r-squared" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="correlation-and-r-squared"><span class="header-section-number">2.8</span> Correlation and R-squared</h2>
<p>The linear correlation of two variables, \(x\) and \(y\), measures the strength of the linear relationship between them. When \(x\) and \(y\) are respectively:</p>
<ul>
<li>the outcomes of a regression model that minimizes squared-error (like linear regression) and</li>
<li>the true outcomes <em>of the training data</em>, then the square of the correlation is the same as \(R^2\). You will verify that in this exercise.</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>cor()</code> to get the correlation between the predictions and female unemployment. Assign it to the variable <code>rho</code> and print it. Make sure you use Pearson correlation (the default).</li>
<li>Square <code>rho</code> and assign it to <code>rho2</code>. Print it.</li>
<li>Compare <code>rho2</code> to \(R^2\) from the model (using <code>glance()</code>). Is it the same?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Get the correlation between the prediction and true outcome: rho and print it</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>(rho <span class="ot">&lt;-</span> <span class="fu">cor</span>(unemployment<span class="sc">$</span>predictions, unemployment<span class="sc">$</span>female_unemployment))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.9062647</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Square rho: rho2 and print it</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>(rho2 <span class="ot">&lt;-</span> rho <span class="sc">^</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.8213157</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Get R-squared from glance and print it</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>(rsq_glance <span class="ot">&lt;-</span> <span class="fu">glance</span>(unemployment_model)<span class="sc">$</span>r.squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.8213157</code></pre>
</div>
</div>
<p>Success! Remember this equivalence is only true for the training data, and only for models that minimize squared error.</p>
</section>
<section id="properly-training-a-model" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="properly-training-a-model"><span class="header-section-number">2.9</span> Properly Training a Model</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Properly Training a Model</strong></p>
<p>In this lesson, you will learn best practices for training and evaluating a regression model.</p>
<p><strong>2. Models can perform much better on training than they do on future data.</strong></p>
<p>In general, a model performs better on its own training data than on data it hasn’t yet seen. For simple models like linear regression, this upward bias is often not severe; but for more complex models, or even for a linear model with too many variables, using only the training data to evaluate the model can produce misleading results.Here, we see a model that got an R-squared of 0.9 on its training data, but an R-squared of only 0.15 on new data. This model was overfit.</p>
<p><strong>3. Test/Train Split</strong></p>
<p>When you have a lot of data, the best thing to do is to split your data into two: one set to train the model, and another set to test it.</p>
<p><strong>4. Example: Model Female Unemployment</strong></p>
<p>For this example, we’ll use data from the World Bank about male and female unemployment rates in North America from 1991-2014. We’ll predict female unemployment rates from male unemployment.We have 96 rows of data, which we randomly split into a training set of 66 rows, and a test set of 30 rows.</p>
<p><strong>5. Model Performance: Train vs.&nbsp;Test</strong></p>
<p>We can fit a linear model to the training data, and then calculate RMSE and R-squared of the model for both the training and test sets. Here the model performs similarly on both sets, slightly better on training. Since the performance is not too different on test, we know the model is not overfit.</p>
<p><strong>6. Cross-Validation</strong></p>
<p>If you don’t have enough data to split into training and test sets, use cross-validation to estimate a model’s out of sample performance. In n-fold cross-validation, you partition the data into n-subsets (in the figure we use n = 3). Let’s call them A, B, and C.</p>
<p><strong>7. Cross-Validation</strong></p>
<p>First, train a model using the data from sets A and B, and use that model to make predictions on C.</p>
<p><strong>8. Cross-Validation</strong></p>
<p>Then train a model on B and C to predict on A</p>
<p><strong>9. Cross-Validation</strong></p>
<p>And a model on A and C to predict on B. Now, none of these models has made predictions on its own training data. All the predictions are essentially “test set” predictions.Therefore, RMSE and R-squared calculated from these predictions should give you an unbiased estimate of how a model fit to all the training data will perform on future data.</p>
<p><strong>10. Create a cross-validation plan</strong></p>
<p>We can implement a cross-validation plan using the function kWayCrossValidation from the package vtreat. The function needs the number of rows in the training data, and the number of folds to create. In our example, we use 3 folds.</p>
<p><strong>11. Create a cross-validation plan</strong></p>
<p>The function returns the indices for training and testing for each fold. Use the data with the training indices to fit a model, and then make prediction on the data with the app, or test, indices.</p>
<p><strong>12. Final Model</strong></p>
<p>If the estimated model performance looks good enough, then use all the data to fit a final model. You can’t evaluate this final model’s future performance, because you don’t have data to evaluate it with. Cross-validation only tests the modeling process, while test/train split tests the final model.</p>
<p><strong>13. Example: Unemployment Model</strong></p>
<p>We can use cross-validation to estimate the out of sample performance of a model to fit female unemployment. The estimates are similar to the estimates made by using a test set.Now let’s practice</p>
<p><strong>14. Let’s practice!</strong></p>
<p>test/train splits and cross-validation.</p>
</section>
<section id="generating-a-random-testtrain-split" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="generating-a-random-testtrain-split"><span class="header-section-number">2.10</span> Generating a random test/train split</h2>
<p>For the next several exercises you will use the <code>mpg</code> data from the package <code>ggplot2</code>. The data describes the characteristics of several makes and models of cars from different years. The goal is to predict city fuel efficiency from highway fuel efficiency.</p>
<p>In this exercise, you will split <code>mpg</code> into a training set <code>mpg_train</code> (75% of the data) and a test set <code>mpg_test</code> (25% of the data). One way to do this is to generate a column of uniform random numbers between 0 and 1, using the function <a href="https://www.rdocumentation.org/packages/stats/topics/Uniform"><code>runif()</code></a>.</p>
<p>If you have a data set <code>dframe</code> of size N, and you want a random subset of approximately size 100 * X% of N (where X is between 0 and 1), then:</p>
<ol type="1">
<li>Generate a vector of uniform random numbers: <code>gp = runif(N)</code>.</li>
<li><code>dframe[gp &lt; X,]</code> will be about the right size.</li>
<li><code>dframe[gp &gt;= X,]</code> will be the complement.</li>
</ol>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use the function <code>nrow</code> to get the number of rows in the data frame <code>mpg</code>. Assign this count to the variable <code>N</code> and print it.</li>
<li>Calculate about how many rows 75% of N should be. Assign it to the variable <code>target</code> and print it.</li>
<li>Use <code>runif()</code> to generate a vector of <code>N</code> uniform random numbers, called <code>gp</code>.</li>
<li>Use <code>gp</code> to split <code>mpg</code> into <code>mpg_train</code> and <code>mpg_test</code> (with <code>mpg_train</code> containing approximately 75% of the data).</li>
<li>Use <code>nrow()</code> to check the size of <code>mpg_train</code> and <code>mpg_test</code>. Are they about the right size?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># Use nrow to get the number of rows in mpg (N) and print it</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>(N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Calculate how many rows 75% of N should be and print it</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="co"># Hint: use round() to get an integer</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>(target <span class="ot">&lt;-</span> <span class="fu">round</span>(N <span class="sc">*</span> <span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 176</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Create the vector of N uniform random variables: gp</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>gp <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb50-3"><a href="#cb50-3"></a></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="co"># Use gp to create the training set: mpg_train (75% of data) and mpg_test (25% of data)</span></span>
<span id="cb50-5"><a href="#cb50-5"></a>mpg_train <span class="ot">&lt;-</span> mpg[gp <span class="sc">&lt;</span> <span class="fl">0.75</span>, ]</span>
<span id="cb50-6"><a href="#cb50-6"></a>mpg_test  <span class="ot">&lt;-</span> mpg[gp <span class="sc">&gt;=</span> <span class="fl">0.75</span>, ]</span>
<span id="cb50-7"><a href="#cb50-7"></a></span>
<span id="cb50-8"><a href="#cb50-8"></a><span class="co"># Use nrow() to examine mpg_train and mpg_test</span></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="fu">nrow</span>(mpg_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">nrow</span>(mpg_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 59</code></pre>
</div>
</div>
<p>Great job! A random split won’t always produce sets of exactly X% and (100-X)% of the data, but it should be close.</p>
</section>
<section id="train-a-model-using-testtrain-split" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="train-a-model-using-testtrain-split"><span class="header-section-number">2.11</span> Train a model using test/train split</h2>
<p>Now that you have split the <code>mpg</code> dataset into <code>mpg_train</code> and <code>mpg_test</code>, you will use <code>mpg_train</code> to train a model to predict city fuel efficiency (<code>cty</code>) from highway fuel efficiency (<code>hwy</code>).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a formula <code>fmla</code> that expresses the relationship <code>cty</code> as a function of <code>hwy</code>. Print it.</li>
<li>Train a model <code>mpg_model</code> on <code>mpg_train</code> to predict <code>cty</code> from <code>hwy</code> using <code>fmla</code> and <code>lm()</code>.</li>
<li>Use <code>summary()</code> to examine the model.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># create a formula to express cty as a function of hwy: fmla and print it.</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>(fmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"cty ~ hwy"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; cty ~ hwy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Now use lm() to build a model mpg_model from mpg_train that predicts cty from hwy </span></span>
<span id="cb56-2"><a href="#cb56-2"></a>mpg_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla, <span class="at">data =</span> mpg_train)</span>
<span id="cb56-3"><a href="#cb56-3"></a></span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="co"># Use summary() to examine the model</span></span>
<span id="cb56-5"><a href="#cb56-5"></a><span class="fu">summary</span>(mpg_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = fmla, data = mpg_train)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -2.9972 -0.7239 -0.0179  0.6214  4.4772 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  0.72942    0.37791    1.93   0.0552 .  
#&gt; hwy          0.69071    0.01576   43.82   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 1.247 on 173 degrees of freedom
#&gt; Multiple R-squared:  0.9173, Adjusted R-squared:  0.9169 
#&gt; F-statistic:  1920 on 1 and 173 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Great! Now it’s time to apply the model.</p>
</section>
<section id="evaluate-a-model-using-testtrain-split" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="evaluate-a-model-using-testtrain-split"><span class="header-section-number">2.12</span> Evaluate a model using test/train split</h2>
<p>Now you will test the model <code>mpg_model</code> on the test data, <code>mpg_test</code>. Functions <code>rmse()</code> and <code>r_squared()</code> to calculate RMSE and R-squared have been provided for convenience:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">rmse</span>(predcol, ycol)</span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="fu">r_squared</span>(predcol, ycol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where:</p>
<ul>
<li>predcol: The predicted values</li>
<li>ycol: The actual outcome You will also plot the predictions vs.&nbsp;the outcome.</li>
</ul>
<p>Generally, model performance is better on the training data than the test data (though sometimes the test set “gets lucky”). A slight difference in performance is okay; if the performance on training is significantly better, there is a problem.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Predict city fuel efficiency from <code>hwy</code> on the <code>mpg_train</code> data. Assign the predictions to the column <code>pred</code>.</li>
<li>Predict city fuel efficiency from <code>hwy</code> on the <code>mpg_test</code> data. Assign the predictions to the column <code>pred</code>.</li>
<li>Use <code>rmse()</code> to evaluate rmse for both the test and training sets. Compare. Are the performances similar?</li>
<li>Do the same with <code>r_squared()</code>. Are the performances similar?</li>
<li>Use <code>ggplot2</code> to plot the predictions against <code>cty</code> on the <code>test</code> data.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># rmse &amp; r_squared function</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(predcol, ycol) {</span>
<span id="cb59-3"><a href="#cb59-3"></a>  res <span class="ot">=</span> predcol<span class="sc">-</span>ycol</span>
<span id="cb59-4"><a href="#cb59-4"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>(res<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb59-5"><a href="#cb59-5"></a>}</span>
<span id="cb59-6"><a href="#cb59-6"></a></span>
<span id="cb59-7"><a href="#cb59-7"></a>r_squared <span class="ot">&lt;-</span> <span class="cf">function</span>(predcol, ycol) {</span>
<span id="cb59-8"><a href="#cb59-8"></a>  tss <span class="ot">=</span> <span class="fu">sum</span>( (ycol <span class="sc">-</span> <span class="fu">mean</span>(ycol))<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb59-9"><a href="#cb59-9"></a>  rss <span class="ot">=</span> <span class="fu">sum</span>( (predcol <span class="sc">-</span> ycol)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb59-10"><a href="#cb59-10"></a>  <span class="dv">1</span> <span class="sc">-</span> rss<span class="sc">/</span>tss</span>
<span id="cb59-11"><a href="#cb59-11"></a>}</span>
<span id="cb59-12"><a href="#cb59-12"></a></span>
<span id="cb59-13"><a href="#cb59-13"></a><span class="co"># predict cty from hwy for the training set</span></span>
<span id="cb59-14"><a href="#cb59-14"></a>mpg_train<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mpg_model)</span>
<span id="cb59-15"><a href="#cb59-15"></a></span>
<span id="cb59-16"><a href="#cb59-16"></a><span class="co"># predict cty from hwy for the test set</span></span>
<span id="cb59-17"><a href="#cb59-17"></a>mpg_test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mpg_model, <span class="at">newdata =</span> mpg_test)</span>
<span id="cb59-18"><a href="#cb59-18"></a></span>
<span id="cb59-19"><a href="#cb59-19"></a><span class="co"># Evaluate the rmse on both training and test data and print them</span></span>
<span id="cb59-20"><a href="#cb59-20"></a>(rmse_train <span class="ot">&lt;-</span> <span class="fu">rmse</span>(mpg_train<span class="sc">$</span>pred, mpg_train<span class="sc">$</span>cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1.239602</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>(rmse_test  <span class="ot">&lt;-</span> <span class="fu">rmse</span>(mpg_test<span class="sc">$</span>pred, mpg_test<span class="sc">$</span>cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1.277706</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Evaluate the r-squared on both training and test data.and print them</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>(rsq_train <span class="ot">&lt;-</span> <span class="fu">r_squared</span>(mpg_train<span class="sc">$</span>pred, mpg_train<span class="sc">$</span>cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.9173457</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>(rsq_test <span class="ot">&lt;-</span> <span class="fu">r_squared</span>(mpg_test<span class="sc">$</span>pred, mpg_test<span class="sc">$</span>cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.8997628</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Plot the predictions (on the x-axis) against the outcome (cty) on the test data</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="fu">ggplot</span>(mpg_test, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> cty)) <span class="sc">+</span> </span>
<span id="cb67-3"><a href="#cb67-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="fu">geom_abline</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Excellent! Good performance on the test data is more confirmation that the model works as expected.</p>
</section>
<section id="create-a-cross-validation-plan" class="level2" data-number="2.13">
<h2 data-number="2.13" class="anchored" data-anchor-id="create-a-cross-validation-plan"><span class="header-section-number">2.13</span> Create a cross validation plan</h2>
<p>There are several ways to implement an n-fold cross validation plan. In this exercise you will create such a plan using <code>vtreat::kWayCrossValidation()</code>, and examine it.</p>
<p><code>kWayCrossValidation()</code> creates a cross validation plan with the following call:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>splitPlan <span class="ot">&lt;-</span> <span class="fu">kWayCrossValidation</span>(nRows, nSplits, dframe, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where <code>nRows</code> is the number of rows of data to be split, and <code>nSplits</code> is the desired number of cross-validation folds.</p>
<p>Strictly speaking, <code>dframe</code> and <code>y</code> aren’t used by <code>kWayCrossValidation</code>; they are there for compatibility with other <code>vtreat</code> data partitioning functions. You can set them both to <code>NULL</code>.</p>
<p>The resulting <code>splitPlan</code> is a list of <code>nSplits</code> elements; each element contains two vectors:</p>
<ul>
<li><code>train</code>: the indices of <code>dframe</code> that will form the training set</li>
<li><code>app</code>: the indices of <code>dframe</code> that will form the test (or application) set</li>
</ul>
<p>In this exercise you will create a 3-fold cross-validation plan for the data set <code>mpg</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Load the package <code>vtreat</code>.</p></li>
<li><p>Get the number of rows in <code>mpg</code> and assign it to the variable <code>nRows</code>.</p></li>
<li><p>Call <code>kWayCrossValidation</code> to create a 3-fold cross validation plan and assign it to the variable <code>splitPlan</code>.can set the last two arguments of the function to <code>NULL</code>.</p>
<ul>
<li>You can set the last two arguments of the function to <code>NULL</code>.</li>
</ul></li>
<li><p>Call <code>str()</code> to examine the structure of <code>splitPlan</code>.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># Load the package vtreat</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="fu">library</span>(vtreat)</span>
<span id="cb69-3"><a href="#cb69-3"></a></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="co"># mpg is in the workspace</span></span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="fu">summary</span>(mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  manufacturer          model               displ            year     
#&gt;  Length:234         Length:234         Min.   :1.600   Min.   :1999  
#&gt;  Class :character   Class :character   1st Qu.:2.400   1st Qu.:1999  
#&gt;  Mode  :character   Mode  :character   Median :3.300   Median :2004  
#&gt;                                        Mean   :3.472   Mean   :2004  
#&gt;                                        3rd Qu.:4.600   3rd Qu.:2008  
#&gt;                                        Max.   :7.000   Max.   :2008  
#&gt;       cyl           trans               drv                 cty       
#&gt;  Min.   :4.000   Length:234         Length:234         Min.   : 9.00  
#&gt;  1st Qu.:4.000   Class :character   Class :character   1st Qu.:14.00  
#&gt;  Median :6.000   Mode  :character   Mode  :character   Median :17.00  
#&gt;  Mean   :5.889                                         Mean   :16.86  
#&gt;  3rd Qu.:8.000                                         3rd Qu.:19.00  
#&gt;  Max.   :8.000                                         Max.   :35.00  
#&gt;       hwy             fl               class          
#&gt;  Min.   :12.00   Length:234         Length:234        
#&gt;  1st Qu.:18.00   Class :character   Class :character  
#&gt;  Median :24.00   Mode  :character   Mode  :character  
#&gt;  Mean   :23.44                                        
#&gt;  3rd Qu.:27.00                                        
#&gt;  Max.   :44.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># Get the number of rows in mpg</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>nRows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mpg)</span>
<span id="cb71-3"><a href="#cb71-3"></a></span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="co"># Implement the 3-fold cross-fold plan with vtreat</span></span>
<span id="cb71-5"><a href="#cb71-5"></a>splitPlan <span class="ot">&lt;-</span> <span class="fu">kWayCrossValidation</span>(nRows, <span class="dv">3</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>)</span>
<span id="cb71-6"><a href="#cb71-6"></a></span>
<span id="cb71-7"><a href="#cb71-7"></a><span class="co"># Examine the split plan</span></span>
<span id="cb71-8"><a href="#cb71-8"></a><span class="fu">str</span>(splitPlan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; List of 3
#&gt;  $ :List of 2
#&gt;   ..$ train: int [1:156] 1 2 3 5 9 10 11 12 13 14 ...
#&gt;   ..$ app  : int [1:78] 133 179 229 148 59 197 91 92 155 22 ...
#&gt;  $ :List of 2
#&gt;   ..$ train: int [1:156] 1 2 3 4 5 6 7 8 9 12 ...
#&gt;   ..$ app  : int [1:78] 175 51 125 121 137 171 120 93 40 70 ...
#&gt;  $ :List of 2
#&gt;   ..$ train: int [1:156] 4 6 7 8 10 11 15 16 17 19 ...
#&gt;   ..$ app  : int [1:78] 207 14 3 50 199 49 68 191 62 100 ...
#&gt;  - attr(*, "splitmethod")= chr "kwaycross"</code></pre>
</div>
</div>
<p>Congratulations! You have created a 3-way cross validation plan. In the next exercise you will use this plan to evaluate a potential model.</p>
</section>
<section id="evaluate-a-modeling-procedure-using-n-fold-cross-validation" class="level2" data-number="2.14">
<h2 data-number="2.14" class="anchored" data-anchor-id="evaluate-a-modeling-procedure-using-n-fold-cross-validation"><span class="header-section-number">2.14</span> Evaluate a modeling procedure using n-fold cross-validation</h2>
<p>In this exercise you will use <code>splitPlan</code>, the 3-fold cross validation plan from the previous exercise, to make predictions from a model that predicts <code>mpg$cty</code> from <code>mpg$hwy</code>.</p>
<p>If <code>dframe</code> is the training data, then one way to add a column of cross-validation predictions to the frame is as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># Initialize a column of the appropriate length</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>dframe<span class="sc">$</span>pred.cv <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb73-3"><a href="#cb73-3"></a></span>
<span id="cb73-4"><a href="#cb73-4"></a><span class="co"># k is the number of folds</span></span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="co"># splitPlan is the cross validation plan</span></span>
<span id="cb73-6"><a href="#cb73-6"></a></span>
<span id="cb73-7"><a href="#cb73-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb73-8"><a href="#cb73-8"></a>  <span class="co"># Get the ith split</span></span>
<span id="cb73-9"><a href="#cb73-9"></a>  split <span class="ot">&lt;-</span> splitPlan[[i]]</span>
<span id="cb73-10"><a href="#cb73-10"></a></span>
<span id="cb73-11"><a href="#cb73-11"></a>  <span class="co"># Build a model on the training data </span></span>
<span id="cb73-12"><a href="#cb73-12"></a>  <span class="co"># from this split </span></span>
<span id="cb73-13"><a href="#cb73-13"></a>  <span class="co"># (lm, in this case)</span></span>
<span id="cb73-14"><a href="#cb73-14"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla, <span class="at">data =</span> dframe[split<span class="sc">$</span>train,])</span>
<span id="cb73-15"><a href="#cb73-15"></a></span>
<span id="cb73-16"><a href="#cb73-16"></a>  <span class="co"># make predictions on the </span></span>
<span id="cb73-17"><a href="#cb73-17"></a>  <span class="co"># application data from this split</span></span>
<span id="cb73-18"><a href="#cb73-18"></a>  dframe<span class="sc">$</span>pred.cv[split<span class="sc">$</span>app] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> dframe[split<span class="sc">$</span>app,])</span>
<span id="cb73-19"><a href="#cb73-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cross-validation predicts how well a model built from all the data will perform on new data. As with the test/train split, for a good modeling procedure, cross-validation performance and training performance should be close.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Run the 3-fold cross validation plan from <code>splitPlan</code> and put the predictions in the column <code>mpg$pred.cv</code>.<code>lm()</code> and the formula <code>cty ~ hwy</code>.</li>
<li>Use <code>lm()</code> and the formula <code>cty ~ hwy</code>.</li>
<li>Create a linear regression model on all the <code>mpg</code> data (formula <code>cty ~ hwy</code>) and assign the predictions to <code>mpg$pred</code>.</li>
<li>Use <code>rmse()</code> to get the root mean squared error of the predictions from the full model (<code>mpg$pred</code>). <em>Recall that <code>rmse()</code> takes two arguments, the predicted values, and the actual outcome.</em></li>
<li>Get the root mean squared error of the cross-validation predictions. Are the two values about the same?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># Run the 3-fold cross validation plan from splitPlan</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># Number of folds</span></span>
<span id="cb74-3"><a href="#cb74-3"></a>mpg<span class="sc">$</span>pred.cv <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb74-5"><a href="#cb74-5"></a>  split <span class="ot">&lt;-</span> splitPlan[[i]]</span>
<span id="cb74-6"><a href="#cb74-6"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(cty <span class="sc">~</span> hwy, <span class="at">data =</span> mpg[split<span class="sc">$</span>train, ])</span>
<span id="cb74-7"><a href="#cb74-7"></a>  mpg<span class="sc">$</span>pred.cv[split<span class="sc">$</span>app] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> mpg[split<span class="sc">$</span>app, ])</span>
<span id="cb74-8"><a href="#cb74-8"></a>}</span>
<span id="cb74-9"><a href="#cb74-9"></a></span>
<span id="cb74-10"><a href="#cb74-10"></a><span class="co"># Predict from a full model</span></span>
<span id="cb74-11"><a href="#cb74-11"></a>mpg<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(cty <span class="sc">~</span> hwy, <span class="at">data =</span> mpg))</span>
<span id="cb74-12"><a href="#cb74-12"></a></span>
<span id="cb74-13"><a href="#cb74-13"></a><span class="co"># Get the rmse of the full model's predictions</span></span>
<span id="cb74-14"><a href="#cb74-14"></a><span class="fu">rmse</span>(mpg<span class="sc">$</span>pred, mpg<span class="sc">$</span>cty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1.247045</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># Get the rmse of the cross-validation predictions</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="fu">rmse</span>(mpg<span class="sc">$</span>pred.cv, mpg<span class="sc">$</span>cty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1.256771</code></pre>
</div>
</div>
<p>Congratulations! You have successfully estimated a model’s out-of-sample error via cross-validation. Remember, cross-validation validates the <em>modeling process</em>, not an actual model.</p>
</section>
</section>
<section id="issues-to-consider" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 3. Issues to Consider</h1>
<p>Before moving on to more sophisticated regression techniques, we will look at some other modeling issues: modeling with categorical inputs, interactions between variables, and when you might consider transforming inputs and outputs before modeling. While more sophisticated regression techniques manage some of these issues automatically, it’s important to be aware of them, in order to understand which methods best handle various issues – and which issues you must still manage yourself.</p>
<section id="categorical-inputs" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="categorical-inputs"><span class="header-section-number">3.1</span> Categorical inputs</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Categorical inputs</strong></p>
<p>In this lesson you will see how categorical variables are represented in R models.</p>
<p><strong>2. Example: Effect of Diet on Weight Loss</strong></p>
<p>As an example, suppose we want to model weight loss over 24 months as a function of diet, as well as age and body mass index at the start of the study. Diet is a categorical variable with three possible values: Mediterranean, Low-Carb, and Low-Fat.</p>
<p><strong>3. model.matrix()</strong></p>
<p>In many R modeling functions, categorical variables with N possible levels are represented under the covers as N-1 0/1, or indicator, variables.You can see the representation R uses via the model-dot-matrix call, which takes a formula and a data frame as inputs.</p>
<p><strong>4. Indicator Variables to Represent Categories</strong></p>
<p>In our example, the Diet variable becomes two indicators, one for Low-Fat and another for Mediterranean. The left-out level, Low-Carb, is the default, or reference level.Converting a categorical variable into a set of indicator variables is sometimes called “one-hot-encoding”.</p>
<p><strong>5. Interpreting the Indicator Variables</strong></p>
<p>Under the covers, the lm function solves a numerical problem, with a coefficient for every indicator variable, as shown in the formula here.Recall that for a linear model the Intercept is the predicted value when all the variables equal 0. In our example, this means that the Intercept is the value when Age and BMI are zero, and Diet is Low-Carb. The coefficients for the Mediterranean and Low-Fat diets represent the change in weight loss from being on the low-carbohydrate diet for a person of the same age and bmi. For example, a person on the Mediterranean diet on average lost a kilogram less than a person of the same age and BMI on the Low-Carb diet. Because a categorical</p>
<p><strong>6. Issues with one-hot-encoding</strong></p>
<p>variable with K possible values encodes to K-1 variables, using variables like ZIP code with many many possible values can be dangerous, both for computational reasons and because too many variables relative to the number of datums can lead to overfit.To deal with this problem some algorithms encode the levels as numbers. In our example, we might code the diets as the values 1, 2, and 3. This is not recommended with algorithms like linear regression that treat datums as points in a geometric space, because it can lead to misleading results. Luckily, in R you don’t usually have to worry about encoding categoricals, as most R functions do that for you. However, it’s still important to be aware of the conversion and how to interpret it. Now</p>
<p><strong>7. Let’s practice!</strong></p>
<p>let’s practice working with categorical variables.</p>
</section>
<section id="examining-the-structure-of-categorical-inputs" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="examining-the-structure-of-categorical-inputs"><span class="header-section-number">3.2</span> Examining the structure of categorical inputs</h2>
<p>For this exercise you will call <a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix"><code>model.matrix()</code></a> to examine how R represents data with both categorical and numerical inputs for modeling. The dataset <code>flowers</code> (derived from the <code>Sleuth3</code> package) is loaded into your workspace. It has the following columns:</p>
<ul>
<li><code>Flowers</code>: the average number of flowers on a <em>meadowfoam</em> plant</li>
<li><code>Intensity</code>: the intensity of a light treatment applied to the plant</li>
<li><code>Time</code>: A categorical variable - when (<code>Late</code> or <code>Early</code>) in the lifecycle the light treatment occurred</li>
</ul>
<p>The ultimate goal is to predict <code>Flowers</code> as a function of <code>Time</code> and <code>Intensity</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Call the <code>str()</code> function on <code>flowers</code> to see the types of each column.</p></li>
<li><p>Use the <code>unique()</code> function on the column <code>flowers$Time</code> to see the possible values that <code>Time</code> takes. How many unique values are there?</p></li>
<li><p>Create a formula to express <code>Flowers</code> as a function of <code>Intensity</code> and <code>Time</code>. Assign it to the variable <code>fmla</code> and print it.</p></li>
<li><p>Use <code>fmla</code> and <code>model.matrix()</code> to create the model matrix for the data frame <code>flowers</code>. Assign it to the variable <code>mmat</code>.</p></li>
<li><p>Use <code>head()</code> to examine the first 20 lines of <code>flowers</code>.</p></li>
<li><p>Now examine the first 20 lines of <code>mmat</code>.the numeric column <code>Intensity</code> different?happened to the categorical column <code>Time</code> from <code>flowers</code>?is <code>Time == 'Early'</code> represented? And <code>Time == 'Late'</code>?</p>
<ul>
<li>Is the numeric column <code>Intensity</code> different?</li>
<li>What happened to the categorical column <code>Time</code> from <code>flowers</code>?</li>
<li>How is <code>Time == 'Early'</code> represented? And <code>Time == 'Late'</code>?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># Load packages</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attache Paket: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Das folgende Objekt ist maskiert 'package:wrapr':
#&gt; 
#&gt;     coalesce</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Die folgenden Objekte sind maskiert von 'package:stats':
#&gt; 
#&gt;     filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Die folgenden Objekte sind maskiert von 'package:base':
#&gt; 
#&gt;     intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Load flowers</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>flowers <span class="ot">&lt;-</span> Sleuth3<span class="sc">::</span>case0901 <span class="sc">|&gt;</span> </span>
<span id="cb83-3"><a href="#cb83-3"></a>              <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb83-4"><a href="#cb83-4"></a>              <span class="fu">mutate</span>(<span class="at">Time =</span> <span class="fu">case_when</span>(Time <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Late"</span>,</span>
<span id="cb83-5"><a href="#cb83-5"></a>                                      Time <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Early"</span>))</span>
<span id="cb83-6"><a href="#cb83-6"></a></span>
<span id="cb83-7"><a href="#cb83-7"></a><span class="co"># Call str on flowers to see the types of each column</span></span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="fu">str</span>(flowers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; tibble [24 × 3] (S3: tbl_df/tbl/data.frame)
#&gt;  $ Flowers  : num [1:24] 62.3 77.4 55.3 54.2 49.6 61.9 39.4 45.7 31.3 44.9 ...
#&gt;  $ Time     : chr [1:24] "Late" "Late" "Late" "Late" ...
#&gt;  $ Intensity: int [1:24] 150 150 300 300 450 450 600 600 750 750 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># Use unique() to see how many possible values Time takes</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="fu">unique</span>(flowers<span class="sc">$</span>Time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Late"  "Early"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># Build a formula to express Flowers as a function of Intensity and Time: fmla. Print it</span></span>
<span id="cb87-2"><a href="#cb87-2"></a>(fmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"Flowers ~ Intensity + Time"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Flowers ~ Intensity + Time</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># Use fmla and model.matrix to see how the data is represented for modeling</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>mmat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fmla, flowers)</span>
<span id="cb89-3"><a href="#cb89-3"></a></span>
<span id="cb89-4"><a href="#cb89-4"></a><span class="co"># Examine the first 20 lines of flowers</span></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="fu">head</span>(flowers, <span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Flowers"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Time"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Intensity"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"62.3","2":"Late","3":"150"},{"1":"77.4","2":"Late","3":"150"},{"1":"55.3","2":"Late","3":"300"},{"1":"54.2","2":"Late","3":"300"},{"1":"49.6","2":"Late","3":"450"},{"1":"61.9","2":"Late","3":"450"},{"1":"39.4","2":"Late","3":"600"},{"1":"45.7","2":"Late","3":"600"},{"1":"31.3","2":"Late","3":"750"},{"1":"44.9","2":"Late","3":"750"},{"1":"36.8","2":"Late","3":"900"},{"1":"41.9","2":"Late","3":"900"},{"1":"77.8","2":"Early","3":"150"},{"1":"75.6","2":"Early","3":"150"},{"1":"69.1","2":"Early","3":"300"},{"1":"78.0","2":"Early","3":"300"},{"1":"57.0","2":"Early","3":"450"},{"1":"71.1","2":"Early","3":"450"},{"1":"62.9","2":"Early","3":"600"},{"1":"52.2","2":"Early","3":"600"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># Examine the first 20 lines of mmat</span></span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="fu">head</span>(mmat, <span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    (Intercept) Intensity TimeLate
#&gt; 1            1       150        1
#&gt; 2            1       150        1
#&gt; 3            1       300        1
#&gt; 4            1       300        1
#&gt; 5            1       450        1
#&gt; 6            1       450        1
#&gt; 7            1       600        1
#&gt; 8            1       600        1
#&gt; 9            1       750        1
#&gt; 10           1       750        1
#&gt; 11           1       900        1
#&gt; 12           1       900        1
#&gt; 13           1       150        0
#&gt; 14           1       150        0
#&gt; 15           1       300        0
#&gt; 16           1       300        0
#&gt; 17           1       450        0
#&gt; 18           1       450        0
#&gt; 19           1       600        0
#&gt; 20           1       600        0</code></pre>
</div>
</div>
<p>Now you have seen how most R modeling functions represent categorical variables internally.</p>
</section>
<section id="modeling-with-categorical-inputs" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="modeling-with-categorical-inputs"><span class="header-section-number">3.3</span> Modeling with categorical inputs</h2>
<p>For this exercise you will fit a linear model to the <code>flowers</code> data, to predict <code>Flowers</code> as a function of <code>Time</code> and <code>Intensity</code>.</p>
<p>The model formula <code>fmla</code> that you created in the previous exercise is still in your workspace, as is the model matrix <code>mmat</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>fmla</code> and <code>lm</code> to train a linear model that predicts <code>Flowers</code> from <code>Intensity</code> and <code>Time</code>. Assign the model to the variable <code>flower_model</code>.</li>
<li>Use <code>summary()</code> to remind yourself of the structure of <code>mmat</code>.</li>
<li>Use <code>summary()</code> to examine the <code>flower_model</code>. Do the variables match what you saw in <code>mmat</code>?</li>
<li>Use <code>flower_model</code> to predict the number of flowers. Add the predictions to <code>flowers</code> as the column <code>predictions</code>.</li>
<li>Fill in the blanks to plot predictions vs.&nbsp;actual flowers (predictions on the x-axis).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="co"># Fit a model to predict Flowers from Intensity and Time : flower_model</span></span>
<span id="cb92-2"><a href="#cb92-2"></a>flower_model <span class="ot">&lt;-</span>  <span class="fu">lm</span>(fmla, <span class="at">data =</span> flowers)</span>
<span id="cb92-3"><a href="#cb92-3"></a></span>
<span id="cb92-4"><a href="#cb92-4"></a><span class="co"># Use summary on mmat to remind yourself of its structure</span></span>
<span id="cb92-5"><a href="#cb92-5"></a><span class="fu">summary</span>(mmat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   (Intercept)   Intensity      TimeLate  
#&gt;  Min.   :1    Min.   :150   Min.   :0.0  
#&gt;  1st Qu.:1    1st Qu.:300   1st Qu.:0.0  
#&gt;  Median :1    Median :525   Median :0.5  
#&gt;  Mean   :1    Mean   :525   Mean   :0.5  
#&gt;  3rd Qu.:1    3rd Qu.:750   3rd Qu.:1.0  
#&gt;  Max.   :1    Max.   :900   Max.   :1.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="co"># Use summary to examine the flower_model</span></span>
<span id="cb94-2"><a href="#cb94-2"></a><span class="fu">summary</span>(flower_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = fmla, data = flowers)
#&gt; 
#&gt; Residuals:
#&gt;    Min     1Q Median     3Q    Max 
#&gt; -9.652 -4.139 -1.558  5.632 12.165 
#&gt; 
#&gt; Coefficients:
#&gt;               Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  83.464167   3.273772  25.495  &lt; 2e-16 ***
#&gt; Intensity    -0.040471   0.005132  -7.886 1.04e-07 ***
#&gt; TimeLate    -12.158333   2.629557  -4.624 0.000146 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 6.441 on 21 degrees of freedom
#&gt; Multiple R-squared:  0.7992, Adjusted R-squared:   0.78 
#&gt; F-statistic: 41.78 on 2 and 21 DF,  p-value: 4.786e-08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="co"># predict the number of flowers on each plant</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>flowers<span class="sc">$</span>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(flower_model)</span>
<span id="cb96-3"><a href="#cb96-3"></a></span>
<span id="cb96-4"><a href="#cb96-4"></a><span class="co"># Plot predictions vs actual flowers (predictions on x-axis)</span></span>
<span id="cb96-5"><a href="#cb96-5"></a><span class="fu">ggplot</span>(flowers, <span class="fu">aes</span>(<span class="at">x =</span> predictions, <span class="at">y =</span> Flowers)) <span class="sc">+</span> </span>
<span id="cb96-6"><a href="#cb96-6"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7"></a>  <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Congratulations! You’ve successfully fit a model with a categorical variable, and seen how categorical variables are represented in that model.</p>
</section>
<section id="interactions" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="interactions"><span class="header-section-number">3.4</span> Interactions</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Interactions</strong></p>
<p>In earlier chapters, we said linear regression assumes that inputs affect the outcome linearly and additively. Now we will start to look at cases that violate these assumptions. In this lesson, you will learn about variable interactions. Before</p>
<p><strong>2. Additive relationships</strong></p>
<p>we jump into variable interactions, lets review an example of an additive relationship. Imagine plant height as a function of sunlight and the bacteria in the soil. If the effects of bacteria and sunlight are additive, then the change in plant height is the sum of the effects of bacteria and sunlight respectively.This means a change in sunlight will cause the same change in plant height, no matter what the level of bacteria in the soil, and vice versa.</p>
<p><strong>3. What is an Interaction?</strong></p>
<p>However, if the effect of bacteria is different, depending on the level of sunlight, then there is an interaction between bacteria and sunlight, designated here by the colon.A variable interaction occurs when the simultaneous effect of two variables on the outcome is not additive.</p>
<p><strong>4. What is an Interaction?</strong></p>
<p>Suppose sun is a categorical variable with two values, sun and shade. An interaction between sun and bacteria means that the change in height due to a change in bacteria will be different in sun than it will in shade. It’s like having two bacteria models: one for sun and one for shade.</p>
<p><strong>5. Example of no Interaction: Soybean Yield</strong></p>
<p>Here we see a plot of soybean plant yield as a function of water stress and the levels of ozone and sulfur trioxide present. Stress has two levels: “stressed” and “well-watered”. The slope between ozone and yield is the same for both stressed and well-watered plants, and the same for sulfur trioxide. This shows that there is no significant interaction between stress and either ozone or sulfur trioxide on soybean yield.</p>
<p><strong>6. Example of an Interaction: Alcohol Metabolism</strong></p>
<p>In this plot, we see alcohol metabolism as a function of gastric dehydrogenase activity for men and women. The slopes of the relationships are quite different by gender, indicating that there is an interaction between gastric activity and gender on alcohol metabolism.</p>
<p><strong>7. Expressing Interactions in Formulae</strong></p>
<p>To fit a linear or additive model with interactions in R, you must specify the interaction explicitly. A colon expresses the interaction between two variables. The asterisk is short hand for the main effects of a and b and the interaction between them. Since the asterisk is also the multiplication symbol in R, you must use the I function in a formula to use the expression “a times b” in a formula.</p>
<p><strong>8. Finding the Correct Interaction Pattern</strong></p>
<p>Unfortunately, using the wrong pattern of main effects and interactions in a linear regression can lead to a suboptimal model, as well as incorrect interpretations of how the inputs affect the outcome.In this course, we are interested in prediction, rather than interpreting the model, so we will use cross-validation to estimate the future prediction performance of three possible alcohol metabolism models: a model with no interactions, a model with both main effects and interactions, and a model with only a main effect for gastric activity and an interaction between sex and gastric activity. In this case, the third model performs the best.In future chapters you will learn about regression methods that can learn certain types of interactions from the data, so you don’t have to encode them yourself.</p>
<p><strong>9. Let’s practice!</strong></p>
<p>Now let’s practice modeling interactions.</p>
</section>
<section id="modeling-an-interaction" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="modeling-an-interaction"><span class="header-section-number">3.5</span> Modeling an interaction</h2>
<p>In this exercise you will use interactions to model the effect of gender and gastric activity on alcohol metabolism.</p>
<p>The data frame <code>alcohol</code> has columns:</p>
<ul>
<li><code>Metabol</code>: the alcohol metabolism rate</li>
<li><code>Gastric</code>: the rate of gastric alcohol dehydrogenase activity</li>
<li><code>Sex</code>: the sex of the drinker (<code>Male</code> or <code>Female</code>)</li>
</ul>
<p>In the video, we fit three models to the <code>alcohol</code> data:</p>
<ul>
<li>one with only additive (main effect) terms : <code>Metabol ~ Gastric + Sex</code></li>
<li>two models, each with interactions between gastric activity and sex</li>
</ul>
<p>We saw that one of the models with interaction terms had a better R-squared than the additive model, suggesting that using interaction terms gives a better fit. In this exercise we will compare the R-squared of one of the interaction models to the main-effects-only model.</p>
<p>Recall that the operator <code>:</code> designates the interaction between two variables. The operator <code>*</code> designates the interaction between the two variables, plus the main effects.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>x<span class="sc">*</span>y <span class="ot">=</span> x <span class="sc">+</span> y <span class="sc">+</span> x<span class="sc">:</span>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Write a formula that expresses <code>Metabol</code> as a function of <code>Gastric</code> and <code>Sex</code> with no interactions.the formula to the variable <code>fmla_add</code> and print it.</p>
<ul>
<li>Assign the formula to the variable <code>fmla_add</code> and print it.</li>
</ul></li>
<li><ul>
<li><p>Write a formula that expresses <code>Metabol</code> as a function of the interaction between <code>Gastric</code> and <code>Sex</code>. <code>Gastric</code> as a main effect, but not <code>Sex</code>. the formula to the variable <code>fmla_interaction</code> and print it.</p></li>
<li><p>Add <code>Gastric</code> as a main effect, but not <code>Sex</code>.</p></li>
<li><p>Assign the formula to the variable <code>fmla_interaction</code> and print it.</p></li>
</ul></li>
<li><p>Fit a linear model with only main effects: <code>model_add</code> to the data.</p></li>
<li><p>Fit a linear model with the interaction: <code>model_interaction</code> to the data.</p></li>
<li><p>Call <code>summary()</code> on both models. Which has a better R-squared?</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="co"># Load data</span></span>
<span id="cb98-2"><a href="#cb98-2"></a>alcohol <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/alcohol.rds"</span>)</span>
<span id="cb98-3"><a href="#cb98-3"></a><span class="fu">summary</span>(alcohol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;     Subject         Metabol          Gastric          Sex           
#&gt;  Min.   : 1.00   Min.   : 0.100   Min.   :0.800   Length:32         
#&gt;  1st Qu.: 8.75   1st Qu.: 0.600   1st Qu.:1.200   Class :character  
#&gt;  Median :16.50   Median : 1.700   Median :1.600   Mode  :character  
#&gt;  Mean   :16.50   Mean   : 2.422   Mean   :1.863                     
#&gt;  3rd Qu.:24.25   3rd Qu.: 2.925   3rd Qu.:2.200                     
#&gt;  Max.   :32.00   Max.   :12.300   Max.   :5.200                     
#&gt;    Alcohol         
#&gt;  Length:32         
#&gt;  Class :character  
#&gt;  Mode  :character  
#&gt;                    
#&gt;                    
#&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="co"># Create the formula with main effects only</span></span>
<span id="cb100-2"><a href="#cb100-2"></a>(fmla_add <span class="ot">&lt;-</span> Metabol <span class="sc">~</span> Gastric <span class="sc">+</span> Sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Metabol ~ Gastric + Sex</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="co"># Create the formula with interactions</span></span>
<span id="cb102-2"><a href="#cb102-2"></a>(fmla_interaction <span class="ot">&lt;-</span> Metabol <span class="sc">~</span>  Gastric <span class="sc">+</span> Gastric<span class="sc">:</span>Sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Metabol ~ Gastric + Gastric:Sex</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co"># Fit the main effects only model</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>model_add <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_add, <span class="at">data =</span> alcohol)</span>
<span id="cb104-3"><a href="#cb104-3"></a></span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="co"># Fit the interaction model</span></span>
<span id="cb104-5"><a href="#cb104-5"></a>model_interaction <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_interaction, <span class="at">data =</span> alcohol)</span>
<span id="cb104-6"><a href="#cb104-6"></a></span>
<span id="cb104-7"><a href="#cb104-7"></a><span class="co"># Call summary on both models and compare</span></span>
<span id="cb104-8"><a href="#cb104-8"></a><span class="fu">summary</span>(model_add)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = fmla_add, data = alcohol)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -2.2779 -0.6328 -0.0966  0.5783  4.5703 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  -1.9466     0.5198  -3.745 0.000796 ***
#&gt; Gastric       1.9656     0.2674   7.352 4.24e-08 ***
#&gt; SexMale       1.6174     0.5114   3.163 0.003649 ** 
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 1.331 on 29 degrees of freedom
#&gt; Multiple R-squared:  0.7654, Adjusted R-squared:  0.7492 
#&gt; F-statistic: 47.31 on 2 and 29 DF,  p-value: 7.41e-10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="fu">summary</span>(model_interaction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = fmla_interaction, data = alcohol)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -2.4656 -0.5091  0.0143  0.5660  4.0668 
#&gt; 
#&gt; Coefficients:
#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)      -0.7504     0.5310  -1.413 0.168236    
#&gt; Gastric           1.1489     0.3450   3.331 0.002372 ** 
#&gt; Gastric:SexMale   1.0422     0.2412   4.321 0.000166 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 1.204 on 29 degrees of freedom
#&gt; Multiple R-squared:  0.8081, Adjusted R-squared:  0.7948 
#&gt; F-statistic: 61.05 on 2 and 29 DF,  p-value: 4.033e-11</code></pre>
</div>
</div>
<p>An interaction appears to give a better fit to the data. In the next exercise we will check the models’ out-of-sample performance.</p>
</section>
<section id="modeling-an-interaction-2" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="modeling-an-interaction-2"><span class="header-section-number">3.6</span> Modeling an interaction (2)</h2>
<p>In this exercise, you will compare the performance of the interaction model you fit in the previous exercise to the performance of a main-effects only model. Because this data set is small, we will use cross-validation to simulate making predictions on out-of-sample data.</p>
<p>You will begin to use the <code>dplyr</code> package to do calculations.</p>
<ul>
<li><a href="https://www.rdocumentation.org/packages/dplyr/topics/mutate"><code>mutate()</code></a> adds new columns to a tbl (a type of data frame)</li>
<li><a href="https://www.rdocumentation.org/packages/dplyr/topics/group_by"><code>group_by()</code></a> specifies how rows are grouped in a tbl</li>
<li><a href="https://www.rdocumentation.org/packages/dplyr/topics/summarise"><code>summarize()</code></a> computes summary statistics of a column You will also use <code>tidyr</code>’s <a href="https://www.rdocumentation.org/packages/tidyr/topics/gather"><code>gather()</code></a> which takes multiple columns and collapses them into key-value pairs.</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Use <code>kWayCrossValidation()</code> to create a splitting plan for a 3-fold cross validation.first argument is the number of rows to be split. second argument is the number of folds for the cross-validation.can set the 3rd and 4th arguments of the function to <code>NULL</code>.</p>
<ul>
<li>The first argument is the number of rows to be split.</li>
<li>The second argument is the number of folds for the cross-validation.</li>
<li>You can set the 3rd and 4th arguments of the function to <code>NULL</code>.</li>
</ul></li>
<li><p>Examine and run the sample code to get the 3-fold cross-validation predictions of a model with no interactions and assign them to the column <code>pred_add</code>.</p></li>
<li><p>Get the 3-fold cross-validation predictions of the model with interactions. Assign the predictions to the column <code>pred_interaction</code>.sample code shows you the procedure.the same <code>splitPlan</code> that you already created.</p>
<ul>
<li>The sample code shows you the procedure.</li>
<li>Use the same <code>splitPlan</code> that you already created.</li>
</ul></li>
<li><p>Fill in the blanks tothe predictions into a single column <code>pred</code>.a column of residuals (actual outcome - predicted outcome).the RMSE of the cross-validation predictions for each model type.</p>
<ul>
<li>gather the predictions into a single column <code>pred</code>.</li>
<li>add a column of residuals (actual outcome - predicted outcome).</li>
<li>get the RMSE of the cross-validation predictions for each model type.</li>
</ul></li>
<li><p>Compare the RMSEs. Based on these results, which model should you use?</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="co"># load package</span></span>
<span id="cb108-2"><a href="#cb108-2"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attache Paket: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Die folgenden Objekte sind maskiert von 'package:wrapr':
#&gt; 
#&gt;     pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="co"># alcohol is in the workspace</span></span>
<span id="cb111-2"><a href="#cb111-2"></a><span class="fu">summary</span>(alcohol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;     Subject         Metabol          Gastric          Sex           
#&gt;  Min.   : 1.00   Min.   : 0.100   Min.   :0.800   Length:32         
#&gt;  1st Qu.: 8.75   1st Qu.: 0.600   1st Qu.:1.200   Class :character  
#&gt;  Median :16.50   Median : 1.700   Median :1.600   Mode  :character  
#&gt;  Mean   :16.50   Mean   : 2.422   Mean   :1.863                     
#&gt;  3rd Qu.:24.25   3rd Qu.: 2.925   3rd Qu.:2.200                     
#&gt;  Max.   :32.00   Max.   :12.300   Max.   :5.200                     
#&gt;    Alcohol         
#&gt;  Length:32         
#&gt;  Class :character  
#&gt;  Mode  :character  
#&gt;                    
#&gt;                    
#&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="co"># Both the formulae are in the workspace</span></span>
<span id="cb113-2"><a href="#cb113-2"></a>fmla_add</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Metabol ~ Gastric + Sex</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>fmla_interaction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Metabol ~ Gastric + Gastric:Sex</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="co"># Create the splitting plan for 3-fold cross validation</span></span>
<span id="cb117-2"><a href="#cb117-2"></a><span class="fu">set.seed</span>(<span class="dv">34245</span>)  <span class="co"># set the seed for reproducibility</span></span>
<span id="cb117-3"><a href="#cb117-3"></a>splitPlan <span class="ot">&lt;-</span> <span class="fu">kWayCrossValidation</span>(<span class="fu">nrow</span>(alcohol), <span class="dv">3</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>)</span>
<span id="cb117-4"><a href="#cb117-4"></a></span>
<span id="cb117-5"><a href="#cb117-5"></a><span class="co"># Sample code: Get cross-val predictions for main-effects only model</span></span>
<span id="cb117-6"><a href="#cb117-6"></a>alcohol<span class="sc">$</span>pred_add <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># initialize the prediction vector</span></span>
<span id="cb117-7"><a href="#cb117-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb117-8"><a href="#cb117-8"></a>  split <span class="ot">&lt;-</span> splitPlan[[i]]</span>
<span id="cb117-9"><a href="#cb117-9"></a>  model_add <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_add, <span class="at">data =</span> alcohol[split<span class="sc">$</span>train, ])</span>
<span id="cb117-10"><a href="#cb117-10"></a>  alcohol<span class="sc">$</span>pred_add[split<span class="sc">$</span>app] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_add, <span class="at">newdata =</span> alcohol[split<span class="sc">$</span>app, ])</span>
<span id="cb117-11"><a href="#cb117-11"></a>}</span>
<span id="cb117-12"><a href="#cb117-12"></a></span>
<span id="cb117-13"><a href="#cb117-13"></a><span class="co"># Get the cross-val predictions for the model with interactions</span></span>
<span id="cb117-14"><a href="#cb117-14"></a>alcohol<span class="sc">$</span>pred_interaction <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># initialize the prediction vector</span></span>
<span id="cb117-15"><a href="#cb117-15"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb117-16"><a href="#cb117-16"></a>  split <span class="ot">&lt;-</span> splitPlan[[i]]</span>
<span id="cb117-17"><a href="#cb117-17"></a>  model_interaction <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_interaction, <span class="at">data =</span> alcohol[split<span class="sc">$</span>train, ])</span>
<span id="cb117-18"><a href="#cb117-18"></a>  alcohol<span class="sc">$</span>pred_interaction[split<span class="sc">$</span>app] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_interaction, <span class="at">newdata =</span> alcohol[split<span class="sc">$</span>app, ])</span>
<span id="cb117-19"><a href="#cb117-19"></a>}</span>
<span id="cb117-20"><a href="#cb117-20"></a></span>
<span id="cb117-21"><a href="#cb117-21"></a><span class="co"># Get RMSE</span></span>
<span id="cb117-22"><a href="#cb117-22"></a>alcohol <span class="sc">%&gt;%</span> </span>
<span id="cb117-23"><a href="#cb117-23"></a>  <span class="fu">gather</span>(<span class="at">key =</span> modeltype, <span class="at">value =</span> pred, pred_add, pred_interaction) <span class="sc">%&gt;%</span></span>
<span id="cb117-24"><a href="#cb117-24"></a>  <span class="fu">mutate</span>(<span class="at">residuals =</span> Metabol <span class="sc">-</span> pred) <span class="sc">%&gt;%</span></span>
<span id="cb117-25"><a href="#cb117-25"></a>  <span class="fu">group_by</span>(modeltype) <span class="sc">%&gt;%</span></span>
<span id="cb117-26"><a href="#cb117-26"></a>  <span class="fu">summarize</span>(<span class="at">rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residuals<span class="sc">^</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["modeltype"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rmse"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"pred_add","2":"1.375565"},{"1":"pred_interaction","2":"1.303637"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Cross-validation confirms that a model with interaction will likely give better predictions.</p>
</section>
<section id="transforming-the-response-before-modeling" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="transforming-the-response-before-modeling"><span class="header-section-number">3.7</span> Transforming the response before modeling</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Transforming the response before modeling</strong></p>
<p>Sometimes you get better models by transforming the output, rather than predicting the output directly. In this lesson you will see an example of modeling a transformed output, and transforming the predictions back into the original space.</p>
<p><strong>2. The Log Transform for Monetary Data</strong></p>
<p>For prediction, a useful transformation is log transforming monetary data, like income or profits. Monetary values are often lognormally distributed, which means that they tend to be skewed, with a long tail. Lognormal distributions also typically have a wide dynamic range: in this data, incomes range from 60 dollars to over 700,000. Wide dynamic ranges can also make prediction more difficult.</p>
<p><strong>3. Lognormal Distributions</strong></p>
<p>With lognormal data, the mean value (shown here in green) is generally greater than the median value (shown here in orange). You can think of the median value of an income distribution as representing a typical income: half the subjects have higher income, and half have lower.Regression algorithms usually predict the expected, or mean, value of the output. This means that predicting income directly will tend to overpredict the typical income for subjects with a given set of characteristics.</p>
<p><strong>4. Back to the Normal Distribution</strong></p>
<p>If you take the log of lognormally distributed data, the resulting data is normally distributed. This means the mean tracks the median, and the dynamic range of the data is more modest.Here, we look at the previous income data on a log scale. The distribution looks closer to a normal, and the mean and median</p>
<p><strong>5. The Procedure</strong></p>
<p>are close together. The modeling procedure is to first fit a model to log outcome. Next apply the model</p>
<p><strong>6. The Procedure</strong></p>
<p>to the data you want predictions for. Finally,</p>
<p><strong>7. The Procedure</strong></p>
<p>exponentiate to transform the predictions back to outcome space. One consequence of log-transforming</p>
<p><strong>8. Predicting Log-transformed Outcomes: Multiplicative Error</strong></p>
<p>outcomes is that prediction errors are multiplicative in outcome space. This means the size of the error is relative to the size of the outcome.We can define relative error as the prediction error divided by the true outcome.Log transformations are useful when you want to reduce relative error, rather than additive error. Predicting monetary amounts is one such example. Being off in your prediction by $100 is quite different when the true amount is $250 rather than $10,000. Let’s define a measure</p>
<p><strong>9. Root Mean Squared Relative Error</strong></p>
<p>called root mean squared relative error, by analogy to RMSE. A model that predicts log-outcome will often have lower RMS-relative error and larger RMSE than a model that predicts outcome directly. Let’s see this by example.</p>
<p><strong>10. Example: Model Income Directly</strong></p>
<p>Here we want to predict a person’s income, based on their education and the score from a proficiency test taken about 25 years before the survey.We want to compare a model to predict income to a model that predicts log income. First, we’ll model income directly.</p>
<p><strong>11. Model Performance</strong></p>
<p>We can evaluate the model’s error and relative error on new data. Now</p>
<p><strong>12. Model log(Income)</strong></p>
<p>let’s fit a model that predicts log income. Now transform the</p>
<p><strong>13. Model Performance</strong></p>
<p>predictions back into outcome units, and evaluate this model’s error and relative error on new data.</p>
<p><strong>14. Compare Errors</strong></p>
<p>We can see that modeling the income directly gave a smaller RMSE, but modeling log income gave smaller relative error.Now let’s</p>
<p><strong>15. Let’s practice!</strong></p>
<p>practice predicting log outcome and calculating error and relative error.</p>
</section>
<section id="relative-error" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="relative-error"><span class="header-section-number">3.8</span> Relative error</h2>
<p>In this exercise, you will compare relative error to absolute error. For the purposes of modeling, we will define relative error as</p>
<p><span class="math display">\[
rel = \\frac{(y - pred)}{y}
\]</span></p>
<p>that is, the error is relative to the true outcome. You will measure the overall relative error of a model using root mean squared relative error:</p>
<p><span class="math display">\[
rmse_{rel} = \\sqrt(\\overline{rel^2})
\]</span></p>
<p>where \(\overline{rel^2}\) is the mean of \(rel^2\).</p>
<p>The example (toy) dataset <code>fdata</code> is loaded in your workspace. It includes the columns:</p>
<ul>
<li><code>y</code>: the true output to be predicted by some model; imagine it is the amount of money a customer will spend on a visit to your store.</li>
<li><code>pred</code>: the predictions of a model that predicts <code>y</code>.</li>
<li><code>label</code>: categorical: whether <code>y</code> comes from a population that makes <code>small</code> purchases, or <code>large</code> ones. You want to know which model does “better”: the one predicting the <code>small</code> purchases, or the one predicting <code>large</code> ones.</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Fill in the blanks to examine the data. Notice that large purchases tend to be about 100 times larger than small ones.</p></li>
<li><p>Fill in the blanks to create error columns: residual as <code>y - pred</code>.relative error as <code>residual / y</code>.</p>
<ul>
<li>Define residual as <code>y - pred</code>.</li>
<li>Define relative error as <code>residual / y</code>.</li>
</ul></li>
<li><p>Fill in the blanks to calculate and compare RMSE and relative RMSE.do the absolute errors compare? The relative errors?</p>
<ul>
<li>How do the absolute errors compare? The relative errors?</li>
</ul></li>
<li><p>Examine the plot of predictions versus outcome.your opinion, which model does “better”?</p>
<ul>
<li>In your opinion, which model does “better”?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># Load data</span></span>
<span id="cb118-2"><a href="#cb118-2"></a>fdata <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/fdata.rds"</span>)</span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="fu">summary</span>(fdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;        y                 pred                      label   
#&gt;  Min.   :  -5.894   Min.   :   1.072   small purchases:50  
#&gt;  1st Qu.:   5.407   1st Qu.:   6.373   large purchases:50  
#&gt;  Median :  57.374   Median :  55.693                       
#&gt;  Mean   : 306.204   Mean   : 305.905                       
#&gt;  3rd Qu.: 550.903   3rd Qu.: 547.886                       
#&gt;  Max.   :1101.619   Max.   :1098.896</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># Examine the data: generate the summaries for the groups large and small:</span></span>
<span id="cb120-2"><a href="#cb120-2"></a>fdata <span class="sc">%&gt;%</span> </span>
<span id="cb120-3"><a href="#cb120-3"></a>    <span class="fu">group_by</span>(label) <span class="sc">%&gt;%</span>        <span class="co"># group by small/large purchases</span></span>
<span id="cb120-4"><a href="#cb120-4"></a>    <span class="fu">summarize</span>(<span class="at">min  =</span> <span class="fu">min</span>(y),   <span class="co"># min of y</span></span>
<span id="cb120-5"><a href="#cb120-5"></a>              <span class="at">mean =</span> <span class="fu">mean</span>(y),  <span class="co"># mean of y</span></span>
<span id="cb120-6"><a href="#cb120-6"></a>              <span class="at">max  =</span> <span class="fu">max</span>(y))   <span class="co"># max of y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["label"],"name":[1],"type":["fct"],"align":["left"]},{"label":["min"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["max"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"small purchases","2":"-5.893499","3":"6.478254","4":"18.62829"},{"1":"large purchases","2":"96.119814","3":"605.928673","4":"1101.61864"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="co"># Fill in the blanks to add error columns</span></span>
<span id="cb121-2"><a href="#cb121-2"></a>fdata2 <span class="ot">&lt;-</span> fdata <span class="sc">%&gt;%</span> </span>
<span id="cb121-3"><a href="#cb121-3"></a>         <span class="fu">group_by</span>(label) <span class="sc">%&gt;%</span>               <span class="co"># group by label</span></span>
<span id="cb121-4"><a href="#cb121-4"></a>           <span class="fu">mutate</span>(<span class="at">residual =</span> y <span class="sc">-</span> pred,     <span class="co"># Residual</span></span>
<span id="cb121-5"><a href="#cb121-5"></a>                  <span class="at">relerr   =</span> residual<span class="sc">/</span>y)   <span class="co"># Relative error</span></span>
<span id="cb121-6"><a href="#cb121-6"></a></span>
<span id="cb121-7"><a href="#cb121-7"></a><span class="co"># Compare the rmse and rmse.rel of the large and small groups:</span></span>
<span id="cb121-8"><a href="#cb121-8"></a>fdata2 <span class="sc">%&gt;%</span> </span>
<span id="cb121-9"><a href="#cb121-9"></a>  <span class="fu">group_by</span>(label) <span class="sc">%&gt;%</span> </span>
<span id="cb121-10"><a href="#cb121-10"></a>  <span class="fu">summarize</span>(<span class="at">rmse     =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residual<span class="sc">^</span><span class="dv">2</span>)),  <span class="co"># RMSE</span></span>
<span id="cb121-11"><a href="#cb121-11"></a>            <span class="at">rmse.rel =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(relerr<span class="sc">^</span><span class="dv">2</span>)))    <span class="co"># Root mean squared relative error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["label"],"name":[1],"type":["fct"],"align":["left"]},{"label":["rmse"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["rmse.rel"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"small purchases","2":"4.014969","3":"1.24965673"},{"1":"large purchases","2":"5.544439","3":"0.01473322"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="co"># Plot the predictions for both groups of purchases</span></span>
<span id="cb122-2"><a href="#cb122-2"></a><span class="fu">ggplot</span>(fdata2, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> y, <span class="at">color =</span> label)) <span class="sc">+</span> </span>
<span id="cb122-3"><a href="#cb122-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb122-4"><a href="#cb122-4"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span> </span>
<span id="cb122-5"><a href="#cb122-5"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> label, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb122-6"><a href="#cb122-6"></a>  <span class="fu">ggtitle</span>(<span class="st">"Outcome vs prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Notice from this example how a model with larger RMSE might still be better, if relative errors are more important than absolute errors.</p>
</section>
<section id="modeling-log-transformed-monetary-output" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="modeling-log-transformed-monetary-output"><span class="header-section-number">3.9</span> Modeling log-transformed monetary output</h2>
<p>In this exercise, you will practice modeling on log-transformed monetary output, and then transforming the “log-money” predictions back into monetary units. The data loaded into your workspace records subjects’ incomes in 2005 (<code>Income2005</code>), as well as the results of several aptitude tests taken by the subjects in 1981:</p>
<ul>
<li><code>Arith</code></li>
<li><code>Word</code></li>
<li><code>Parag</code></li>
<li><code>Math</code></li>
<li><code>AFQT</code> (Percentile on the Armed Forces Qualifying Test)</li>
</ul>
<p>The data have already been split into training and test sets (<code>income_train</code> and <code>income_test</code> respectively) and are in the workspace. You will build a model of log(income) from the inputs, and then convert log(income) back into income.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Call <code>summary()</code> on <code>income_train$Income2005</code> to see the summary statistics of income in the training set.</p></li>
<li><p>Write a formula to express <code>log(Income2005)</code> as a function of the five tests as the variable <code>fmla.log</code>. Print it.</p></li>
<li><p>Fit a linear model of <code>log(Income2005)</code> to the <code>income_train</code> data: <code>model.log</code>.</p></li>
<li><p>Use <code>model.log</code> to predict income on the <code>income_test</code> dataset. Put it in the column <code>logpred</code>.<code>summary()</code> of <code>logpred</code> to see that the magnitudes are much different from those of <code>Income2005</code>.</p>
<ul>
<li>Check <code>summary()</code> of <code>logpred</code> to see that the magnitudes are much different from those of <code>Income2005</code>.</li>
</ul></li>
<li><p>Reverse the log transformation to put the predictions into “monetary units”: <code>exp(income_test$logpred)</code>.<code>summary()</code> of <code>pred.income</code> and see that the magnitudes are now similar to <code>Income2005</code> magnitudes.</p>
<ul>
<li>Check <code>summary()</code> of <code>pred.income</code> and see that the magnitudes are now similar to <code>Income2005</code> magnitudes.</li>
</ul></li>
<li><p>Fill in the blanks to plot a scatter plot of predicted income vs income on the test set.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="co"># Load data</span></span>
<span id="cb123-2"><a href="#cb123-2"></a>income_train <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/income_train.rds"</span>) </span>
<span id="cb123-3"><a href="#cb123-3"></a>income_test  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/income_test.rds"</span>)</span>
<span id="cb123-4"><a href="#cb123-4"></a></span>
<span id="cb123-5"><a href="#cb123-5"></a><span class="co"># Examine Income2005 in the training set</span></span>
<span id="cb123-6"><a href="#cb123-6"></a><span class="fu">summary</span>(income_train<span class="sc">$</span>Income2005)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;      63   23000   39000   49894   61500  703637</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="co"># Write the formula for log income as a function of the tests and print it</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>(fmla.log <span class="ot">&lt;-</span> <span class="fu">log</span>(Income2005) <span class="sc">~</span> Arith <span class="sc">+</span> Word <span class="sc">+</span> Parag <span class="sc">+</span> Math <span class="sc">+</span> AFQT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; log(Income2005) ~ Arith + Word + Parag + Math + AFQT</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb127-2"><a href="#cb127-2"></a>model.log <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla.log, <span class="at">data =</span> income_train)</span>
<span id="cb127-3"><a href="#cb127-3"></a></span>
<span id="cb127-4"><a href="#cb127-4"></a><span class="co"># Make predictions on income_test</span></span>
<span id="cb127-5"><a href="#cb127-5"></a>income_test<span class="sc">$</span>logpred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.log, <span class="at">newdata =</span> income_test)</span>
<span id="cb127-6"><a href="#cb127-6"></a><span class="fu">summary</span>(income_test<span class="sc">$</span>logpred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;   9.766  10.133  10.423  10.419  10.705  11.006</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="co"># Convert the predictions to monetary units</span></span>
<span id="cb129-2"><a href="#cb129-2"></a>income_test<span class="sc">$</span>pred.income <span class="ot">&lt;-</span> <span class="fu">exp</span>(income_test<span class="sc">$</span>logpred)</span>
<span id="cb129-3"><a href="#cb129-3"></a><span class="fu">summary</span>(income_test<span class="sc">$</span>pred.income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;   17432   25167   33615   35363   44566   60217</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="co">#  Plot predicted income (x axis) vs income</span></span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="fu">ggplot</span>(income_test, <span class="fu">aes</span>(<span class="at">x =</span> pred.income, <span class="at">y =</span> Income2005)) <span class="sc">+</span> </span>
<span id="cb131-3"><a href="#cb131-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb131-4"><a href="#cb131-4"></a>  <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-35-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! Remember that when you transform the output before modeling, you have to ‘reverse transform’ the resulting predictions after applying the model.</p>
</section>
<section id="comparing-rmse-and-root-mean-squared-relative-error" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="comparing-rmse-and-root-mean-squared-relative-error"><span class="header-section-number">3.10</span> Comparing RMSE and root-mean-squared Relative Error</h2>
<p>In this exercise, you will show that log-transforming a monetary output before modeling improves mean relative error (but increases RMSE) compared to modeling the monetary output directly. You will compare the results of <code>model.log</code> from the previous exercise to a model (<code>model.abs</code>) that directly fits income.</p>
<p>The <code>income_train</code> and <code>income_test</code> datasets are loaded in your workspace, along with your model, <code>model.log</code>.</p>
<p>Also in the workspace:</p>
<ul>
<li><code>model.abs</code>: a model that directly fits income to the inputs using the formula</li>
</ul>
<p><code>Income2005 ~ Arith + Word + Parag + Math + AFQT</code> <strong>Steps</strong></p>
<ol type="1">
<li>Fill in the blanks to add predictions from the models to <code>income_test</code>.’t forget to take the exponent of the predictions from <code>model.log</code> to undo the log transform!</li>
<li>Don’t forget to take the exponent of the predictions from <code>model.log</code> to undo the log transform!</li>
<li>Fill in the blanks to <code>gather()</code> the predictions and calculate the residuals and relative error.</li>
<li>Fill in the blanks to calculate the RMSE and relative RMSE for predictions.model has larger absolute error? Larger relative error?</li>
<li>Which model has larger absolute error? Larger relative error?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="co"># fmla.abs is in the workspace</span></span>
<span id="cb132-2"><a href="#cb132-2"></a>fmla.abs <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"Income2005 ~ Arith + Word + Parag + Math + AFQT"</span>)</span>
<span id="cb132-3"><a href="#cb132-3"></a></span>
<span id="cb132-4"><a href="#cb132-4"></a><span class="co"># model.abs is in the workspace</span></span>
<span id="cb132-5"><a href="#cb132-5"></a>model.abs <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> fmla.abs, <span class="at">data =</span> income_train)</span>
<span id="cb132-6"><a href="#cb132-6"></a><span class="fu">summary</span>(model.abs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = fmla.abs, data = income_train)
#&gt; 
#&gt; Residuals:
#&gt;    Min     1Q Median     3Q    Max 
#&gt; -78728 -24137  -6979  11964 648573 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  17516.7     6420.1   2.728  0.00642 ** 
#&gt; Arith         1552.3      303.4   5.116 3.41e-07 ***
#&gt; Word          -132.3      265.0  -0.499  0.61754    
#&gt; Parag        -1155.1      618.3  -1.868  0.06189 .  
#&gt; Math           725.5      372.0   1.950  0.05127 .  
#&gt; AFQT           177.8      144.1   1.234  0.21734    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 45500 on 2063 degrees of freedom
#&gt; Multiple R-squared:  0.1165, Adjusted R-squared:  0.1144 
#&gt; F-statistic:  54.4 on 5 and 2063 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="co"># Add predictions to the test set</span></span>
<span id="cb134-2"><a href="#cb134-2"></a>income_test <span class="ot">&lt;-</span> income_test <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3"></a>  <span class="fu">mutate</span>(<span class="at">pred.absmodel =</span> <span class="fu">predict</span>(model.abs, income_test),      <span class="co"># predictions from model.abs</span></span>
<span id="cb134-4"><a href="#cb134-4"></a>         <span class="at">pred.logmodel =</span> <span class="fu">exp</span>(<span class="fu">predict</span>(model.log, income_test))) <span class="co"># predictions from model.log</span></span>
<span id="cb134-5"><a href="#cb134-5"></a></span>
<span id="cb134-6"><a href="#cb134-6"></a><span class="co"># Gather the predictions and calculate residuals and relative error</span></span>
<span id="cb134-7"><a href="#cb134-7"></a>income_long <span class="ot">&lt;-</span> income_test <span class="sc">%&gt;%</span> </span>
<span id="cb134-8"><a href="#cb134-8"></a>  <span class="fu">gather</span>(<span class="at">key =</span> modeltype, <span class="at">value =</span> pred, pred.absmodel, pred.logmodel) <span class="sc">%&gt;%</span></span>
<span id="cb134-9"><a href="#cb134-9"></a>  <span class="fu">mutate</span>(<span class="at">residual =</span> pred <span class="sc">-</span> Income2005,     <span class="co"># residuals</span></span>
<span id="cb134-10"><a href="#cb134-10"></a>         <span class="at">relerr   =</span> residual <span class="sc">/</span> Income2005) <span class="co"># relative error</span></span>
<span id="cb134-11"><a href="#cb134-11"></a></span>
<span id="cb134-12"><a href="#cb134-12"></a><span class="co"># Calculate RMSE and relative RMSE and compare</span></span>
<span id="cb134-13"><a href="#cb134-13"></a>income_long <span class="sc">%&gt;%</span> </span>
<span id="cb134-14"><a href="#cb134-14"></a>  <span class="fu">group_by</span>(modeltype) <span class="sc">%&gt;%</span>                       <span class="co"># group by modeltype</span></span>
<span id="cb134-15"><a href="#cb134-15"></a>  <span class="fu">summarize</span>(<span class="at">rmse     =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residual<span class="sc">^</span><span class="dv">2</span>)),  <span class="co"># RMSE</span></span>
<span id="cb134-16"><a href="#cb134-16"></a>            <span class="at">rmse.rel =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(relerr<span class="sc">^</span><span class="dv">2</span>)))    <span class="co"># Root mean squared relative error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["modeltype"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rmse"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["rmse.rel"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"pred.absmodel","2":"37448.37","3":"3.183705"},{"1":"pred.logmodel","2":"39234.90","3":"2.218663"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>You’ve seen how modeling log(income) can reduce the relative error of the fit, at the cost of increased RMSE. Which tradeoff to make depends on the goals of your project.</p>
</section>
<section id="transforming-inputs-before-modeling" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="transforming-inputs-before-modeling"><span class="header-section-number">3.11</span> Transforming inputs before modeling</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Transforming inputs before modeling</strong></p>
<p>Last lesson, you explored transforming the output before modeling. In this lesson, you will explore transforming input variables before modeling.</p>
<p><strong>2. Why To Transform Input Variables</strong></p>
<p>There are many reasons why you might want to transform input variables before modeling. The most important reason is that you have domain knowledge that tells you that a transformed variable may be more informative than the variables that you have. For instance, animal intelligence is related to the ratio of brain mass to body mass to the two-thirds, rather than to brain or body mass directly.</p>
<p><strong>3. Why To Transform Input Variables</strong></p>
<p>You may also want to transform variables for pragmatic reasons, to make the variable easier to model with. The log transform we saw in the previous lesson is again useful, especially for monetary input variables.</p>
<p><strong>4. Why To Transform Input Variables</strong></p>
<p>Or you may want to transform variables to meet modeling assumptions, like linearity.</p>
<p><strong>5. Example: Predicting Anxiety</strong></p>
<p>As an example, here we see a plot that relates a person’s level of anxiety to the number of hassles they experience in a day. The relationship is clearly non-linear: when a person has experienced only a few hassles, another hassle may not affect their anxiety much; but when they are having a day filled with problems, the next hassle may have a much greater impact on their emotions.So if you wanted to fit a linear regression model for anxiety that included hassles as a variable, you would have a problem.</p>
<p><strong>6. Transforming the hassles variable</strong></p>
<p>We can try fitting a model not only to hassles, but to hassles squared or hassles cubed. As the graph shows, both hassles squared or cubed show a better fit to the data than a linear fit.But which model is best?</p>
<p><strong>7. Different possible fits</strong></p>
<p>There are many different transformations of the hassles variable that might give us the shape we observed in the data. If we have a domain knowledge for preferring one, then that’s how we should pick. But if we don’t know, and are mostly concerned with accurate prediction, then we should pick the one that seems to give us the lowest prediction error.Note that when you raise a variable to a power in a formula, you should use the I function to treat the expression mathematically, not as an interaction.</p>
<p><strong>8. Compare different models</strong></p>
<p>We can fit models to hassles, hassles squared, and hassles cubed, and compare. In this case, the cubic model has the best r-squared.</p>
<p><strong>9. Compare different models</strong></p>
<p>We should also validate the models’ out-of-sample performance, in this case by cross-validation. The cubic model still looks the best.Note that we don’t know that hassles literally affect anxiety in a cubic way; we only know that of the three models we tried, the cubic model seems to predict the best.In a later lesson, we will see regression algorithms that can learn some of these input variable transforms automatically, so that the data scientist doesn’t always have to specify them.</p>
<p><strong>10. Let’s practice!</strong></p>
<p>Now let’s practice transforming input variables and modeling with them.</p>
</section>
<section id="input-transforms-the-hockey-stick" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="input-transforms-the-hockey-stick"><span class="header-section-number">3.12</span> Input transforms: the “hockey stick”</h2>
<p>In this exercise, we will build a model to predict price from a measure of the house’s size (surface area). The data set <code>houseprice</code> has the columns:</p>
<ul>
<li><code>price</code> : house price in units of $1000</li>
<li><code>size</code>: surface area</li>
</ul>
<p>A scatterplot of the data shows that the data is quite non-linear: a sort of “hockey-stick” where price is fairly flat for smaller houses, but rises steeply as the house gets larger. Quadratics and tritics are often good functional forms to express hockey-stick like relationships. Note that there may not be a “physical” reason that <code>price</code> is related to the square of the <code>size</code>; a quadratic is simply a closed form approximation of the observed relationship.</p>
<p><img src="https://assets.datacamp.com/production/course_3851/datasets/Ch3_V4_houseprice.png" alt="scatterplot"></p>
<p>You will fit a model to predict price as a function of the squared size, and look at its fit on the training data.</p>
<p>Because <code>^</code> is also a symbol to express interactions, use the function <a href="https://www.rdocumentation.org/packages/base/topics/AsIs"><code>I()</code></a> to treat the expression <code>x^2</code> “as is”: that is, as the square of x rather than the interaction of <code>x</code> with itself.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a>exampleFormula <span class="ot">=</span> y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Write a formula, <code>fmla_sqr</code>, to express price as a function of squared size. Print it.</p></li>
<li><p>Fit a model <code>model_sqr</code> to the data using <code>fmla_sqr</code></p></li>
<li><p>For comparison, fit a linear model <code>model_lin</code> to the data using the formula <code>price ~ size</code>.</p></li>
<li><p>Fill in the blanks to</p>
<ul>
<li>make predictions from the training data from the two models</li>
<li>gather the predictions into a single column <code>pred</code></li>
<li>graphically compare the predictions of the two models to the data. Which fits better?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="co"># houseprice is in the workspace</span></span>
<span id="cb136-2"><a href="#cb136-2"></a>houseprice <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/houseprice.rds"</span>)</span>
<span id="cb136-3"><a href="#cb136-3"></a><span class="fu">summary</span>(houseprice)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;       size           price      
#&gt;  Min.   : 44.0   Min.   : 42.0  
#&gt;  1st Qu.: 73.5   1st Qu.:164.5  
#&gt;  Median : 91.0   Median :203.5  
#&gt;  Mean   : 94.3   Mean   :249.2  
#&gt;  3rd Qu.:118.5   3rd Qu.:287.8  
#&gt;  Max.   :150.0   Max.   :573.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="co"># Create the formula for price as a function of squared size</span></span>
<span id="cb138-2"><a href="#cb138-2"></a>(fmla_sqr <span class="ot">&lt;-</span> price <span class="sc">~</span> <span class="fu">I</span>(size<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; price ~ I(size^2)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="co"># Fit a model of price as a function of squared size (use fmla_sqr)</span></span>
<span id="cb140-2"><a href="#cb140-2"></a>model_sqr <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_sqr, houseprice)</span>
<span id="cb140-3"><a href="#cb140-3"></a></span>
<span id="cb140-4"><a href="#cb140-4"></a><span class="co"># Fit a model of price as a linear function of size</span></span>
<span id="cb140-5"><a href="#cb140-5"></a>model_lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> size, houseprice)</span>
<span id="cb140-6"><a href="#cb140-6"></a></span>
<span id="cb140-7"><a href="#cb140-7"></a><span class="co"># Make predictions and compare</span></span>
<span id="cb140-8"><a href="#cb140-8"></a>houseprice <span class="sc">%&gt;%</span> </span>
<span id="cb140-9"><a href="#cb140-9"></a>    <span class="fu">mutate</span>(<span class="at">pred_lin =</span> <span class="fu">predict</span>(model_lin),       <span class="co"># predictions from linear model</span></span>
<span id="cb140-10"><a href="#cb140-10"></a>           <span class="at">pred_sqr =</span> <span class="fu">predict</span>(model_sqr)) <span class="sc">%&gt;%</span>   <span class="co"># predictions from quadratic model </span></span>
<span id="cb140-11"><a href="#cb140-11"></a>    <span class="fu">gather</span>(<span class="at">key =</span> modeltype, <span class="at">value =</span> pred, pred_lin, pred_sqr) <span class="sc">%&gt;%</span> <span class="co"># gather the predictions</span></span>
<span id="cb140-12"><a href="#cb140-12"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> size)) <span class="sc">+</span> </span>
<span id="cb140-13"><a href="#cb140-13"></a>       <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> price)) <span class="sc">+</span>                  <span class="co"># actual prices</span></span>
<span id="cb140-14"><a href="#cb140-14"></a>       <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred, <span class="at">color =</span> modeltype)) <span class="sc">+</span> <span class="co"># the predictions</span></span>
<span id="cb140-15"><a href="#cb140-15"></a>       <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-38-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Great work! In the next chapter you will see how transformations like this can sometimes be learned automatically.</p>
</section>
<section id="input-transforms-the-hockey-stick-2" class="level2" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="input-transforms-the-hockey-stick-2"><span class="header-section-number">3.13</span> Input transforms: the “hockey stick” (2)</h2>
<p>In the last exercise you saw that a quadratic model seems to fit the <code>houseprice</code> data better than a linear model. In this exercise you will confirm whether the quadratic model would perform better on out-of-sample data. Since this data set is small, you will use cross-validation. The quadratic formula <code>fmla_sqr</code> that you created in the last exercise is in your workspace.</p>
<p>For comparison, the sample code will calculate cross-validation predictions from a linear model <code>price ~ size</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Use <code>kWayCrossValidation()</code> to create a splitting plan for a 3-fold cross validation.can set the 3rd and 4th arguments of the function to <code>NULL</code>.</p>
<ul>
<li>You can set the 3rd and 4th arguments of the function to <code>NULL</code>.</li>
</ul></li>
<li><p>Examine and run the sample code to get the 3-fold cross-validation predictions of the model <code>price ~ size</code> and add them to the column <code>pred_lin</code>.</p></li>
<li><p>Get the cross-validation predictions for price as a function of squared size. Assign them to the column <code>pred_sqr</code>.sample code gives you the procedure.can use the splitting plan you already created.</p>
<ul>
<li>The sample code gives you the procedure.</li>
<li>You can use the splitting plan you already created.</li>
</ul></li>
<li><p>Fill in the blanks to gather the predictions and calculate the residuals.</p></li>
<li><p>Fill in the blanks to compare the RMSE for the two models. Which one fits better?</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="co"># houseprice is in the workspace</span></span>
<span id="cb141-2"><a href="#cb141-2"></a><span class="fu">summary</span>(houseprice)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;       size           price      
#&gt;  Min.   : 44.0   Min.   : 42.0  
#&gt;  1st Qu.: 73.5   1st Qu.:164.5  
#&gt;  Median : 91.0   Median :203.5  
#&gt;  Mean   : 94.3   Mean   :249.2  
#&gt;  3rd Qu.:118.5   3rd Qu.:287.8  
#&gt;  Max.   :150.0   Max.   :573.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="co"># fmla_sqr is in the workspace</span></span>
<span id="cb143-2"><a href="#cb143-2"></a>fmla_sqr <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"price ~ I(size^2)"</span>)</span>
<span id="cb143-3"><a href="#cb143-3"></a></span>
<span id="cb143-4"><a href="#cb143-4"></a><span class="co"># Create a splitting plan for 3-fold cross validation</span></span>
<span id="cb143-5"><a href="#cb143-5"></a><span class="fu">set.seed</span>(<span class="dv">34245</span>)  <span class="co"># set the seed for reproducibility</span></span>
<span id="cb143-6"><a href="#cb143-6"></a>splitPlan <span class="ot">&lt;-</span> <span class="fu">kWayCrossValidation</span>(<span class="fu">nrow</span>(houseprice), <span class="dv">3</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>)</span>
<span id="cb143-7"><a href="#cb143-7"></a></span>
<span id="cb143-8"><a href="#cb143-8"></a><span class="co"># Sample code: get cross-val predictions for price ~ size</span></span>
<span id="cb143-9"><a href="#cb143-9"></a>houseprice<span class="sc">$</span>pred_lin <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># initialize the prediction vector</span></span>
<span id="cb143-10"><a href="#cb143-10"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb143-11"><a href="#cb143-11"></a>  split <span class="ot">&lt;-</span> splitPlan[[i]]</span>
<span id="cb143-12"><a href="#cb143-12"></a>  model_lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> size, <span class="at">data =</span> houseprice[split<span class="sc">$</span>train, ])</span>
<span id="cb143-13"><a href="#cb143-13"></a>  houseprice<span class="sc">$</span>pred_lin[split<span class="sc">$</span>app] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_lin, <span class="at">newdata =</span> houseprice[split<span class="sc">$</span>app, ])</span>
<span id="cb143-14"><a href="#cb143-14"></a>}</span>
<span id="cb143-15"><a href="#cb143-15"></a></span>
<span id="cb143-16"><a href="#cb143-16"></a><span class="co"># Get cross-val predictions for price as a function of size^2 (use fmla_sqr)</span></span>
<span id="cb143-17"><a href="#cb143-17"></a>houseprice<span class="sc">$</span>pred_sqr <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># initialize the prediction vector</span></span>
<span id="cb143-18"><a href="#cb143-18"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb143-19"><a href="#cb143-19"></a>  split <span class="ot">&lt;-</span> splitPlan[[i]]</span>
<span id="cb143-20"><a href="#cb143-20"></a>  model_sqr <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_sqr, <span class="at">data =</span> houseprice[split<span class="sc">$</span>train, ])</span>
<span id="cb143-21"><a href="#cb143-21"></a>  houseprice<span class="sc">$</span>pred_sqr[split<span class="sc">$</span>app] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_sqr, <span class="at">newdata =</span> houseprice[split<span class="sc">$</span>app, ])</span>
<span id="cb143-22"><a href="#cb143-22"></a>}</span>
<span id="cb143-23"><a href="#cb143-23"></a></span>
<span id="cb143-24"><a href="#cb143-24"></a><span class="co"># Gather the predictions and calculate the residuals</span></span>
<span id="cb143-25"><a href="#cb143-25"></a>houseprice_long <span class="ot">&lt;-</span> houseprice <span class="sc">%&gt;%</span></span>
<span id="cb143-26"><a href="#cb143-26"></a>  <span class="fu">gather</span>(<span class="at">key =</span> modeltype, <span class="at">value =</span> pred, pred_lin, pred_sqr) <span class="sc">%&gt;%</span></span>
<span id="cb143-27"><a href="#cb143-27"></a>  <span class="fu">mutate</span>(<span class="at">residuals =</span> pred <span class="sc">-</span> price)</span>
<span id="cb143-28"><a href="#cb143-28"></a></span>
<span id="cb143-29"><a href="#cb143-29"></a><span class="co"># Compare the cross-validated RMSE for the two models</span></span>
<span id="cb143-30"><a href="#cb143-30"></a>houseprice_long <span class="sc">%&gt;%</span> </span>
<span id="cb143-31"><a href="#cb143-31"></a>  <span class="fu">group_by</span>(modeltype) <span class="sc">%&gt;%</span></span>
<span id="cb143-32"><a href="#cb143-32"></a>  <span class="fu">summarize</span>(<span class="at">rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residuals<span class="sc">^</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["modeltype"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rmse"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"pred_lin","2":"73.14852"},{"1":"pred_sqr","2":"60.27335"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Great work! You’ve confirmed that the quadratic input tranformation improved the model. In the next chapter you will see how transformations like this can sometimes be learned automatically.</p>
</section>
</section>
<section id="dealing-with-non-linear-responses" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 4. Dealing with Non-Linear Responses</h1>
<p>Now that we have mastered linear models, we will begin to look at techniques for modeling situations that don’t meet the assumptions of linearity. This includes predicting probabilities and frequencies (values bounded between 0 and 1); predicting counts (nonnegative integer values, and associated rates); and responses that have a non-linear but additive relationship to the inputs. These algorithms are variations on the standard linear model.</p>
<section id="logistic-regression-to-predict-probabilities" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="logistic-regression-to-predict-probabilities"><span class="header-section-number">4.1</span> Logistic regression to predict probabilities</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Logistic regression to predict probabilities</strong></p>
<p>In this chapter, you will learn about regression in non-linear situations. This first lesson, covers regression to predict probabilities.</p>
<p><strong>2. Predicting Probabilities</strong></p>
<p>While predicting if an event will occur is a classification problem, we’ll call predicting the numerical probability that it occurs regression.However, unlike standard regression, probabilities can only be in the range 0-1.Let’s see an example.</p>
<p><strong>3. Example: Predicting Duchenne Muscular Dystrophy (DMD)</strong></p>
<p>In this example, we want to develop a test to detect the gene for DMD in women. The test uses the measurement of two enzymes in the blood, here labeled CK and H. What is the probability that a woman is a DMD carrier, based on her CK and H levels?</p>
<p><strong>4. A Linear Regression Model</strong></p>
<p>We can try a linear regression, where the outcome is 1 or TRUE for women who have the DMD gene, and 0 or FALSE otherwise. Unfortunately, the model predicts probabilities outside the range 0-1. We’d like a model that only predicts valid probabilities.</p>
<p><strong>5. Logistic Regression</strong></p>
<p>The counterpart to linear regression for predicting probabilities is logistic regression. Logistic regression assumes that the inputs are additive and linear in the log-odds of the outcome, where the odds is the ratio of the probability that an event occurs to the probability that it does not.You fit logistic regression models in R with the glm function. glm looks a lot like lm; it takes as input a formula, a data frame, and a third argument called family.The family argument describes the error distribution of the model; just remember that for logistic regression, use family = binomial.</p>
<p><strong>6. DMD model</strong></p>
<p>glm also assumes that there are two possible outcomes, a and b. The model returns the probability of event b. To make the model easier to understand, we recommend that you encode the two outcomes as 0/1 or FALSE and TRUE.</p>
<p><strong>7. Interpreting Logistic Regression Models</strong></p>
<p>Read the coefficients of a logistic regression as you do those for a linear model. If the coefficient is positive, then the event becomes more probable as that value increases, if everything else is held constant.In our example, increased levels of both CK and H make the probability of the dmd gene higher.</p>
<p><strong>8. Predicting with a glm() model</strong></p>
<p>predict takes as inputs the model and a data frame. To get the probabilities, include the argument type = “response”.</p>
<p><strong>9. DMD Model</strong></p>
<p>We can fit a logistic model to the dmd training data, and look at the predictions. Now all the predictions lie between zero and one. But how good are they?</p>
<p><strong>10. Evaluating a logistic regression model: pseudo-<span class="math inline">\(R^2\)</span></strong></p>
<p>Squared error and RMSE are not good measures for logistic regression models. Instead, use deviance and Pseudo R-squared. You can think of deviance as being similar to variance.Pseudo-R-squared is analogous to R-squared. It compares the deviance of a model to the null-deviance of the data. A good fit gives pseudo-R-squared near 1.</p>
<p><strong>11. Pseudo-<span class="math inline">\(R^2\)</span> on Training data</strong></p>
<p>For training performance, you can calculate pseudo-R-squared using the deviance and null deviance from glance, or call wrapChiSqTest on the model.</p>
<p><strong>12. Pseudo-<span class="math inline">\(R^2\)</span> on Test data</strong></p>
<p>For test performance, call wrapChiSqTest on a data frame that has both the predictions and the true outcomes. You also have to designate the target event, which in our example is “TRUE”.</p>
<p><strong>13. The Gain Curve Plot</strong></p>
<p>The gain curve plot is great for evaluating logistic regression models.The wizard curve (in green) shows how a perfect model would sort the events: in our case, all the women with the dmd gene first. The blue curve shows how the model’s probability scores would sort the events. We want women who carry the dmd gene to have higher probability scores than women who do not. The closer the blue curve is to the green one, the better the model’s probability estimates are for identifying positive instances.</p>
<p><strong>14. Let’s practice!</strong></p>
<p>Now let’s practice fitting logistic regression models.</p>
</section>
<section id="fit-a-model-of-sparrow-survival-probability" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="fit-a-model-of-sparrow-survival-probability"><span class="header-section-number">4.2</span> Fit a model of sparrow survival probability</h2>
<p>In this exercise, you will estimate the probability that a sparrow survives a severe winter storm, based on physical characteristics of the sparrow. The dataset <code>sparrow</code> is loaded into your workspace. The outcome to be predicted is <code>status</code> (“Survived”, “Perished”). The variables we will consider are:</p>
<ul>
<li><code>total_length</code>: length of the bird from tip of beak to tip of tail (mm)</li>
<li><code>weight</code>: in grams</li>
<li><code>humerus</code> : length of humerus (“upper arm bone” that connects the wing to the body) (inches)</li>
</ul>
<p>Remember that when using <a href="https://www.rdocumentation.org/packages/stats/topics/glm"><code>glm()</code></a> to create a logistic regression model, you must explicitly specify that <code>family = binomial</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="fu">glm</span>(formula, <span class="at">data =</span> data, <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will call <code>summary()</code>, <code>broom::glance()</code> to see different functions for examining a logistic regression model. One of the diagnostics that you will look at is the analog to \(R^2\), called pseudo-\(R^2\).</p>
<p><span class="math display">\[
pseudoR^2 = 1 - \\frac{deviance}{null.deviance}
\]</span></p>
<p>You can think of deviance as analogous to variance: it is a measure of the variation in categorical data. The pseudo-\(R^2\) is analogous to \(R^2\) for standard regression: \(R^2\) is a measure of the “variance explained” of a regression model. The pseudo-\(R^2\) is a measure of the “deviance explained”.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>As suggested in the video, you will predict on the outcomes <code>TRUE</code> and <code>FALSE</code>. Create a new column <code>survived</code> in the <code>sparrow</code> data frame that is TRUE when <code>status == "Survived"</code>.</li>
<li>Create the formula <code>fmla</code> that expresses <code>survived</code> as a function of the variables of interest. Print it.</li>
<li>Fit a logistic regression model to predict the probability of sparrow survival. Assign the model to the variable <code>sparrow_model</code>.</li>
<li>Call <code>summary()</code> to see the coefficients of the model, the deviance and the null deviance.</li>
<li>Call <code>glance()</code> on the model to see the deviances and other diagnostics in a data frame. Assign the output from <code>glance()</code> to the variable <code>perf</code>.</li>
<li>Calculate the pseudo-\(R^2\).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="co"># Load data</span></span>
<span id="cb145-2"><a href="#cb145-2"></a>sparrow <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/sparrow.rds"</span>)</span>
<span id="cb145-3"><a href="#cb145-3"></a><span class="fu">summary</span>(sparrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;       status       age             total_length      wingspan    
#&gt;  Perished:36   Length:87          Min.   :153.0   Min.   :236.0  
#&gt;  Survived:51   Class :character   1st Qu.:158.0   1st Qu.:245.0  
#&gt;                Mode  :character   Median :160.0   Median :247.0  
#&gt;                                   Mean   :160.4   Mean   :247.5  
#&gt;                                   3rd Qu.:162.5   3rd Qu.:251.0  
#&gt;                                   Max.   :167.0   Max.   :256.0  
#&gt;      weight       beak_head        humerus           femur       
#&gt;  Min.   :23.2   Min.   :29.80   Min.   :0.6600   Min.   :0.6500  
#&gt;  1st Qu.:24.7   1st Qu.:31.40   1st Qu.:0.7250   1st Qu.:0.7000  
#&gt;  Median :25.8   Median :31.70   Median :0.7400   Median :0.7100  
#&gt;  Mean   :25.8   Mean   :31.64   Mean   :0.7353   Mean   :0.7134  
#&gt;  3rd Qu.:26.7   3rd Qu.:32.10   3rd Qu.:0.7500   3rd Qu.:0.7300  
#&gt;  Max.   :31.0   Max.   :33.00   Max.   :0.7800   Max.   :0.7600  
#&gt;     legbone          skull           sternum      
#&gt;  Min.   :1.010   Min.   :0.5600   Min.   :0.7700  
#&gt;  1st Qu.:1.110   1st Qu.:0.5900   1st Qu.:0.8300  
#&gt;  Median :1.130   Median :0.6000   Median :0.8500  
#&gt;  Mean   :1.131   Mean   :0.6032   Mean   :0.8511  
#&gt;  3rd Qu.:1.160   3rd Qu.:0.6100   3rd Qu.:0.8800  
#&gt;  Max.   :1.230   Max.   :0.6400   Max.   :0.9300</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="co"># Create the survived column</span></span>
<span id="cb147-2"><a href="#cb147-2"></a>sparrow<span class="sc">$</span>survived <span class="ot">&lt;-</span> sparrow<span class="sc">$</span>status <span class="sc">==</span> <span class="st">"Survived"</span></span>
<span id="cb147-3"><a href="#cb147-3"></a></span>
<span id="cb147-4"><a href="#cb147-4"></a><span class="co"># Create the formula</span></span>
<span id="cb147-5"><a href="#cb147-5"></a>(fmla <span class="ot">&lt;-</span> survived <span class="sc">~</span> total_length <span class="sc">+</span> weight <span class="sc">+</span> humerus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; survived ~ total_length + weight + humerus</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a><span class="co"># Fit the logistic regression model</span></span>
<span id="cb149-2"><a href="#cb149-2"></a>sparrow_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(fmla, <span class="at">data =</span> sparrow, <span class="at">family =</span> binomial)</span>
<span id="cb149-3"><a href="#cb149-3"></a></span>
<span id="cb149-4"><a href="#cb149-4"></a><span class="co"># Call summary</span></span>
<span id="cb149-5"><a href="#cb149-5"></a><span class="fu">summary</span>(sparrow_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = fmla, family = binomial, data = sparrow)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -2.1117  -0.6026   0.2871   0.6577   1.7082  
#&gt; 
#&gt; Coefficients:
#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)   46.8813    16.9631   2.764 0.005715 ** 
#&gt; total_length  -0.5435     0.1409  -3.858 0.000115 ***
#&gt; weight        -0.5689     0.2771  -2.053 0.040060 *  
#&gt; humerus       75.4610    19.1586   3.939 8.19e-05 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 118.008  on 86  degrees of freedom
#&gt; Residual deviance:  75.094  on 83  degrees of freedom
#&gt; AIC: 83.094
#&gt; 
#&gt; Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="co"># Call glance</span></span>
<span id="cb151-2"><a href="#cb151-2"></a>(perf <span class="ot">&lt;-</span> <span class="fu">glance</span>(sparrow_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["null.deviance"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["df.null"],"name":[2],"type":["int"],"align":["right"]},{"label":["logLik"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[7],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[8],"type":["int"],"align":["right"]}],"data":[{"1":"118.0084","2":"86","3":"-37.54718","4":"83.09436","5":"92.95799","6":"75.09436","7":"83","8":"87"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a><span class="co"># Calculate pseudo-R-squared</span></span>
<span id="cb152-2"><a href="#cb152-2"></a>(pseudoR2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> perf<span class="sc">$</span>deviance<span class="sc">/</span>perf<span class="sc">$</span>null.deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.3636526</code></pre>
</div>
</div>
<p>You’ve fit a logistic regression model to predict probabilities! When looking at the pseudo-<span class="math inline">\(R^2\)</span> of a logistic regression model, you should hope to see a value close to 1.</p>
</section>
<section id="predict-sparrow-survival" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="predict-sparrow-survival"><span class="header-section-number">4.3</span> Predict sparrow survival</h2>
<p>In this exercise you will predict the probability of survival using the sparrow survival model from the previous exercise.</p>
<p>Recall that when calling <a href="https://www.rdocumentation.org/packages/stats/topics/predict.glm"><code>predict()</code></a> to get the predicted probabilities from a <code>glm()</code> model, you must specify that you want the response:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a><span class="fu">predict</span>(model, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Otherwise, <code>predict()</code> on a logistic regression model returns the predicted log-odds of the event, not the probability.</p>
<p>You will also use the <a href="https://www.rdocumentation.org/packages/WVPlots/topics/GainCurvePlot"><code>GainCurvePlot()</code></a> function to plot the gain curve from the model predictions. If the model’s gain curve is close to the ideal (“wizard”) gain curve, then the model sorted the sparrows well: that is, the model predicted that sparrows that actually survived would have a higher probability of survival. The inputs to the <code>GainCurvePlot()</code> function are:</p>
<ul>
<li><code>frame</code>: data frame with prediction column and ground truth column</li>
<li><code>xvar</code>: the name of the column of predictions (as a string)</li>
<li><code>truthVar</code>: the name of the column with actual outcome (as a string)</li>
<li><code>title</code>: a title for the plot (as a string)</li>
</ul>
<p><code>GainCurvePlot(frame, xvar, truthVar, title)</code></p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a new column in <code>sparrow</code> called <code>pred</code> that contains the predictions on the training data.</li>
<li>Call <code>GainCurvePlot()</code> to create the gain curve of predictions. Does the model do a good job of sorting the sparrows by whether or not they actually survived?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a><span class="co"># sparrow is in the workspace</span></span>
<span id="cb155-2"><a href="#cb155-2"></a><span class="fu">summary</span>(sparrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;       status       age             total_length      wingspan    
#&gt;  Perished:36   Length:87          Min.   :153.0   Min.   :236.0  
#&gt;  Survived:51   Class :character   1st Qu.:158.0   1st Qu.:245.0  
#&gt;                Mode  :character   Median :160.0   Median :247.0  
#&gt;                                   Mean   :160.4   Mean   :247.5  
#&gt;                                   3rd Qu.:162.5   3rd Qu.:251.0  
#&gt;                                   Max.   :167.0   Max.   :256.0  
#&gt;      weight       beak_head        humerus           femur       
#&gt;  Min.   :23.2   Min.   :29.80   Min.   :0.6600   Min.   :0.6500  
#&gt;  1st Qu.:24.7   1st Qu.:31.40   1st Qu.:0.7250   1st Qu.:0.7000  
#&gt;  Median :25.8   Median :31.70   Median :0.7400   Median :0.7100  
#&gt;  Mean   :25.8   Mean   :31.64   Mean   :0.7353   Mean   :0.7134  
#&gt;  3rd Qu.:26.7   3rd Qu.:32.10   3rd Qu.:0.7500   3rd Qu.:0.7300  
#&gt;  Max.   :31.0   Max.   :33.00   Max.   :0.7800   Max.   :0.7600  
#&gt;     legbone          skull           sternum        survived      
#&gt;  Min.   :1.010   Min.   :0.5600   Min.   :0.7700   Mode :logical  
#&gt;  1st Qu.:1.110   1st Qu.:0.5900   1st Qu.:0.8300   FALSE:36       
#&gt;  Median :1.130   Median :0.6000   Median :0.8500   TRUE :51       
#&gt;  Mean   :1.131   Mean   :0.6032   Mean   :0.8511                  
#&gt;  3rd Qu.:1.160   3rd Qu.:0.6100   3rd Qu.:0.8800                  
#&gt;  Max.   :1.230   Max.   :0.6400   Max.   :0.9300</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a><span class="co"># sparrow_model is in the workspace</span></span>
<span id="cb157-2"><a href="#cb157-2"></a><span class="fu">summary</span>(sparrow_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = fmla, family = binomial, data = sparrow)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -2.1117  -0.6026   0.2871   0.6577   1.7082  
#&gt; 
#&gt; Coefficients:
#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)   46.8813    16.9631   2.764 0.005715 ** 
#&gt; total_length  -0.5435     0.1409  -3.858 0.000115 ***
#&gt; weight        -0.5689     0.2771  -2.053 0.040060 *  
#&gt; humerus       75.4610    19.1586   3.939 8.19e-05 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 118.008  on 86  degrees of freedom
#&gt; Residual deviance:  75.094  on 83  degrees of freedom
#&gt; AIC: 83.094
#&gt; 
#&gt; Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a><span class="co"># Make predictions</span></span>
<span id="cb159-2"><a href="#cb159-2"></a>sparrow<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(sparrow_model, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb159-3"><a href="#cb159-3"></a></span>
<span id="cb159-4"><a href="#cb159-4"></a><span class="co"># Look at gain curve</span></span>
<span id="cb159-5"><a href="#cb159-5"></a><span class="fu">GainCurvePlot</span>(sparrow, <span class="st">"pred"</span>, <span class="st">"survived"</span>, <span class="st">"sparrow survival model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Very good. You see from the gain curve that the model follows the wizard curve for about the first 30% of the data, identifying about 45% of the surviving sparrows with only a few false positives.</p>
</section>
<section id="poisson-and-quasipoisson-regression-to-predict-counts" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="poisson-and-quasipoisson-regression-to-predict-counts"><span class="header-section-number">4.4</span> Poisson and quasipoisson regression to predict counts</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Poisson and quasipoisson regression to predict counts</strong></p>
<p>In this lesson, you will learn about regression to predict count data.</p>
<p><strong>2. Predicting Counts</strong></p>
<p>Predicting counts is a non-linear problem, because counts are restricted to being non-negative and integral.The counterpart to linear regression for count data is poisson or quasipoisson regression.</p>
<p><strong>3. Poisson/Quasipoisson Regression</strong></p>
<p>Poisson regression is also a generalized linear model. It assumes that the inputs are additive and linear with respect to the log of the outcome. In R, you will again use the glm function, with family either poisson or quasipoisson.</p>
<p><strong>4. Poisson/Quasipoisson Regression</strong></p>
<p>For Poisson regression, the outcome is an integer that represents a count or a rate, like the number of traffic tickets a driver gets in a year, or the number of visits to a website per day. The model returns an expected rate that is not necessarily an integer, for instance the expected number of visits to a website per day.</p>
<p><strong>5. Poisson vs.&nbsp;Quasipoisson</strong></p>
<p>Poisson regression assumes that the process producing the count has a poisson distribution, where the mean equals the variance. For many real-life processes, the variance will be quite different from the mean. In this case, you should use quasipoisson regression. Poisson and quasipoisson regression work better on larger data sets.If the counts that you want to predict are much larger than zero, doing regular regression will often be fine, as well.Let’s see an example.</p>
<p><strong>6. Example: Predicting Bike Rentals</strong></p>
<p>Here we have hourly data from a bike sharing system in Washington, D.C., detailing the number of bikes rented during the first 2 weeks of January. We want a model to predict the hourly bike rental counts as a function of the time of day, the type of day (workday, weekend, or holiday), and details about the weather.</p>
<p><strong>7. Fit the model</strong></p>
<p>We’ll use January data for training. Because the variance of the bike rentals is much larger than the mean, we will use quasipoisson regression.</p>
<p><strong>8. Check model fit</strong></p>
<p>As with logistic regression, we can use pseudo-R-squared to check the goodness of fit. We can get the deviance and null deviance of the model using glance. This model explains about 76% of the deviance, not too bad.</p>
<p><strong>9. Predicting from the model</strong></p>
<p>The predict function takes the model and the data to prediction. As with logistic regression, be sure to use type = “response” to get the predicted rates. Here, we apply the model to data from February, and also plot the predicted hourly rates versus the actual counts.</p>
<p><strong>10. Evaluate the model</strong></p>
<p>We can calculate the root mean squared error of the model for February. On average, the prediction is off by about 69 rentals each hour, about half the standard deviation of the rental rates from the mean.</p>
<p><strong>11. Compare Predictions and Actual Outcomes</strong></p>
<p>We can also compare the predictions to actual outcomes as a function of time.</p>
<p><strong>12. Let’s practice!</strong></p>
<p>Let’s now practice fitting and predicting from count models.</p>
</section>
<section id="poisson-or-quasipoisson" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="poisson-or-quasipoisson"><span class="header-section-number">4.5</span> Poisson or quasipoisson</h2>
<p>One of the assumptions of Poisson regression to predict counts is that the event you are counting is <em>Poisson distributed</em>: the average count per unit time is the same as the variance of the count. In practice, “the same” means that the mean and the variance should be of a similar order of magnitude.</p>
<p>When the variance is much larger than the mean, the Poisson assumption doesn’t apply, and one solution is to use quasipoisson regression, which does not assume that \(variance = mean\).</p>
<p>For each of the following situations, decide if Poisson regression would be suitable, or if you should use quasipoisson regression.</p>
<blockquote class="blockquote">
<h2 id="question-1" data-number="4.6" class="anchored"><span class="header-section-number">4.6</span> <em>Question</em></h2>
<p>For which situations can you use Poisson regression?<br> 1. Number of days students are absent: mean 5.9, variance 49 2. Number of awards a student wins: mean 0.6, variance 1.1 3. Number of hits per website page: mean 108.2, variance 108.5 4. Number of bikes rented per day: mean 273, variance 45863.84 <br> ⬜ All of them<br> ⬜ 1 and 4<br> ✅ 2 and 3<br> ⬜ 1 and 3<br> ⬜ 2 and 4<br></p>
</blockquote>
<p>Yes! When the mean and variance of event arrivals are reasonably close, Poisson regression is suitable.</p>
</section>
<section id="fit-a-model-to-predict-bike-rental-counts" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="fit-a-model-to-predict-bike-rental-counts"><span class="header-section-number">4.7</span> Fit a model to predict bike rental counts</h2>
<p>In this exercise you will build a model to predict the number of bikes rented in an hour as a function of the weather, the type of day (holiday, working day, or weekend), and the time of day. You will train the model on data from the month of July.</p>
<p>The data frame has the columns:</p>
<ul>
<li><code>cnt</code>: the number of bikes rented in that hour (the outcome)</li>
<li><code>hr</code>: the hour of the day (0-23, as a factor)</li>
<li><code>holiday</code>: TRUE/FALSE</li>
<li><code>workingday</code>: TRUE if neither a holiday nor a weekend, else FALSE</li>
<li><code>weathersit</code>: categorical, “Clear to partly cloudy”/“Light Precipitation”/“Misty”</li>
<li><code>temp</code>: normalized temperature in Celsius</li>
<li><code>atemp</code>: normalized “feeling” temperature in Celsius</li>
<li><code>hum</code>: normalized humidity</li>
<li><code>windspeed</code>: normalized windspeed</li>
<li><code>instant</code>: the time index – number of hours since beginning of data set (not a variable)</li>
<li><code>mnth</code> and <code>yr</code>: month and year indices (not variables)</li>
</ul>
<p>Remember that you must specify <code>family = poisson</code> or <code>family = quasipoisson</code> when using <a href="https://www.rdocumentation.org/packages/stats/topics/glm"><code>glm()</code></a> to fit a count model.</p>
<p>Since there are a lot of input variables, for convenience we will specify the outcome and the inputs in variables, and use <a href="https://www.rdocumentation.org/packages/base/topics/paste"><code>paste()</code></a> to assemble a string representing the model formula.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>The data frame <code>bikesJuly</code> is in the workspace. The names of the outcome variable and the input variables are also in the workspace as the variables <code>outcome</code> and <code>vars</code> respectively.</p>
<ul>
<li>Fill in the blanks to create the formula <code>fmla</code> expressing <code>cnt</code> as a function of the inputs. Print it.</li>
<li>Calculate the mean (<code>mean()</code>) and variance (<code>var()</code>) of <code>bikesJuly$cnt</code>. you use poisson or quasipoisson regression?</li>
<li>Should you use poisson or quasipoisson regression?</li>
<li>Use <code>glm()</code> to fit a model to the <code>bikesJuly</code> data: <code>bike_model</code>.</li>
<li>Use <code>glance()</code> to look at the model’s fit statistics. Assign the output of <code>glance()</code> to the variable <code>perf</code>.</li>
<li>Calculate the pseudo-R-squared of the model.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a><span class="co"># bikesJuly is in the workspace</span></span>
<span id="cb160-2"><a href="#cb160-2"></a>bikesJuly <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/bikesJuly.rds"</span>)</span>
<span id="cb160-3"><a href="#cb160-3"></a><span class="fu">str</span>(bikesJuly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 'data.frame':    744 obs. of  12 variables:
#&gt;  $ hr        : Factor w/ 24 levels "0","1","2","3",..: 1 2 3 4 5 6 7 8 9 10 ...
#&gt;  $ holiday   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
#&gt;  $ workingday: logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
#&gt;  $ weathersit: chr  "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" ...
#&gt;  $ temp      : num  0.76 0.74 0.72 0.72 0.7 0.68 0.7 0.74 0.78 0.82 ...
#&gt;  $ atemp     : num  0.727 0.697 0.697 0.712 0.667 ...
#&gt;  $ hum       : num  0.66 0.7 0.74 0.84 0.79 0.79 0.79 0.7 0.62 0.56 ...
#&gt;  $ windspeed : num  0 0.1343 0.0896 0.1343 0.194 ...
#&gt;  $ cnt       : int  149 93 90 33 4 10 27 50 142 219 ...
#&gt;  $ instant   : int  13004 13005 13006 13007 13008 13009 13010 13011 13012 13013 ...
#&gt;  $ mnth      : int  7 7 7 7 7 7 7 7 7 7 ...
#&gt;  $ yr        : int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a><span class="co"># The outcome column</span></span>
<span id="cb162-2"><a href="#cb162-2"></a>outcome <span class="ot">&lt;-</span> <span class="st">"cnt"</span></span>
<span id="cb162-3"><a href="#cb162-3"></a></span>
<span id="cb162-4"><a href="#cb162-4"></a><span class="co"># The inputs to use</span></span>
<span id="cb162-5"><a href="#cb162-5"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hr"</span>, <span class="st">"holiday"</span>, <span class="st">"workingday"</span>, <span class="st">"weathersit"</span>, <span class="st">"temp"</span>, <span class="st">"atemp"</span>, <span class="st">"hum"</span>, <span class="st">"windspeed"</span>)</span>
<span id="cb162-6"><a href="#cb162-6"></a></span>
<span id="cb162-7"><a href="#cb162-7"></a><span class="co"># Create the formula string for bikes rented as a function of the inputs</span></span>
<span id="cb162-8"><a href="#cb162-8"></a>(fmla <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "cnt ~ hr + holiday + workingday + weathersit + temp + atemp + hum + windspeed"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a><span class="co"># Calculate the mean and variance of the outcome</span></span>
<span id="cb164-2"><a href="#cb164-2"></a>(mean_bikes <span class="ot">&lt;-</span> <span class="fu">mean</span>(bikesJuly<span class="sc">$</span>cnt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 273.6653</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1"></a>(var_bikes <span class="ot">&lt;-</span> <span class="fu">var</span>(bikesJuly<span class="sc">$</span>cnt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 45863.84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a><span class="co"># Fit the model</span></span>
<span id="cb168-2"><a href="#cb168-2"></a>bike_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(fmla, <span class="at">data =</span> bikesJuly, <span class="at">family =</span> quasipoisson)</span>
<span id="cb168-3"><a href="#cb168-3"></a></span>
<span id="cb168-4"><a href="#cb168-4"></a><span class="co"># Call glance</span></span>
<span id="cb168-5"><a href="#cb168-5"></a>(perf <span class="ot">&lt;-</span> <span class="fu">glance</span>(bike_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["null.deviance"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["df.null"],"name":[2],"type":["int"],"align":["right"]},{"label":["logLik"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[7],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[8],"type":["int"],"align":["right"]}],"data":[{"1":"133364.9","2":"743","3":"NA","4":"NA","5":"NA","6":"28774.9","7":"712","8":"744"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a><span class="co"># Calculate pseudo-R-squared</span></span>
<span id="cb169-2"><a href="#cb169-2"></a>(pseudoR2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> perf<span class="sc">$</span>deviance<span class="sc">/</span>perf<span class="sc">$</span>null.deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.7842393</code></pre>
</div>
</div>
<p>You’ve fit a (quasi)poisson model to predict counts! As with a logistic model, you hope for a pseudo-<span class="math inline">\(R^2\)</span> near 1.</p>
</section>
<section id="predict-bike-rentals-on-new-data" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="predict-bike-rentals-on-new-data"><span class="header-section-number">4.8</span> Predict bike rentals on new data</h2>
<p>In this exercise you will use the model you built in the previous exercise to make predictions for the month of August. The data set <code>bikesAugust</code> has the same columns as <code>bikesJuly</code>.</p>
<p>Recall that you must specify <code>type = "response"</code> with <a href="https://www.rdocumentation.org/packages/stats/topics/predict.glm"><code>predict()</code></a> when predicting counts from a <code>glm</code> poisson or quasipoisson model.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Use <code>predict</code> to predict the number of bikes per hour on the <code>bikesAugust</code> data. Assign the predictions to the column <code>bikesAugust$pred</code>.</p></li>
<li><p>Fill in the blanks to get the RMSE of the predictions on the August data.</p></li>
<li><p>Fill in the blanks to generate the plot of predictions to actual counts.any of the predictions appear negative?</p>
<ul>
<li>Do any of the predictions appear negative?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a><span class="co"># bikesAugust is in the workspace</span></span>
<span id="cb171-2"><a href="#cb171-2"></a>bikesAugust <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/bikesAugust.rds"</span>)</span>
<span id="cb171-3"><a href="#cb171-3"></a><span class="fu">str</span>(bikesAugust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 'data.frame':    744 obs. of  12 variables:
#&gt;  $ hr        : Factor w/ 24 levels "0","1","2","3",..: 1 2 3 4 5 6 7 8 9 10 ...
#&gt;  $ holiday   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
#&gt;  $ workingday: logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
#&gt;  $ weathersit: chr  "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" ...
#&gt;  $ temp      : num  0.68 0.66 0.64 0.64 0.64 0.64 0.64 0.64 0.66 0.68 ...
#&gt;  $ atemp     : num  0.636 0.606 0.576 0.576 0.591 ...
#&gt;  $ hum       : num  0.79 0.83 0.83 0.83 0.78 0.78 0.78 0.83 0.78 0.74 ...
#&gt;  $ windspeed : num  0.1642 0.0896 0.1045 0.1045 0.1343 ...
#&gt;  $ cnt       : int  47 33 13 7 4 49 185 487 681 350 ...
#&gt;  $ instant   : int  13748 13749 13750 13751 13752 13753 13754 13755 13756 13757 ...
#&gt;  $ mnth      : int  8 8 8 8 8 8 8 8 8 8 ...
#&gt;  $ yr        : int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a><span class="co"># bike_model is in the workspace</span></span>
<span id="cb173-2"><a href="#cb173-2"></a><span class="fu">summary</span>(bike_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = fmla, family = quasipoisson, data = bikesJuly)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;      Min        1Q    Median        3Q       Max  
#&gt; -21.6117   -4.3121   -0.7223    3.5507   16.5079  
#&gt; 
#&gt; Coefficients:
#&gt;                                Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)                    5.934986   0.439027  13.519  &lt; 2e-16 ***
#&gt; hr1                           -0.580055   0.193354  -3.000 0.002794 ** 
#&gt; hr2                           -0.892314   0.215452  -4.142 3.86e-05 ***
#&gt; hr3                           -1.662342   0.290658  -5.719 1.58e-08 ***
#&gt; hr4                           -2.350204   0.393560  -5.972 3.71e-09 ***
#&gt; hr5                           -1.084289   0.230130  -4.712 2.96e-06 ***
#&gt; hr6                            0.211945   0.156476   1.354 0.176012    
#&gt; hr7                            1.211135   0.132332   9.152  &lt; 2e-16 ***
#&gt; hr8                            1.648361   0.127177  12.961  &lt; 2e-16 ***
#&gt; hr9                            1.155669   0.133927   8.629  &lt; 2e-16 ***
#&gt; hr10                           0.993913   0.137096   7.250 1.09e-12 ***
#&gt; hr11                           1.116547   0.136300   8.192 1.19e-15 ***
#&gt; hr12                           1.282685   0.134769   9.518  &lt; 2e-16 ***
#&gt; hr13                           1.273010   0.135872   9.369  &lt; 2e-16 ***
#&gt; hr14                           1.237721   0.136386   9.075  &lt; 2e-16 ***
#&gt; hr15                           1.260647   0.136144   9.260  &lt; 2e-16 ***
#&gt; hr16                           1.515893   0.132727  11.421  &lt; 2e-16 ***
#&gt; hr17                           1.948404   0.128080  15.212  &lt; 2e-16 ***
#&gt; hr18                           1.893915   0.127812  14.818  &lt; 2e-16 ***
#&gt; hr19                           1.669277   0.128471  12.993  &lt; 2e-16 ***
#&gt; hr20                           1.420732   0.131004  10.845  &lt; 2e-16 ***
#&gt; hr21                           1.146763   0.134042   8.555  &lt; 2e-16 ***
#&gt; hr22                           0.856182   0.138982   6.160 1.21e-09 ***
#&gt; hr23                           0.479197   0.148051   3.237 0.001265 ** 
#&gt; holidayTRUE                    0.201598   0.079039   2.551 0.010961 *  
#&gt; workingdayTRUE                 0.116798   0.033510   3.485 0.000521 ***
#&gt; weathersitLight Precipitation -0.214801   0.072699  -2.955 0.003233 ** 
#&gt; weathersitMisty               -0.010757   0.038600  -0.279 0.780572    
#&gt; temp                          -3.246001   1.148270  -2.827 0.004833 ** 
#&gt; atemp                          2.042314   0.953772   2.141 0.032589 *  
#&gt; hum                           -0.748557   0.236015  -3.172 0.001581 ** 
#&gt; windspeed                      0.003277   0.148814   0.022 0.982439    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for quasipoisson family taken to be 38.98949)
#&gt; 
#&gt;     Null deviance: 133365  on 743  degrees of freedom
#&gt; Residual deviance:  28775  on 712  degrees of freedom
#&gt; AIC: NA
#&gt; 
#&gt; Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a><span class="co"># Make predictions on August data</span></span>
<span id="cb175-2"><a href="#cb175-2"></a>bikesAugust<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bike_model, <span class="at">newdata =</span> bikesAugust, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb175-3"><a href="#cb175-3"></a></span>
<span id="cb175-4"><a href="#cb175-4"></a><span class="co"># Calculate the RMSE</span></span>
<span id="cb175-5"><a href="#cb175-5"></a>bikesAugust <span class="sc">%&gt;%</span> </span>
<span id="cb175-6"><a href="#cb175-6"></a>  <span class="fu">mutate</span>(<span class="at">residual =</span> pred <span class="sc">-</span> cnt) <span class="sc">%&gt;%</span></span>
<span id="cb175-7"><a href="#cb175-7"></a>  <span class="fu">summarize</span>(<span class="at">rmse  =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residual<span class="sc">^</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rmse"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"112.5815"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a><span class="co"># Plot predictions vs cnt (pred on x-axis)</span></span>
<span id="cb176-2"><a href="#cb176-2"></a><span class="fu">ggplot</span>(bikesAugust, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> cnt)) <span class="sc">+</span></span>
<span id="cb176-3"><a href="#cb176-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb176-4"><a href="#cb176-4"></a>  <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Great! (Quasi)poisson models predict non-negative rates, making them useful for count or frequency data.</p>
</section>
<section id="visualize-the-bike-rental-predictions" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="visualize-the-bike-rental-predictions"><span class="header-section-number">4.9</span> Visualize the bike rental predictions</h2>
<p>In the previous exercise, you visualized the bike model’s predictions using the standard “outcome vs.&nbsp;prediction” scatter plot. Since the bike rental data is time series data, you might be interested in how the model performs as a function of time. In this exercise, you will compare the predictions and actual rentals on an hourly basis, for the first 14 days of August.</p>
<p>To create the plot you will use the function <a href="https://www.rdocumentation.org/packages/tidyr/topics/gather"><code>tidyr::gather()</code></a> to consolidate the predicted and actual values from <code>bikesAugust</code> in a single column. <code>gather()</code> takes as arguments:</p>
<ul>
<li>The “wide” data frame to be gathered (implicit in a pipe)</li>
<li>The name of the key column to be created - contains the names of the gathered columns.</li>
<li>The name of the value column to be created - contains the values of the gathered columns.</li>
<li>The names of the columns to be gathered into a single column.</li>
</ul>
<p>You’ll use the gathered data frame to compare the actual and predicted rental counts as a function of time. The time index, <code>instant</code> counts the number of observations since the beginning of data collection. The sample code converts the instants to daily units, starting from 0.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Fill in the blanks to plot the predictions and actual counts by hour for the first 14 days of August.<code>instant</code> to be in day units, rather than hour<code>gather()</code> the <code>cnt</code> and <code>pred</code> columns into a column called <code>value</code>, with a key called <code>valuetype</code>.<code>filter()</code> for the first two weeks of August<code>value</code> as a function of <code>instant</code> (day).</p>
<ul>
<li>convert <code>instant</code> to be in day units, rather than hour</li>
<li><code>gather()</code> the <code>cnt</code> and <code>pred</code> columns into a column called <code>value</code>, with a key called <code>valuetype</code>.</li>
<li><code>filter()</code> for the first two weeks of August</li>
<li>Plot <code>value</code> as a function of <code>instant</code> (day).</li>
</ul></li>
<li><p>Does the model see the general time patterns in bike rentals?</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a><span class="co"># Plot predictions and cnt by date/time</span></span>
<span id="cb177-2"><a href="#cb177-2"></a>bikesAugust <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="#cb177-3"></a>  <span class="co"># set start to 0, convert unit to days</span></span>
<span id="cb177-4"><a href="#cb177-4"></a>  <span class="fu">mutate</span>(<span class="at">instant =</span> (instant <span class="sc">-</span> <span class="fu">min</span>(instant))<span class="sc">/</span><span class="dv">24</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb177-5"><a href="#cb177-5"></a>  <span class="co"># gather cnt and pred into a value column</span></span>
<span id="cb177-6"><a href="#cb177-6"></a>  <span class="fu">gather</span>(<span class="at">key =</span> valuetype, <span class="at">value =</span> value, cnt, pred) <span class="sc">%&gt;%</span></span>
<span id="cb177-7"><a href="#cb177-7"></a>  <span class="fu">filter</span>(instant <span class="sc">&lt;</span> <span class="dv">14</span>) <span class="sc">%&gt;%</span> <span class="co"># restrict to first 14 days</span></span>
<span id="cb177-8"><a href="#cb177-8"></a>  <span class="co"># plot value by instant</span></span>
<span id="cb177-9"><a href="#cb177-9"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> instant, <span class="at">y =</span> value, <span class="at">color =</span> valuetype, <span class="at">linetype =</span> valuetype)) <span class="sc">+</span> </span>
<span id="cb177-10"><a href="#cb177-10"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb177-11"><a href="#cb177-11"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb177-12"><a href="#cb177-12"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Day"</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>, <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb177-13"><a href="#cb177-13"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span> </span>
<span id="cb177-14"><a href="#cb177-14"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted August bike rentals, Quasipoisson model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good work! This model mostly identifies the slow and busy hours of the day, although it often underestimates peak demand.</p>
</section>
<section id="gam-to-learn-non-linear-transforms" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="gam-to-learn-non-linear-transforms"><span class="header-section-number">4.10</span> GAM to learn non-linear transforms</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. GAM to learn non-linear transformations</strong></p>
<p>In this lesson, you will learn about generalized additive models, to automatically learn input variable transformations.</p>
<p><strong>2. Generalized Additive Models (GAMs)</strong></p>
<p>With a generalized additive model (GAM), the outcome depends additively on unknown smooth functions of the input variables. A GAM learns the functions s_i and the intercept b0 that best fit the data.</p>
<p><strong>3. Learning Non-linear Relationships</strong></p>
<p>Remember the hassles data from a previous lesson? If we want to model the non-linear relationship between hassles and anxiety levels, but we aren’t sure if the relationship is quadratic, cubic, or something else, we can try a GAM to learn the relationship.</p>
<p><strong>4. gam() in the mgcv package</strong></p>
<p>We will use the gam function from the mgcv package to fit GAM models. gam takes a formula, a dataset, and a family as arguments. For regular regression, use the gaussian family. For predicting probabilities, use binomial, and for counts, poisson or quasipoisson.Because GAMs are more complex than linear models, they are more likely to overfit, and so are best used on larger data sets.</p>
<p><strong>5. The s() function</strong></p>
<p>To specify that an input has a non-linear relationship with the outcome, use the s function in the formula. Here, we specify that we want to model anxiety as a non-linear function of hassles.It’s not recommended to use s with a categorical variable; the s function tries to fit a spline between the input and the outcome. To do this, the input should take on about 10 or more unique values.Let’s work an example.</p>
<p><strong>6. Revisit the hassles data</strong></p>
<p>Let’s revisit the hassles data from a previous lesson. Last time, we tried three variations</p>
<p><strong>7. Revisit the hassles data</strong></p>
<p>a linear,quadratic, and cubic model, and saw that cubic seemed to be the best.</p>
<p><strong>8. GAM of the hassles data</strong></p>
<p>Now let’s try a GAM. We specify in the formula that we want a non-linear fit to the hassles variable, and use family equals gaussian. A summary of the model reports deviance explained, or pseudo-R2 of 0-point-64, almost as good as the cubic model.</p>
<p><strong>9. Examining the Transformations</strong></p>
<p>Calling plot on the model gives you plots of the variable transformations that the algorithm learned. To get the y-values of these plots, call predict on the model with the argument type = “terms”.</p>
<p><strong>10. Predicting with the Model</strong></p>
<p>To make predictions with the model, call predict with the argument type = “response”.If we compare the GAM to our previous models on the training data, we see that the GAM learned a relationship that’s close to the cubic model, except at the high ends.</p>
<p><strong>11. Comparing out-of-sample performance</strong></p>
<p>When we look at the GAM’s out-of-sample RMSE, we see that the performance is better than the linear model, though not quite as good as the quadratic or cubic models. This may be because the data set is small, and so the model is noisier.The takeaway is that while knowing the appropriate transformations is best, using GAM to learn the transformations is useful when you don’t have the domain knowledge to tell you the correct transform.</p>
<p><strong>12. Let’s practice!</strong></p>
<p>Now let’s practice fitting and predicting with generalized additive models.</p>
</section>
<section id="writing-formulas-for-gam-models" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="writing-formulas-for-gam-models"><span class="header-section-number">4.11</span> Writing formulas for GAM models</h2>
<p>When using <a href="https://www.rdocumentation.org/packages/mgcv/topics/gam"><code>gam()</code></a> to model outcome as an additive function of the inputs, you can use the <a href="https://www.rdocumentation.org/packages/mgcv/topics/s"><code>s()</code></a> function inside formulas to designate that you want to use a spline to model the non-linear relationship of a continuous variable to the outcome.</p>
<p>Suppose that you want to predict how much weight (<code>Wtloss</code>) a dieter will lose over a 2-year diet plan as a function of:</p>
<ul>
<li><code>Diet</code> type (categorical)</li>
<li><code>Sex</code> (categorical)</li>
<li><code>Age</code> at beginning of diet (continuous)</li>
<li><code>BMI</code> (body mass index) at beginning of diet (continuous)</li>
</ul>
<p>You do not want to assume that any of the relationships are linear.</p>
<blockquote class="blockquote">
<h2 id="question-2" data-number="4.12" class="anchored"><span class="header-section-number">4.12</span> <em>Question</em></h2>
<p>Which is the most appropriate formula?<br> <br> ⬜ <code>Wtloss ~ Diet + Sex + Age + BMI</code><br> ⬜ <code>Wtloss ~ s(Diet) + s(Sex) + s(Age) + s(BMI)</code><br> ✅ <code>Wtloss ~ Diet + Sex + s(Age) + s(BMI)</code><br></p>
</blockquote>
<p>Yes! This formula says that Age and BMI will both be modeled non-linearly.</p>
</section>
<section id="writing-formulas-for-gam-models-2" class="level2" data-number="4.13">
<h2 data-number="4.13" class="anchored" data-anchor-id="writing-formulas-for-gam-models-2"><span class="header-section-number">4.13</span> Writing formulas for GAM models (2)</h2>
<p>Suppose that in the diet problem from the previous exercise, you now also want to take into account</p>
<ul>
<li>the dieter’s resting metabolic rate (<code>BMR</code> – continuous) and</li>
<li>the dieter’s average number hours of aerobic exercise per day (<code>E</code> – continuous) at the beginning of the study.</li>
</ul>
<p>You have reason to believe that the relationship between BMR and weight loss is linear (and you want to model it that way), but not necessarily the relationship between aerobic exercise and weight loss.</p>
<blockquote class="blockquote">
<h2 id="question-3" data-number="4.14" class="anchored"><span class="header-section-number">4.14</span> <em>Question</em></h2>
<p>Which is the most appropriate formula?<br> <br> ⬜ <code>Wtloss ~ Diet + Sex + s(Age) + s(BMI) + s(BMR) + s(E)</code><br> ✅ <code>Wtloss ~ Diet + Sex + s(Age) + s(BMI) + BMR + s(E)</code><br> ⬜ <code>Wtloss ~ Diet + Sex + s(Age) + s(BMI) + s(BMR) + E</code><br></p>
</blockquote>
<p>Yes! This formula says to model Age, BMI and E as non-linear, but model BMR as linear.</p>
</section>
<section id="model-soybean-growth-with-gam" class="level2" data-number="4.15">
<h2 data-number="4.15" class="anchored" data-anchor-id="model-soybean-growth-with-gam"><span class="header-section-number">4.15</span> Model soybean growth with GAM</h2>
<p>In this exercise you will model the average leaf weight on a soybean plant as a function of time (after planting). As you will see, the soybean plant doesn’t grow at a steady rate, but rather has a “growth spurt” that eventually tapers off. Hence, leaf weight is not well described by a linear model.</p>
<p>Recall that you can designate which variable you want to model non-linearly in a formula with the <a href="https://www.rdocumentation.org/packages/mgcv/topics/s"><code>s()</code></a> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a>y <span class="sc">~</span> <span class="fu">s</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Also remember that <a href="https://www.rdocumentation.org/packages/mgcv/topics/gam"><code>gam()</code></a> from the package <code>mgcv</code> has the calling interface</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="fu">gam</span>(formula, family, data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For standard regression, use <code>family = gaussian</code> (the default).</p>
<p>The soybean training data, <code>soybean_train</code> is loaded into your workspace. It has two columns: the outcome <code>weight</code> and the variable <code>Time</code>. For comparison, the linear model <code>model.lin</code>, which was fit using the formula <code>weight ~ Time</code> has already been loaded into the workspace as well.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Fill in the blanks to plot <code>weight</code> versus <code>Time</code> (<code>Time</code> on x-axis). <em>Does the relationship look linear?</em></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a><span class="co"># load data</span></span>
<span id="cb180-2"><a href="#cb180-2"></a>soybean_train <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/soybean_train.rds"</span>)</span>
<span id="cb180-3"><a href="#cb180-3"></a><span class="fu">summary</span>(soybean_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;       Plot     Variety   Year          Time           weight       
#&gt;  1988F6 : 10   F:161   1988:124   Min.   :14.00   Min.   : 0.0290  
#&gt;  1988F7 :  9   P:169   1989:102   1st Qu.:27.00   1st Qu.: 0.6663  
#&gt;  1988P1 :  9           1990:104   Median :42.00   Median : 3.5233  
#&gt;  1988P8 :  9                      Mean   :43.56   Mean   : 6.1645  
#&gt;  1988P2 :  9                      3rd Qu.:56.00   3rd Qu.:10.3808  
#&gt;  1988F3 :  8                      Max.   :84.00   Max.   :27.3700  
#&gt;  (Other):276</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a><span class="co"># Plot weight vs Time (Time on x axis)</span></span>
<span id="cb182-2"><a href="#cb182-2"></a><span class="fu">ggplot</span>(soybean_train, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> weight)) <span class="sc">+</span> </span>
<span id="cb182-3"><a href="#cb182-3"></a>  <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-49-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Load the package <code>mgcv</code>.</li>
<li>Create the formula <code>fmla.gam</code> to express <code>weight</code> as a non-linear function of <code>Time</code>. Print it.</li>
<li>Fit a generalized additive model on <code>soybean_train</code> using <code>fmla.gam</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a><span class="co"># Load the package mgcv</span></span>
<span id="cb183-2"><a href="#cb183-2"></a><span class="fu">library</span>(mgcv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Lade nötiges Paket: nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attache Paket: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Das folgende Objekt ist maskiert 'package:dplyr':
#&gt; 
#&gt;     collapse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; This is mgcv 1.8-41. For overview type 'help("mgcv-package")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attache Paket: 'mgcv'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Das folgende Objekt ist maskiert 'package:wrapr':
#&gt; 
#&gt;     %.%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a><span class="co"># Create the formula </span></span>
<span id="cb190-2"><a href="#cb190-2"></a>(fmla.gam <span class="ot">&lt;-</span> weight <span class="sc">~</span> <span class="fu">s</span>(Time) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; weight ~ s(Time)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a><span class="co"># Fit the GAM Model</span></span>
<span id="cb192-2"><a href="#cb192-2"></a>model.gam <span class="ot">&lt;-</span> <span class="fu">gam</span>(fmla.gam, <span class="at">data =</span> soybean_train, <span class="at">family =</span> gaussian)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>Call <code>summary()</code> on the linear model <code>model.lin</code> (already in your workspace). <em>What is the \(R^2\)?</em></li>
<li>Call <code>summary()</code> on <code>'model.gam</code>. <em>The “deviance explained” reports the model’s unadjusted \(R^2\). What is the \(R^2\)? Which model appears to be a better fit to the training data?</em></li>
<li>Call <code>plot()</code> on <code>model.gam</code> to see the derived relationship between <code>Time</code> and <code>weight</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a><span class="co"># Call summary() on model.lin and look for R-squared</span></span>
<span id="cb193-2"><a href="#cb193-2"></a>model.lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> weight <span class="sc">~</span> Time, <span class="at">data =</span> soybean_train)</span>
<span id="cb193-3"><a href="#cb193-3"></a><span class="fu">summary</span>(model.lin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = weight ~ Time, data = soybean_train)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -9.3933 -1.7100 -0.3909  1.9056 11.4381 
#&gt; 
#&gt; Coefficients:
#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept) -6.559283   0.358527  -18.30   &lt;2e-16 ***
#&gt; Time         0.292094   0.007444   39.24   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 2.778 on 328 degrees of freedom
#&gt; Multiple R-squared:  0.8244, Adjusted R-squared:  0.8238 
#&gt; F-statistic:  1540 on 1 and 328 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a><span class="co"># Call summary() on model.gam and look for R-squared</span></span>
<span id="cb195-2"><a href="#cb195-2"></a><span class="fu">summary</span>(model.gam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Family: gaussian 
#&gt; Link function: identity 
#&gt; 
#&gt; Formula:
#&gt; weight ~ s(Time)
#&gt; 
#&gt; Parametric coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)   6.1645     0.1143   53.93   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Approximate significance of smooth terms:
#&gt;           edf Ref.df     F p-value    
#&gt; s(Time) 8.495   8.93 338.2  &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; R-sq.(adj) =  0.902   Deviance explained = 90.4%
#&gt; GCV = 4.4395  Scale est. = 4.3117    n = 330</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a><span class="co"># Call plot() on model.gam</span></span>
<span id="cb197-2"><a href="#cb197-2"></a><span class="fu">plot</span>(model.gam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-51-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Congratulations! You have fit a generalized additive model. For this data, the GAM appears to fit the data better than a linear model, as measured by the R-squared.</p>
</section>
<section id="predict-with-the-soybean-model-on-test-data" class="level2" data-number="4.16">
<h2 data-number="4.16" class="anchored" data-anchor-id="predict-with-the-soybean-model-on-test-data"><span class="header-section-number">4.16</span> Predict with the soybean model on test data</h2>
<p>In this exercise you will apply the soybean models from the previous exercise (<code>model.lin</code> and <code>model.gam</code>, already in your workspace) to new data: <code>soybean_test</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Create a column <code>soybean_test$pred.lin</code> with predictions from the linear model <code>model.lin</code>.</p></li>
<li><p>Create a column <code>soybean_test$pred.gam</code> with predictions from the gam model <code>model.gam</code>.GAM models, the <code>predict()</code> method returns a matrix, so use <code>as.numeric()</code> to convert the matrix to a vector.</p>
<ul>
<li>For GAM models, the <code>predict()</code> method returns a matrix, so use <code>as.numeric()</code> to convert the matrix to a vector.</li>
</ul></li>
<li><p>Fill in the blanks to <code>gather()</code> the prediction columns into a single value column <code>pred</code> with key column <code>modeltype</code>. Call the long dataframe <code>soybean_long</code>.</p></li>
<li><p>Calculate and compare the RMSE of both models. model does better?</p>
<ul>
<li>Which model does better?</li>
</ul></li>
<li><p>Run the code to compare the predictions of each model against the actual average leaf weights.</p>
<ul>
<li>A scatter plot of <code>weight</code> as a function of <code>Time</code>.</li>
<li>Point-and-line plots of the predictions (<code>pred</code>) as a function of <code>Time</code>.</li>
<li>Notice that the linear model sometimes predicts negative weights! Does the gam model?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1"></a><span class="co"># Load soybean_test</span></span>
<span id="cb198-2"><a href="#cb198-2"></a>soybean_test <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/soybean_test.rds"</span>)</span>
<span id="cb198-3"><a href="#cb198-3"></a><span class="fu">summary</span>(soybean_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;       Plot    Variety   Year         Time           weight       
#&gt;  1988F8 : 4   F:43    1988:32   Min.   :14.00   Min.   : 0.0380  
#&gt;  1988P7 : 4   P:39    1989:26   1st Qu.:23.00   1st Qu.: 0.4248  
#&gt;  1989F8 : 4           1990:24   Median :41.00   Median : 3.0025  
#&gt;  1990F8 : 4                     Mean   :44.09   Mean   : 7.1576  
#&gt;  1988F4 : 3                     3rd Qu.:69.00   3rd Qu.:15.0113  
#&gt;  1988F2 : 3                     Max.   :84.00   Max.   :30.2717  
#&gt;  (Other):60</code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a><span class="co"># Get predictions from linear model</span></span>
<span id="cb200-2"><a href="#cb200-2"></a>soybean_test<span class="sc">$</span>pred.lin <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.lin, <span class="at">newdata =</span> soybean_test)</span>
<span id="cb200-3"><a href="#cb200-3"></a></span>
<span id="cb200-4"><a href="#cb200-4"></a><span class="co"># Get predictions from gam model</span></span>
<span id="cb200-5"><a href="#cb200-5"></a>soybean_test<span class="sc">$</span>pred.gam <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(model.gam, <span class="at">newdata =</span> soybean_test))</span>
<span id="cb200-6"><a href="#cb200-6"></a></span>
<span id="cb200-7"><a href="#cb200-7"></a><span class="co"># Gather the predictions into a "long" dataset</span></span>
<span id="cb200-8"><a href="#cb200-8"></a>soybean_long <span class="ot">&lt;-</span> soybean_test <span class="sc">%&gt;%</span></span>
<span id="cb200-9"><a href="#cb200-9"></a>  <span class="fu">gather</span>(<span class="at">key =</span> modeltype, <span class="at">value =</span> pred, pred.lin, pred.gam)</span>
<span id="cb200-10"><a href="#cb200-10"></a></span>
<span id="cb200-11"><a href="#cb200-11"></a><span class="co"># Calculate the rmse</span></span>
<span id="cb200-12"><a href="#cb200-12"></a>soybean_long <span class="sc">%&gt;%</span></span>
<span id="cb200-13"><a href="#cb200-13"></a>  <span class="fu">mutate</span>(<span class="at">residual =</span> weight <span class="sc">-</span> pred) <span class="sc">%&gt;%</span>     <span class="co"># residuals</span></span>
<span id="cb200-14"><a href="#cb200-14"></a>  <span class="fu">group_by</span>(modeltype) <span class="sc">%&gt;%</span>                  <span class="co"># group by modeltype</span></span>
<span id="cb200-15"><a href="#cb200-15"></a>  <span class="fu">summarize</span>(<span class="at">rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residual<span class="sc">^</span><span class="dv">2</span>))) <span class="co"># calculate the RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["modeltype"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rmse"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"pred.gam","2":"2.286451"},{"1":"pred.lin","2":"3.190995"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1"></a><span class="co"># Compare the predictions against actual weights on the test data</span></span>
<span id="cb201-2"><a href="#cb201-2"></a>soybean_long <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="#cb201-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Time)) <span class="sc">+</span>                          <span class="co"># the column for the x axis</span></span>
<span id="cb201-4"><a href="#cb201-4"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> weight)) <span class="sc">+</span>                    <span class="co"># the y-column for the scatterplot</span></span>
<span id="cb201-5"><a href="#cb201-5"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred, <span class="at">color =</span> modeltype)) <span class="sc">+</span>   <span class="co"># the y-column for the point-and-line plot</span></span>
<span id="cb201-6"><a href="#cb201-6"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred, <span class="at">color =</span> modeltype, <span class="at">linetype =</span> modeltype)) <span class="sc">+</span> <span class="co"># the y-column for the point-and-line plot</span></span>
<span id="cb201-7"><a href="#cb201-7"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-52-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Great job! The GAM learns the non-linear growth function of the soybean plants, including the fact that weight is never negative.</p>
</section>
</section>
<section id="tree-based-methods" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 5. Tree-Based Methods</h1>
<p>In this chapter we will look at modeling algorithms that do not assume linearity or additivity, and that can learn limited types of interactions among input variables. These algorithms are <em>tree-based</em> methods that work by combining ensembles of <em>decision trees</em> that are learned from the training data.</p>
<section id="the-intuition-behind-tree-based-methods" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="the-intuition-behind-tree-based-methods"><span class="header-section-number">5.1</span> The intuition behind tree-based methods</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. The intuition behind tree-based methods</strong></p>
<p>In this chapter, you will learn about ensembles of decision trees, a powerful machine learning method for both regression and classification. In the first lesson, you will review the intuition behind a decision tree.</p>
<p><strong>2. Example: Predict animal intelligence from Gestation Time and Litter Size</strong></p>
<p>As an example, here we have data about the litter size and gestation time in days of various mammals. We also have a measure of each species’ intelligence, scaled so that human intelligence is 1.We want to predict intelligence from a species’ average litter size and gestation time. We’ll use a decision tree.</p>
<p><strong>3. Decision Trees</strong></p>
<p>Decision trees learn rules of the form “if a and b and c, then y”. Trees can express non-linear concepts like intervals and non-monotonic relationships, and because AND is similar to multiplication, trees can express certain kinds of non-additive interactions.</p>
<p><strong>4. Decision Trees</strong></p>
<p>A tree model for intelligence expresses that species with average litter size less than 1-point-15 and gestation greater than 268 days have average intelligence of 0-point-315, and species with litter sizes between 1-point-15 and 4-point-3 have average intelligence of 0-point-131.</p>
<p><strong>5. Decision Trees</strong></p>
<p>Trees have an expressive and easy to understand concept space. In this case, a tree fits the intelligence data better than a linear model, in the sense that the predictions have a lower root mean squared error.</p>
<p><strong>6. Decision Trees</strong></p>
<p>But trees also give only coarse-grained predictions. Our tree model can only predict 6 possible values, while linear models give continuous-valued predictions.</p>
<p><strong>7. It’s Hard for Trees to Express Linear Relationships</strong></p>
<p>Since trees express axis-aligned regions, it’s also hard for them to express truly linear relationships</p>
<p><strong>8. It’s Hard for Trees to Express Linear Relationships</strong></p>
<p>or any relationship that varies quickly and continuously.</p>
<p><strong>9. Other Issues with Trees</strong></p>
<p>You can try to make finer-grain predictions by doing more splits on the data to build deeper trees, but a deep tree can be overly complex, potentially overfitting the training data. Shallower trees are less likely to overfit, but the predictions are often too coarse-grained.</p>
<p><strong>10. Ensembles of Trees</strong></p>
<p>An ensemble, or a model made up of several trees, will give finer-grained predictions</p>
<p><strong>11. Ensembles of Trees</strong></p>
<p>and usually better quality models than a single tree. In this chapter, we will cover two ensemble methods: random forests and gradient boosted trees.</p>
<p><strong>12. Let’s practice!</strong></p>
<p>Now let’s do a quick tree exercise.</p>
</section>
<section id="predicting-with-a-decision-tree" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="predicting-with-a-decision-tree"><span class="header-section-number">5.2</span> Predicting with a decision tree</h2>
<p><img src="https://assets.datacamp.com/production/course_3851/datasets/decisiontree_intelligence.png" alt="decision tree"></p>
<p>Here you see the decision tree learned from the brain data set shown in the previous video. The tree predicts the expected intelligence (humans have an intelligence of 1) of several mammals, as a function of <em>gestation time</em> (in days) and average <em>litter size</em> for that species.</p>
<p>The leaf nodes show the expected brain size for the datums in that node, as well as how many (percentage-wise) of the datums fall into the node.</p>
<p>You want to predict the intelligence of a gorilla, which has a gestation time of 265 days and an average litter size of 1.</p>
<blockquote class="blockquote">
<h2 id="question-4" data-number="5.3" class="anchored"><span class="header-section-number">5.3</span> <em>Question</em></h2>
<p>What relative brain size does this tree model predict?<br> <br> ⬜ 0.073<br> ⬜ 0.131<br> ✅ 0.148<br> ⬜ 0.161<br> ⬜ 0.274<br> ⬜ 0.315<br></p>
</blockquote>
<p>Yes! But as you see this tree can predict only 6 values. For the rest of this chapter we will use tree ensembles to predict at a finer granularity.</p>
</section>
<section id="random-forests" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="random-forests"><span class="header-section-number">5.4</span> Random forests</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Random forests</strong></p>
<p>In this lesson, you will learn about random forests, and how to fit a random forest model with the ranger package.</p>
<p><strong>2. Random Forests</strong></p>
<p>Random forests try to resolve the issues with decision tree model by building multiple trees from the training data. Using slightly different data to build each tree adds diversity to the models. Averaging the results of multiple trees together reduces the risk of overfit. Multiple trees also gives finer-grain predictions than a single tree.</p>
<p><strong>3. Building a Random Forest Model</strong></p>
<p>Each individual tree is grown from a random sample of the training data. For a single tree, each node is formed by picking a variable to split the data on, and a value to make the split. In a random forest, the set of candidate variables to consider is randomly selected. All this randomization gives diversity to the set of trees. After all the trees are grown, the model makes a prediction on a datum by running it through all the trees and averaging the result.</p>
<p><strong>4. Example: Bike Rental Data</strong></p>
<p>For our example, we’ll return to the bike rental data from a previous lesson, and predict hourly bike rental rates from the time of day, the type of day, and the weather conditions. We’ll train a model on data from January, and evaluate the model on data from February.</p>
<p><strong>5. Random Forests with ranger()</strong></p>
<p>We’ll use the ranger package to fit random forest. The ranger function takes a formula, the training data, and the number of trees. If the outcome variable is a numeric value, ranger will automatically do regression rather than classification. By default, ranger builds 500 trees. We recommend that you use at least 200.The argument respect-dot-unordered-dot-factors tells ranger how to treat categorical variables.We recommend setting this value to “order”. This causes ranger to safely and meaningfully encode the categorical variables as numbers. This encoding runs faster than converting a categorical variable to indicator variables when the categorical variable has a very large number of possible values.</p>
<p><strong>6. Random Forests with ranger()</strong></p>
<p>Printing a ranger model will display what’s called an out of bag estimate of the model’s R-squared and mean squared error. These are the algorithm’s estimates of how the model will perform on future data. When possible, you should still evaluate the model directly on test data.</p>
<p><strong>7. Predicting with a ranger() model</strong></p>
<p>The predict function for a ranger model takes the model and a new data set. It returns an object with a field called predictions, containing the predicted outcomes. Here we get the model’s predictions for the February data.</p>
<p><strong>8. Evaluating the model</strong></p>
<p>On the February data, our random forest model has a root mean squared error of 67-point-15, a slight improvement on the RMSE of 69-point-3 for the quasipoisson model from Chapter 3.</p>
<p><strong>9. Evaluating the model</strong></p>
<p>We can also compare the predictions to the actual hourly bike rentals via a scatterplot</p>
<p><strong>10. Evaluating the model</strong></p>
<p>or by plotting the data as a function of time.</p>
<p><strong>11. Let’s practice!</strong></p>
<p>Now let’s practice building and fitting random forest models.</p>
</section>
<section id="build-a-random-forest-model-for-bike-rentals" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="build-a-random-forest-model-for-bike-rentals"><span class="header-section-number">5.5</span> Build a random forest model for bike rentals</h2>
<p>In this exercise you will again build a model to predict the number of bikes rented in an hour as a function of the weather, the type of day (holiday, working day, or weekend), and the time of day. You will train the model on data from the month of July.</p>
<p>You will use the <code>ranger</code> package to fit the random forest model. For this exercise, the key arguments to the <a href="https://www.rdocumentation.org/packages/ranger/topics/ranger"><code>ranger()</code></a> call are:</p>
<ul>
<li><code>formula</code></li>
<li><code>data</code></li>
<li><code>num.trees</code>: the number of trees in the forest.</li>
<li><code>respect.unordered.factors</code> : Specifies how to treat unordered factor variables. We recommend setting this to “order” for regression.</li>
<li><code>seed</code>: because this is a random algorithm, you will set the seed to get reproducible results</li>
</ul>
<p>Since there are a lot of input variables, for convenience we will specify the outcome and the inputs in the variables <code>outcome</code> and <code>vars</code>, and use <a href="https://www.rdocumentation.org/packages/base/topics/paste"><code>paste()</code></a> to assemble a string representing the model formula.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Fill in the blanks to create the formula <code>fmla</code> expressing <code>cnt</code> as a function of the inputs. Print it.</p></li>
<li><p>Load the package <code>ranger</code>.</p></li>
<li><p>Use <code>ranger</code> to fit a model to the <code>bikesJuly</code> data: <code>bike_model_rf</code>.</p>
<ul>
<li>The first argument to <code>ranger()</code> is the formula, <code>fmla</code>.</li>
<li>Use 500 trees and <code>respect.unordered.factors = "order"</code>.</li>
<li>Set the seed to <code>seed</code> for reproducible results.</li>
<li>Print the model. What is the R-squared?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1"></a><span class="co"># bikesJuly is in the workspace</span></span>
<span id="cb202-2"><a href="#cb202-2"></a><span class="fu">str</span>(bikesJuly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 'data.frame':    744 obs. of  12 variables:
#&gt;  $ hr        : Factor w/ 24 levels "0","1","2","3",..: 1 2 3 4 5 6 7 8 9 10 ...
#&gt;  $ holiday   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
#&gt;  $ workingday: logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
#&gt;  $ weathersit: chr  "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" ...
#&gt;  $ temp      : num  0.76 0.74 0.72 0.72 0.7 0.68 0.7 0.74 0.78 0.82 ...
#&gt;  $ atemp     : num  0.727 0.697 0.697 0.712 0.667 ...
#&gt;  $ hum       : num  0.66 0.7 0.74 0.84 0.79 0.79 0.79 0.7 0.62 0.56 ...
#&gt;  $ windspeed : num  0 0.1343 0.0896 0.1343 0.194 ...
#&gt;  $ cnt       : int  149 93 90 33 4 10 27 50 142 219 ...
#&gt;  $ instant   : int  13004 13005 13006 13007 13008 13009 13010 13011 13012 13013 ...
#&gt;  $ mnth      : int  7 7 7 7 7 7 7 7 7 7 ...
#&gt;  $ yr        : int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1"></a><span class="co"># Random seed to reproduce results</span></span>
<span id="cb204-2"><a href="#cb204-2"></a>seed <span class="ot">&lt;-</span> <span class="dv">423563</span></span>
<span id="cb204-3"><a href="#cb204-3"></a></span>
<span id="cb204-4"><a href="#cb204-4"></a><span class="co"># the outcome column</span></span>
<span id="cb204-5"><a href="#cb204-5"></a>(outcome <span class="ot">&lt;-</span> <span class="st">"cnt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "cnt"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1"></a><span class="co"># The input variables</span></span>
<span id="cb206-2"><a href="#cb206-2"></a>(vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hr"</span>, <span class="st">"holiday"</span>, <span class="st">"workingday"</span>, <span class="st">"weathersit"</span>, <span class="st">"temp"</span>, <span class="st">"atemp"</span>, <span class="st">"hum"</span>, <span class="st">"windspeed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "hr"         "holiday"    "workingday" "weathersit" "temp"      
#&gt; [6] "atemp"      "hum"        "windspeed"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a><span class="co"># Create the formula string for bikes rented as a function of the inputs</span></span>
<span id="cb208-2"><a href="#cb208-2"></a>(fmla <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "cnt ~ hr + holiday + workingday + weathersit + temp + atemp + hum + windspeed"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a><span class="co"># Load the package ranger</span></span>
<span id="cb210-2"><a href="#cb210-2"></a><span class="fu">library</span>(ranger)</span>
<span id="cb210-3"><a href="#cb210-3"></a></span>
<span id="cb210-4"><a href="#cb210-4"></a><span class="co"># Fit and print the random forest model.</span></span>
<span id="cb210-5"><a href="#cb210-5"></a>(bike_model_rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(fmla, </span>
<span id="cb210-6"><a href="#cb210-6"></a>                         bikesJuly, </span>
<span id="cb210-7"><a href="#cb210-7"></a>                         <span class="at">num.trees =</span> <span class="dv">500</span>, </span>
<span id="cb210-8"><a href="#cb210-8"></a>                         <span class="at">respect.unordered.factors =</span> <span class="st">"order"</span>, </span>
<span id="cb210-9"><a href="#cb210-9"></a>                         <span class="at">seed =</span> seed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Ranger result
#&gt; 
#&gt; Call:
#&gt;  ranger(fmla, bikesJuly, num.trees = 500, respect.unordered.factors = "order",      seed = seed) 
#&gt; 
#&gt; Type:                             Regression 
#&gt; Number of trees:                  500 
#&gt; Sample size:                      744 
#&gt; Number of independent variables:  8 
#&gt; Mtry:                             2 
#&gt; Target node size:                 5 
#&gt; Variable importance mode:         none 
#&gt; Splitrule:                        variance 
#&gt; OOB prediction error (MSE):       8299.851 
#&gt; R squared (OOB):                  0.8190328</code></pre>
</div>
</div>
<p>Very good! You have fit a model to the data with a respectable R-squared. In the next exercise you will see how well it does on holdout data.</p>
</section>
<section id="predict-bike-rentals-with-the-random-forest-model" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="predict-bike-rentals-with-the-random-forest-model"><span class="header-section-number">5.6</span> Predict bike rentals with the random forest model</h2>
<p>In this exercise you will use the model that you fit in the previous exercise to predict bike rentals for the month of August.</p>
<p>The <a href="https://www.rdocumentation.org/packages/ranger/topics/predict.ranger"><code>predict()</code></a> function for a <code>ranger</code> model produces a list. One of the elements of this list is <code>predictions</code>, a vector of predicted values. You can access <code>predictions</code> with the <code>$</code> notation for accessing named elements of a list:</p>
<p><code>predict(model, data)$predictions</code></p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Call <code>predict()</code> on <code>bikesAugust</code> to predict the number of bikes rented in August (<code>cnt</code>). Add the predictions to <code>bikesAugust</code> as the column <code>pred</code>.</p></li>
<li><p>Fill in the blanks to calculate the root mean squared error of the predictions.poisson model you built for this data gave an RMSE of about 112.6. How does this model compare?</p>
<ul>
<li>The poisson model you built for this data gave an RMSE of about 112.6. How does this model compare?</li>
</ul></li>
<li><p>Fill in the blanks to plot actual bike rental counts (<code>cnt</code>) versus the predictions (<code>pred</code> on x-axis).</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a><span class="co"># Make predictions on the August data</span></span>
<span id="cb212-2"><a href="#cb212-2"></a>bikesAugust<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bike_model_rf, bikesAugust)<span class="sc">$</span>predictions</span>
<span id="cb212-3"><a href="#cb212-3"></a></span>
<span id="cb212-4"><a href="#cb212-4"></a><span class="co"># Calculate the RMSE of the predictions</span></span>
<span id="cb212-5"><a href="#cb212-5"></a>bikesAugust <span class="sc">%&gt;%</span> </span>
<span id="cb212-6"><a href="#cb212-6"></a>  <span class="fu">mutate</span>(<span class="at">residual =</span> cnt <span class="sc">-</span> pred)  <span class="sc">%&gt;%</span>        <span class="co"># calculate the residual</span></span>
<span id="cb212-7"><a href="#cb212-7"></a>  <span class="fu">summarize</span>(<span class="at">rmse  =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residual<span class="sc">^</span><span class="dv">2</span>))) <span class="co"># calculate rmse</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rmse"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"96.66032"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1"></a><span class="co"># Plot actual outcome vs predictions (predictions on x-axis)</span></span>
<span id="cb213-2"><a href="#cb213-2"></a><span class="fu">ggplot</span>(bikesAugust, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> cnt)) <span class="sc">+</span> </span>
<span id="cb213-3"><a href="#cb213-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb213-4"><a href="#cb213-4"></a>  <span class="fu">geom_abline</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-54-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job! This random forest model outperforms the poisson count model on the same data; it is discovering more complex non-linear or non-additive relationships in the data.</p>
</section>
<section id="visualize-random-forest-bike-model-predictions" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="visualize-random-forest-bike-model-predictions"><span class="header-section-number">5.7</span> Visualize random forest bike model predictions</h2>
<p>In the previous exercise, you saw that the random forest bike model did better on the August data than the quasiposson model, in terms of RMSE.</p>
<p>In this exercise you will visualize the random forest model’s August predictions as a function of time. The corresponding plot from the quasipoisson model that you built in a previous exercise is in the workspace for you to compare.</p>
<p>Recall that the quasipoisson model mostly identified the pattern of slow and busy hours in the day, but it somewhat underestimated peak demands. You would like to see how the random forest model compares.</p>
<p>The data frame <code>bikesAugust</code> (with predictions) is in the workspace. The plot <code>quasipoisson_plot</code> of quasipoisson model predictions as a function of time is shown.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Fill in the blanks to plot the predictions and actual counts by hour for the first 14 days of August.<code>gather</code> the <code>cnt</code> and <code>pred</code> columns into a column called <code>value</code>, with a key called <code>valuetype</code>.<code>value</code> as a function of <code>instant</code> (day).</p>
<ul>
<li><code>gather</code> the <code>cnt</code> and <code>pred</code> columns into a column called <code>value</code>, with a key called <code>valuetype</code>.</li>
<li>Plot <code>value</code> as a function of <code>instant</code> (day).</li>
</ul></li>
</ol>
<p><em>How does the random forest model compare?</em></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1"></a>first_two_weeks <span class="ot">&lt;-</span> bikesAugust <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="#cb214-2"></a>  <span class="co"># Set start to 0, convert unit to days</span></span>
<span id="cb214-3"><a href="#cb214-3"></a>  <span class="fu">mutate</span>(<span class="at">instant =</span> (instant <span class="sc">-</span> <span class="fu">min</span>(instant)) <span class="sc">/</span> <span class="dv">24</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb214-4"><a href="#cb214-4"></a>  <span class="co"># Gather cnt and pred into a column named value with key valuetype</span></span>
<span id="cb214-5"><a href="#cb214-5"></a>  <span class="fu">gather</span>(<span class="at">key =</span> valuetype, <span class="at">value =</span> value, cnt, pred) <span class="sc">%&gt;%</span></span>
<span id="cb214-6"><a href="#cb214-6"></a>  <span class="co"># Filter for rows in the first two</span></span>
<span id="cb214-7"><a href="#cb214-7"></a>  <span class="fu">filter</span>(instant <span class="sc">&lt;</span> <span class="dv">14</span>) </span>
<span id="cb214-8"><a href="#cb214-8"></a></span>
<span id="cb214-9"><a href="#cb214-9"></a><span class="co"># Plot predictions and cnt by date/time </span></span>
<span id="cb214-10"><a href="#cb214-10"></a><span class="fu">ggplot</span>(first_two_weeks, <span class="fu">aes</span>(<span class="at">x =</span> instant, <span class="at">y =</span> value, <span class="at">color =</span> valuetype, <span class="at">linetype =</span> valuetype)) <span class="sc">+</span> </span>
<span id="cb214-11"><a href="#cb214-11"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb214-12"><a href="#cb214-12"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb214-13"><a href="#cb214-13"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Day"</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>, <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb214-14"><a href="#cb214-14"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span> </span>
<span id="cb214-15"><a href="#cb214-15"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted August bike rentals, Random Forest plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-55-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Nice job! The random forest model captured the day-to-day variations in peak demand better than the quasipoisson model, but it still underestmates peak demand, and also overestimates minimum demand. So there is still room for improvement.</p>
</section>
<section id="one-hot-encoding-categorical-variables" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="one-hot-encoding-categorical-variables"><span class="header-section-number">5.8</span> One-Hot-Encoding Categorical Variables</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. One-Hot-Encoding Categorical Variables</strong></p>
<p>To prepare for the next lesson on the xgboost implementation of gradient boosting, in this lesson you will learn how to safely convert categorical variables to indicator variables.</p>
<p><strong>2. Why Convert Categoricals Manually?</strong></p>
<p>As we mentioned in a previous lesson, most R modeling functions do a great job of managing categorical variables for you, so usually you don’t have to worry about it. However, not all programming languages do this. In the next lesson, you will learn about xgboost, a package that originally comes from Python. xgboost does not directly accept categoricals; they must be converted to indicators or another numerical representation. In Python, this conversion is called one-hot encoding.</p>
<p><strong>3. One-hot-encoding and data cleaning with <code>vtreat</code></strong></p>
<p>We will use the vtreat package to one-hot encode categorical variables. As a side effect, vtreat also cleans up missing values in both categorical and numeric data. The basic idea is to design a treatment plan from the training data using the function designTreatmentsZ. This treatment plan records the steps needed to safely one-hot-encode not just the training data, but future data as well.The function prepare converts the training and future data to a form that is compatible with xgboost: all numerical variables, with no missing values.</p>
<p><strong>4. A Small vtreat Example</strong></p>
<p>Let’s work a small example. Here we have data where x is a categorical input variable with levels “one”, “two” and “three”, and u is a numeric input variable. y is the outcome.</p>
<p><strong>5. Create the Treatment Plan</strong></p>
<p>First create the treatment plan. designTreatmentsZ takes as input the training data and a list of the input variable names.</p>
<p><strong>6. Get the New Variables</strong></p>
<p>The treatment plan contains a member called the score frame, which holds a mapping from the original variable names to new variable names, and the type of the new variables. We are only interested in “lev” variables, which are the indicator variables, and “clean” variables, which are the numeric variables, cleaned to not hold bad values like NA or NaN. We can get a list of the new variable names from the scoreFrame.</p>
<p><strong>7. Prepare the Training Data for Modeling</strong></p>
<p>Once we have the variable names, we can use the prepare function and the treatment plan to create new treated training data suitable for training an xgboost model.</p>
<p><strong>8. Before and After Data Treatment</strong></p>
<p>The categorical variable is now three indicator variables, and the treated data is all numerical, with no missing values. Note that the outcome variable is not present in the treated data.</p>
<p><strong>9. Prepare the Test Data Before Model Application</strong></p>
<p>We must also use prepare on future data before model application.</p>
<p><strong>10. vtreat Treatment is Robust</strong></p>
<p>Sometimes, there are levels of a categorical variable that don’t appear in the training data. Usually, this will crash a model. vtreat encodings handle this situation gracefully.vtreat can also do a meaningful encoding of categorical variables similar to the method ranger uses, but that is outside the scope of this lesson. For more information, see the vtreat documentation on github.Now let’s practice using vtreat on data.</p>
<p><strong>11. Let’s practice!</strong></p>
</section>
<section id="vtreat-on-a-small-example" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="vtreat-on-a-small-example"><span class="header-section-number">5.9</span> vtreat on a small example</h2>
<p>In this exercise you will use <code>vtreat</code> to one-hot-encode a categorical variable on a small example. <code>vtreat</code> creates a <em>treatment plan</em> to transform categorical variables into indicator variables (coded <code>"lev"</code>), and to clean bad values out of numerical variables (coded <code>"clean"</code>).</p>
<p>To design a treatment plan use the function <a href="https://www.rdocumentation.org/packages/vtreat/topics/designTreatmentsZ"><code>designTreatmentsZ()</code></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1"></a>treatplan <span class="ot">&lt;-</span> <span class="fu">designTreatmentsZ</span>(data, varlist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>data</code>: the original training data frame</li>
<li><code>varlist</code>: a vector of input variables to be treated (as strings).</li>
</ul>
<p><code>designTreatmentsZ()</code> returns a list with an element <code>scoreFrame</code>: a data frame that includes the names and types of the new variables:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1"></a>scoreFrame <span class="ot">&lt;-</span> treatplan <span class="sc">%&gt;%</span> </span>
<span id="cb216-2"><a href="#cb216-2"></a>            magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span> </span>
<span id="cb216-3"><a href="#cb216-3"></a>            <span class="fu">select</span>(varName, origName, code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>varName</code>: the name of the new treated variable</li>
<li><code>origName</code>: the name of the original variable that the treated variable comes from</li>
<li><code>code</code>: the type of the new variable.
<ul>
<li><code>"clean"</code>: a numerical variable with no NAs or NaNs</li>
<li><code>"lev"</code>: an indicator variable for a specific level of the original categorical variable.</li>
</ul></li>
</ul>
<p>(<a href="https://www.rdocumentation.org/packages/magrittr/topics/extract"><code>magrittr::use_series()</code></a> is an alias for <code>$</code> that you can use in pipes.)</p>
<p>For these exercises, we want <code>varName</code> where <code>code</code> is either <code>"clean"</code> or <code>"lev"</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a>newvarlist <span class="ot">&lt;-</span> scoreFrame <span class="sc">%&gt;%</span> </span>
<span id="cb217-2"><a href="#cb217-2"></a>             <span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb217-3"><a href="#cb217-3"></a>             magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To transform the data set into all numerical and one-hot-encoded variables, use <a href="https://www.rdocumentation.org/packages/vtreat/topics/prepare"><code>prepare()</code></a>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1"></a>data.treat <span class="ot">&lt;-</span> <span class="fu">prepare</span>(treatplan, data, <span class="at">varRestrictions =</span> newvarlist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>treatplan</code>: the treatment plan</li>
<li><code>data</code>: the data frame to be treated</li>
<li><code>varRestrictions</code>: the variables desired in the treated data</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Print <code>dframe</code>. We will assume that <code>color</code> and <code>size</code> are input variables, and <code>popularity</code> is the outcome to be predicted.</p></li>
<li><p>Create a vector called <code>vars</code> with the names of the input variables (as strings).</p></li>
<li><p>Load the package <code>vtreat</code>.</p></li>
<li><p>Use <code>designTreatmentsZ()</code> to create a treatment plan for the variables in <code>vars</code>. Assign it to the variable <code>treatplan</code>.</p></li>
<li><p>Get and examine the <code>scoreFrame</code> from the treatment plan to see the mapping from old variables to new variables.only need the columns <code>varName</code>, <code>origName</code> and <code>code</code>.are the names of the new indicator variables? Of the continuous variable?</p>
<ul>
<li>You only need the columns <code>varName</code>, <code>origName</code> and <code>code</code>.</li>
<li>What are the names of the new indicator variables? Of the continuous variable?</li>
</ul></li>
<li><p>Create a vector <code>newvars</code> that contains the variable <code>varName</code> where <code>code</code> is either <code>clean</code> or <code>lev</code>. Print it.</p></li>
<li><p>Use <code>prepare()</code> to create a new data frame <code>dframe.treat</code> that is a one-hot-encoded version of <code>dframe</code> (without the outcome column). it and compare to <code>dframe</code>.</p>
<ul>
<li>Print it and compare to <code>dframe</code>.</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a><span class="co"># Load package</span></span>
<span id="cb219-2"><a href="#cb219-2"></a><span class="fu">library</span>(magrittr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attache Paket: 'magrittr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Das folgende Objekt ist maskiert 'package:tidyr':
#&gt; 
#&gt;     extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1"></a><span class="co"># Load dframe</span></span>
<span id="cb222-2"><a href="#cb222-2"></a>dframe <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/dframe.rds"</span>)</span>
<span id="cb222-3"><a href="#cb222-3"></a></span>
<span id="cb222-4"><a href="#cb222-4"></a><span class="co"># Create a vector of variable names</span></span>
<span id="cb222-5"><a href="#cb222-5"></a>(vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"color"</span>, <span class="st">"size"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "color" "size"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a><span class="co"># Load the package vtreat</span></span>
<span id="cb224-2"><a href="#cb224-2"></a><span class="fu">library</span>(vtreat)</span>
<span id="cb224-3"><a href="#cb224-3"></a></span>
<span id="cb224-4"><a href="#cb224-4"></a><span class="co"># Create the treatment plan</span></span>
<span id="cb224-5"><a href="#cb224-5"></a>treatplan <span class="ot">&lt;-</span> <span class="fu">designTreatmentsZ</span>(dframe, vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "vtreat 1.6.3 inspecting inputs Fri Dec  9 11:06:06 2022"
#&gt; [1] "designing treatments Fri Dec  9 11:06:06 2022"
#&gt; [1] " have initial level statistics Fri Dec  9 11:06:06 2022"
#&gt; [1] " scoring treatments Fri Dec  9 11:06:06 2022"
#&gt; [1] "have treatment plan Fri Dec  9 11:06:06 2022"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a><span class="co"># Examine the scoreFrame</span></span>
<span id="cb226-2"><a href="#cb226-2"></a>(scoreFrame <span class="ot">&lt;-</span> treatplan <span class="sc">%&gt;%</span></span>
<span id="cb226-3"><a href="#cb226-3"></a>    <span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span></span>
<span id="cb226-4"><a href="#cb226-4"></a>    <span class="fu">select</span>(varName, origName, code))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["varName"],"name":[1],"type":["chr"],"align":["left"]},{"label":["origName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["code"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"color_catP","2":"color","3":"catP","_rn_":"1"},{"1":"size","2":"size","3":"clean","_rn_":"2"},{"1":"color_lev_x_b","2":"color","3":"lev","_rn_":"3"},{"1":"color_lev_x_g","2":"color","3":"lev","_rn_":"4"},{"1":"color_lev_x_r","2":"color","3":"lev","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a><span class="co"># We only want the rows with codes "clean" or "lev"</span></span>
<span id="cb227-2"><a href="#cb227-2"></a>(newvars <span class="ot">&lt;-</span> scoreFrame <span class="sc">%&gt;%</span></span>
<span id="cb227-3"><a href="#cb227-3"></a>    <span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb227-4"><a href="#cb227-4"></a>    <span class="fu">use_series</span>(varName))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "size"          "color_lev_x_b" "color_lev_x_g" "color_lev_x_r"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1"></a><span class="co"># Create the treated training data</span></span>
<span id="cb229-2"><a href="#cb229-2"></a>(dframe.treat <span class="ot">&lt;-</span> <span class="fu">prepare</span>(treatplan, dframe, <span class="at">varRestriction =</span> newvars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["size"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["color_lev_x_b"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["color_lev_x_g"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["color_lev_x_r"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"13","2":"1","3":"0","4":"0"},{"1":"11","2":"0","3":"0","4":"1"},{"1":"15","2":"0","3":"0","4":"1"},{"1":"14","2":"0","3":"0","4":"1"},{"1":"13","2":"0","3":"0","4":"1"},{"1":"11","2":"1","3":"0","4":"0"},{"1":"9","2":"0","3":"0","4":"1"},{"1":"12","2":"0","3":"1","4":"0"},{"1":"7","2":"1","3":"0","4":"0"},{"1":"12","2":"1","3":"0","4":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Great work! You have successfully one-hot-encoded categorical data. The new indicator variables have <code>'_lev_'</code> in their names, and the new cleaned continuous variables have <code>'_clean'</code> in their names. The treated data is all numerical, with no missing values, and is suitable for use with xgboost and other R modeling functions.</p>
</section>
<section id="novel-levels" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="novel-levels"><span class="header-section-number">5.10</span> Novel levels</h2>
<p>When a level of a categorical variable is rare, sometimes it will fail to show up in training data. If that rare level then appears in future data, downstream models may not know what to do with it. When such <em>novel levels</em> appear, using <code>model.matrix</code> or <code>caret::dummyVars</code> to one-hot-encode will not work correctly.</p>
<p><code>vtreat</code> is a “safer” alternative to <code>model.matrix</code> for one-hot-encoding, because it can manage novel levels safely. <code>vtreat</code> also manages missing values in the data (both categorical and continuous).</p>
<p>In this exercise you will see how <code>vtreat</code> handles categorical values that did not appear in the training set. The treatment plan <code>treatplan</code> and the set of variables <code>newvars</code> from the previous exercise are still in your workspace. <code>dframe</code> and a new data frame <code>testframe</code> are also in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Print <code>dframe</code> and <code>testframe</code>. there colors in <code>testframe</code> that didn’t appear in <code>dframe</code>?</p>
<ul>
<li>Are there colors in <code>testframe</code> that didn’t appear in <code>dframe</code>?</li>
</ul></li>
<li><p>Call <code>prepare()</code> to create a one-hot-encoded version of <code>testframe</code> (without the outcome). Call it <code>testframe.treat</code> and print it.the <code>varRestriction</code> argument to restrict to only the variables in <code>newvars</code>. are the yellow rows encoded?</p>
<ul>
<li>Use the <code>varRestriction</code> argument to restrict to only the variables in <code>newvars</code>.</li>
<li>How are the yellow rows encoded?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a><span class="co"># treatplan is in the workspace</span></span>
<span id="cb230-2"><a href="#cb230-2"></a><span class="fu">summary</span>(treatplan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;               Length Class           Mode     
#&gt; treatments    3      -none-          list     
#&gt; scoreFrame    8      data.frame      list     
#&gt; outcomename   1      -none-          character
#&gt; vtreatVersion 1      package_version list     
#&gt; outcomeType   1      -none-          character
#&gt; outcomeTarget 1      -none-          character
#&gt; meanY         1      -none-          logical  
#&gt; splitmethod   1      -none-          character</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a><span class="co"># newvars is in the workspace</span></span>
<span id="cb232-2"><a href="#cb232-2"></a>newvars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "size"          "color_lev_x_b" "color_lev_x_g" "color_lev_x_r"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a><span class="co"># Print dframe and testframe</span></span>
<span id="cb234-2"><a href="#cb234-2"></a>dframe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["color"],"name":[1],"type":["chr"],"align":["left"]},{"label":["size"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["popularity"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"b","2":"13","3":"1.0785088"},{"1":"r","2":"11","3":"1.3956245"},{"1":"r","2":"15","3":"0.9217988"},{"1":"r","2":"14","3":"1.2025453"},{"1":"r","2":"13","3":"1.0838662"},{"1":"b","2":"11","3":"0.8043527"},{"1":"r","2":"9","3":"1.1035440"},{"1":"g","2":"12","3":"0.8746332"},{"1":"b","2":"7","3":"0.6947058"},{"1":"b","2":"12","3":"0.8832502"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1"></a>testframe <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/testframe.rds"</span>)</span>
<span id="cb235-2"><a href="#cb235-2"></a>testframe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["color"],"name":[1],"type":["chr"],"align":["left"]},{"label":["size"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["popularity"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"g","2":"7","3":"0.9733920"},{"1":"g","2":"8","3":"0.9122529"},{"1":"y","2":"10","3":"1.4217153"},{"1":"g","2":"12","3":"1.1905828"},{"1":"g","2":"6","3":"0.9866464"},{"1":"y","2":"8","3":"1.3697515"},{"1":"b","2":"12","3":"1.0959387"},{"1":"g","2":"12","3":"0.9161547"},{"1":"r","2":"8","3":"1.3137360"},{"1":"g","2":"12","3":"1.0000460"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1"></a><span class="co"># Use prepare() to one-hot-encode testframe</span></span>
<span id="cb236-2"><a href="#cb236-2"></a>(testframe.treat <span class="ot">&lt;-</span> <span class="fu">prepare</span>(treatplan, testframe, <span class="at">varRestriction =</span> newvars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["size"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["color_lev_x_b"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["color_lev_x_g"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["color_lev_x_r"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"7","2":"0","3":"1","4":"0"},{"1":"8","2":"0","3":"1","4":"0"},{"1":"10","2":"0","3":"0","4":"0"},{"1":"12","2":"0","3":"1","4":"0"},{"1":"6","2":"0","3":"1","4":"0"},{"1":"8","2":"0","3":"0","4":"0"},{"1":"12","2":"1","3":"0","4":"0"},{"1":"12","2":"0","3":"1","4":"0"},{"1":"8","2":"0","3":"0","4":"1"},{"1":"12","2":"0","3":"1","4":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Good work! As you saw, vtreat encodes novel colors like yellow that were not present in the data as all zeros: ‘none of the known colors’. This allows downstream models to accept these novel values without crashing.</p>
</section>
<section id="vtreat-the-bike-rental-data" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="vtreat-the-bike-rental-data"><span class="header-section-number">5.11</span> vtreat the bike rental data</h2>
<p>In this exercise you will create one-hot-encoded data frames of the July/August bike data, for use with <code>xgboost</code> later on.</p>
<p>The data frames <code>bikesJuly</code> and <code>bikesAugust</code> are in the workspace.</p>
<p>For your convenience, we have defined the variable <code>vars</code> with the list of variable columns for the model.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Load the package <code>vtreat</code>.</p></li>
<li><p>Use <code>designTreatmentsZ()</code> to create a treatment plan <code>treatplan</code> for the variables in <code>vars</code> from <code>bikesJuly</code> (the training data).the flag <code>verbose=FALSE</code> to prevent the function from printing too many messages.</p>
<ul>
<li>Set the flag <code>verbose=FALSE</code> to prevent the function from printing too many messages.</li>
</ul></li>
<li><p>Fill in the blanks to create a vector <code>newvars</code> that contains only the names of the <code>clean</code> and <code>lev</code> transformed variables. Print it.</p></li>
<li><p>Use <code>prepare()</code> to create a one-hot-encoded training data frame <code>bikesJuly.treat</code>. the <code>varRestrictions</code> argument to restrict the variables you will use to <code>newvars</code>.</p>
<ul>
<li>Use the <code>varRestrictions</code> argument to restrict the variables you will use to <code>newvars</code>.</li>
</ul></li>
<li><p>Use <code>prepare()</code> to create a one-hot-encoded test frame <code>bikesAugust.treat</code> from <code>bikesAugust</code> in the same way.</p></li>
<li><p>Call <code>str()</code> on both prepared test frames to see the structure.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a><span class="co"># The outcome column</span></span>
<span id="cb237-2"><a href="#cb237-2"></a>(outcome <span class="ot">&lt;-</span> <span class="st">"cnt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "cnt"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1"></a><span class="co"># The input columns</span></span>
<span id="cb239-2"><a href="#cb239-2"></a>(vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hr"</span>, <span class="st">"holiday"</span>, <span class="st">"workingday"</span>, <span class="st">"weathersit"</span>, <span class="st">"temp"</span>, <span class="st">"atemp"</span>, <span class="st">"hum"</span>, <span class="st">"windspeed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "hr"         "holiday"    "workingday" "weathersit" "temp"      
#&gt; [6] "atemp"      "hum"        "windspeed"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a><span class="co"># Load the package vtreat</span></span>
<span id="cb241-2"><a href="#cb241-2"></a><span class="fu">library</span>(vtreat)</span>
<span id="cb241-3"><a href="#cb241-3"></a></span>
<span id="cb241-4"><a href="#cb241-4"></a><span class="co"># Create the treatment plan from bikesJuly (the training data)</span></span>
<span id="cb241-5"><a href="#cb241-5"></a>treatplan <span class="ot">&lt;-</span> <span class="fu">designTreatmentsZ</span>(bikesJuly, vars, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb241-6"><a href="#cb241-6"></a></span>
<span id="cb241-7"><a href="#cb241-7"></a><span class="co"># Get the "clean" and "lev" variables from the scoreFrame</span></span>
<span id="cb241-8"><a href="#cb241-8"></a>(newvars <span class="ot">&lt;-</span> treatplan <span class="sc">%&gt;%</span></span>
<span id="cb241-9"><a href="#cb241-9"></a>  <span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>               </span>
<span id="cb241-10"><a href="#cb241-10"></a>  <span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># get the variables you care about</span></span>
<span id="cb241-11"><a href="#cb241-11"></a>  <span class="fu">use_series</span>(varName))                     <span class="co"># get the varName column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "holiday"                                
#&gt;  [2] "workingday"                             
#&gt;  [3] "temp"                                   
#&gt;  [4] "atemp"                                  
#&gt;  [5] "hum"                                    
#&gt;  [6] "windspeed"                              
#&gt;  [7] "hr_lev_x_0"                             
#&gt;  [8] "hr_lev_x_1"                             
#&gt;  [9] "hr_lev_x_10"                            
#&gt; [10] "hr_lev_x_11"                            
#&gt; [11] "hr_lev_x_12"                            
#&gt; [12] "hr_lev_x_13"                            
#&gt; [13] "hr_lev_x_14"                            
#&gt; [14] "hr_lev_x_15"                            
#&gt; [15] "hr_lev_x_16"                            
#&gt; [16] "hr_lev_x_17"                            
#&gt; [17] "hr_lev_x_18"                            
#&gt; [18] "hr_lev_x_19"                            
#&gt; [19] "hr_lev_x_2"                             
#&gt; [20] "hr_lev_x_20"                            
#&gt; [21] "hr_lev_x_21"                            
#&gt; [22] "hr_lev_x_22"                            
#&gt; [23] "hr_lev_x_23"                            
#&gt; [24] "hr_lev_x_3"                             
#&gt; [25] "hr_lev_x_4"                             
#&gt; [26] "hr_lev_x_5"                             
#&gt; [27] "hr_lev_x_6"                             
#&gt; [28] "hr_lev_x_7"                             
#&gt; [29] "hr_lev_x_8"                             
#&gt; [30] "hr_lev_x_9"                             
#&gt; [31] "weathersit_lev_x_Clear_to_partly_cloudy"
#&gt; [32] "weathersit_lev_x_Light_Precipitation"   
#&gt; [33] "weathersit_lev_x_Misty"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a><span class="co"># Prepare the training data</span></span>
<span id="cb243-2"><a href="#cb243-2"></a>bikesJuly.treat <span class="ot">&lt;-</span> <span class="fu">prepare</span>(treatplan, bikesJuly,  <span class="at">varRestriction =</span> newvars)</span>
<span id="cb243-3"><a href="#cb243-3"></a></span>
<span id="cb243-4"><a href="#cb243-4"></a><span class="co"># Prepare the test data</span></span>
<span id="cb243-5"><a href="#cb243-5"></a>bikesAugust.treat <span class="ot">&lt;-</span> <span class="fu">prepare</span>(treatplan, bikesAugust, <span class="at">varRestriction =</span> newvars)</span>
<span id="cb243-6"><a href="#cb243-6"></a></span>
<span id="cb243-7"><a href="#cb243-7"></a><span class="co"># Call str() on the treated data</span></span>
<span id="cb243-8"><a href="#cb243-8"></a><span class="fu">str</span>(bikesJuly.treat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 'data.frame':    744 obs. of  33 variables:
#&gt;  $ holiday                                : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ workingday                             : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ temp                                   : num  0.76 0.74 0.72 0.72 0.7 0.68 0.7 0.74 0.78 0.82 ...
#&gt;  $ atemp                                  : num  0.727 0.697 0.697 0.712 0.667 ...
#&gt;  $ hum                                    : num  0.66 0.7 0.74 0.84 0.79 0.79 0.79 0.7 0.62 0.56 ...
#&gt;  $ windspeed                              : num  0 0.1343 0.0896 0.1343 0.194 ...
#&gt;  $ hr_lev_x_0                             : num  1 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_1                             : num  0 1 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_10                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_11                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_12                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_13                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_14                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_15                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_16                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_17                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_18                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_19                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_2                             : num  0 0 1 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_20                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_21                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_22                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_23                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_3                             : num  0 0 0 1 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_4                             : num  0 0 0 0 1 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_5                             : num  0 0 0 0 0 1 0 0 0 0 ...
#&gt;  $ hr_lev_x_6                             : num  0 0 0 0 0 0 1 0 0 0 ...
#&gt;  $ hr_lev_x_7                             : num  0 0 0 0 0 0 0 1 0 0 ...
#&gt;  $ hr_lev_x_8                             : num  0 0 0 0 0 0 0 0 1 0 ...
#&gt;  $ hr_lev_x_9                             : num  0 0 0 0 0 0 0 0 0 1 ...
#&gt;  $ weathersit_lev_x_Clear_to_partly_cloudy: num  1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ weathersit_lev_x_Light_Precipitation   : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ weathersit_lev_x_Misty                 : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1"></a><span class="fu">str</span>(bikesAugust.treat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 'data.frame':    744 obs. of  33 variables:
#&gt;  $ holiday                                : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ workingday                             : num  1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ temp                                   : num  0.68 0.66 0.64 0.64 0.64 0.64 0.64 0.64 0.66 0.68 ...
#&gt;  $ atemp                                  : num  0.636 0.606 0.576 0.576 0.591 ...
#&gt;  $ hum                                    : num  0.79 0.83 0.83 0.83 0.78 0.78 0.78 0.83 0.78 0.74 ...
#&gt;  $ windspeed                              : num  0.1642 0.0896 0.1045 0.1045 0.1343 ...
#&gt;  $ hr_lev_x_0                             : num  1 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_1                             : num  0 1 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_10                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_11                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_12                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_13                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_14                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_15                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_16                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_17                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_18                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_19                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_2                             : num  0 0 1 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_20                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_21                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_22                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_23                            : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_3                             : num  0 0 0 1 0 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_4                             : num  0 0 0 0 1 0 0 0 0 0 ...
#&gt;  $ hr_lev_x_5                             : num  0 0 0 0 0 1 0 0 0 0 ...
#&gt;  $ hr_lev_x_6                             : num  0 0 0 0 0 0 1 0 0 0 ...
#&gt;  $ hr_lev_x_7                             : num  0 0 0 0 0 0 0 1 0 0 ...
#&gt;  $ hr_lev_x_8                             : num  0 0 0 0 0 0 0 0 1 0 ...
#&gt;  $ hr_lev_x_9                             : num  0 0 0 0 0 0 0 0 0 1 ...
#&gt;  $ weathersit_lev_x_Clear_to_partly_cloudy: num  1 1 1 1 0 0 1 0 0 0 ...
#&gt;  $ weathersit_lev_x_Light_Precipitation   : num  0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ weathersit_lev_x_Misty                 : num  0 0 0 0 1 1 0 1 1 1 ...</code></pre>
</div>
</div>
<p>Perfect. The bike data is now in completely numeric form, ready to use with xgboost. Note that the treated data does not include the outcome column.</p>
</section>
<section id="gradient-boosting-machines" class="level2" data-number="5.12">
<h2 data-number="5.12" class="anchored" data-anchor-id="gradient-boosting-machines"><span class="header-section-number">5.12</span> Gradient boosting machines</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Gradient boosting machines</strong></p>
<p>In this lesson, you will learn about gradient boosting machines, and how to fit gradient boosting models in R with the xgboost package.</p>
<p><strong>2. How Gradient Boosting Works</strong></p>
<p>Gradient boosting is an ensemble method that builds up a model by incrementally improving the existing one. Start the model by fitting a single, usually shallow, tree to the data. This is M_1.</p>
<p><strong>3. How Gradient Boosting Works</strong></p>
<p>Next, fit a tree to the residuals of the model and find the weighted sum of that tree with the first one that gives the best fit. This is M_2.</p>
<p><strong>4. How Gradient Boosting Works</strong></p>
<p>For regularized boosting, decrease the learning by a factor eta, between 0 and 1. Eta close to 1 will give faster learning, but increases the risk of overfit. Smaller eta slows the learning, but lessens the risk of overfit.</p>
<p><strong>5. How Gradient Boosting Works</strong></p>
<p>Repeat until either the residuals are small enough, or the maximum number of iterations is reached.</p>
<p><strong>6. Cross-validation to Guard Against Overfit</strong></p>
<p>Because gradient boosting optimizes error on the training data, it’s very easy to overfit the model. So best practice is to estimate out-of-sample error via cross-validation for each incremental model, then retroactively decide how many trees to use.</p>
<p><strong>7. Best Practice (with xgboost())</strong></p>
<p>In xgboost, the xgb-dot-cv function fits a model and calculates the cross-validated errors. Run this function with a large number of rounds.</p>
<p><strong>8. Best Practice (with xgboost())</strong></p>
<p>xgb-dot-cv records the estimated errors in the evaluation_log element of its output. You can use the evaluation_log to find the number of trees with the lowest estimated RMSE.</p>
<p><strong>9. Best Practice (with xgboost())</strong></p>
<p>Now run the xgboost function with the right number of trees to get the final model.</p>
<p><strong>10. Example: Bike Rental Model</strong></p>
<p>Let’s work an example with the January and February bike rental data. Since xgboost can’t work directly with categorical variables, we use vtreat to prepare the data.</p>
<p><strong>11. Training a model with xgboost() / xgb.cv()</strong></p>
<p>First run xgb-dot-cv, which takes a large number of arguments. Set the objective to “reg:linear” for regression. Here we set the number of rounds to 100, with a tree depth of 6 and a learning rate eta of 0-point-3. We specify 5-fold cross validation for estimating out-of-sample error.</p>
<p><strong>12. Find the Right Number of Trees</strong></p>
<p>The out-of-sample error estimates are in the column test_rmse_mean of the evaluation log. The index of the minimum value corresponds to the best number of trees. For this example, the best model had 78 trees.</p>
<p><strong>13. Run xgboost() for final model</strong></p>
<p>Now run xgboost with the right number of trees to get the final model.</p>
<p><strong>14. Predict with an xgboost() model</strong></p>
<p>The predict function for xgboost models takes a model and the input data. Again, we have to prepare the test data using vtreat. Our gradient boosting model has an RMSE of 54, a notable improvement over the quasipoisson and random forest models we fit earlier.</p>
<p><strong>15. Visualize the Results</strong></p>
<p>We can compare the February predictions to the actual February hourly bike rentals as a scatterplot, and plotted against time.Now let’s practice using xgboost to build and run gradient boosting models.</p>
<p><strong>16. Let’s practice!</strong></p>
</section>
<section id="find-the-right-number-of-trees-for-a-gradient-boosting-machine" class="level2" data-number="5.13">
<h2 data-number="5.13" class="anchored" data-anchor-id="find-the-right-number-of-trees-for-a-gradient-boosting-machine"><span class="header-section-number">5.13</span> Find the right number of trees for a gradient boosting machine</h2>
<p>In this exercise you will get ready to build a gradient boosting model to predict the number of bikes rented in an hour as a function of the weather and the type and time of day. You will train the model on data from the month of July.</p>
<p>The July data is loaded into your workspace. Remember that <code>bikesJuly.treat</code> no longer has the outcome column, so you must get it from the untreated data: <code>bikesJuly$cnt</code>.</p>
<p>You will use the <code>xgboost</code> package to fit the random forest model. The function <a href="https://www.rdocumentation.org/packages/xgboost/topics/xgb.cv"><code>xgb.cv()</code></a> uses cross-validation to estimate the out-of-sample learning error as each new tree is added to the model. The appropriate number of trees to use in the final model is the number that minimizes the holdout RMSE.</p>
<p>For this exercise, the key arguments to the <code>xgb.cv()</code> call are:</p>
<ul>
<li><code>data</code>: a numeric matrix.</li>
<li><code>label</code>: vector of outcomes (also numeric).</li>
<li><code>nrounds</code>: the maximum number of rounds (trees to build).</li>
<li><code>nfold</code>: the number of folds for the cross-validation. 5 is a good number.</li>
<li><code>objective</code>: “reg:linear” for continuous outcomes.</li>
<li><code>eta</code>: the learning rate.</li>
<li><code>max_depth</code>: depth of trees.</li>
<li><code>early_stopping_rounds</code>: after this many rounds without improvement, stop.</li>
<li><code>verbose</code>: 0 to stay silent.</li>
</ul>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>The data frames <code>bikesJuly</code> and <code>bikesJuly.treat</code> are in the workspace.</p></li>
<li><p>Load the package <code>xgboost</code>.</p></li>
<li><p>Fill in the blanks to run <code>xgb.cv()</code> on the treated training data; assign the output to the variable <code>cv</code>.<code>as.matrix()</code> to convert the vtreated data frame to a matrix. rounds, and 5-fold cross validation.<code>early_stopping_rounds</code> to 10.<code>eta</code> to 0.3, <code>max_depth</code> to 6.</p>
<ul>
<li>Use <code>as.matrix()</code> to convert the vtreated data frame to a matrix.</li>
<li>Use 100 rounds, and 5-fold cross validation.</li>
<li>Set <code>early_stopping_rounds</code> to 10.</li>
<li>Set <code>eta</code> to 0.3, <code>max_depth</code> to 6.</li>
</ul></li>
<li><p>Get the data frame <code>evaluation_log</code> from <code>cv</code> and assign it to the variable <code>elog</code>. Each row of the <code>evaluation_log</code> corresponds to an additional tree, so the row number tells you the number of trees in the model.</p></li>
<li><p>Fill in the blanks to get the number of trees with the minimum value of the columns <code>train_rmse_mean</code> and <code>test_rmse_mean</code>.<code>which.min()</code> returns the index of the minimum value in a vector.many trees do you need?</p>
<ul>
<li><code>which.min()</code> returns the index of the minimum value in a vector.</li>
<li>How many trees do you need?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1"></a><span class="co"># The July data is in the workspace</span></span>
<span id="cb247-2"><a href="#cb247-2"></a><span class="fu">ls</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   [1] "N"                      "alcohol"                "bike_model"            
#&gt;   [4] "bike_model_rf"          "bikesAugust"            "bikesAugust.treat"     
#&gt;   [7] "bikesJuly"              "bikesJuly.treat"        "bloodpressure"         
#&gt;  [10] "bloodpressure_model"    "dframe"                 "dframe.treat"          
#&gt;  [13] "fdata"                  "fdata2"                 "fe_mean"               
#&gt;  [16] "first_two_weeks"        "flower_model"           "flowers"               
#&gt;  [19] "fmla"                   "fmla.abs"               "fmla.gam"              
#&gt;  [22] "fmla.log"               "fmla_add"               "fmla_interaction"      
#&gt;  [25] "fmla_sqr"               "geom_colors"            "gp"                    
#&gt;  [28] "houseprice"             "houseprice_long"        "i"                     
#&gt;  [31] "income_long"            "income_test"            "income_train"          
#&gt;  [34] "k"                      "mean_bikes"             "mmat"                  
#&gt;  [37] "model"                  "model.abs"              "model.gam"             
#&gt;  [40] "model.lin"              "model.log"              "model_add"             
#&gt;  [43] "model_interaction"      "model_lin"              "model_sqr"             
#&gt;  [46] "mpg"                    "mpg_model"              "mpg_test"              
#&gt;  [49] "mpg_train"              "nRows"                  "newrates"              
#&gt;  [52] "newvars"                "outcome"                "palette"               
#&gt;  [55] "palette_tie"            "perf"                   "pred"                  
#&gt;  [58] "pseudoR2"               "r_squared"              "res"                   
#&gt;  [61] "rho"                    "rho2"                   "rmse"                  
#&gt;  [64] "rmse_test"              "rmse_train"             "rsq"                   
#&gt;  [67] "rsq_glance"             "rsq_test"               "rsq_train"             
#&gt;  [70] "rss"                    "scale_color_discrete"   "scale_color_gradientn" 
#&gt;  [73] "scale_color_ordinal"    "scale_colour_discrete"  "scale_colour_gradientn"
#&gt;  [76] "scale_colour_ordinal"   "scale_fill_discrete"    "scale_fill_gradientn"  
#&gt;  [79] "scale_fill_ordinal"     "scoreFrame"             "sd_unemployment"       
#&gt;  [82] "seed"                   "soybean_long"           "soybean_test"          
#&gt;  [85] "soybean_train"          "sparrow"                "sparrow_model"         
#&gt;  [88] "split"                  "splitPlan"              "stat_colors"           
#&gt;  [91] "target"                 "testframe"              "testframe.treat"       
#&gt;  [94] "theme_tie"              "tie_color_pal"          "treatplan"             
#&gt;  [97] "tss"                    "unemployment"           "unemployment_model"    
#&gt; [100] "var_bikes"              "vars"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1"></a><span class="co"># Load the package xgboost</span></span>
<span id="cb249-2"><a href="#cb249-2"></a><span class="fu">library</span>(xgboost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; 
#&gt; Attache Paket: 'xgboost'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Das folgende Objekt ist maskiert 'package:dplyr':
#&gt; 
#&gt;     slice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1"></a><span class="co"># Run xgb.cv</span></span>
<span id="cb252-2"><a href="#cb252-2"></a>cv <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(bikesJuly.treat), </span>
<span id="cb252-3"><a href="#cb252-3"></a>            <span class="at">label =</span> bikesJuly<span class="sc">$</span>cnt,</span>
<span id="cb252-4"><a href="#cb252-4"></a>            <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb252-5"><a href="#cb252-5"></a>            <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb252-6"><a href="#cb252-6"></a>            <span class="at">objective =</span> <span class="st">"reg:linear"</span>,</span>
<span id="cb252-7"><a href="#cb252-7"></a>            <span class="at">eta =</span> <span class="fl">0.3</span>,</span>
<span id="cb252-8"><a href="#cb252-8"></a>            <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb252-9"><a href="#cb252-9"></a>            <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb252-10"><a href="#cb252-10"></a>            <span class="at">verbose =</span> <span class="dv">0</span>   <span class="co"># silent</span></span>
<span id="cb252-11"><a href="#cb252-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [11:06:06] WARNING: amalgamation/../src/objective/regression_obj.cu:203: reg:linear is now deprecated in favor of reg:squarederror.
#&gt; [11:06:06] WARNING: amalgamation/../src/objective/regression_obj.cu:203: reg:linear is now deprecated in favor of reg:squarederror.
#&gt; [11:06:06] WARNING: amalgamation/../src/objective/regression_obj.cu:203: reg:linear is now deprecated in favor of reg:squarederror.
#&gt; [11:06:06] WARNING: amalgamation/../src/objective/regression_obj.cu:203: reg:linear is now deprecated in favor of reg:squarederror.
#&gt; [11:06:06] WARNING: amalgamation/../src/objective/regression_obj.cu:203: reg:linear is now deprecated in favor of reg:squarederror.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1"></a><span class="co"># Get the evaluation log</span></span>
<span id="cb254-2"><a href="#cb254-2"></a>elog <span class="ot">&lt;-</span> cv<span class="sc">$</span>evaluation_log</span>
<span id="cb254-3"><a href="#cb254-3"></a></span>
<span id="cb254-4"><a href="#cb254-4"></a><span class="co"># Determine and print how many trees minimize training and test error</span></span>
<span id="cb254-5"><a href="#cb254-5"></a>elog <span class="sc">%&gt;%</span> </span>
<span id="cb254-6"><a href="#cb254-6"></a>  <span class="fu">summarize</span>(<span class="at">ntrees.train =</span> <span class="fu">which.min</span>(train_rmse_mean),   <span class="co"># find the index of min(train_rmse_mean)</span></span>
<span id="cb254-7"><a href="#cb254-7"></a>            <span class="at">ntrees.test  =</span> <span class="fu">which.min</span>(test_rmse_mean))    <span class="co"># find the index of min(test_rmse_mean)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["ntrees.train"],"name":[1],"type":["int"],"align":["right"]},{"label":["ntrees.test"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"93","2":"83"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Very good! In most cases, <code>ntrees.test</code> is less than <code>ntrees.train</code>. The training error keeps decreasing even after the test error starts to increase. It’s important to use cross-validation to find the right number of trees (as determined by <code>ntrees.test</code>) and avoid an overfit model.</p>
</section>
<section id="fit-an-xgboost-bike-rental-model-and-predict" class="level2" data-number="5.14">
<h2 data-number="5.14" class="anchored" data-anchor-id="fit-an-xgboost-bike-rental-model-and-predict"><span class="header-section-number">5.14</span> Fit an xgboost bike rental model and predict</h2>
<p>In this exercise you will fit a gradient boosting model using <code>xgboost()</code> to predict the number of bikes rented in an hour as a function of the weather and the type and time of day. You will train the model on data from the month of July and predict on data for the month of August.</p>
<p>The datasets for July and August are loaded into your workspace. Remember the <code>vtreat</code>-ed data no longer has the outcome column, so you must get it from the original data (the <code>cnt</code> column).</p>
<p>For convenience, the number of trees to use, <code>ntrees</code> from the previous exercise is in the workspace.</p>
<p>The arguments to <a href="https://www.rdocumentation.org/packages/xgboost/topics/xgb.train"><code>xgboost()</code></a> are similar to those of <code>xgb.cv()</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Fill in the blanks to run <code>xgboost()</code> on the July data. Assign the model to the variable <code>model</code>. <code>as.matrix()</code> to convert the vtreated data frame to a matrix.objective should be “reg:linear”.<code>ntrees</code> rounds.<code>eta</code> to 0.3, <code>depth</code> to 6, and <code>verbose</code> to 0 (silent).</p>
<ul>
<li>Use <code>as.matrix()</code> to convert the vtreated data frame to a matrix.</li>
<li>The objective should be “reg:linear”.</li>
<li>Use <code>ntrees</code> rounds.</li>
<li>Set <code>eta</code> to 0.3, <code>depth</code> to 6, and <code>verbose</code> to 0 (silent).</li>
</ul></li>
<li><p>Now call <code>predict()</code> on <code>bikesAugust.treat</code> to predict the number of bikes rented in August. <code>as.matrix()</code> to convert the <code>vtreat</code>-ed test data into a matrix.the predictions to<code>bikesAugust</code> as the column <code>pred</code>.</p>
<ul>
<li>Use <code>as.matrix()</code> to convert the <code>vtreat</code>-ed test data into a matrix.</li>
<li>Add the predictions to<code>bikesAugust</code> as the column <code>pred</code>.</li>
</ul></li>
<li><p>Fill in the blanks to plot actual bike rental counts versus the predictions (predictions on the x-axis).you see a possible problem with the predictions?</p>
<ul>
<li>Do you see a possible problem with the predictions?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1"></a><span class="co"># The number of trees to use, as determined by xgb.cv</span></span>
<span id="cb255-2"><a href="#cb255-2"></a>ntrees <span class="ot">&lt;-</span> <span class="dv">76</span></span>
<span id="cb255-3"><a href="#cb255-3"></a></span>
<span id="cb255-4"><a href="#cb255-4"></a><span class="co"># Run xgboost</span></span>
<span id="cb255-5"><a href="#cb255-5"></a>bike_model_xgb <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(bikesJuly.treat), <span class="co"># training data as matrix</span></span>
<span id="cb255-6"><a href="#cb255-6"></a>                   <span class="at">label =</span> bikesJuly<span class="sc">$</span>cnt,  <span class="co"># column of outcomes</span></span>
<span id="cb255-7"><a href="#cb255-7"></a>                   <span class="at">nrounds =</span> ntrees,       <span class="co"># number of trees to build</span></span>
<span id="cb255-8"><a href="#cb255-8"></a>                   <span class="at">objective =</span> <span class="st">"reg:linear"</span>, <span class="co"># objective</span></span>
<span id="cb255-9"><a href="#cb255-9"></a>                   <span class="at">eta =</span> <span class="fl">0.3</span>,</span>
<span id="cb255-10"><a href="#cb255-10"></a>                   <span class="at">depth =</span> <span class="dv">6</span>,</span>
<span id="cb255-11"><a href="#cb255-11"></a>                   <span class="at">verbose =</span> <span class="dv">0</span>  <span class="co"># silent</span></span>
<span id="cb255-12"><a href="#cb255-12"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [11:06:06] WARNING: amalgamation/../src/objective/regression_obj.cu:203: reg:linear is now deprecated in favor of reg:squarederror.
#&gt; [11:06:06] WARNING: amalgamation/../src/learner.cc:627: 
#&gt; Parameters: { "depth" } might not be used.
#&gt; 
#&gt;   This could be a false alarm, with some parameters getting used by language bindings but
#&gt;   then being mistakenly passed down to XGBoost core, or some parameter actually being used
#&gt;   but getting flagged wrongly here. Please open an issue if you find any such cases.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1"></a><span class="co"># Make predictions</span></span>
<span id="cb257-2"><a href="#cb257-2"></a>bikesAugust<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bike_model_xgb, <span class="fu">as.matrix</span>(bikesAugust.treat))</span>
<span id="cb257-3"><a href="#cb257-3"></a></span>
<span id="cb257-4"><a href="#cb257-4"></a><span class="co"># Plot predictions vs actual bike rental count</span></span>
<span id="cb257-5"><a href="#cb257-5"></a><span class="fu">ggplot</span>(bikesAugust, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> cnt)) <span class="sc">+</span> </span>
<span id="cb257-6"><a href="#cb257-6"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb257-7"><a href="#cb257-7"></a>  <span class="fu">geom_abline</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-64-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good! Overall, the scatterplot looked pretty good, but did you notice that the model made some negative predictions? In the next exercise, you’ll compare this model’s RMSE to the previous bike models that you’ve built.</p>
</section>
<section id="evaluate-the-xgboost-bike-rental-model" class="level2" data-number="5.15">
<h2 data-number="5.15" class="anchored" data-anchor-id="evaluate-the-xgboost-bike-rental-model"><span class="header-section-number">5.15</span> Evaluate the xgboost bike rental model</h2>
<p>In this exercise you will evaluate the gradient boosting model <code>bike_model_xgb</code> that you fit in the last exercise, using data from the month of August. You’ll compare this model’s RMSE for August to the RMSE of previous models that you’ve built.</p>
<p>The dataset <code>bikesAugust</code> is in the workspace. You have already made predictions using the <code>xgboost</code> model; they are in the column <code>pred</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Fill in the blanks to calculate the RMSE of the predictions.</p>
<ul>
<li>How does it compare to the RMSE from the poisson model (approx. 112.6) and the random forest model (approx. 96.7)?</li>
</ul></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1"></a><span class="co"># bikesAugust is in the workspace</span></span>
<span id="cb258-2"><a href="#cb258-2"></a><span class="fu">str</span>(bikesAugust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 'data.frame':    744 obs. of  13 variables:
#&gt;  $ hr        : Factor w/ 24 levels "0","1","2","3",..: 1 2 3 4 5 6 7 8 9 10 ...
#&gt;  $ holiday   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
#&gt;  $ workingday: logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
#&gt;  $ weathersit: chr  "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" "Clear to partly cloudy" ...
#&gt;  $ temp      : num  0.68 0.66 0.64 0.64 0.64 0.64 0.64 0.64 0.66 0.68 ...
#&gt;  $ atemp     : num  0.636 0.606 0.576 0.576 0.591 ...
#&gt;  $ hum       : num  0.79 0.83 0.83 0.83 0.78 0.78 0.78 0.83 0.78 0.74 ...
#&gt;  $ windspeed : num  0.1642 0.0896 0.1045 0.1045 0.1343 ...
#&gt;  $ cnt       : int  47 33 13 7 4 49 185 487 681 350 ...
#&gt;  $ instant   : int  13748 13749 13750 13751 13752 13753 13754 13755 13756 13757 ...
#&gt;  $ mnth      : int  8 8 8 8 8 8 8 8 8 8 ...
#&gt;  $ yr        : int  1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ pred      : num  47.67 35.351 0.626 -6.65 3.922 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1"></a><span class="co"># Calculate RMSE</span></span>
<span id="cb260-2"><a href="#cb260-2"></a>bikesAugust <span class="sc">%&gt;%</span></span>
<span id="cb260-3"><a href="#cb260-3"></a>  <span class="fu">mutate</span>(<span class="at">residuals =</span> cnt <span class="sc">-</span> pred) <span class="sc">%&gt;%</span></span>
<span id="cb260-4"><a href="#cb260-4"></a>  <span class="fu">summarize</span>(<span class="at">rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residuals<span class="sc">^</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rmse"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"76.57615"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Even though this gradient boosting made some negative predictions, overall it makes smaller errors than the previous two models. Perhaps rounding negative predictions up to zero is a reasonable tradeoff.</p>
</section>
<section id="visualize-the-xgboost-bike-rental-model" class="level2" data-number="5.16">
<h2 data-number="5.16" class="anchored" data-anchor-id="visualize-the-xgboost-bike-rental-model"><span class="header-section-number">5.16</span> Visualize the xgboost bike rental model</h2>
<p>You’ve now seen three different ways to model the bike rental data. For this example, you’ve seen that the gradient boosting model had the smallest RMSE. To finish up the course, let’s compare the gradient boosting model’s predictions to the other two models as a function of time.</p>
<p>On completing this exercise, you will have completed the course. Congratulations! Now you have the tools to apply a variety of approaches to your regression tasks.</p>
<p><strong>Steps</strong></p>
<!-- 1. Print `quasipoisson_plot` to review the quasipoisson model's behavior. -->
<!-- 2. Print `randomforest_plot` to review the random forest model's behavior. -->
<ol start="3" type="1">
<li><p>Fill in the blanks to plot the gradient boosting predictions and actual counts by hour for the first 14 days of August.<code>gather()</code> the <code>cnt</code> and <code>pred</code> columns into a column called <code>value</code>, with a key called <code>valuetype</code>.<code>value</code> as a function of <code>instant</code> (day).</p>
<ul>
<li><code>gather()</code> the <code>cnt</code> and <code>pred</code> columns into a column called <code>value</code>, with a key called <code>valuetype</code>.</li>
<li>Plot <code>value</code> as a function of <code>instant</code> (day).</li>
</ul></li>
</ol>
<p>How does the gradient boosting model compare to the previous models?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1"></a><span class="co"># Print quasipoisson_plot</span></span>
<span id="cb261-2"><a href="#cb261-2"></a><span class="co"># quasipoisson_plot</span></span>
<span id="cb261-3"><a href="#cb261-3"></a></span>
<span id="cb261-4"><a href="#cb261-4"></a><span class="co"># Print randomforest_plot</span></span>
<span id="cb261-5"><a href="#cb261-5"></a><span class="co"># randomforest_plot</span></span>
<span id="cb261-6"><a href="#cb261-6"></a></span>
<span id="cb261-7"><a href="#cb261-7"></a><span class="co"># Plot predictions and actual bike rentals as a function of time (days)</span></span>
<span id="cb261-8"><a href="#cb261-8"></a>bikesAugust <span class="sc">%&gt;%</span> </span>
<span id="cb261-9"><a href="#cb261-9"></a>  <span class="fu">mutate</span>(<span class="at">instant =</span> (instant <span class="sc">-</span> <span class="fu">min</span>(instant))<span class="sc">/</span><span class="dv">24</span>) <span class="sc">%&gt;%</span>  <span class="co"># set start to 0, convert unit to days</span></span>
<span id="cb261-10"><a href="#cb261-10"></a>  <span class="fu">gather</span>(<span class="at">key =</span> valuetype, <span class="at">value =</span> value, cnt, pred) <span class="sc">%&gt;%</span></span>
<span id="cb261-11"><a href="#cb261-11"></a>  <span class="fu">filter</span>(instant <span class="sc">&lt;</span> <span class="dv">14</span>) <span class="sc">%&gt;%</span> <span class="co"># first two weeks</span></span>
<span id="cb261-12"><a href="#cb261-12"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> instant, <span class="at">y =</span> value, <span class="at">color =</span> valuetype, <span class="at">linetype =</span> valuetype)) <span class="sc">+</span> </span>
<span id="cb261-13"><a href="#cb261-13"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb261-14"><a href="#cb261-14"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb261-15"><a href="#cb261-15"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Day"</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>, <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb261-16"><a href="#cb261-16"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span> </span>
<span id="cb261-17"><a href="#cb261-17"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted August bike rentals, Gradient Boosting model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02_supervised_learning_regression_files/figure-html/unnamed-chunk-66-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="02_supervised_learning_regression_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Great job! The gradient boosting pattern captures rental variations due to time of day and other factors better than the previous models. Congratulations on completing the course!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../../../content/R/topics/07_machine_learning/01_supervised_learning_classification/01_supervised_learning_classification.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">7.1: Supervised Learning: Classification</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../../../content/R/topics/07_machine_learning/03_unsupervised_learning/03_unsupervised_learning.html" class="pagination-link">
        <span class="nav-page-text">7.3: Unsupervised Learning</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2022 by <a href="https://www.startupengineer.io/authors/schwarz/">Joschka Schwarz</a> <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/jwarz/jwarz.github.io">View the source at GitHub</a></div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","closeEffect":"zoom","loop":true,"descPosition":"bottom","selector":".lightbox"});</script>



<script src="../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>