<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joschka Schwarz">

<title>Joschka Schwarz - Machine Learning with Tree-Based Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../../content/R/topics/07_machine_learning/09_support_vector_machines/09_support_vector_machines.html" rel="next">
<link href="../../../../../content/R/topics/07_machine_learning/07_modeling_with_tidymodels/07_modeling_with_tidymodels.html" rel="prev">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

<link href="../../../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Joschka Schwarz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-science" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Science</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-science">    
        <li>
    <a class="dropdown-item" href="../../../../../content/R/index.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/python/index.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../content/sql/index.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../../slides/index.html">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../resumes/index.html">
 <span class="menu-text">Resumes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jwarz/"><i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/j-schwarz"><i class="bi bi-linkedin" role="img" aria-label="Quarto LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Machine Learning with Tree-Based Models in R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Topics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <b><i>1 Programming Basics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/01_programming_beginner/01_programming_beginner.html" class="sidebar-item-text sidebar-link">1.1: Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/02_programming_intermediate/02_programming_intermediate.html" class="sidebar-item-text sidebar-link">1.2: Intermediate R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/01_basics/03_programming_tidyverse/03_programming_tidyverse.html" class="sidebar-item-text sidebar-link">1.3: Introduction to the tidyverse</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>2 Importing Data</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/01_importing_data_beginner/01_importing_data_beginner.html" class="sidebar-item-text sidebar-link">2.1: Introduction to Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/02_importing_data_intermediate/02_importing_data_intermediate.html" class="sidebar-item-text sidebar-link">2.2: Intermediate Importing Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/02_importing_data/03_working_with_web_data/03_working_with_web_data.html" class="sidebar-item-text sidebar-link">2.3: Working with web data</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>3 Data Wrangling</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/01_data_manipulation_with_dplyr/01_data_manipulation_with_dplyr.html" class="sidebar-item-text sidebar-link">3.1: Data Manipulation with dplyr</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/02_joining_data_with_dplyr/02_joining_data_with_dplyr.html" class="sidebar-item-text sidebar-link">3.2: Joining data with dplyr</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/exploratory_data_analysis_in_r/exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">3.3: Exploratory Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/case_study_exploratory_data_analysis_in_r/case_study_exploratory_data_analysis_in_r.html" class="sidebar-item-text sidebar-link">3.4: Case Study: EDA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/cleaning_data_in_r/cleaning_data_in_r.html" class="sidebar-item-text sidebar-link">3.5: Cleaning Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/data_manipulation_with_datatable/data_manipulation_with_datatable.html" class="sidebar-item-text sidebar-link">3.6: Data Manipulation with data.table</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/03_data_wrangling/joining_data_with_datatable/joining_data_with_datatable.html" class="sidebar-item-text sidebar-link">3.7: Joining Data with data.table</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>4 Data Visualization</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/introduction_to_data_visualization_with_ggplot2/ggplot2_intro.html" class="sidebar-item-text sidebar-link">4.1: Introduction to Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/04_data_visualization/data_visualization_with_ggplot2_intermediate/ggplot2_intermediate.html" class="sidebar-item-text sidebar-link">4.2: Intermediate Data Visualization with ggplot2</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>5 Statistics</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/01_statistics_beginner/01_statistics_beginner.html" class="sidebar-item-text sidebar-link">5.1: Introduction to Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/02_foundations_of_probability_in_r/02_foundations_of_probability_in_r.html" class="sidebar-item-text sidebar-link">5.2: Foundations of Probability</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/03_regression_beginner/03_regression_beginner.html" class="sidebar-item-text sidebar-link">5.3: Introduction to Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/04_regression_intermediate/04_regression_intermediate.html" class="sidebar-item-text sidebar-link">5.4: Intermediate Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/06_modeling_with_data_in_the_tidyverse/06_modeling_with_data_in_the_tidyverse.html" class="sidebar-item-text sidebar-link">5.5: Modeling with Data in the Tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/09_experimental_design/09_experimental_design.html" class="sidebar-item-text sidebar-link">5.6: Experimental Design</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/10_ab_testing_in_r/10_ab_testing_in_r.html" class="sidebar-item-text sidebar-link">5.7: A/B Testing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/19_fundamentals_of_bayesian_data_analysis/19_fundamentals_of_bayesian_data_analysis.html" class="sidebar-item-text sidebar-link">5.8: Fundamentals of Bayesian Data Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/05_statistics/21_factor_analysis_in_r/21_factor_analysis_in_r.html" class="sidebar-item-text sidebar-link">5.9: Factor Analysis</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <b><i>7 Machine Learning</i></b>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/01_supervised_learning_classification/01_supervised_learning_classification.html" class="sidebar-item-text sidebar-link">7.1: Supervised Learning: Classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/02_supervised_learning_regression/02_supervised_learning_regression.html" class="sidebar-item-text sidebar-link">7.2: Supervised Learning: Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/03_unsupervised_learning/03_unsupervised_learning.html" class="sidebar-item-text sidebar-link">7.3: Unsupervised Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/04_machine_learning_in_the_tidyverse/04_machine_learning_in_the_tidyverse.html" class="sidebar-item-text sidebar-link">7.4: Machine Learning in the tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/05_cluster_analysis/05_cluster_analysis.html" class="sidebar-item-text sidebar-link">7.5: Cluster Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/06_machine_learning_with_caret/06_machine_learning_with_caret.html" class="sidebar-item-text sidebar-link">7.6: Machine Learning with caret</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/07_modeling_with_tidymodels/07_modeling_with_tidymodels.html" class="sidebar-item-text sidebar-link">7.7: Modeling with tidymodels</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/08_machine_learning_with_tree-based_models/08_machine_learning_with_tree-based_models.html" class="sidebar-item-text sidebar-link active">7.8: Machine Learning with tree-based Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/09_support_vector_machines/09_support_vector_machines.html" class="sidebar-item-text sidebar-link">7.9: Support Vector Machines</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/10_topic_modeling/10_topic_modeling.html" class="sidebar-item-text sidebar-link">7.10: Topic Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/11_hyperparameter_tuning/11_hyperparameter_tuning.html" class="sidebar-item-text sidebar-link">7.11: Hyperparameter Tuning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/12_bayesian_regression_modeling_with_rstanarm/12_bayesian_regression_modeling_with_rstanarm.html" class="sidebar-item-text sidebar-link">7.12: Bayesian Regression Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/topics/07_machine_learning/13_spark_with_sparklyr_in_R/13_spark_with_sparklyr_in_R.html" class="sidebar-item-text sidebar-link">7.13: Introduction to Spark</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">R Manuals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/test.html" class="sidebar-item-text sidebar-link">1: An Introduction to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/02-content.html" class="sidebar-item-text sidebar-link">2: R Data Import/Export</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/03-content.html" class="sidebar-item-text sidebar-link">3: R Installation and Administration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/04-content.html" class="sidebar-item-text sidebar-link">4: Writing R Extensions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/05-content.html" class="sidebar-item-text sidebar-link">5: R Language Definition</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/R/r-manuals/06-content.html" class="sidebar-item-text sidebar-link">6: R Internals</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#classification-trees" id="toc-classification-trees" class="nav-link active" data-scroll-target="#classification-trees"><span class="toc-section-number">1</span>  Classification Trees</a>
  <ul class="collapse">
  <li><a href="#welcome-to-the-course" id="toc-welcome-to-the-course" class="nav-link" data-scroll-target="#welcome-to-the-course"><span class="toc-section-number">1.1</span>  Welcome to the course!</a></li>
  <li><a href="#why-tree-based-methods" id="toc-why-tree-based-methods" class="nav-link" data-scroll-target="#why-tree-based-methods"><span class="toc-section-number">1.2</span>  Why tree-based methods?</a></li>
  <li><a href="#specify-that-tree" id="toc-specify-that-tree" class="nav-link" data-scroll-target="#specify-that-tree"><span class="toc-section-number">1.3</span>  Specify that tree</a></li>
  <li><a href="#train-that-model" id="toc-train-that-model" class="nav-link" data-scroll-target="#train-that-model"><span class="toc-section-number">1.4</span>  Train that model</a></li>
  <li><a href="#how-to-grow-your-tree" id="toc-how-to-grow-your-tree" class="nav-link" data-scroll-target="#how-to-grow-your-tree"><span class="toc-section-number">1.5</span>  How to grow your tree</a></li>
  <li><a href="#traintest-split" id="toc-traintest-split" class="nav-link" data-scroll-target="#traintest-split"><span class="toc-section-number">1.6</span>  Train/test split</a></li>
  <li><a href="#avoiding-class-imbalances" id="toc-avoiding-class-imbalances" class="nav-link" data-scroll-target="#avoiding-class-imbalances"><span class="toc-section-number">1.7</span>  Avoiding class imbalances</a></li>
  <li><a href="#from-zero-to-hero" id="toc-from-zero-to-hero" class="nav-link" data-scroll-target="#from-zero-to-hero"><span class="toc-section-number">1.8</span>  From zero to hero</a></li>
  <li><a href="#predict-and-evaluate" id="toc-predict-and-evaluate" class="nav-link" data-scroll-target="#predict-and-evaluate"><span class="toc-section-number">1.9</span>  Predict and evaluate</a></li>
  <li><a href="#make-predictions" id="toc-make-predictions" class="nav-link" data-scroll-target="#make-predictions"><span class="toc-section-number">1.10</span>  Make predictions</a></li>
  <li><a href="#crack-the-matrix" id="toc-crack-the-matrix" class="nav-link" data-scroll-target="#crack-the-matrix"><span class="toc-section-number">1.11</span>  Crack the matrix</a></li>
  <li><a href="#are-you-predicting-correctly" id="toc-are-you-predicting-correctly" class="nav-link" data-scroll-target="#are-you-predicting-correctly"><span class="toc-section-number">1.13</span>  Are you predicting correctly?</a></li>
  </ul></li>
  <li><a href="#regression-trees-and-cross-validation" id="toc-regression-trees-and-cross-validation" class="nav-link" data-scroll-target="#regression-trees-and-cross-validation"><span class="toc-section-number">2</span>  2. Regression Trees and Cross-Validation</a>
  <ul class="collapse">
  <li><a href="#continuous-outcomes" id="toc-continuous-outcomes" class="nav-link" data-scroll-target="#continuous-outcomes"><span class="toc-section-number">2.1</span>  Continuous outcomes</a></li>
  <li><a href="#train-a-regression-tree" id="toc-train-a-regression-tree" class="nav-link" data-scroll-target="#train-a-regression-tree"><span class="toc-section-number">2.2</span>  Train a regression tree</a></li>
  <li><a href="#predict-new-values" id="toc-predict-new-values" class="nav-link" data-scroll-target="#predict-new-values"><span class="toc-section-number">2.3</span>  Predict new values</a></li>
  <li><a href="#inspect-model-output" id="toc-inspect-model-output" class="nav-link" data-scroll-target="#inspect-model-output"><span class="toc-section-number">2.4</span>  Inspect model output</a></li>
  <li><a href="#performance-metrics-for-regression-trees" id="toc-performance-metrics-for-regression-trees" class="nav-link" data-scroll-target="#performance-metrics-for-regression-trees"><span class="toc-section-number">2.6</span>  Performance metrics for regression trees</a></li>
  <li><a href="#in-sample-performance" id="toc-in-sample-performance" class="nav-link" data-scroll-target="#in-sample-performance"><span class="toc-section-number">2.7</span>  In-sample performance</a></li>
  <li><a href="#out-of-sample-performance" id="toc-out-of-sample-performance" class="nav-link" data-scroll-target="#out-of-sample-performance"><span class="toc-section-number">2.8</span>  Out-of-sample performance</a></li>
  <li><a href="#bigger-mistakes-bigger-penalty" id="toc-bigger-mistakes-bigger-penalty" class="nav-link" data-scroll-target="#bigger-mistakes-bigger-penalty"><span class="toc-section-number">2.9</span>  Bigger mistakes, bigger penalty</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="toc-section-number">2.10</span>  Cross-validation</a></li>
  <li><a href="#create-the-folds" id="toc-create-the-folds" class="nav-link" data-scroll-target="#create-the-folds"><span class="toc-section-number">2.11</span>  Create the folds</a></li>
  <li><a href="#fit-the-folds" id="toc-fit-the-folds" class="nav-link" data-scroll-target="#fit-the-folds"><span class="toc-section-number">2.12</span>  Fit the folds</a></li>
  <li><a href="#evaluate-the-folds" id="toc-evaluate-the-folds" class="nav-link" data-scroll-target="#evaluate-the-folds"><span class="toc-section-number">2.13</span>  Evaluate the folds</a></li>
  <li><a href="#bias-variance-tradeoff" id="toc-bias-variance-tradeoff" class="nav-link" data-scroll-target="#bias-variance-tradeoff"><span class="toc-section-number">2.14</span>  Bias-variance tradeoff</a></li>
  <li><a href="#call-things-by-their-names" id="toc-call-things-by-their-names" class="nav-link" data-scroll-target="#call-things-by-their-names"><span class="toc-section-number">2.15</span>  Call things by their names</a></li>
  <li><a href="#adjust-model-complexity" id="toc-adjust-model-complexity" class="nav-link" data-scroll-target="#adjust-model-complexity"><span class="toc-section-number">2.16</span>  Adjust model complexity</a></li>
  <li><a href="#in-sample-and-out-of-sample-performance" id="toc-in-sample-and-out-of-sample-performance" class="nav-link" data-scroll-target="#in-sample-and-out-of-sample-performance"><span class="toc-section-number">2.17</span>  In-sample and out-of-sample performance</a></li>
  </ul></li>
  <li><a href="#hyperparameters-and-ensemble-models" id="toc-hyperparameters-and-ensemble-models" class="nav-link" data-scroll-target="#hyperparameters-and-ensemble-models"><span class="toc-section-number">3</span>  3. Hyperparameters and Ensemble Models</a>
  <ul class="collapse">
  <li><a href="#tuning-hyperparameters" id="toc-tuning-hyperparameters" class="nav-link" data-scroll-target="#tuning-hyperparameters"><span class="toc-section-number">3.1</span>  Tuning hyperparameters</a></li>
  <li><a href="#generate-a-tuning-grid" id="toc-generate-a-tuning-grid" class="nav-link" data-scroll-target="#generate-a-tuning-grid"><span class="toc-section-number">3.2</span>  Generate a tuning grid</a></li>
  <li><a href="#tune-along-the-grid" id="toc-tune-along-the-grid" class="nav-link" data-scroll-target="#tune-along-the-grid"><span class="toc-section-number">3.3</span>  Tune along the grid</a></li>
  <li><a href="#pick-the-winner" id="toc-pick-the-winner" class="nav-link" data-scroll-target="#pick-the-winner"><span class="toc-section-number">3.4</span>  Pick the winner</a></li>
  <li><a href="#more-model-measures" id="toc-more-model-measures" class="nav-link" data-scroll-target="#more-model-measures"><span class="toc-section-number">3.5</span>  More model measures</a></li>
  <li><a href="#calculate-specificity" id="toc-calculate-specificity" class="nav-link" data-scroll-target="#calculate-specificity"><span class="toc-section-number">3.6</span>  Calculate specificity</a></li>
  <li><a href="#draw-the-roc-curve" id="toc-draw-the-roc-curve" class="nav-link" data-scroll-target="#draw-the-roc-curve"><span class="toc-section-number">3.7</span>  Draw the ROC curve</a></li>
  <li><a href="#area-under-the-roc-curve" id="toc-area-under-the-roc-curve" class="nav-link" data-scroll-target="#area-under-the-roc-curve"><span class="toc-section-number">3.8</span>  Area under the ROC curve</a></li>
  <li><a href="#bagged-trees" id="toc-bagged-trees" class="nav-link" data-scroll-target="#bagged-trees"><span class="toc-section-number">3.9</span>  Bagged trees</a></li>
  <li><a href="#create-bagged-trees" id="toc-create-bagged-trees" class="nav-link" data-scroll-target="#create-bagged-trees"><span class="toc-section-number">3.10</span>  Create bagged trees</a></li>
  <li><a href="#in-sample-roc-and-auc" id="toc-in-sample-roc-and-auc" class="nav-link" data-scroll-target="#in-sample-roc-and-auc"><span class="toc-section-number">3.12</span>  In-sample ROC and AUC</a></li>
  <li><a href="#check-for-overfitting" id="toc-check-for-overfitting" class="nav-link" data-scroll-target="#check-for-overfitting"><span class="toc-section-number">3.13</span>  Check for overfitting</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="toc-section-number">3.14</span>  Random forest</a></li>
  <li><a href="#bagged-trees-vs.-random-forest" id="toc-bagged-trees-vs.-random-forest" class="nav-link" data-scroll-target="#bagged-trees-vs.-random-forest"><span class="toc-section-number">3.15</span>  Bagged trees vs.&nbsp;random forest</a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="toc-section-number">3.17</span>  Variable importance</a></li>
  </ul></li>
  <li><a href="#boosted-trees" id="toc-boosted-trees" class="nav-link" data-scroll-target="#boosted-trees"><span class="toc-section-number">4</span>  4. Boosted Trees</a>
  <ul class="collapse">
  <li><a href="#introduction-to-boosting" id="toc-introduction-to-boosting" class="nav-link" data-scroll-target="#introduction-to-boosting"><span class="toc-section-number">4.1</span>  Introduction to boosting</a></li>
  <li><a href="#bagging-vs.-boosting" id="toc-bagging-vs.-boosting" class="nav-link" data-scroll-target="#bagging-vs.-boosting"><span class="toc-section-number">4.2</span>  Bagging vs.&nbsp;boosting</a></li>
  <li><a href="#specify-a-boosted-ensemble" id="toc-specify-a-boosted-ensemble" class="nav-link" data-scroll-target="#specify-a-boosted-ensemble"><span class="toc-section-number">4.4</span>  Specify a boosted ensemble</a></li>
  <li><a href="#gradient-boosting" id="toc-gradient-boosting" class="nav-link" data-scroll-target="#gradient-boosting"><span class="toc-section-number">4.5</span>  Gradient boosting</a></li>
  <li><a href="#train-a-boosted-ensemble" id="toc-train-a-boosted-ensemble" class="nav-link" data-scroll-target="#train-a-boosted-ensemble"><span class="toc-section-number">4.6</span>  Train a boosted ensemble</a></li>
  <li><a href="#evaluate-the-ensemble" id="toc-evaluate-the-ensemble" class="nav-link" data-scroll-target="#evaluate-the-ensemble"><span class="toc-section-number">4.8</span>  Evaluate the ensemble</a></li>
  <li><a href="#compare-to-a-single-classifier" id="toc-compare-to-a-single-classifier" class="nav-link" data-scroll-target="#compare-to-a-single-classifier"><span class="toc-section-number">4.9</span>  Compare to a single classifier</a></li>
  <li><a href="#optimize-the-boosted-ensemble" id="toc-optimize-the-boosted-ensemble" class="nav-link" data-scroll-target="#optimize-the-boosted-ensemble"><span class="toc-section-number">4.10</span>  Optimize the boosted ensemble</a></li>
  <li><a href="#tuning-preparation" id="toc-tuning-preparation" class="nav-link" data-scroll-target="#tuning-preparation"><span class="toc-section-number">4.11</span>  Tuning preparation</a></li>
  <li><a href="#the-actual-tuning" id="toc-the-actual-tuning" class="nav-link" data-scroll-target="#the-actual-tuning"><span class="toc-section-number">4.12</span>  The actual tuning</a></li>
  <li><a href="#finalize-the-model" id="toc-finalize-the-model" class="nav-link" data-scroll-target="#finalize-the-model"><span class="toc-section-number">4.13</span>  Finalize the model</a></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison"><span class="toc-section-number">4.14</span>  Model comparison</a></li>
  <li><a href="#compare-auc" id="toc-compare-auc" class="nav-link" data-scroll-target="#compare-auc"><span class="toc-section-number">4.15</span>  Compare AUC</a></li>
  <li><a href="#plot-roc-curves" id="toc-plot-roc-curves" class="nav-link" data-scroll-target="#plot-roc-curves"><span class="toc-section-number">4.16</span>  Plot ROC curves</a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up"><span class="toc-section-number">4.17</span>  Wrap-up</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jwarz/jwarz.github.io/edit/main/content/R/topics/07_machine_learning/08_machine_learning_with_tree-based_models/08_machine_learning_with_tree-based_models.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jwarz/jwarz.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Machine Learning with Tree-Based Models in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joschka Schwarz </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>Tree-based machine learning models can reveal complex non-linear relationships in data and often dominate machine learning competitions. In this course, you’ll use the tidymodels package to explore and build different tree-based models—from simple decision trees to complex random forests. You’ll also learn to use boosted trees, a powerful machine learning technique that uses ensemble learning to build high-performing predictive models. Along the way, you’ll work with health and credit risk data to predict the incidence of diabetes and customer churn.</p>
<section id="classification-trees" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Classification Trees</h1>
<p>Ready to build a real machine learning pipeline? Complete step-by-step exercises to learn how to create decision trees, split your data, and predict which patients are most likely to suffer from diabetes. Last but not least, you’ll build performance measures to assess your models and judge your predictions.</p>
<section id="welcome-to-the-course" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="welcome-to-the-course"><span class="header-section-number">1.1</span> Welcome to the course!</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Welcome to the course!</strong></p>
<p>Hi and welcome to the course! My name is Sandro and I am a Data Scientist. I will introduce you to some exciting classification and regression methods using decision trees and ensemble models.What exactly are we going to cover?</p>
<p><strong>2. Course overview</strong></p>
<p>In Chapter 1, you’ll be introduced to a set of supervised learning models known as classification trees.In Chapter 2, you’ll build decision trees for regression problems and understand the concepts of cross-validation and bias-variance trade-off.Chapter 3 introduces you to hyperparameter tuning, bagging, and random forests. Finally, Chapter 4 deals with boosting as a powerful ensemble method.Along the way, you’ll get to know many useful tools and methods for machine learning.</p>
<p><strong>3. Decision trees are flowcharts</strong></p>
<p>Consider this flowchart, which shows a way of classifying living animals. A set of questions like “Can this thing live in water?” or “Does it have feathers?” allow you to narrow down the options until you arrive at a decision.This type of flow chart describes how a computer or an algorithm could go about solving a classification problem. This schema is also found in human decision-making, like holiday planning or deciding where to meet up with your friends.</p>
<p><strong>4. Advantages of tree-based models</strong></p>
<p>One of the biggest advantages of decision trees is that they are easy to explain. Anyone able to read a flow-chart is already able to understand a decision tree.In contrast to linear models, trees are able to capture non-linear relationships. Furthermore, trees do not need normalization or standardization of numeric features. Trees can also handle categorical features without the need to create dummy binary indicator variables.Missing values are not a problem, and trees are robust to outliers.Last but not least, it’s relatively fast to train a decision tree, so tree methods can handle big datasets.</p>
<p><strong>5. Disadvantages of tree-based models</strong></p>
<p>Unfortunately, large and deep trees are hard to interpret. One of the major problems with trees is that they have high variance. If not tuned properly, it’s easy to create overly complex trees that do not generalize well to new data, known as overfitting.</p>
<p><strong>6. The tidymodels package</strong></p>
<p>There are many great machine learning R packages out there. Throughout the course, we will use the tidymodels package, which orchestrates many of these for you. Among these is parsnip for modeling, rsample for sampling, and yardstick for measuring performance.</p>
<p><strong>7. The tidymodels package</strong></p>
<p>To make use of the package, simply type “library parenthesis, tidymodels, then end parenthesis” in your console.It takes care of loading all the other useful packages.</p>
<p><strong>8. Create a decision tree</strong></p>
<p>To create a tree model, you first need to create the specification for your later model.This serves as a functional design or skeleton.First, pick a model class, and since we are in a tree-based course, we use decision_tree().</p>
<p><strong>9. Create a decision tree</strong></p>
<p>The set_engine() function adds an engine to power or implement the model. We use rpart, which is an R package for “recursive partitioning”.</p>
<p><strong>10. Create a decision tree</strong></p>
<p>Then, set the mode, like classification or regression.This sets the class of problems the model will solve.</p>
<p><strong>11. From a model specification to a real model</strong></p>
<p>A model specification, which you can save, for example, as tree_spec, is only a skeleton. You need to bring it to life using data. We call this process model training or model fitting.Simply call the fit() function on your specification supplying the arguments ‘formula’ and ‘data’. You can read the formula as “outcome is modeled as a function of age and bmi”.We used a diabetes dataset in this example. The output informs you about the training time and the number of samples used for training.</p>
<p><strong>12. Let’s build a model!</strong></p>
<p>Time for you to practice!</p>
</section>
<section id="why-tree-based-methods" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="why-tree-based-methods"><span class="header-section-number">1.2</span> Why tree-based methods?</h2>
<p>Tree-based models are one class of methods used in machine learning. They are superior in many ways, but also have their drawbacks.</p>
<p>Which of these statements are true and which are false? For each statement, decide whether it is correct or incorrect and drop it into the corresponding bucket.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Correct statements</th>
<th>Incorrect statements</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Trees are robust to outliers in the data.</td>
<td>Trees take longer than other models when trained on large datasets.</td>
</tr>
<tr class="even">
<td>Trees can model non-linearity in data, but sometimes learn the noise in the data.</td>
<td>Trees require data preparation, like normalization of numeric variables.</td>
</tr>
</tbody>
</table>
</section>
<section id="specify-that-tree" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="specify-that-tree"><span class="header-section-number">1.3</span> Specify that tree</h2>
<!-- Guidelines for contexts: https://instructor-support.datacamp.com/en/articles/2375525-course-sequential-exercises. -->
<p>In order to build models and use them to solve real-world problems, you first need to lay the foundations of your model by creating a <em>model specification</em>. This is the very first step in every machine learning pipeline that you will ever build.</p>
<p>You are going to load the relevant packages and design the specification for your classification tree in just a few steps.</p>
<p>A magical moment, enjoy!</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Load the <code>tidymodels</code> package.</li>
<li>Pick a model class for decision trees, save it as <code>tree_spec</code>, and print it.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load the package</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; ── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; ✔ broom        1.0.1      ✔ rsample      1.1.0 
#&gt; ✔ dials        1.1.0      ✔ tibble       3.1.8 
#&gt; ✔ dplyr        1.0.10     ✔ tidyr        1.2.1 
#&gt; ✔ infer        1.0.3      ✔ tune         1.0.1 
#&gt; ✔ modeldata    1.0.1      ✔ workflows    1.1.2 
#&gt; ✔ parsnip      1.0.3      ✔ workflowsets 1.0.0 
#&gt; ✔ purrr        0.3.5      ✔ yardstick    1.1.0 
#&gt; ✔ recipes      1.0.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
#&gt; ✖ purrr::discard()                     masks scales::discard()
#&gt; ✖ dplyr::filter()                      masks stats::filter()
#&gt; ✖ dplyr::lag()                         masks stats::lag()
#&gt; ✖ .GlobalEnv::scale_color_discrete()   masks ggplot2::scale_color_discrete()
#&gt; ✖ .GlobalEnv::scale_color_gradientn()  masks ggplot2::scale_color_gradientn()
#&gt; ✖ .GlobalEnv::scale_color_ordinal()    masks ggplot2::scale_color_ordinal()
#&gt; ✖ .GlobalEnv::scale_colour_discrete()  masks ggplot2::scale_colour_discrete()
#&gt; ✖ .GlobalEnv::scale_colour_gradientn() masks ggplot2::scale_colour_gradientn()
#&gt; ✖ .GlobalEnv::scale_colour_ordinal()   masks ggplot2::scale_colour_ordinal()
#&gt; ✖ .GlobalEnv::scale_fill_discrete()    masks ggplot2::scale_fill_discrete()
#&gt; ✖ .GlobalEnv::scale_fill_gradientn()   masks ggplot2::scale_fill_gradientn()
#&gt; ✖ .GlobalEnv::scale_fill_ordinal()     masks ggplot2::scale_fill_ordinal()
#&gt; ✖ yardstick::spec()                    masks readr::spec()
#&gt; ✖ recipes::step()                      masks stats::step()
#&gt; • Learn how to get started at https://www.tidymodels.org/start/</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Pick a model class</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() </span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># Print the result</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>tree_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Decision Tree Model Specification (unknown mode)
#&gt; 
#&gt; Computational engine: rpart</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Set the engine to <code>"rpart"</code> and print the result.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Pick a model class</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="co"># Set the engine</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co"># Print the result</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>tree_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Decision Tree Model Specification (unknown mode)
#&gt; 
#&gt; Computational engine: rpart</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Set the mode to <code>"classification"</code> and print the result.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Pick a model class</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="co"># Set the engine</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="co"># Set the mode</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># Print the result</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>tree_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Decision Tree Model Specification (classification)
#&gt; 
#&gt; Computational engine: rpart</code></pre>
</div>
</div>
<p>Specific specification! You created a decision tree model class, used an <code>rpart</code> engine, and set the mode to “classification”. Remember, you will need to perform similar steps every time you design a new model. Come back anytime if you need a reminder!</p>
</section>
<section id="train-that-model" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="train-that-model"><span class="header-section-number">1.4</span> Train that model</h2>
<!-- Guidelines for contexts: https://instructor-support.datacamp.com/en/articles/2375526-course-coding-exercises. -->
<p>A model specification is a good start, just like the canvas for a painter. But just as a painter needs color, the specification needs data. Only the final model is able to make predictions:</p>
<p><em>Model specification + data = model</em></p>
<p>In this exercise, you will train a decision tree that models the risk of diabetes using health variables as predictors. The response variable, <code>outcome</code>, indicates whether the patient has diabetes or not, which means this is a binary classification problem (there are just two classes). The dataset also contains health variables of patients like <code>blood_pressure</code>, <code>age</code>, and <code>bmi</code>.</p>
<p><strong>For the rest of the course, the</strong> <code>tidymodels</code> <strong>package will always be pre-loaded.</strong> In this exercise, the <code>diabetes</code> dataset is also available in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create <code>tree_spec</code>, a specification for a decision tree with an <code>rpart</code> engine.</li>
<li>Train a model <code>tree_model_bmi</code>, where the <code>outcome</code> depends only on the <code>bmi</code> predictor by fitting the <code>diabetes</code> dataset to the specification.</li>
<li>Print the model to the console.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Load library</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">library</span>(readr)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># Load data</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co"># col_types does not work properly if tidymodels was loaded before</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co"># diabetes &lt;- read_csv("data/diabetes_tibble.csv", col_types = cols(outcome = col_factor()))</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>diabetes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/diabetes_tibble.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8"></a>              <span class="fu">mutate</span>(<span class="at">outcome =</span> outcome <span class="sc">|&gt;</span> <span class="fu">as.factor</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Rows: 768 Columns: 9
#&gt; ── Column specification ────────────────────────────────────────────────────────
#&gt; Delimiter: ","
#&gt; chr (1): outcome
#&gt; dbl (8): pregnancies, glucose, blood_pressure, skin_thickness, insulin, bmi,...
#&gt; 
#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Create the specification</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co"># Train the model</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>tree_model_bmi <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span> </span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">fit</span>(<span class="at">formula =</span> outcome <span class="sc">~</span> bmi, </span>
<span id="cb13-9"><a href="#cb13-9"></a>      <span class="at">data =</span> diabetes)</span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co"># Print the model</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>tree_model_bmi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 768 
#&gt; 
#&gt; node), split, n, loss, yval, (yprob)
#&gt;       * denotes terminal node
#&gt; 
#&gt; 1) root 768 268 no (0.6510417 0.3489583)  
#&gt;   2) bmi&lt; 29.85 291  47 no (0.8384880 0.1615120) *
#&gt;   3) bmi&gt;=29.85 477 221 no (0.5366876 0.4633124)  
#&gt;     6) bmi&lt; 40.85 392 168 no (0.5714286 0.4285714) *
#&gt;     7) bmi&gt;=40.85 85  32 yes (0.3764706 0.6235294) *</code></pre>
</div>
</div>
<p>Excellent work! You have defined your model with <code>decision_tree()</code> and trained it to predict <code>outcome</code> using <code>bmi</code> like a professional coach! Printing the model displays useful information, such as the training time, the model formula used during training, and the node details. Remember, <em>to fit a model to data</em> is just a different phrase for <em>training it</em>. Don’t worry about the precise output too much, you’ll cover that later!</p>
</section>
<section id="how-to-grow-your-tree" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="how-to-grow-your-tree"><span class="header-section-number">1.5</span> How to grow your tree</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. How to grow your tree</strong></p>
<p>Welcome back!</p>
<p><strong>2. Diabetes dataset</strong></p>
<p>You now know how to create the skeleton or specification of a decision tree and how to train it on real data to create a model.In this section, we’ll use the diabetes dataset from the last exercise.It has an outcome column that indicates if a patient has diabetes or not and some numeric predictors like blood pressure, BMI, and age.</p>
<p><strong>3. Using the whole dataset</strong></p>
<p>So far, you used a dataset to fit a decision tree model.Now, how can you test the performance of your model on new data?You would need to collect more data.</p>
<p><strong>4. Data split</strong></p>
<p>A common solution for this problem is to split the data into two groups.One part of the data, the training set, is used to estimate parameters, and compare or tune models.The test set is held in reserve until the end of the project.It is used as an unbiased source for measuring final model performance.It is critical that you don’t use the test set before this point, otherwise the testing data will have become part of the model development process.</p>
<p><strong>5. Splitting methods</strong></p>
<p>There are different ways to create these data partitions. You could take data from the end, from the center, or a random sample. Just select a part of the data set, say 80% of all samples, for the training set and use the rest for the test set. We will introduce more exciting and more robust splitting methods in chapter 2.</p>
<p><strong>6. The initial_split() function</strong></p>
<p>The initial_split() function from the rsample package comes in handy because it does all the work for you.The function takes the original data, diabetes, and a proportion argument, say 0-point-9, and randomly assigns samples (rows of the tibble) to the training or test set. If no proportion is given, it assigns 75% of the samples to the training and 25% to the test set.The result is a split object which contains analysis and assessment sets, which are just different names for training and test sets. Here we see that 76 samples are in the test or assessment set, which is about 10% of 768 samples in total.</p>
<p><strong>7. Functions training() and testing()</strong></p>
<p>After the initial split, the training() and testing() functions return the actual datasets.Calling the training() function on our split object diabetes_split gives us our training set.Calling the testing() function on our split object diabetes_split gives us our test set.You can compare the number of rows using the nrow() function to validate that the training set has indeed 90% as many rows as the total dataset.</p>
<p><strong>8. Avoid class imbalances</strong></p>
<p>Ideally, your training and test sets have the same distribution in the outcome variable. Otherwise, if your data split is very unlucky, you can end up with a training set with no diabetes patients at all, which would result in a useless model.The following code exhibits this problem. First, count the different outcomes of ‘yes’ and ‘no’ in the training set using the table() function.Then, count the proportion of ‘yes’ outcomes among all outcomes in the training set - it’s about 15%.Do the same for the test set and find that this contains approximately 63% diabetes patients. This is a real problem if you have a rare disease dataset and end up with no positive outcomes in your training set.</p>
<p><strong>9. Solution - enforce similar distributions</strong></p>
<p>A remedy for this is the strata argument, which is set to the target variable “outcome” here.This ensures a random split with a similar outcome distribution in both the training and test sets.</p>
<p><strong>10. Let’s split!</strong></p>
<p>Enough said, now it’s your turn to split the data!</p>
</section>
<section id="traintest-split" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="traintest-split"><span class="header-section-number">1.6</span> Train/test split</h2>
<p>In order to test your models, you need to build and test the model on two different parts of the data - otherwise, it’s like cheating on an exam (as you already know the answers).</p>
<p>The data split is an integral part of the modeling process. You will dive into this by splitting the diabetes data and confirming the split proportions.</p>
<p>The <code>diabetes</code> data from the last exercise is pre-loaded in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Split the <code>diabetes</code> tibble into <code>diabetes_split</code>, a split of 80% training and 20% test data.</li>
<li>Print the resulting object.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Create the split</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>diabetes_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(diabetes, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># Print the data split</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>diabetes_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;Training/Testing/Total&gt;
#&gt; &lt;614/154/768&gt;</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Extract the training and test sets and save them as <code>diabetes_train</code> and <code>diabetes_test</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Extract the training and test set</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>diabetes_train <span class="ot">&lt;-</span> <span class="fu">training</span>(diabetes_split)</span>
<span id="cb17-3"><a href="#cb17-3"></a>diabetes_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(diabetes_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Verify the correct row proportion in both datasets compared to the <code>diabetes</code> tibble.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Create the split</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>diabetes_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(diabetes, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># Extract the training and test set</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>diabetes_train <span class="ot">&lt;-</span> <span class="fu">training</span>(diabetes_split)</span>
<span id="cb18-6"><a href="#cb18-6"></a>diabetes_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(diabetes_split)</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co"># Verify the proportions of both sets</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="fu">round</span>(<span class="fu">nrow</span>(diabetes_train) <span class="sc">/</span> <span class="fu">nrow</span>(diabetes), <span class="dv">2</span>) <span class="sc">==</span> <span class="fl">0.80</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">round</span>(<span class="fu">nrow</span>(diabetes_test) <span class="sc">/</span> <span class="fu">nrow</span>(diabetes), <span class="dv">2</span>) <span class="sc">==</span> <span class="fl">0.20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
</div>
<p>You split the data like a samurai! Using <code>training()</code> and <code>testing()</code> after the split ensures that you save your working datasets. Sharpen your sword for some more splitting magic…</p>
</section>
<section id="avoiding-class-imbalances" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="avoiding-class-imbalances"><span class="header-section-number">1.7</span> Avoiding class imbalances</h2>
<!-- Guidelines for contexts: https://instructor-support.datacamp.com/en/articles/2375528-course-iterative-exercises -->
<p>Some data contains very imbalanced outcomes - like a rare disease dataset. When splitting randomly, you might end up with a very unfortunate split. Imagine all the rare observations are in the test and none in the training set. That would ruin your whole training process!</p>
<p>Fortunately, the <code>initial_split()</code> function provides a remedy. You are going to observe and solve these so-called <em>class imbalances</em> in this exercise.</p>
<p>There’s already a split object <code>diabetes_split</code> available with a 75% training and 25% test split.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Count the proportion of <code>"yes"</code> outcomes in the training and test sets of <code>diabetes_split</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Proportion of 'yes' outcomes in the training data</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>counts_train <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">training</span>(diabetes_split)<span class="sc">$</span>outcome)</span>
<span id="cb22-3"><a href="#cb22-3"></a>prop_yes_train <span class="ot">&lt;-</span> counts_train[<span class="st">"yes"</span>] <span class="sc">/</span> <span class="fu">sum</span>(counts_train)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># Proportion of 'yes' outcomes in the test data</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>counts_test <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">testing</span>(diabetes_split)<span class="sc">$</span>outcome)</span>
<span id="cb22-7"><a href="#cb22-7"></a>prop_yes_test <span class="ot">&lt;-</span> counts_test[<span class="st">"yes"</span>] <span class="sc">/</span> <span class="fu">sum</span>(counts_test)</span>
<span id="cb22-8"><a href="#cb22-8"></a></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="fu">paste</span>(<span class="st">"Proportion of positive outcomes in training set:"</span>, <span class="fu">round</span>(prop_yes_train, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Proportion of positive outcomes in training set: 0.35"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">paste</span>(<span class="st">"Proportion of positive outcomes in test set:"</span>, <span class="fu">round</span>(prop_yes_test, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Proportion of positive outcomes in test set: 0.36"</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Redesign <code>diabetes_split</code> using the same training/testing proportion, but the <code>outcome</code> variable being equally distributed in both sets.</li>
<li>Count the proportion of <code>yes</code> outcomes in both datasets.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Create a split with a constant outcome distribution</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>diabetes_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(diabetes, <span class="at">strata =</span> outcome)</span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co"># Proportion of 'yes' outcomes in the training data</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>counts_train <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">training</span>(diabetes_split)<span class="sc">$</span>outcome)</span>
<span id="cb26-6"><a href="#cb26-6"></a>prop_yes_train <span class="ot">&lt;-</span> counts_train[<span class="st">"yes"</span>] <span class="sc">/</span> <span class="fu">sum</span>(counts_train)</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co"># Proportion of 'yes' outcomes in the test data</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>counts_test <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">testing</span>(diabetes_split)<span class="sc">$</span>outcome)</span>
<span id="cb26-10"><a href="#cb26-10"></a>prop_yes_test <span class="ot">&lt;-</span> counts_test[<span class="st">"yes"</span>] <span class="sc">/</span> <span class="fu">sum</span>(counts_test)</span>
<span id="cb26-11"><a href="#cb26-11"></a></span>
<span id="cb26-12"><a href="#cb26-12"></a><span class="fu">paste</span>(<span class="st">"Proportion of positive outcomes in training set:"</span>, <span class="fu">round</span>(prop_yes_train, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Proportion of positive outcomes in training set: 0.35"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">paste</span>(<span class="st">"Proportion of positive outcomes in test set:"</span>, <span class="fu">round</span>(prop_yes_test, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Proportion of positive outcomes in test set: 0.35"</code></pre>
</div>
</div>
<p>Impressive - from 40% vs.&nbsp;20% positive outcomes to 35% in both sets. This was a tough one, but now you know how simple it is to avoid class imbalances! This is even more important in a large dataset with a very imbalanced target variable.</p>
</section>
<section id="from-zero-to-hero" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="from-zero-to-hero"><span class="header-section-number">1.8</span> From zero to hero</h2>
<!-- Guidelines for contexts: https://instructor-support.datacamp.com/en/articles/2375526-course-coding-exercises. -->
<p>You mastered the skills of creating a model specification and splitting the data into training and test sets. You also know how to avoid class imbalances in the split. It’s now time to combine what you learned in the preceding lesson and build your model using only the training set!</p>
<p>You are going to build a proper <em>machine learning pipeline</em>. This is comprised of creating a model specification, splitting your data into training and test sets, and last but not least, fitting the training data to a model. Enjoy!</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create <code>diabetes_split</code>, a split where the training set contains three-quarters of all <code>diabetes</code> rows and where training and test sets have a similar distribution in the <code>outcome</code> variable.</li>
<li>Build a decision tree specification for your model using the <code>rpart</code> engine and save it as <code>tree_spec</code>.</li>
<li>Fit a model <code>model_trained</code> using the training data of <code>diabetes_split</code> with <code>outcome</code> as the target variable and <code>bmi</code> and <code>skin_thickness</code> as the predictors.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co"># Create the balanced data split</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>diabetes_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(diabetes, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata =</span> outcome)</span>
<span id="cb30-5"><a href="#cb30-5"></a></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co"># Build the specification of the model</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb30-10"><a href="#cb30-10"></a></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="co"># Train the model</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>model_trained <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span> </span>
<span id="cb30-13"><a href="#cb30-13"></a>  <span class="fu">fit</span>(<span class="at">formula =</span> outcome <span class="sc">~</span> bmi <span class="sc">+</span> skin_thickness, </span>
<span id="cb30-14"><a href="#cb30-14"></a>      <span class="at">data =</span> <span class="fu">training</span>(diabetes_split))</span>
<span id="cb30-15"><a href="#cb30-15"></a></span>
<span id="cb30-16"><a href="#cb30-16"></a>model_trained</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 576 
#&gt; 
#&gt; node), split, n, loss, yval, (yprob)
#&gt;       * denotes terminal node
#&gt; 
#&gt;   1) root 576 201 no (0.6510417 0.3489583)  
#&gt;     2) bmi&lt; 29.85 213  34 no (0.8403756 0.1596244) *
#&gt;     3) bmi&gt;=29.85 363 167 no (0.5399449 0.4600551)  
#&gt;       6) bmi&lt; 40.85 297 126 no (0.5757576 0.4242424)  
#&gt;        12) bmi&gt;=40.05 10   1 no (0.9000000 0.1000000) *
#&gt;        13) bmi&lt; 40.05 287 125 no (0.5644599 0.4355401)  
#&gt;          26) skin_thickness&gt;=5.5 208  82 no (0.6057692 0.3942308)  
#&gt;            52) skin_thickness&lt; 25.5 48  11 no (0.7708333 0.2291667) *
#&gt;            53) skin_thickness&gt;=25.5 160  71 no (0.5562500 0.4437500)  
#&gt;             106) bmi&gt;=38.8 19   4 no (0.7894737 0.2105263) *
#&gt;             107) bmi&lt; 38.8 141  67 no (0.5248227 0.4751773)  
#&gt;               214) bmi&lt; 30.85 15   3 no (0.8000000 0.2000000) *
#&gt;               215) bmi&gt;=30.85 126  62 yes (0.4920635 0.5079365)  
#&gt;                 430) skin_thickness&gt;=35.5 51  21 no (0.5882353 0.4117647) *
#&gt;                 431) skin_thickness&lt; 35.5 75  32 yes (0.4266667 0.5733333)  
#&gt;                   862) skin_thickness&lt; 29.5 37  17 no (0.5405405 0.4594595) *
#&gt;                   863) skin_thickness&gt;=29.5 38  12 yes (0.3157895 0.6842105) *
#&gt;          27) skin_thickness&lt; 5.5 79  36 yes (0.4556962 0.5443038)  
#&gt;            54) bmi&lt; 37.65 66  32 no (0.5151515 0.4848485)  
#&gt;             108) bmi&gt;=33.05 30  10 no (0.6666667 0.3333333) *
#&gt;             109) bmi&lt; 33.05 36  14 yes (0.3888889 0.6111111) *
#&gt;            55) bmi&gt;=37.65 13   2 yes (0.1538462 0.8461538) *
#&gt;       7) bmi&gt;=40.85 66  25 yes (0.3787879 0.6212121)  
#&gt;        14) skin_thickness&gt;=37.5 24  11 no (0.5416667 0.4583333)  
#&gt;          28) skin_thickness&lt; 41.5 11   2 no (0.8181818 0.1818182) *
#&gt;          29) skin_thickness&gt;=41.5 13   4 yes (0.3076923 0.6923077) *
#&gt;        15) skin_thickness&lt; 37.5 42  12 yes (0.2857143 0.7142857) *</code></pre>
</div>
</div>
<p>That pipeline was perfectly handcrafted! Did you see that, according to the nodes, a BMI value of over 42.25 corresponds to a very high risk of diabetes? Let’s head over to the engine room to check your model’s performance…</p>
</section>
<section id="predict-and-evaluate" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="predict-and-evaluate"><span class="header-section-number">1.9</span> Predict and evaluate</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Predict and evaluate</strong></p>
<p>Welcome back! Now that you know how to create a data split and classification tree model, let’s learn how to make predictions and evaluate how close they are to the truth.</p>
<p><strong>2. Predicting on new data</strong></p>
<p>Like most machine learning packages in R, parsnip has a predict() function.The first argument is the trained model, the second argument is the new or test dataset, and the third argument, type, controls whether the function returns predicted labels or probabilities.</p>
<p><strong>3. Predicting on new data</strong></p>
<p>Call the predict() function with the model and the test data. The default argument for type is “class”, which produces class labels. If you write type = “prob”, the result will contain numeric columns, one for each outcome variable. The numbers are the probability. Note you always get a tibble with rows that correspond to the rows of the new data. This makes working with tidymodels objects very handy.</p>
<p><strong>4. Confusion matrix</strong></p>
<p>The confusion matrix is a really useful tool for evaluating binary classification models.It’s called a confusion matrix because it reveals how confused the model is between the two classes, and highlights instances in which it confuses one class for the other.</p>
<p><strong>5. Confusion matrix</strong></p>
<p>The columns of a confusion matrix correspond to the truth labels,</p>
<p><strong>6. Confusion matrix</strong></p>
<p>and the rows represent the predictions.</p>
<p><strong>7. Confusion matrix</strong></p>
<p>In a binary classification problem, the confusion matrix will be a 2 by 2 table.The main diagonal contains the counts of correctly classified examples, that is “yes”-predictions that are in fact “yes”, and “no” predictions that are in fact “no”.A good model will contain most of the examples in the main diagonal (the green squares) and it will have a small number of examples, ideally zero, in the off-diagonal (the red squares).</p>
<p><strong>8. Confusion matrix</strong></p>
<p>Let’s briefly review the 4 possible outcomes with a binary classification model: True positives or TP are cases where the model correctly predicted yes. True negatives or TN are cases where the model correctly predicted no.False positives or FP are cases where the model predicted positive, but the true labels are negative.False negatives or FN are cases where the model predicted negative, but it’s actually positive.</p>
<p><strong>9. Create the confusion matrix</strong></p>
<p>So, how to create such a confusion matrix? Simply use the mutate() function to add the true outcome of the diabetes test tibble to the predictions. The resulting tibble pred_combined has two columns: dot-pred_class and true_class.The yardstick package, which is a part of the tidymodels framework, provides the conf_mat() function.You need to specify three arguments: data, which is the data containing your predictions and true values, estimate, which is your prediction column, and truth, which are the true values.The matrix is printed as a result.</p>
<p><strong>10. Accuracy</strong></p>
<p>There are quite a few ways of evaluating classification performance. Accuracy measures how often the classifier predicted the class correctly. It is defined as the ratio between the number of correct predictions and the total number of predictions it made. It is quite intuitive and easy to calculate, and in Chapter 3, you’ll get to know more helpful performance metrics!The yardstick package makes it very easy to assess accuracy. Just call the accuracy() function the same way you called the conf_mat() function: Simply supply the pred_combined tibble containing predictions and true values, and specify the estimate and truth arguments as before.The result is a tibble with information like the name of the metric, accuracy, and the result. In this case, the model is right about 70% of the time.</p>
<p><strong>11. Let’s evaluate!</strong></p>
<p>Now that you learned techniques for evaluating classification models, it’s your turn!</p>
</section>
<section id="make-predictions" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="make-predictions"><span class="header-section-number">1.10</span> Make predictions</h2>
<!-- Guidelines for contexts: https://instructor-support.datacamp.com/en/articles/2375526-course-coding-exercises. -->
<p>Making predictions with data is one of the fundamental goals of machine learning. Now that you know how to split the data and fit a model, it’s time to make predictions about unseen samples with your models.</p>
<p>You are going to make predictions about your test set using a model obtained by fitting the training data to a tree specification.</p>
<p>Available in your workspace are the datasets that you generated previously (<code>diabetes_train</code> and <code>diabetes_test</code>) and a decision tree specification <code>tree_spec</code>, which was generated using the following code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Fit your specification to the training data using <code>outcome</code> as the target variable and all predictors to create <code>model</code>.</li>
<li>Use your model to predict the outcome of diabetes for every observation in the test set and assign the result to <code>predictions</code>.</li>
<li>Add the true test set outcome to <code>predictions</code> as a column named <code>true_class</code> and save the result as <code>predictions_combined</code>.</li>
<li>Use the <code>head()</code> function to print the first rows of the result.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Train your model</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>model <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">fit</span>(<span class="at">formula =</span> outcome <span class="sc">~</span> ., <span class="at">data =</span> diabetes_train)</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="co"># Generate predictions</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,</span>
<span id="cb33-7"><a href="#cb33-7"></a>                       <span class="at">new_data =</span> diabetes_test)</span>
<span id="cb33-8"><a href="#cb33-8"></a></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="co"># Add the true outcomes</span></span>
<span id="cb33-10"><a href="#cb33-10"></a>predictions_combined <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span> </span>
<span id="cb33-11"><a href="#cb33-11"></a>  <span class="fu">mutate</span>(<span class="at">true_class =</span> diabetes_test<span class="sc">$</span>outcome)</span>
<span id="cb33-12"><a href="#cb33-12"></a>  </span>
<span id="cb33-13"><a href="#cb33-13"></a><span class="co"># Print the first lines of the result</span></span>
<span id="cb33-14"><a href="#cb33-14"></a><span class="fu">head</span>(predictions_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".pred_class"],"name":[1],"type":["fct"],"align":["left"]},{"label":["true_class"],"name":[2],"type":["fct"],"align":["left"]}],"data":[{"1":"yes","2":"yes"},{"1":"no","2":"no"},{"1":"yes","2":"yes"},{"1":"no","2":"yes"},{"1":"no","2":"yes"},{"1":"yes","2":"yes"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Smooth! Now every predicted <code>.pred_class</code> has its <code>true_class</code> counterpart. The natural next step would be to compare these two and see how many are correct. You are about to find out in the next exercise.</p>
</section>
<section id="crack-the-matrix" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="crack-the-matrix"><span class="header-section-number">1.11</span> Crack the matrix</h2>
<p>Visual representations are a great and intuitive way to assess results. One way to visualize and assess the performance of your model is by using a confusion matrix. In this exercise, you will create the confusion matrix of your predicted values to see in which cases it performs well and in which cases it doesn’t.</p>
<p>The result of the previous exercise, <code>predictions_combined</code>, is still loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the confusion matrix of the <code>predictions_combined</code> tibble and save it as <code>diabetes_matrix</code>.</li>
<li>Print the result to the console.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># The confusion matrix</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>diabetes_matrix <span class="ot">&lt;-</span> <span class="fu">conf_mat</span>(<span class="at">data =</span> predictions_combined,</span>
<span id="cb34-3"><a href="#cb34-3"></a>                            <span class="at">estimate =</span> .pred_class,</span>
<span id="cb34-4"><a href="#cb34-4"></a>                            <span class="at">truth =</span> true_class)</span>
<span id="cb34-5"><a href="#cb34-5"></a></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co"># Print the matrix</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>diabetes_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;           Truth
#&gt; Prediction no yes
#&gt;        no  79  22
#&gt;        yes 20  33</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h2 id="question" data-number="1.12" class="anchored"><span class="header-section-number">1.12</span> <em>Question</em></h2>
<p>Out of all true <code>no</code> outcomes, what percent did your model correctly predict?<br> <br> ✅ 83%<br> ⬜ 75%<br> ⬜ 55%<br></p>
</blockquote>
<p>Your model found 83% of all negative outcomes, which is not bad! This measure is called <em>specificity</em> or the <em>true negative rate (TNR)</em>. Let’s see how we can quantify this further…</p>
</section>
<section id="are-you-predicting-correctly" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="are-you-predicting-correctly"><span class="header-section-number">1.13</span> Are you predicting correctly?</h2>
<!-- Guidelines for contexts: https://instructor-support.datacamp.com/en/articles/2375525-course-sequential-exercises. -->
<p>Your model should be <em>as good as possible</em>, right? One way you can assess this is by counting how often it predicted the <strong>correct</strong> classes compared to the total number of predictions it made. As discussed in the video, we call this performance measure <strong>accuracy</strong>. You can either calculate this manually or by using a handy shortcut. Both obtain the same result.</p>
<p>The confusion matrix <code>diabetes_matrix</code> and the tibble <code>predictions_combined</code> are loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Print <code>diabetes_matrix</code> to the console and use its entries to directly calculate <code>correct_predictions</code>, the number of correct predictions.</li>
<li>Save the <strong>total number</strong> of predictions to <code>all_predictions</code>.</li>
<li>Calculate and the accuracy, save it to <code>acc_manual</code>, and print it.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Calculate the number of correctly predicted classes</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>correct_predictions <span class="ot">&lt;-</span> <span class="dv">84</span> <span class="sc">+</span> <span class="dv">24</span></span>
<span id="cb36-3"><a href="#cb36-3"></a></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="co"># Calculate the number of all predicted classes</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>all_predictions <span class="ot">&lt;-</span> <span class="dv">84</span> <span class="sc">+</span> <span class="dv">24</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">+</span> <span class="dv">17</span></span>
<span id="cb36-6"><a href="#cb36-6"></a></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="co"># Calculate and print the accuracy</span></span>
<span id="cb36-8"><a href="#cb36-8"></a>acc_manual <span class="ot">&lt;-</span> correct_predictions <span class="sc">/</span> all_predictions</span>
<span id="cb36-9"><a href="#cb36-9"></a>acc_manual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.7058824</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Calculate the accuracy using a <code>yardstick</code> function and store the result in <code>acc_auto</code>.</li>
<li>Print the accuracy estimate.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># The number of correctly predicted classes</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>correct_predictions <span class="ot">&lt;-</span> <span class="dv">84</span> <span class="sc">+</span> <span class="dv">24</span></span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="co"># The number of all predicted classes</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>all_predictions <span class="ot">&lt;-</span> <span class="dv">84</span> <span class="sc">+</span> <span class="dv">24</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">+</span> <span class="dv">17</span></span>
<span id="cb38-6"><a href="#cb38-6"></a></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="co"># The accuracy calculated by hand</span></span>
<span id="cb38-8"><a href="#cb38-8"></a>acc_manual <span class="ot">&lt;-</span> correct_predictions <span class="sc">/</span> all_predictions</span>
<span id="cb38-9"><a href="#cb38-9"></a>acc_manual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.7058824</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># The accuracy calculated by a function</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>acc_auto <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(predictions_combined,</span>
<span id="cb40-3"><a href="#cb40-3"></a>                     <span class="at">estimate =</span> .pred_class,</span>
<span id="cb40-4"><a href="#cb40-4"></a>                     <span class="at">truth =</span> true_class)</span>
<span id="cb40-5"><a href="#cb40-5"></a>acc_auto<span class="sc">$</span>.estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.7272727</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h2 id="question-1" data-number="1.14" class="anchored"><span class="header-section-number">1.14</span> <em>Question</em></h2>
<p>Accuracy is very intuitive but also has its limitations. Imagine we have a naive model that <strong>always</strong> predicts <code>no</code>, regardless of the input. What would the accuracy be for that model?</p>
</blockquote>
<p>The <code>predictions_combined</code> tibble from the previous model is still available. Use this and the interactive console to find the answer!<br> &gt; <br> &gt; ⬜ The accuracy of all <em>no</em> predictions is 100%.<br> &gt; ⬜ The new model is right about 50% of the time.<br> &gt; ⬜ There are no correct predictions for the new model - 0%.<br> &gt; ✅ The new model is right in 66% of all cases.<br></p>
<p>Correct! A naive model always predicting <code>no</code> only has a slightly worse accuracy than our model. Luckily there are more useful performance metrics which we’ll cover later in the course. Stay tuned for Chapter 3!<br><br> Enjoying the course so far? <a href="http://twitter.com/intent/tweet?text=I%20am%20taking%20Machine%20Learning%20with%20Tree-Based%20Models%20in%20R%20on%20@DataCamp!%20So%20far,%20I’ve%20learned%20about%20classification%20trees%20and%20will%20learn%20about%20random%20forests%20and%20boosted%20trees%3A&amp;url=https%3A%2Fdatacamp.com/courses/machine-learning-with-tree-based-models-in-r">Tell us what you think</a>​ via Twitter!</p>
</section>
</section>
<section id="regression-trees-and-cross-validation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 2. Regression Trees and Cross-Validation</h1>
<p>Ready for some candy? Use a chocolate rating dataset to build regression trees and assess their performance using suitable error measures. You’ll overcome statistical insecurities of single train/test splits by applying sweet techniques like cross-validation and then dive even deeper by mastering the bias-variance tradeoff.</p>
<section id="continuous-outcomes" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="continuous-outcomes"><span class="header-section-number">2.1</span> Continuous outcomes</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Continuous outcomes</strong></p>
<p>In this section, we’ll talk about another type of decision tree, the regression tree.In regression, the goal is to predict a numeric or quantitative outcome.An example of a continuous numeric outcome is house prices or the number of online store visitors - the underlying value is continuous and can take any positive value.</p>
<p><strong>2. The dataset</strong></p>
<p>These examples and the exercises will use data from a survey of chocolate tastings. There is information about the amount of cocoa (in percent), the origin of the bean, the company location, and others.The outcome or response variable is final_grade, which is a numeric double value from 1 to 5.</p>
<p><strong>3. Construct the regression tree</strong></p>
<p>Construct the regression tree almost in the same way as a classification tree:Define the model class decision_tree(), set the mode to regression and the engine to “rpart”.Afterward, you can train the model by using the fit function as usual. Provide the formula, and data to train on: the dataset chocolate_train.</p>
<p><strong>4. Predictions using a regression tree</strong></p>
<p>Predicting with a regression tree is again the same as predicting with a classification tree. Simply call the predict() function and provide the model and new data. In this example, we supply our testing data as the new_data argument.The predicted numbers are chocolate grade scores.</p>
<p><strong>5. Divide &amp; conquer</strong></p>
<p>What actually happens during the training of a decision tree? Beginning at the root node, the data is divided into groups according to the feature that will result in the greatest increase in homogeneity in the groups after a split.</p>
<p><strong>6. Hyperparameters</strong></p>
<p>For regression trees, the variance or deviation from the mean within a group is aimed to be minimized.There are several “knobs” that we can turn that affect how the tree is grown, and often, turning these knobs - or model hyperparameters - will result in a better performing model.Some of these design decisions are:The min_n parameter defines the minimum number of data points in a node to be split further. The tree_depth is the maximum depth of the tree.cost_complexity is a penalty parameter (a smaller value makes more complex trees).So far, we’ve trained our trees using the default values. These defaults are chosen to provide a decent starting point on most datasets. Finding the optimal hyperparameters is called “tuning”, and you will dive into this in Chapter 3.You choose hyperparameters in the very first decision_tree() step. In this example, the hyperparameter tree_depth is four, and the cost_complexity is 0-point-05.</p>
<p><strong>7. Understanding model output</strong></p>
<p>Suppose you create a decision tree with tree_depth 1 and fit it to the chocolate_train data.When you print your model to the console, you’ll see the following output.First, some information about the fit time and number of samples, then, at the bottom, more details about the decision tree.The first column is the numbered node, here: one to three. The second column is the split criterion, here: root node or cocoa_percent greater than or equal to 0-point-905.The third column is the number of samples in that node, here: 1000 at the root node, 16 at node 2, and 984 at node three. The last column is the mean outcome of all samples in that node. For leaf nodes, that is, those having an asterisk, the model will predict that value.</p>
<p><strong>8. Let’s do regression!</strong></p>
<p>That was a lot to digest. But since many things are the same as in classification trees, you’ll see the patterns. Off to the exercises.</p>
</section>
<section id="train-a-regression-tree" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="train-a-regression-tree"><span class="header-section-number">2.2</span> Train a regression tree</h2>
<p>As you know already, decision trees are a useful tool for classification problems. Moreover, you can also use them to model regression problems. The structural difference is that there will be numeric values (instead of classes) on the leaf nodes.</p>
<p>In this exercise, you will use the chocolate dataset to fit a regression tree. This is very similar to what you already did in Chapter 1 with the <code>diabetes</code> dataset.</p>
<p>Available in your workspace is the training data <code>chocolate_train</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Build <code>model_spec</code>, a regression tree specification.</li>
<li>Using the <code>chocolate_train</code> data frame, use <code>model_spec</code> to train a regression tree that predicts <code>final_grade</code> using only the <strong>numerical predictors</strong> in the data.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Load data</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>chocolate <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/chocolate_tibble.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3"></a>                <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Rows: 1795 Columns: 6
#&gt; ── Column specification ────────────────────────────────────────────────────────
#&gt; Delimiter: ","
#&gt; chr (3): company_location, bean_type, broad_bean_origin
#&gt; dbl (3): final_grade, review_date, cocoa_percent
#&gt; 
#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Create the split</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>chocolate_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(chocolate, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb44-3"><a href="#cb44-3"></a></span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="co"># Extract the training and test set</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>chocolate_train <span class="ot">&lt;-</span> <span class="fu">training</span>(chocolate_split)</span>
<span id="cb44-6"><a href="#cb44-6"></a>chocolate_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(chocolate_split)</span>
<span id="cb44-7"><a href="#cb44-7"></a></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="co"># Build the specification</span></span>
<span id="cb44-9"><a href="#cb44-9"></a>model_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-10"><a href="#cb44-10"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-11"><a href="#cb44-11"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>)</span>
<span id="cb44-12"><a href="#cb44-12"></a></span>
<span id="cb44-13"><a href="#cb44-13"></a><span class="co"># Fit to the data</span></span>
<span id="cb44-14"><a href="#cb44-14"></a>model_fit <span class="ot">&lt;-</span> model_spec <span class="sc">%&gt;%</span></span>
<span id="cb44-15"><a href="#cb44-15"></a>  <span class="fu">fit</span>(<span class="at">formula =</span> final_grade <span class="sc">~</span> cocoa_percent <span class="sc">+</span> review_date,</span>
<span id="cb44-16"><a href="#cb44-16"></a>      <span class="at">data =</span> chocolate_train)</span>
<span id="cb44-17"><a href="#cb44-17"></a></span>
<span id="cb44-18"><a href="#cb44-18"></a>model_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 1436 
#&gt; 
#&gt; node), split, n, deviance, yval
#&gt;       * denotes terminal node
#&gt; 
#&gt;  1) root 1436 323.452400 3.188196  
#&gt;    2) cocoa_percent&gt;=0.905 21   7.952381 2.297619 *
#&gt;    3) cocoa_percent&lt; 0.905 1415 298.597200 3.201413  
#&gt;      6) cocoa_percent&gt;=0.755 194  37.111150 3.032216 *
#&gt;      7) cocoa_percent&lt; 0.755 1221 255.049900 3.228296  
#&gt;       14) cocoa_percent&lt; 0.625 83  13.701810 2.975904 *
#&gt;       15) cocoa_percent&gt;=0.625 1138 235.675100 3.246705  
#&gt;         30) cocoa_percent&gt;=0.705 426  90.933830 3.169601 *
#&gt;         31) cocoa_percent&lt; 0.705 712 140.693500 3.292837 *</code></pre>
</div>
</div>
<p>Terrific training of a tree! You specified and fit a regression tree using <code>cocoa_percent</code> and <code>review_date</code> as predictor variables. Remember that a regression tree is technically the same as a classification tree with the difference that it has numeric values at the terminal nodes and is specified using <code>"regression"</code> mode.</p>
</section>
<section id="predict-new-values" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="predict-new-values"><span class="header-section-number">2.3</span> Predict new values</h2>
<p>A <strong>predictive</strong> model is one that predicts the outcomes of new, unseen data. Besides the numeric predictors, there are other useful columns in the dataset. The goal of this exercise is to predict the final rating grades of a chocolate tasting based on all other predictor variables that are available.</p>
<p>Loaded in your workspace is the regression tree specification that you created in the last exercise, <code>chocolate_spec</code>, as well as the training and testing data (<code>chocolate_train</code> and <code>chocolate_test</code>).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>model_spec</code> to train a regression tree <code>chocolate_model</code> that predicts <code>final_grade</code> using all predictors in the data.</li>
<li>Predict <code>final_grade</code> values using the <code>chocolate_test</code> tibble.</li>
<li>Add the results to the <code>chocolate_test</code> tibble.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># Train the model</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>chocolate_model <span class="ot">&lt;-</span> model_spec <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="fu">fit</span>(<span class="at">formula =</span> final_grade <span class="sc">~</span> .,</span>
<span id="cb46-4"><a href="#cb46-4"></a>      <span class="at">data =</span> chocolate_train)</span>
<span id="cb46-5"><a href="#cb46-5"></a></span>
<span id="cb46-6"><a href="#cb46-6"></a><span class="co"># Predict new data</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(chocolate_model,</span>
<span id="cb46-8"><a href="#cb46-8"></a>                       <span class="at">new_data =</span> chocolate_test) <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="#cb46-9"></a>  <span class="co"># Add the test set</span></span>
<span id="cb46-10"><a href="#cb46-10"></a>  <span class="fu">bind_cols</span>(chocolate_test)</span>
<span id="cb46-11"><a href="#cb46-11"></a></span>
<span id="cb46-12"><a href="#cb46-12"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".pred"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["final_grade"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["review_date"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cocoa_percent"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["company_location"],"name":[5],"type":["fct"],"align":["left"]},{"label":["bean_type"],"name":[6],"type":["fct"],"align":["left"]},{"label":["broad_bean_origin"],"name":[7],"type":["fct"],"align":["left"]}],"data":[{"1":"3.405428","2":"3.75","3":"2014","4":"0.700","5":"France","6":"Criollo","7":"Venezuela"},{"1":"3.199755","2":"3.75","3":"2013","4":"0.700","5":"France","6":"NA","7":"Ecuador"},{"1":"3.199755","2":"2.75","3":"2013","4":"0.700","5":"France","6":"NA","7":"Colombia"},{"1":"3.405428","2":"4.00","3":"2013","4":"0.630","5":"France","6":"NA","7":"Peru"},{"1":"3.405428","2":"3.75","3":"2012","4":"0.630","5":"France","6":"NA","7":"Peru"},{"1":"2.987013","2":"3.75","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Peru"},{"1":"3.199755","2":"3.25","3":"2011","4":"0.800","5":"Fiji","6":"Trinitario","7":"Fiji"},{"1":"3.405428","2":"2.75","3":"2010","4":"0.750","5":"Switzerland","6":"Forastero","7":"Brazil"},{"1":"2.987013","2":"3.25","3":"2013","4":"0.600","5":"U.S.A.","6":"NA","7":"Peru"},{"1":"3.218750","2":"4.00","3":"2011","4":"0.700","5":"U.S.A.","6":"NA","7":"Papua New Guinea"},{"1":"2.987013","2":"2.75","3":"2008","4":"0.700","5":"U.S.A.","6":"NA","7":"Indonesia"},{"1":"3.218750","2":"3.00","3":"2007","4":"0.700","5":"U.S.A.","6":"NA","7":"Venezuela"},{"1":"2.987013","2":"3.50","3":"2013","4":"0.730","5":"Peru","6":"Trinitario","7":"Peru"},{"1":"3.199755","2":"3.00","3":"2015","4":"0.640","5":"Canada","6":"Trinitario","7":"Belize"},{"1":"3.405428","2":"3.25","3":"2015","4":"0.750","5":"Canada","6":"NA","7":"Dominican Republic"},{"1":"3.405428","2":"4.00","3":"2006","4":"0.660","5":"Italy","6":"Blend","7":"NA"},{"1":"3.405428","2":"3.25","3":"2013","4":"0.750","5":"Brazil","6":"Forastero (Catongo)","7":"Brazil"},{"1":"3.405428","2":"2.75","3":"2010","4":"0.850","5":"Brazil","6":"Forastero (Parazinho)","7":"Brazil"},{"1":"3.218750","2":"3.50","3":"2016","4":"0.700","5":"U.S.A.","6":"NA","7":"Guatemala"},{"1":"2.987013","2":"4.00","3":"2016","4":"0.700","5":"U.S.A.","6":"NA","7":"Costa Rica"},{"1":"2.987013","2":"3.25","3":"2016","4":"0.700","5":"U.S.A.","6":"NA","7":"Fiji"},{"1":"3.218750","2":"3.25","3":"2016","4":"0.730","5":"U.S.A.","6":"NA","7":"Vietnam"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Brazil"},{"1":"3.218750","2":"3.75","3":"2015","4":"0.700","5":"U.S.A.","6":"Forastero (Nacional)","7":"Ecuador"},{"1":"2.987013","2":"4.00","3":"2015","4":"0.700","5":"U.S.A.","6":"Criollo, Trinitario","7":"Nicaragua"},{"1":"3.218750","2":"3.75","3":"2012","4":"0.720","5":"U.K.","6":"NA","7":"Colombia"},{"1":"3.218750","2":"3.25","3":"2010","4":"0.720","5":"U.K.","6":"Trinitario","7":"Vietnam"},{"1":"3.218750","2":"2.50","3":"2009","4":"0.750","5":"U.K.","6":"Criollo, Trinitario","7":"Venezuela"},{"1":"3.218750","2":"3.25","3":"2009","4":"0.720","5":"U.K.","6":"Trinitario","7":"Dominican Republic"},{"1":"3.218750","2":"3.75","3":"2008","4":"0.720","5":"U.K.","6":"Forastero","7":"Congo"},{"1":"3.218750","2":"2.75","3":"2013","4":"0.720","5":"U.K.","6":"Trinitario","7":"Colombia"},{"1":"3.218750","2":"2.50","3":"2007","4":"0.750","5":"U.S.A.","6":"Trinitario","7":"Mexico"},{"1":"3.199755","2":"3.50","3":"2015","4":"0.700","5":"Australia","6":"NA","7":"Papua New Guinea"},{"1":"3.405428","2":"3.00","3":"2012","4":"0.700","5":"Australia","6":"Trinitario","7":"Madagascar"},{"1":"3.199755","2":"2.50","3":"2012","4":"0.700","5":"Australia","6":"Blend","7":"NA"},{"1":"2.987013","2":"2.75","3":"2015","4":"0.700","5":"Peru","6":"NA","7":"Peru"},{"1":"2.987013","2":"4.00","3":"2014","4":"0.700","5":"U.S.A.","6":"Forastero (Nacional)","7":"Peru"},{"1":"2.987013","2":"2.75","3":"2012","4":"0.800","5":"Wales","6":"NA","7":"Costa Rica"},{"1":"3.218750","2":"2.75","3":"2016","4":"0.700","5":"U.S.A.","6":"NA","7":"Domincan Republic"},{"1":"3.218750","2":"2.75","3":"2016","4":"0.700","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"2.987013","2":"2.75","3":"2010","4":"0.640","5":"Belgium","6":"NA","7":"Peru"},{"1":"3.199755","2":"3.50","3":"2016","4":"0.830","5":"Germany","6":"Trinitario","7":"Belize"},{"1":"2.987013","2":"4.00","3":"2011","4":"0.720","5":"Belgium","6":"Trinitario","7":"Indonesia"},{"1":"3.199755","2":"4.00","3":"2011","4":"0.720","5":"Switzerland","6":"NA","7":"Ecuador"},{"1":"3.405428","2":"3.25","3":"2010","4":"0.740","5":"Switzerland","6":"Criollo (Porcelana)","7":"Venezuela"},{"1":"3.405428","2":"3.50","3":"2010","4":"0.640","5":"Switzerland","6":"NA","7":"Indonesia"},{"1":"2.987013","2":"2.50","3":"2015","4":"0.760","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"2.987013","2":"3.50","3":"2012","4":"0.720","5":"U.S.A.","6":"Forastero","7":"Ghana"},{"1":"3.218750","2":"3.75","3":"2010","4":"0.700","5":"U.S.A.","6":"Blend","7":"Dominican Rep., Bali"},{"1":"2.987013","2":"3.00","3":"2008","4":"0.700","5":"U.S.A.","6":"Forastero","7":"Ghana"},{"1":"3.218750","2":"2.75","3":"2008","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Venezuela"},{"1":"2.987013","2":"3.00","3":"2008","4":"0.700","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"2.997685","2":"3.50","3":"2013","4":"0.820","5":"Spain","6":"Forastero","7":"Congo"},{"1":"3.218750","2":"2.75","3":"2009","4":"0.720","5":"Spain","6":"NA","7":"NA"},{"1":"3.218750","2":"3.50","3":"2012","4":"0.700","5":"U.S.A.","6":"NA","7":"Guatemala"},{"1":"3.405428","2":"3.75","3":"2014","4":"0.650","5":"France","6":"NA","7":"Venez,Africa,Brasil,Peru,Mex"},{"1":"3.405428","2":"3.25","3":"2011","4":"0.750","5":"France","6":"Trinitario","7":"Jamaica"},{"1":"3.199755","2":"3.00","3":"2009","4":"0.750","5":"France","6":"Criollo","7":"Mexico"},{"1":"3.405428","2":"4.00","3":"2008","4":"0.750","5":"France","6":"Criollo (Porcelana)","7":"Venezuela"},{"1":"2.297619","2":"1.50","3":"2006","4":"1.000","5":"France","6":"NA","7":"NA"},{"1":"2.997685","2":"3.25","3":"2009","4":"0.770","5":"Ecuador","6":"Forastero (Arriba)","7":"Ecuador"},{"1":"3.218750","2":"2.75","3":"2014","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Belize"},{"1":"2.987013","2":"3.50","3":"2013","4":"0.750","5":"U.S.A.","6":"Forastero","7":"Ghana"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Guatemala"},{"1":"3.218750","2":"2.75","3":"2010","4":"0.750","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"2.25","3":"2010","4":"0.750","5":"U.S.A.","6":"NA","7":"Venezuela"},{"1":"3.405428","2":"3.50","3":"2016","4":"0.650","5":"France","6":"Trinitario, Criollo","7":"Haiti"},{"1":"3.405428","2":"2.00","3":"2007","4":"0.720","5":"France","6":"NA","7":"Venezuela"},{"1":"3.218750","2":"3.50","3":"2014","4":"0.750","5":"Venezuela","6":"Trinitario","7":"Venezuela"},{"1":"3.218750","2":"3.25","3":"2015","4":"0.740","5":"Venezuela","6":"NA","7":"Venezuela"},{"1":"3.218750","2":"3.75","3":"2016","4":"0.710","5":"Colombia","6":"NA","7":"Colombia"},{"1":"3.218750","2":"3.50","3":"2014","4":"0.640","5":"Colombia","6":"NA","7":"Colombia"},{"1":"3.218750","2":"3.00","3":"2011","4":"0.720","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"3.75","3":"2011","4":"0.660","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"3.75","3":"2010","4":"0.710","5":"Spain","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"4.00","3":"2010","4":"0.710","5":"Spain","6":"NA","7":"Papua New Guinea"},{"1":"2.997685","2":"3.50","3":"2010","4":"0.770","5":"Spain","6":"NA","7":"Venezuela"},{"1":"2.987013","2":"3.25","3":"2013","4":"0.700","5":"Peru","6":"NA","7":"Peru"},{"1":"3.199755","2":"2.50","3":"2011","4":"0.700","5":"Italy","6":"Trinitario","7":"Trinidad"},{"1":"3.218750","2":"3.25","3":"2016","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Brazil"},{"1":"3.199755","2":"2.75","3":"2012","4":"0.800","5":"Costa Rica","6":"Forastero","7":"Costa Rica"},{"1":"3.218750","2":"3.00","3":"2016","4":"0.650","5":"Colombia","6":"Trinitario","7":"Colombia"},{"1":"3.218750","2":"3.25","3":"2016","4":"0.650","5":"Colombia","6":"Trinitario","7":"Colombia"},{"1":"3.218750","2":"4.00","3":"2016","4":"0.720","5":"U.S.A.","6":"Trinitario","7":"Belize"},{"1":"3.218750","2":"3.00","3":"2013","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Bolivia"},{"1":"3.218750","2":"3.25","3":"2013","4":"0.700","5":"U.S.A.","6":"NA","7":"Venezuela"},{"1":"3.218750","2":"2.50","3":"2014","4":"0.700","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"2.987013","2":"2.75","3":"2014","4":"0.700","5":"U.S.A.","6":"NA","7":"Peru"},{"1":"3.199755","2":"3.00","3":"2014","4":"0.750","5":"Germany","6":"Trinitario","7":"Belize"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.700","5":"South Korea","6":"Trinitario","7":"Malaysia"},{"1":"2.987013","2":"2.50","3":"2015","4":"0.650","5":"U.K.","6":"Criollo","7":"Peru"},{"1":"2.987013","2":"2.75","3":"2015","4":"0.650","5":"U.K.","6":"Criollo","7":"Peru"},{"1":"3.405428","2":"3.50","3":"2015","4":"0.680","5":"Amsterdam","6":"Forastero","7":"Congo"},{"1":"3.405428","2":"3.75","3":"2015","4":"0.690","5":"Scotland","6":"Forastero (Nacional)","7":"Peru"},{"1":"3.199755","2":"3.25","3":"2011","4":"0.650","5":"Canada","6":"NA","7":"Mexico"},{"1":"3.218750","2":"2.50","3":"2015","4":"0.650","5":"U.S.A.","6":"Trinitario","7":"Mexico"},{"1":"3.218750","2":"2.50","3":"2015","4":"0.750","5":"U.S.A.","6":"Trinitario","7":"Mexico"},{"1":"3.199755","2":"2.75","3":"2009","4":"0.700","5":"Canada","6":"Criollo","7":"Mexico"},{"1":"3.218750","2":"2.75","3":"2013","4":"0.420","5":"Martinique","6":"NA","7":"Martinique"},{"1":"2.297619","2":"1.00","3":"2008","4":"1.000","5":"Sao Tome","6":"Forastero","7":"Sao Tome & Principe"},{"1":"3.405428","2":"2.75","3":"2008","4":"0.800","5":"Argentina","6":"Trinitario","7":"Venezuela"},{"1":"3.199755","2":"2.75","3":"2008","4":"0.880","5":"Argentina","6":"Forastero (Nacional)","7":"Ecuador"},{"1":"3.199755","2":"3.25","3":"2013","4":"0.650","5":"Germany","6":"Forastero (Nacional)","7":"Ecuador"},{"1":"3.199755","2":"2.50","3":"2014","4":"0.700","5":"Australia","6":"Forastero","7":"Papua New Guinea"},{"1":"3.218750","2":"2.75","3":"2017","4":"0.720","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"2.75","3":"2013","4":"0.700","5":"U.S.A.","6":"NA","7":"Venezuela"},{"1":"3.405428","2":"3.00","3":"2012","4":"0.750","5":"Guatemala","6":"Trinitario","7":"Venezuela"},{"1":"3.199755","2":"3.25","3":"2012","4":"0.700","5":"Guatemala","6":"NA","7":"Guatemala"},{"1":"3.199755","2":"3.50","3":"2011","4":"0.600","5":"Guatemala","6":"NA","7":"Guatemala"},{"1":"3.218750","2":"2.75","3":"2016","4":"0.720","5":"U.S.A.","6":"NA","7":"Venezuela"},{"1":"3.218750","2":"3.25","3":"2016","4":"0.750","5":"U.S.A.","6":"NA","7":"Bolivia"},{"1":"3.218750","2":"3.25","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"2.75","3":"2011","4":"0.750","5":"U.S.A.","6":"Criollo","7":"Venezuela"},{"1":"3.218750","2":"3.00","3":"2011","4":"0.740","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"3.25","3":"2011","4":"0.700","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"3.25","3":"2014","4":"0.720","5":"U.K.","6":"Trinitario","7":"Venezuela"},{"1":"2.987013","2":"3.50","3":"2014","4":"0.720","5":"U.K.","6":"Criollo, Trinitario","7":"Nicaragua"},{"1":"3.218750","2":"3.75","3":"2009","4":"0.700","5":"U.S.A.","6":"NA","7":"Hawaii"},{"1":"3.218750","2":"1.50","3":"2006","4":"0.700","5":"Belgium","6":"NA","7":"NA"},{"1":"3.405428","2":"3.00","3":"2006","4":"0.700","5":"Italy","6":"Trinitario","7":"Venezuela"},{"1":"3.218750","2":"2.50","3":"2015","4":"0.700","5":"U.K.","6":"Trinitario","7":"Venezuela"},{"1":"3.218750","2":"3.00","3":"2011","4":"0.720","5":"U.K.","6":"NA","7":"Panama"},{"1":"3.218750","2":"3.50","3":"2010","4":"0.700","5":"U.K.","6":"NA","7":"Panama"},{"1":"3.218750","2":"3.75","3":"2010","4":"0.720","5":"U.K.","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"2.50","3":"2010","4":"0.700","5":"U.K.","6":"NA","7":"Ecuador"},{"1":"2.987013","2":"3.75","3":"2010","4":"0.700","5":"U.K.","6":"NA","7":"Peru"},{"1":"3.405428","2":"2.75","3":"2012","4":"0.820","5":"France","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.25","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Domincan Republic"},{"1":"3.405428","2":"3.25","3":"2014","4":"0.700","5":"Canada","6":"NA","7":"Peru"},{"1":"3.199755","2":"3.25","3":"2016","4":"0.700","5":"Canada","6":"NA","7":"Colombia"},{"1":"3.218750","2":"3.75","3":"2015","4":"0.700","5":"Venezuela","6":"NA","7":"Venezuela"},{"1":"3.218750","2":"3.00","3":"2009","4":"0.700","5":"Venezuela","6":"Trinitario","7":"Venezuela"},{"1":"3.218750","2":"2.50","3":"2008","4":"0.580","5":"Venezuela","6":"Criollo","7":"Venezuela"},{"1":"3.405428","2":"3.25","3":"2014","4":"0.740","5":"France","6":"Trinitario","7":"Vietnam"},{"1":"2.997685","2":"3.50","3":"2009","4":"0.810","5":"U.S.A.","6":"Criollo","7":"Venezuela"},{"1":"3.218750","2":"2.50","3":"2011","4":"0.550","5":"U.S.A.","6":"Trinitario","7":"Trinidad"},{"1":"2.987013","2":"3.00","3":"2016","4":"0.760","5":"Portugal","6":"NA","7":"Jamaica"},{"1":"2.997685","2":"2.75","3":"2016","4":"0.760","5":"Portugal","6":"Trinitario","7":"Belize"},{"1":"3.405428","2":"3.00","3":"2006","4":"0.650","5":"Switzerland","6":"Criollo","7":"Venezuela"},{"1":"3.218750","2":"2.75","3":"2016","4":"0.700","5":"Puerto Rico","6":"NA","7":"Domincan Republic"},{"1":"2.987013","2":"3.50","3":"2015","4":"0.700","5":"Belgium","6":"NA","7":"Costa Rica"},{"1":"2.987013","2":"3.50","3":"2014","4":"0.600","5":"Belgium","6":"Forastero","7":"Ghana"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.730","5":"U.S.A.","6":"NA","7":"Guatemala"},{"1":"2.987013","2":"3.00","3":"2014","4":"0.800","5":"U.S.A.","6":"NA","7":"Costa Rica"},{"1":"2.987013","2":"3.25","3":"2014","4":"0.680","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"2.987013","2":"2.50","3":"2012","4":"0.700","5":"U.S.A.","6":"Criollo","7":"Peru"},{"1":"2.987013","2":"3.00","3":"2014","4":"0.700","5":"U.S.A.","6":"Forastero (Nacional)","7":"Peru"},{"1":"2.987013","2":"3.50","3":"2014","4":"0.700","5":"U.S.A.","6":"Forastero (Nacional)","7":"Peru"},{"1":"2.987013","2":"3.25","3":"2011","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Jamaica"},{"1":"3.218750","2":"3.50","3":"2011","4":"0.720","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"2.75","3":"2011","4":"0.740","5":"U.S.A.","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.00","3":"2011","4":"0.740","5":"U.S.A.","6":"Trinitario","7":"Madagascar"},{"1":"3.405428","2":"3.50","3":"2014","4":"0.700","5":"Denmark","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"3.25","3":"2013","4":"0.700","5":"Denmark","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"3.50","3":"2013","4":"0.700","5":"Denmark","6":"NA","7":"Nicaragua"},{"1":"2.987013","2":"4.00","3":"2016","4":"0.740","5":"U.S.A.","6":"Amazon mix","7":"Costa Rica"},{"1":"2.987013","2":"2.50","3":"2012","4":"0.700","5":"U.S.A.","6":"NA","7":"Peru"},{"1":"3.405428","2":"3.50","3":"2015","4":"0.750","5":"Germany","6":"Trinitario","7":"Madagascar"},{"1":"2.987013","2":"3.25","3":"2016","4":"0.770","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"3.00","3":"2009","4":"0.760","5":"Italy","6":"NA","7":"Venezuela"},{"1":"3.405428","2":"3.25","3":"2009","4":"0.640","5":"Italy","6":"NA","7":"Ven, Trinidad, Ecuador"},{"1":"2.987013","2":"2.75","3":"2013","4":"0.650","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"2.987013","2":"3.25","3":"2013","4":"0.650","5":"U.S.A.","6":"Trinitario","7":"Jamaica"},{"1":"3.218750","2":"2.75","3":"2011","4":"0.720","5":"U.S.A.","6":"NA","7":"NA"},{"1":"3.218750","2":"3.50","3":"2009","4":"0.700","5":"U.S.A.","6":"Blend","7":"NA"},{"1":"2.987013","2":"3.00","3":"2008","4":"0.650","5":"U.S.A.","6":"NA","7":"Peru"},{"1":"3.218750","2":"2.75","3":"2014","4":"0.550","5":"Ecuador","6":"Trinitario","7":"Ecuador"},{"1":"3.218750","2":"3.00","3":"2014","4":"0.700","5":"Ecuador","6":"Trinitario","7":"Ecuador"},{"1":"3.218750","2":"3.75","3":"2014","4":"0.670","5":"U.S.A.","6":"NA","7":"Hawaii"},{"1":"3.218750","2":"3.50","3":"2016","4":"0.700","5":"U.S.A.","6":"EET","7":"Ecuador"},{"1":"3.218750","2":"2.75","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Tanzania"},{"1":"3.218750","2":"3.00","3":"2015","4":"0.740","5":"U.S.A.","6":"Trinitario","7":"Madagascar"},{"1":"3.405428","2":"2.75","3":"2016","4":"0.700","5":"New Zealand","6":"Trinitario","7":"Madagascar"},{"1":"3.405428","2":"3.25","3":"2016","4":"0.750","5":"New Zealand","6":"Trinitario","7":"Domincan Republic"},{"1":"2.997685","2":"2.50","3":"2009","4":"0.800","5":"Ecuador","6":"Forastero (Arriba) ASS","7":"Ecuador"},{"1":"3.218750","2":"3.50","3":"2009","4":"0.580","5":"Ecuador","6":"Forastero (Arriba) ASS","7":"Ecuador"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.700","5":"Israel","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.700","5":"Israel","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.700","5":"Israel","6":"Trinitario","7":"Trinidad"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.700","5":"Israel","6":"NA","7":"Venezuela"},{"1":"3.218750","2":"3.00","3":"2013","4":"0.750","5":"U.K.","6":"Trinitario","7":"Trinidad"},{"1":"2.297619","2":"2.75","3":"2013","4":"1.000","5":"U.K.","6":"NA","7":"Peru"},{"1":"3.218750","2":"3.50","3":"2012","4":"0.660","5":"U.K.","6":"Trinitario, Criollo","7":"Madagascar"},{"1":"3.218750","2":"3.00","3":"2010","4":"0.700","5":"U.K.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"3.00","3":"2008","4":"0.720","5":"U.K.","6":"NA","7":"St. Lucia"},{"1":"2.987013","2":"2.50","3":"2008","4":"0.800","5":"U.K.","6":"Forastero","7":"Uganda"},{"1":"2.987013","2":"3.00","3":"2008","4":"0.720","5":"U.K.","6":"Forastero","7":"Sao Tome"},{"1":"3.405428","2":"3.00","3":"2014","4":"0.700","5":"Canada","6":"Trinitario","7":"Nicaragua"},{"1":"3.405428","2":"3.75","3":"2011","4":"0.720","5":"Switzerland","6":"Criollo","7":"Venezuela"},{"1":"3.405428","2":"3.75","3":"2011","4":"0.720","5":"Switzerland","6":"NA","7":"Venezuela"},{"1":"3.405428","2":"3.75","3":"2011","4":"0.720","5":"Switzerland","6":"Criollo","7":"Venezuela"},{"1":"3.405428","2":"4.00","3":"2011","4":"0.740","5":"Switzerland","6":"Criollo","7":"Venezuela"},{"1":"3.405428","2":"4.00","3":"2011","4":"0.700","5":"Switzerland","6":"Trinitario","7":"Venezuela"},{"1":"3.199755","2":"2.50","3":"2016","4":"0.610","5":"India","6":"NA","7":"India"},{"1":"3.218750","2":"3.25","3":"2014","4":"0.720","5":"U.S.A.","6":"Trinitario","7":"Belize"},{"1":"3.218750","2":"3.50","3":"2014","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Madagascar"},{"1":"3.405428","2":"2.50","3":"2012","4":"0.640","5":"Germany","6":"NA","7":"Peru"},{"1":"3.218750","2":"3.50","3":"2008","4":"0.700","5":"Ecuador","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"3.25","3":"2014","4":"0.720","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"3.25","3":"2016","4":"0.700","5":"U.S.A.","6":"NA","7":"Haiti"},{"1":"2.987013","2":"2.50","3":"2014","4":"0.725","5":"U.S.A.","6":"Forastero","7":"Uganda"},{"1":"3.218750","2":"4.00","3":"2012","4":"0.700","5":"U.S.A.","6":"NA","7":"Brazil"},{"1":"3.218750","2":"3.75","3":"2011","4":"0.740","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"2.987013","2":"3.25","3":"2010","4":"0.750","5":"U.S.A.","6":"Trinitario","7":"Grenada"},{"1":"3.218750","2":"3.00","3":"2009","4":"0.680","5":"U.S.A.","6":"NA","7":"Bolivia"},{"1":"2.987013","2":"2.50","3":"2016","4":"0.700","5":"Japan","6":"Trinitario, Criollo","7":"Peru"},{"1":"2.987013","2":"3.00","3":"2016","4":"0.700","5":"Japan","6":"Criollo","7":"Peru"},{"1":"3.405428","2":"2.75","3":"2013","4":"0.740","5":"France","6":"NA","7":"Africa, Carribean, C. Am."},{"1":"3.405428","2":"3.50","3":"2009","4":"0.690","5":"France","6":"Criollo (Porcelana)","7":"Venezuela"},{"1":"3.405428","2":"3.50","3":"2008","4":"0.740","5":"France","6":"Blend","7":"Ven., Indonesia, Ecuad."},{"1":"3.218750","2":"3.25","3":"2011","4":"0.600","5":"Ecuador","6":"NA","7":"Ecuador"},{"1":"3.405428","2":"3.25","3":"2015","4":"0.750","5":"France","6":"NA","7":"Peru"},{"1":"2.987013","2":"3.50","3":"2014","4":"0.700","5":"U.S.A.","6":"Forastero (Nacional)","7":"Peru"},{"1":"2.987013","2":"3.75","3":"2012","4":"0.680","5":"U.S.A.","6":"NA","7":"Peru"},{"1":"3.218750","2":"3.50","3":"2012","4":"0.680","5":"U.S.A.","6":"Criollo","7":"Bolivia"},{"1":"3.218750","2":"3.50","3":"2010","4":"0.650","5":"Colombia","6":"NA","7":"Colombia"},{"1":"3.218750","2":"3.75","3":"2008","4":"0.700","5":"Madagascar","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"4.00","3":"2008","4":"0.630","5":"Madagascar","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.50","3":"2013","4":"0.700","5":"U.S.A.","6":"NA","7":"Brazil"},{"1":"3.218750","2":"2.50","3":"2011","4":"0.700","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.199755","2":"2.00","3":"2008","4":"0.750","5":"Italy","6":"NA","7":"Tanzania"},{"1":"3.218750","2":"2.75","3":"2009","4":"0.550","5":"U.S.A.","6":"Blend","7":"Hawaii"},{"1":"2.987013","2":"3.75","3":"2015","4":"0.720","5":"U.S.A.","6":"NA","7":"Costa Rica"},{"1":"3.405428","2":"3.50","3":"2016","4":"0.700","5":"Poland","6":"NA","7":"Peru"},{"1":"3.405428","2":"3.25","3":"2012","4":"0.700","5":"Poland","6":"NA","7":"Dominican Republic"},{"1":"2.987013","2":"3.50","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"3.25","3":"2016","4":"0.750","5":"Canada","6":"NA","7":"NA"},{"1":"3.405428","2":"3.50","3":"2015","4":"0.680","5":"Vietnam","6":"Trinitario","7":"Vietnam"},{"1":"3.405428","2":"3.50","3":"2012","4":"0.740","5":"Vietnam","6":"Trinitario","7":"Vietnam"},{"1":"2.987013","2":"3.00","3":"2010","4":"0.650","5":"U.S.A.","6":"NA","7":"Costa Rica"},{"1":"2.987013","2":"3.00","3":"2010","4":"0.650","5":"U.S.A.","6":"NA","7":"Ivory Coast"},{"1":"3.218750","2":"3.00","3":"2011","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Venezuela"},{"1":"3.199755","2":"4.00","3":"2013","4":"0.740","5":"Australia","6":"Trinitario","7":"Papua New Guinea"},{"1":"3.218750","2":"3.25","3":"2014","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Belize"},{"1":"3.218750","2":"2.50","3":"2014","4":"0.700","5":"U.S.A.","6":"NA","7":"Bolivia"},{"1":"3.218750","2":"3.00","3":"2014","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Belize"},{"1":"3.218750","2":"2.50","3":"2012","4":"0.720","5":"Madagascar","6":"Trinitario","7":"Madagascar"},{"1":"3.199755","2":"2.75","3":"2015","4":"0.800","5":"Honduras","6":"NA","7":"El Salvador"},{"1":"3.405428","2":"3.25","3":"2014","4":"0.700","5":"Honduras","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"3.50","3":"2014","4":"0.800","5":"Honduras","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"4.00","3":"2006","4":"0.670","5":"France","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"1.50","3":"2012","4":"0.650","5":"U.S.A.","6":"NA","7":"NA"},{"1":"2.987013","2":"2.75","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Indonesia"},{"1":"2.987013","2":"2.75","3":"2011","4":"0.700","5":"Nicaragua","6":"NA","7":"Nicaragua"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.630","5":"Ecuador","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"2.75","3":"2016","4":"0.680","5":"U.S.A.","6":"NA","7":"Madagascar"},{"1":"3.199755","2":"2.50","3":"2013","4":"0.580","5":"Costa Rica","6":"NA","7":"Costa Rica"},{"1":"2.987013","2":"3.75","3":"2013","4":"0.780","5":"Lithuania","6":"Forastero (Nacional)","7":"Peru"},{"1":"2.987013","2":"3.25","3":"2014","4":"0.700","5":"Lithuania","6":"Criollo","7":"Nicaragua"},{"1":"2.997685","2":"3.50","3":"2013","4":"0.850","5":"U.S.A.","6":"NA","7":"Hawaii"},{"1":"2.987013","2":"3.50","3":"2014","4":"0.700","5":"U.S.A.","6":"Forastero","7":"Ghana"},{"1":"3.218750","2":"2.25","3":"2015","4":"0.720","5":"U.S.A.","6":"Criollo","7":"Venezuela"},{"1":"3.218750","2":"3.50","3":"2013","4":"0.750","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"2.987013","2":"3.00","3":"2014","4":"0.750","5":"U.S.A.","6":"Forastero","7":"Ghana"},{"1":"2.987013","2":"3.25","3":"2014","4":"0.750","5":"U.S.A.","6":"Forastero (Nacional)","7":"Peru"},{"1":"3.199755","2":"2.75","3":"2011","4":"0.760","5":"Canada","6":"NA","7":"Carribean"},{"1":"2.987013","2":"2.75","3":"2011","4":"0.800","5":"Ghana","6":"Forastero","7":"Ghana"},{"1":"3.199755","2":"3.00","3":"2014","4":"0.700","5":"Iceland","6":"NA","7":"Papua New Guinea"},{"1":"3.405428","2":"3.50","3":"2014","4":"0.660","5":"Iceland","6":"Trinitario","7":"Madagascar"},{"1":"3.405428","2":"2.75","3":"2013","4":"0.720","5":"Canada","6":"Trinitario","7":"Nicaragua"},{"1":"3.405428","2":"3.00","3":"2009","4":"0.700","5":"Switzerland","6":"Forastero","7":"Congo"},{"1":"3.218750","2":"3.50","3":"2014","4":"0.700","5":"Ecuador","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"3.75","3":"2014","4":"0.700","5":"Ecuador","6":"NA","7":"Ecuador"},{"1":"3.199755","2":"3.00","3":"2016","4":"0.720","5":"Canada","6":"Trinitario","7":"Belize"},{"1":"3.218750","2":"3.50","3":"2014","4":"0.650","5":"U.S.A.","6":"NA","7":"South America"},{"1":"2.987013","2":"2.75","3":"2013","4":"0.700","5":"Peru","6":"NA","7":"Peru"},{"1":"3.218750","2":"2.25","3":"2014","4":"0.730","5":"U.K.","6":"Trinitario","7":"Madagascar"},{"1":"2.987013","2":"3.25","3":"2015","4":"0.800","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"3.218750","2":"3.25","3":"2014","4":"0.730","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"3.199755","2":"3.00","3":"2008","4":"0.750","5":"France","6":"Trinitario","7":"Papua New Guinea"},{"1":"3.405428","2":"2.00","3":"2008","4":"0.750","5":"France","6":"NA","7":"Dominican Republic"},{"1":"3.199755","2":"3.50","3":"2006","4":"0.750","5":"France","6":"Criollo","7":"Tanzania"},{"1":"3.199755","2":"3.50","3":"2006","4":"0.750","5":"France","6":"Trinitario","7":"Trinidad"},{"1":"3.199755","2":"4.00","3":"2006","4":"0.800","5":"France","6":"Criollo, Trinitario","7":"Ecuador"},{"1":"3.199755","2":"3.00","3":"2006","4":"0.750","5":"France","6":"Trinitario","7":"Cuba"},{"1":"3.405428","2":"3.50","3":"2006","4":"0.750","5":"France","6":"Criollo, Forastero","7":"Indonesia, Ghana"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.740","5":"U.K.","6":"Criollo","7":"Madagascar"},{"1":"3.405428","2":"3.25","3":"2012","4":"0.650","5":"Brazil","6":"NA","7":"Brazil"},{"1":"3.218750","2":"2.75","3":"2016","4":"0.700","5":"Mexico","6":"Criollo","7":"Mexico"},{"1":"3.218750","2":"3.25","3":"2012","4":"0.750","5":"U.S.A.","6":"Trinitario","7":"Madagascar"},{"1":"2.987013","2":"3.50","3":"2015","4":"0.730","5":"U.S.A.","6":"Criollo","7":"Peru"},{"1":"3.199755","2":"2.50","3":"2012","4":"0.700","5":"Poland","6":"Criollo","7":"NA"},{"1":"3.218750","2":"2.50","3":"2009","4":"0.750","5":"Ecuador","6":"Forastero (Arriba)","7":"Ecuador"},{"1":"3.218750","2":"4.00","3":"2012","4":"0.750","5":"U.S.A.","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.25","3":"2013","4":"0.750","5":"Madagascar","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.75","3":"2016","4":"0.750","5":"U.S.A.","6":"NA","7":"Honduras"},{"1":"3.218750","2":"2.75","3":"2008","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"2.50","3":"2012","4":"0.720","5":"Hungary","6":"Trinitario","7":"Madagascar"},{"1":"3.405428","2":"3.50","3":"2010","4":"0.640","5":"Italy","6":"Trinitario","7":"Madagascar"},{"1":"3.199755","2":"3.50","3":"2010","4":"0.720","5":"Italy","6":"NA","7":"Carribean"},{"1":"2.997685","2":"2.75","3":"2012","4":"0.830","5":"U.S.A.","6":"NA","7":"Central and S. America"},{"1":"3.218750","2":"3.25","3":"2012","4":"0.690","5":"U.S.A.","6":"NA","7":"Central and S. America"},{"1":"3.218750","2":"3.00","3":"2006","4":"0.650","5":"Colombia","6":"Forastero (Nacional)","7":"Colombia"},{"1":"2.987013","2":"3.50","3":"2010","4":"0.680","5":"U.S.A.","6":"Trinitario","7":"Grenada"},{"1":"3.218750","2":"3.75","3":"2010","4":"0.650","5":"U.S.A.","6":"Trinitario, Criollo","7":"Madagascar"},{"1":"3.218750","2":"3.75","3":"2009","4":"0.720","5":"U.S.A.","6":"Trinitario","7":"Vietnam"},{"1":"3.218750","2":"3.00","3":"2007","4":"0.720","5":"U.S.A.","6":"Blend","7":"Carribean(DR/Jam/Tri)"},{"1":"2.997685","2":"2.00","3":"2006","4":"0.820","5":"U.S.A.","6":"NA","7":"NA"},{"1":"3.218750","2":"2.00","3":"2006","4":"0.680","5":"U.S.A.","6":"Blend","7":"Ghana & Madagascar"},{"1":"3.218750","2":"3.50","3":"2015","4":"0.740","5":"U.S.A.","6":"Criollo, Trinitario","7":"Dominican Republic"},{"1":"3.199755","2":"3.50","3":"2015","4":"0.700","5":"Costa Rica","6":"NA","7":"Costa Rica"},{"1":"3.405428","2":"3.25","3":"2011","4":"0.600","5":"Italy","6":"Trinitario","7":"Brazil"},{"1":"3.199755","2":"3.50","3":"2016","4":"0.730","5":"Canada","6":"NA","7":"Tanzania"},{"1":"3.199755","2":"3.00","3":"2015","4":"0.730","5":"Canada","6":"NA","7":"Guatemala"},{"1":"3.405428","2":"3.00","3":"2016","4":"0.700","5":"Australia","6":"Trinitario","7":"Vietnam"},{"1":"2.987013","2":"1.50","3":"2011","4":"0.670","5":"U.S.A.","6":"Forastero","7":"Ghana"},{"1":"3.405428","2":"3.50","3":"2016","4":"0.620","5":"Canada","6":"NA","7":"Domincan Republic"},{"1":"3.405428","2":"3.50","3":"2016","4":"0.700","5":"Canada","6":"Trinitario","7":"Madagascar"},{"1":"3.405428","2":"4.00","3":"2016","4":"0.700","5":"Canada","6":"Trinitario","7":"Vietnam"},{"1":"3.405428","2":"3.50","3":"2014","4":"0.700","5":"Canada","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"3.25","3":"2014","4":"0.700","5":"Canada","6":"Blend","7":"Madagascar & Ecuador"},{"1":"3.405428","2":"3.25","3":"2013","4":"0.700","5":"Canada","6":"NA","7":"NA"},{"1":"3.405428","2":"3.75","3":"2012","4":"0.700","5":"Canada","6":"Trinitario","7":"Venezuela"},{"1":"3.405428","2":"3.00","3":"2009","4":"0.700","5":"Canada","6":"Forastero","7":"Dominican Republic"},{"1":"3.199755","2":"3.50","3":"2009","4":"0.700","5":"Canada","6":"Trinitario","7":"Papua New Guinea"},{"1":"3.405428","2":"3.75","3":"2009","4":"0.700","5":"Canada","6":"Criollo","7":"Madagascar"},{"1":"2.987013","2":"3.25","3":"2014","4":"0.700","5":"U.S.A.","6":"NA","7":"Nicaragua"},{"1":"3.405428","2":"3.50","3":"2017","4":"0.750","5":"Canada","6":"NA","7":"Venezuela"},{"1":"3.199755","2":"3.25","3":"2017","4":"0.770","5":"Canada","6":"NA","7":"Papua New Guinea"},{"1":"3.199755","2":"3.50","3":"2017","4":"0.800","5":"Canada","6":"NA","7":"Tanzania"},{"1":"2.997685","2":"3.50","3":"2014","4":"0.840","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"2.75","3":"2016","4":"0.700","5":"Venezuela","6":"NA","7":"Venezuela"},{"1":"2.997685","2":"3.25","3":"2015","4":"0.880","5":"Hungary","6":"Trinitario","7":"Cuba"},{"1":"3.218750","2":"3.75","3":"2015","4":"0.700","5":"Hungary","6":"Forastero (Nacional)","7":"Ecuador"},{"1":"3.218750","2":"3.25","3":"2012","4":"0.700","5":"Hungary","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"3.00","3":"2014","4":"0.680","5":"U.S.A.","6":"Trinitario","7":"Belize"},{"1":"2.997685","2":"3.25","3":"2011","4":"0.870","5":"U.S.A.","6":"NA","7":"Bolivia"},{"1":"2.297619","2":"3.25","3":"2012","4":"0.990","5":"U.S.A.","6":"NA","7":"Peru, Ecuador"},{"1":"3.218750","2":"3.00","3":"2009","4":"0.680","5":"U.S.A.","6":"NA","7":"NA"},{"1":"3.218750","2":"2.75","3":"2008","4":"0.700","5":"U.S.A.","6":"NA","7":"Madagascar"},{"1":"3.218750","2":"2.75","3":"2012","4":"0.700","5":"U.S.A.","6":"NA","7":"Madagascar"},{"1":"3.218750","2":"3.75","3":"2015","4":"0.700","5":"U.S.A.","6":"Trinitario","7":"Belize"},{"1":"3.218750","2":"3.25","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"3.25","3":"2012","4":"0.650","5":"U.S.A.","6":"Forastero","7":"Congo"},{"1":"3.199755","2":"4.00","3":"2012","4":"0.700","5":"France","6":"Trinitario","7":"Tobago"},{"1":"2.997685","2":"3.00","3":"2012","4":"0.770","5":"U.S.A.","6":"Criollo","7":"Bolivia"},{"1":"3.218750","2":"2.75","3":"2015","4":"0.750","5":"U.S.A.","6":"NA","7":"Domincan Republic"},{"1":"3.218750","2":"3.00","3":"2014","4":"0.700","5":"U.S.A.","6":"NA","7":"Dominican Republic"},{"1":"3.199755","2":"3.50","3":"2009","4":"0.680","5":"France","6":"Forastero","7":"Ghana"},{"1":"3.405428","2":"4.00","3":"2006","4":"0.700","5":"France","6":"Criollo, Trinitario","7":"South America"},{"1":"2.987013","2":"2.50","3":"2012","4":"0.720","5":"U.S.A.","6":"Forastero","7":"Ghana"},{"1":"3.218750","2":"3.00","3":"2009","4":"0.680","5":"Madagascar","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.25","3":"2009","4":"0.640","5":"Madagascar","6":"Trinitario","7":"Madagascar"},{"1":"3.218750","2":"3.25","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Bolivia"},{"1":"3.218750","2":"3.25","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Bolivia"},{"1":"3.218750","2":"3.50","3":"2014","4":"0.750","5":"U.S.A.","6":"NA","7":"Ecuador"},{"1":"3.218750","2":"3.25","3":"2012","4":"0.700","5":"U.S.A.","6":"NA","7":"Central and S. America"},{"1":"3.218750","2":"3.00","3":"2007","4":"0.750","5":"U.S.A.","6":"Forastero (Arriba)","7":"Ecuador"},{"1":"2.987013","2":"3.25","3":"2013","4":"0.750","5":"Ireland","6":"Criollo","7":"Peru"},{"1":"2.997685","2":"3.00","3":"2014","4":"0.880","5":"U.K.","6":"Trinitario","7":"Colombia"},{"1":"3.218750","2":"3.25","3":"2009","4":"0.720","5":"U.K.","6":"Trinitario","7":"Venezuela"},{"1":"2.987013","2":"3.75","3":"2016","4":"0.750","5":"U.S.A.","6":"NA","7":"Ghana"},{"1":"3.405428","2":"3.00","3":"2013","4":"0.660","5":"Domincan Republic","6":"NA","7":"Dominican Republic"},{"1":"3.218750","2":"3.00","3":"2015","4":"0.700","5":"U.S.A.","6":"NA","7":"Papua New Guinea"},{"1":"3.199755","2":"3.00","3":"2016","4":"0.850","5":"Austria","6":"Criollo, Trinitario","7":"Tanzania"},{"1":"3.199755","2":"3.75","3":"2011","4":"0.720","5":"Australia","6":"NA","7":"Bolivia"},{"1":"3.199755","2":"3.50","3":"2012","4":"0.720","5":"Austria","6":"NA","7":"Panama"},{"1":"3.199755","2":"3.50","3":"2011","4":"0.650","5":"Austria","6":"Forastero","7":"India"},{"1":"3.405428","2":"3.00","3":"2010","4":"0.650","5":"Austria","6":"NA","7":"Brazil"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Wonderful work! You predicted numerical values, namely chocolate grades, using a regression tree. Note the shape of the predictions: a tibble with one column <code>.pred</code>, which contains the predicted grades. Using <code>bind_cols()</code> glues them back neatly to the test data.</p>
</section>
<section id="inspect-model-output" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="inspect-model-output"><span class="header-section-number">2.4</span> Inspect model output</h2>
<p>A hyperparameter is a value that influences the training process and can have a great impact on model performance. Available in your workspace is a regression tree model that was created using the following code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="fu">fit</span>(final_grade <span class="sc">~</span> ., <span class="at">data =</span> chocolate_train)</span>
<span id="cb47-5"><a href="#cb47-5"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 1436 
#&gt; 
#&gt; node), split, n, deviance, yval
#&gt;       * denotes terminal node
#&gt; 
#&gt; 1) root 1436 323.452400 3.188196  
#&gt;   2) cocoa_percent&gt;=0.905 21   7.952381 2.297619 *
#&gt;   3) cocoa_percent&lt; 0.905 1415 298.597200 3.201413 *</code></pre>
</div>
</div>
<p>As you can see, the <code>tree_depth</code> hyperparameter is set to <code>1</code>, which means there’s only one split in the tree.</p>
<blockquote class="blockquote">
<h2 id="question-2" data-number="2.5" class="anchored"><span class="header-section-number">2.5</span> <em>Question</em></h2>
<p>What are the possible values for <code>final_grade</code> that will be predicted by this regression tree?<br> <br> ⬜ Only 3.183787<br> ⬜ 11.37 or 332.72<br> ✅ 2.27 or 3.198<br> ⬜ Less than 0.905 and greater than 0.905<br></p>
</blockquote>
<p>Exactly! The last value is the prediction. Looks like beans with a lower cocoa percentage were rated higher by the study participants.</p>
</section>
<section id="performance-metrics-for-regression-trees" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="performance-metrics-for-regression-trees"><span class="header-section-number">2.6</span> Performance metrics for regression trees</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Performance metrics for regression trees</strong></p>
<p>Well done!Now that you’ve trained a regression tree, it’s time to evaluate the performance of the model.</p>
<p><strong>2. How to measure performance?</strong></p>
<p>In classification, a single prediction can be either right or wrong, and nothing else. So it makes sense to evaluate classification models using a metric like accuracy or the confusion matrix. In regression, however, your prediction can be almost right or even totally wrong. There is no binary correctness that calculates accuracy. You need to evaluate the regression trees using a different metric.Since the response is some real-valued number, and our prediction is the same, it makes sense to measure how far our predictions are away from the true values.</p>
<p><strong>3. Common metrics for regression</strong></p>
<p>There are several metrics for regression and two popular ones are the Mean Absolute Error, or MAE, and the Root Mean Square Error, also known as RMSE.MAE is the average absolute distance between the actual (or observed) values and the predicted values. In this picture, the predictions are depicted by the blue line, and the true values are the black dots. The red bars are the prediction errors, and the mean absolute error would be the average length of the red bars.The root mean squared error is the square root of the average squared length of the red bars.</p>
<p><strong>4. Formulas and intuition</strong></p>
<p>The formula for MAE is very straight-forward.You sum up all the absolute differences between the actual and the predicted values and divide them by the number of predictions made to get the average error.The RMSE is similar, but instead of taking the absolute difference between errors, you square the differences of the errors. Then you’ll average those values</p>
<p><strong>5. Formulas and intuition</strong></p>
<p>and take the square root of the whole thing. Taking the square root brings the metric back to the original scale of the response.Both MAE and RMSE express average model prediction errors in units of the variable of interest.The key difference between the two is that RMSE punishes large errors more harshly than MAE. Since the errors are squared before they are averaged, the RMSE gives a relatively high weight to large errors. This means the RMSE should be more useful when large errors are particularly undesirable.</p>
<p><strong>6. Coding: predictions</strong></p>
<p>Tidymodels provides the yardstick package, which is a toolbox for evaluating your models. Simply load the parsnip package to make predictions and the yardstick package for evaluations, or just the tidymodels package to load both.First, we use the predict function with our model and chocolate_test data to get predicted values.Then, we use the bind_cols() function to add these predictions to the test data as first column dot-pred.</p>
<p><strong>7. Coding: mae() and rmse()</strong></p>
<p>This is then passed to the mae() function which also expects the column that contains the predictions or estimates, dot-pred, and the column that contains the truth values, final_grade.The result is a tibble that contains the mean absolute error in the column dot-estimate.The same goes for the rmse() function.This works exactly the same as with the accuracy() function for classification trees.</p>
<p><strong>8. Let’s evaluate!</strong></p>
<p>Time to put this into practice.</p>
</section>
<section id="in-sample-performance" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="in-sample-performance"><span class="header-section-number">2.7</span> In-sample performance</h2>
<p>It’s very important to know whether your regression model is useful or not. A useful model can be one that captures the structure of your training set well. One way to assess this <em>in-sample</em> performance is to <strong>predict on training data</strong> and calculate the mean absolute error of all predicted data points.</p>
<p>In this exercise, you will evaluate your in-sample predictions using MAE (mean absolute error). MAE tells you approximately how far away the predictions are from the true values.</p>
<p>It is calculated using the following formula, where \(n\) is the number of predictions made:</p>
<p><span class="math display">\[MAE = \\frac{1}{n} \\cdot \\sum_{i=1}^n \\text{absolute value of the }i\\text{th error}\]</span></p>
<p>Available in your workspace is your <code>model</code>, the regression tree that you built in the last exercises.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create <code>in_sample_predictions</code> by using <code>model</code> to predict on the <code>chocolate_train</code> tibble.</li>
<li>Calculate a vector <code>abs_diffs</code> that contains the absolute differences between the in-sample-predictions and the true grades.</li>
<li>Calculate the mean absolute error according to the formula above.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Predict using the training set</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>in_sample_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,</span>
<span id="cb49-3"><a href="#cb49-3"></a>                                 <span class="at">new_data =</span> chocolate_train)</span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="co"># Calculate the vector of absolute differences</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>abs_diffs <span class="ot">&lt;-</span> <span class="fu">abs</span>(in_sample_predictions<span class="sc">$</span>.pred <span class="sc">-</span> chocolate_train<span class="sc">$</span>final_grade)</span>
<span id="cb49-7"><a href="#cb49-7"></a></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="co"># Calculate the mean absolute error</span></span>
<span id="cb49-9"><a href="#cb49-9"></a><span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(abs_diffs) <span class="sc">*</span> <span class="fu">sum</span>(abs_diffs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.3750626</code></pre>
</div>
</div>
<p>Excellent! You computed the mean absolute error on the training set. It has the same unit as the outcome variable, in this case, chocolate rating. This in-sample error does not seem to be very high. Let’s see how the model performs on the test data.</p>
</section>
<section id="out-of-sample-performance" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="out-of-sample-performance"><span class="header-section-number">2.8</span> Out-of-sample performance</h2>
<p>In-sample performance provides insights about how well a model captures the data it is modeling. For predictive models, it’s also important to check model performance on new, unseen data, the <em>out-of-sample</em> performance.</p>
<p>In this exercise, you will check the <strong>test set predictions</strong> of your model using MAE (mean absolute error).</p>
<p>Pre-loaded in your workspace again is the <code>model</code> that you built and used in the last exercises.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>model</code> to predict the out-of-sample <code>final_grade</code> and add your predictions to <code>chocolate_test</code> using <code>bind_cols()</code>.</li>
<li>Calculate the mean absolute error using a <code>yardstick</code> function.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Predict ratings on test set and add true grades</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>test_enriched <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">new_data =</span> chocolate_test) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>    <span class="fu">bind_cols</span>(chocolate_test)</span>
<span id="cb51-4"><a href="#cb51-4"></a></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="co"># Compute the mean absolute error using one single function</span></span>
<span id="cb51-6"><a href="#cb51-6"></a><span class="fu">mae</span>(test_enriched,</span>
<span id="cb51-7"><a href="#cb51-7"></a>    <span class="at">estimate =</span> .pred,</span>
<span id="cb51-8"><a href="#cb51-8"></a>    <span class="at">truth =</span> final_grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"mae","2":"standard","3":"0.3844552"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Positive performance! You computed the mean absolute error on the test set using a very simple function call. In-sample and out-of-sample errors are roughly equal, which is a good sign. Keep in mind that most of the <code>yardstick</code> functions have the same structure.</p>
</section>
<section id="bigger-mistakes-bigger-penalty" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="bigger-mistakes-bigger-penalty"><span class="header-section-number">2.9</span> Bigger mistakes, bigger penalty</h2>
<p>All errors are wrong, but not all are equally bad. Sometimes large prediction errors are disproportionately more harmful than small errors.</p>
<p>Bigger mistakes, bigger penalty - that’s one of the features of the root mean squared error or RMSE. It squares large errors, which punishes these outliers more harshly than smaller errors.</p>
<p>RMSE can be calculated using the following formula, where the \(i\) th <code>squared_diff</code> is the square of the \(i\) th error.</p>
<p><span class="math display">\[RMSE = \\sqrt{\\frac{1}{n} \\cdot \\sum_{i=1} ^n i\\text{th squared_diff}}\]</span></p>
<p>In this exercise, you will compute the RMSE of your predictions.</p>
<p>Available in your workspace is the result of the last exercise, <code>test_enriched</code>, the test data with a new column <code>.pred</code>, the model’s out-of-sample predictions.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the component-wise differences of the predictions and the final grades, square them, and save as <code>squared_diffs</code>.</li>
<li>Use the formula above to calculate the RMSE and save it as <code>rmse_manual</code>.</li>
<li>Use the <code>rmse()</code> function to calculate the error and save as <code>rmse_auto</code>.</li>
<li>Print <code>rmse_manual</code> and <code>rmse_auto</code> to verify that they are the same.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Calculate the squared differences</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>squared_diffs <span class="ot">&lt;-</span> (test_enriched<span class="sc">$</span>final_grade <span class="sc">-</span> test_enriched<span class="sc">$</span>.pred)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb52-3"><a href="#cb52-3"></a></span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="co"># Compute the RMSE using the formula</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>rmse_manual <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(squared_diffs) <span class="sc">*</span> <span class="fu">sum</span>(squared_diffs))</span>
<span id="cb52-6"><a href="#cb52-6"></a></span>
<span id="cb52-7"><a href="#cb52-7"></a><span class="co"># Compute the RMSE using a function</span></span>
<span id="cb52-8"><a href="#cb52-8"></a>rmse_auto <span class="ot">&lt;-</span> <span class="fu">rmse</span>(test_enriched,</span>
<span id="cb52-9"><a href="#cb52-9"></a>                  <span class="at">estimate =</span> .pred,</span>
<span id="cb52-10"><a href="#cb52-10"></a>                  <span class="at">truth =</span> final_grade)</span>
<span id="cb52-11"><a href="#cb52-11"></a></span>
<span id="cb52-12"><a href="#cb52-12"></a><span class="co"># Print both errors</span></span>
<span id="cb52-13"><a href="#cb52-13"></a>rmse_manual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.4785619</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>rmse_auto</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"rmse","2":"standard","3":"0.4785619"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Candid calculation of the RMSE in two ways! Use the RMSE to compare models where large prediction errors shouldn’t occur. Which one do you prefer - calculating the error by hand or using <code>rmse()</code>? The one you use doesn’t matter, the result is the same.</p>
</section>
<section id="cross-validation" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">2.10</span> Cross-validation</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Cross-validation</strong></p>
<p>Welcome back!So far, we always used a single train/test split.However, this is a little fragile: a single outlier can vastly change our out-of-sample error.One way to reduce this variance is to average multiple estimates together.This is exactly what cross-validation does.</p>
<p><strong>2. k-fold cross-validation</strong></p>
<p>How exactly does it work?The first step is to partition the rows of the training dataset into k subsets of equal sizes.So, if you have 500 data points and you have 5 folds, then there will be 100 data points in each of the folds.</p>
<p><strong>3. k-fold cross-validation</strong></p>
<p>In each iteration, you pick one of the k subsets as your test set</p>
<p><strong>4. k-fold cross-validation</strong></p>
<p>and the remaining k minus 1 subsets are used as the aggregated training set.</p>
<p><strong>5. k-fold cross-validation</strong></p>
<p><strong>6. k-fold cross-validation</strong></p>
<p>You train your machine learning model on each training set and evaluate the model’s performance on each test set.</p>
<p><strong>7. k-fold cross-validation</strong></p>
<p>Once you are finished you will have 5 estimates of the out-of-sample error.</p>
<p><strong>8. k-fold cross-validation</strong></p>
<p>We average those 5 estimates together to get what’s called the cross-validated estimate of the error.Since we end up training k models instead of one, it’s obvious that cross-validation takes k times as long to evaluate your models this way.</p>
<p><strong>9. Fit final model on the full dataset</strong></p>
<p>One important note: You use cross-validation to estimate the out-of-sample error for your model.When finished, you throw all resampled models away and start over, fitting your model on the full training dataset, to fully exploit the information in that dataset.</p>
<p><strong>10. Coding - Split the data 10 times</strong></p>
<p>Using the tidymodels package, it’s incredibly easy to perform cross-validation.The relevant function is called vfold_cv().It expects the data to be split and v, the number of folds to create. Let’s create ten folds of chocolate_train.The result is a tibble with ten rows, each row containing one split together with an id of that fold.</p>
<p><strong>11. Coding - Fit the folds</strong></p>
<p>Next, we want to train a model for every fold and measure the out-of-sample performance for that model.tidymodels gives us a shortcut called fit_resamples().It takes the tree specification, tree_spec,the model formula,the resamples, or folds, chocolate_folds,and metrics that you want to assess.The metrics are bundled like a list using the metric_set() function.You already know MAE and RMSE.The result is the previous tibble with a new column dot-metrics containing the out-of-sample errors for every fold. Every result in the dot-metrics column has two rows because we asked for MAE and RMSE in the metric_set.</p>
<p><strong>12. Coding - Collect all errors</strong></p>
<p>There is a handy function that extracts all errors from the fitting results.collect_metrics() takes your CV results and an argument summarize, which specifies if you want to calculate summary statistics.The result is a tibble containing every error of every fold.Let’s draw a histogram using ggplot2 to visualize these errors. We use the dot-estimate as the x aesthetic and dot-metric as the fill variable.Without cross-validation, we would have only one of the red bars, that is one mean absolute error,and only one of the blue bars, that is one root mean squared error.See how useful cross-validation is for estimating model performance?</p>
<p><strong>13. Coding - Summarize training sessions</strong></p>
<p>Of course, you can specify summarize equals TRUE, which is the default in collect_metrics(). This results in a small tibble showing the name and the mean of the metric, and n, the number of errors that were calculated.n here equals 10, because we had 10 folds in our cross-validation, and the mean absolute out-of-sample error in this example is 0-point-383.</p>
<p><strong>14. Let’s cross-validate!</strong></p>
<p>Let’s practice cross-validating your model.</p>
</section>
<section id="create-the-folds" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="create-the-folds"><span class="header-section-number">2.11</span> Create the folds</h2>
<p>Splitting data only once into training and test sets has statistical insecurities - there is a small chance that your test set contains only high-rated beans, while all the low-rated beans are in your training set. It also means that you can only measure the performance of your model once.</p>
<p>Cross-validation gives you a more robust estimate of your out-of-sample performance without the statistical pitfalls - it assesses your model more profoundly.</p>
<p>In this exercise, you will create folds of your training data <code>chocolate_train</code>, which is pre-loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Set a seed of 20 for reproducibility.</li>
<li>Create 10 folds of <code>chocolate_train</code> and save the result as <code>chocolate_folds</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="fu">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb55-3"><a href="#cb55-3"></a></span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="co"># Build 10 folds</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>chocolate_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(chocolate_train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb55-6"><a href="#cb55-6"></a></span>
<span id="cb55-7"><a href="#cb55-7"></a>chocolate_folds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"<S3: vfold_split>","2":"Fold01"},{"1":"<S3: vfold_split>","2":"Fold02"},{"1":"<S3: vfold_split>","2":"Fold03"},{"1":"<S3: vfold_split>","2":"Fold04"},{"1":"<S3: vfold_split>","2":"Fold05"},{"1":"<S3: vfold_split>","2":"Fold06"},{"1":"<S3: vfold_split>","2":"Fold07"},{"1":"<S3: vfold_split>","2":"Fold08"},{"1":"<S3: vfold_split>","2":"Fold09"},{"1":"<S3: vfold_split>","2":"Fold10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Your fancy folds are almost as perfect as origami! Note that with k-fold CV, your result has <code>k</code> rows. Now let’s use these folds to fit some models.</p>
</section>
<section id="fit-the-folds" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="fit-the-folds"><span class="header-section-number">2.12</span> Fit the folds</h2>
<p>Now that you split your data into folds, it’s time to use them for model training and calculating the out-of-sample error of every single model. This way, you gain a balanced estimation of the performance of your model specification because you evaluated it out-of-sample several times.</p>
<p>Provided in your workspace is <code>chocolate_folds</code>, which you created in the last exercise (10 folds of the chocolate training set).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Show that you can still do it: create <code>tree_spec</code>, a regression tree specification using an <code>"rpart"</code> engine.</li>
<li>Use <code>fit_resamples()</code> to fit your folds to <code>tree_spec</code>, modeling <code>final_grade</code> using all other predictors and evaluating with both MAE and RMSE.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Create a specification</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3"></a>                <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>                <span class="fu">set_engine</span>(<span class="st">"rpart"</span>)</span>
<span id="cb56-5"><a href="#cb56-5"></a></span>
<span id="cb56-6"><a href="#cb56-6"></a><span class="co"># Fit all folds to the specification</span></span>
<span id="cb56-7"><a href="#cb56-7"></a>fits_cv <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(tree_spec,</span>
<span id="cb56-8"><a href="#cb56-8"></a>                         final_grade <span class="sc">~</span> .,</span>
<span id="cb56-9"><a href="#cb56-9"></a>                         <span class="at">resamples =</span> chocolate_folds,</span>
<span id="cb56-10"><a href="#cb56-10"></a>                         <span class="at">metrics =</span> <span class="fu">metric_set</span>(mae, rmse))</span>
<span id="cb56-11"><a href="#cb56-11"></a></span>
<span id="cb56-12"><a href="#cb56-12"></a>fits_cv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["splits"],"name":[1],"type":["list"],"align":["right"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".metrics"],"name":[3],"type":["list"],"align":["right"]},{"label":[".notes"],"name":[4],"type":["list"],"align":["right"]}],"data":[{"1":"<S3: vfold_split>","2":"Fold01","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold02","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold03","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold04","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold05","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold06","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold07","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold08","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold09","3":"<tibble[,4]>","4":"<tibble[,3]>"},{"1":"<S3: vfold_split>","2":"Fold10","3":"<tibble[,4]>","4":"<tibble[,3]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Adequate model automation! Note the result has one row per fold and every entry in the <code>.metrics</code> column has two nested rows, one for MAE and one for RMSE. That is a result of the <code>metrics</code> argument choice.</p>
</section>
<section id="evaluate-the-folds" class="level2" data-number="2.13">
<h2 data-number="2.13" class="anchored" data-anchor-id="evaluate-the-folds"><span class="header-section-number">2.13</span> Evaluate the folds</h2>
<p>Now that you fit 10 models using all 10 of your folds and calculated the MAE and RMSE of each of these models, it’s time to visualize how large the errors are. This way, you build an intuition of the out-of-sample error distribution, which is helpful in assessing your model quality.</p>
<p>You will plot all these errors as a histogram and display the summary statistics across all folds.</p>
<p>The result of the previous exercise, <code>fits_cv</code>, is pre-loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Collect the out-of-sample errors of all models of <code>fits_cv</code> using a single <code>yardstick</code> function and save them as <code>all_errors</code>.</li>
<li>Create a <code>ggplot2</code> histogram using the <code>.estimate</code> as the <code>x</code> aesthetic and <code>fill</code> the bars by <code>.metric</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co"># Collect the errors</span></span>
<span id="cb57-4"><a href="#cb57-4"></a>all_errors <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(fits_cv, <span class="at">summarize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-5"><a href="#cb57-5"></a></span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="co"># Plot an error histogram</span></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="fu">ggplot</span>(all_errors , <span class="fu">aes</span>(<span class="at">x =</span> .estimate, <span class="at">fill =</span> .metric)) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8"></a>        <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Use the same function as in the first instruction with <code>summarize = TRUE</code> to display summary statistics of <code>fits_cv</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Collect and print error statistics</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="fu">collect_metrics</span>(fits_cv, <span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"mae","2":"standard","3":"0.3753388","4":"10","5":"0.004691608","6":"Preprocessor1_Model1"},{"1":"rmse","2":"standard","3":"0.4665108","4":"10","5":"0.008589315","6":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Dashing display! You drew all of the errors as a histogram and summarized them in the console. See how RMSE and MAE differ across folds? Without cross-validation, you only would see one of these MAEs and one of these RMSEs.</p>
</section>
<section id="bias-variance-tradeoff" class="level2" data-number="2.14">
<h2 data-number="2.14" class="anchored" data-anchor-id="bias-variance-tradeoff"><span class="header-section-number">2.14</span> Bias-variance tradeoff</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Bias-variance tradeoff</strong></p>
<p>Now that we laid the foundations of modeling, you are going to use your new skills to understand a very important concept in machine learning.</p>
<p><strong>2. Hyperparameters</strong></p>
<p>When creating a model, the modeler - that’s you! - chooses parameters that define the learning process, the hyperparameters. One example is the tree depth, which controls how many splits are made until a decision is reached. Details are to be found in the documentation, like you see here. Stay tuned for chapter three, where we dive deeper into these hyperparameters!</p>
<p><strong>3. Impact on model complexity</strong></p>
<p>Using hyperparameters, you control how simple or complex the structure of your model is, as seen in these two examples. We fit a model which constructs 2 levels from the root to the leaf nodes (that’s what tree_depth means), and one with 15 levels to our training data. The impact on the final model is huge.</p>
<p><strong>4. Complex model - overfitting - high variance</strong></p>
<p>Imagine you want to predict the final_grade in your chocolate dataset. You build a very complex decision tree and find that it fits your training data surprisingly well. In this example, the mean absolute error, calculated by the mae() function, is only around 0-point-2.However, when you check your model on your test set, you observe very large errors. In this case, we say that your model over-fits the data.We call that effect ‘high variance’. Our very sophisticated decision tree learned the structure of the training data very well and cannot adapt to the different structure of the test set.</p>
<p><strong>5. Simple model - underfitting - high bias</strong></p>
<p>It’s easy to simplify your decision tree - for example by using only a few features or columns of the training set.After fitting the new tree and binding together the errors of training and test sets - ouch - all of a sudden you have large errors in both cases.The simple tree is not able to capture the complexity of the training or test set very well.You under-fit the data. We call that effect ‘high bias’.</p>
<p><strong>6. The bias-variance tradeoff</strong></p>
<p>This chart shows the relationship between these two observations. For very simple models we usually observe high bias and low variance. For overly complex models, we observe very low bias, but high variance.This tradeoff in complexity is called the bias-variance tradeoff. You need to find the right balance of model complexity without overfitting or underfitting the data: the sweet spot in the center.</p>
<p><strong>7. Detecting overfitting</strong></p>
<p>What does all this mean in practice?As you have learned in the previous lesson, cross-validation is great for using many training and test sets during model development without even touching the final test set.Suppose you fitted models on all your CV folds. By using the collect_metrics() function on your resampling results, you find a mean out-of-sample error of your folds of 2-point-4. You also fit the final model to the whole training set and measure the in-sample error (using the mae() function) of 0-point-2.As the CV error is much higher than the training error, we can deduce that your model suffers from overfitting. You should decrease the complexity of the tree, for example, by decreasing the number of features or the tree depth.</p>
<p><strong>8. Detecting underfitting</strong></p>
<p>Suppose now that you did that and re-fit your model to the whole training set. Again, you calculate your mean absolute in-sample error and see that this is very high. That’s a clear indicator that your model now suffers from underfitting. You did too much simplification and should increase the model’s complexity.</p>
<p><strong>9. Let’s trade off!</strong></p>
<p>If you think this is tricky, rest assured: you will understand this step by step in the exercises.</p>
</section>
<section id="call-things-by-their-names" class="level2" data-number="2.15">
<h2 data-number="2.15" class="anchored" data-anchor-id="call-things-by-their-names"><span class="header-section-number">2.15</span> Call things by their names</h2>
<p>Overfitting and underfitting both result in a model that performs poorly on test data, but the implications of each are different. In this exercise, you’ll classify model characteristics as symptoms of either overfitting or underfitting to better understand the bias-variance tradeoff.</p>
<p>Decide which characteristics represent overfitting and which characterize underfitting.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Overfitting</th>
<th>Underfitting</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Low in-sample error and high out-of-sample error</td>
<td>Large training set error</td>
</tr>
<tr class="even">
<td>High Variance</td>
<td>High Bias</td>
</tr>
<tr class="odd">
<td>Low training error and high CV error</td>
<td>Large in-sample-error</td>
</tr>
</tbody>
</table>
</section>
<section id="adjust-model-complexity" class="level2" data-number="2.16">
<h2 data-number="2.16" class="anchored" data-anchor-id="adjust-model-complexity"><span class="header-section-number">2.16</span> Adjust model complexity</h2>
<p>To make good predictions, you need to adjust the complexity of your model. Simple models can only represent simple data structures, while complex models can represent fine-grained data structures.</p>
<p>In this exercise, you are going to create trees of different complexities by altering the hyperparameters of a regression tree.</p>
<p>The training data <code>chocolate_train</code> is pre-loaded in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Grow a <em>decision stump</em>, a regression tree with only one split.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Create a model having only one split</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>chocolate_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="fu">fit</span>(final_grade <span class="sc">~</span> ., <span class="at">data =</span> chocolate_train)</span>
<span id="cb60-6"><a href="#cb60-6"></a>chocolate_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 1436 
#&gt; 
#&gt; node), split, n, deviance, yval
#&gt;       * denotes terminal node
#&gt; 
#&gt; 1) root 1436 323.452400 3.188196  
#&gt;   2) cocoa_percent&gt;=0.905 21   7.952381 2.297619 *
#&gt;   3) cocoa_percent&lt; 0.905 1415 298.597200 3.201413 *</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Grow a regression tree with a complexity cost of <code>0.1</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Create a model with high cost for complexity</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>chocolate_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-5"><a href="#cb62-5"></a>  <span class="fu">fit</span>(final_grade <span class="sc">~</span> ., <span class="at">data =</span> chocolate_train)</span>
<span id="cb62-6"><a href="#cb62-6"></a>chocolate_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 1436 
#&gt; 
#&gt; node), split, n, deviance, yval
#&gt;       * denotes terminal node
#&gt; 
#&gt; 1) root 1436 323.4524 3.188196 *</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Create a model that has <strong>no penalty</strong> for complexity, <strong>and</strong> a minimum sample size of <strong>2</strong>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Create a model that can grow arbitrarily complex</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>chocolate_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="dv">0</span>,</span>
<span id="cb64-3"><a href="#cb64-3"></a>                                 <span class="at">min_n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4"></a>        <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5"></a>        <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-6"><a href="#cb64-6"></a>        <span class="fu">fit</span>(final_grade <span class="sc">~</span> ., <span class="at">data =</span> chocolate_train)</span>
<span id="cb64-7"><a href="#cb64-7"></a>chocolate_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 1436 
#&gt; 
#&gt; node), split, n, deviance, yval
#&gt;       * denotes terminal node
#&gt; 
#&gt;         1) root 1436 323.45240000 3.188196  
#&gt;           2) cocoa_percent&gt;=0.905 21   7.95238100 2.297619  
#&gt;             4) review_date&lt; 2012.5 11   3.05681800 1.977273  
#&gt;               8) company_location=Ecuador,Germany,Italy,U.K. 6   0.21875000 1.625000  
#&gt;                16) review_date&gt;=2008.5 4   0.04687500 1.562500  
#&gt;                  32) company_location=Ecuador,Germany,Italy 3   0.00000000 1.500000 *
#&gt;                  33) company_location=U.K. 1   0.00000000 1.750000 *
#&gt;                17) review_date&lt; 2008.5 2   0.12500000 1.750000  
#&gt;                  34) cocoa_percent&lt; 0.955 1   0.00000000 1.500000 *
#&gt;                  35) cocoa_percent&gt;=0.955 1   0.00000000 2.000000 *
#&gt;               9) company_location=France,U.S.A. 5   1.20000000 2.400000  
#&gt;                18) review_date&lt; 2007.5 3   0.00000000 2.000000 *
#&gt;                19) review_date&gt;=2007.5 2   0.00000000 3.000000 *
#&gt;             5) review_date&gt;=2012.5 10   2.52500000 2.650000  
#&gt;              10) broad_bean_origin=Indonesia,St. Lucia 2   0.12500000 2.000000  
#&gt;                20) broad_bean_origin=St. Lucia 1   0.00000000 1.750000 *
#&gt;                21) broad_bean_origin=Indonesia 1   0.00000000 2.250000 *
#&gt;              11) broad_bean_origin=Dominican Republic,Ecuador,Madagascar,Samoa,Venezuela 8   1.34375000 2.812500  
#&gt;                22) company_location=Canada,New Zealand,U.K. 6   0.70833330 2.666667  
#&gt;                  44) review_date&lt; 2014.5 3   0.29166670 2.416667  
#&gt;                    88) review_date&gt;=2013.5 1   0.00000000 2.000000 *
#&gt;                    89) review_date&lt; 2013.5 2   0.03125000 2.625000  
#&gt;                     178) broad_bean_origin=Ecuador 1   0.00000000 2.500000 *
#&gt;                     179) broad_bean_origin=Dominican Republic 1   0.00000000 2.750000 *
#&gt;                  45) review_date&gt;=2014.5 3   0.04166667 2.916667  
#&gt;                    90) review_date&gt;=2015.5 1   0.00000000 2.750000 *
#&gt;                    91) review_date&lt; 2015.5 2   0.00000000 3.000000 *
#&gt;                23) company_location=Italy 2   0.12500000 3.250000  
#&gt;                  46) broad_bean_origin=Venezuela 1   0.00000000 3.000000 *
#&gt;                  47) broad_bean_origin=Ecuador 1   0.00000000 3.500000 *
#&gt;           3) cocoa_percent&lt; 0.905 1415 298.59720000 3.201413  
#&gt;             6) company_location=Belgium,Colombia,Czech Republic,Ecuador,Eucador,Grenada,Hungary,Ireland,Israel,Japan,Lithuania,Madagascar,Mexico,Niacragua,Nicaragua,Peru,Portugal,Puerto Rico,South Africa,South Korea,Spain,St. Lucia,Sweden,U.K.,U.S.A.,Venezuela 907 188.10780000 3.133407  
#&gt;              12) broad_bean_origin=Carribean,Colombia, Ecuador,Cost Rica, Ven,Costa Rica,Ecuador, Mad., PNG,Fiji,Ghana,Ghana, Domin. Rep,Ghana, Panama, Ecuador,Grenada,Indonesia,Ivory Coast,Jamaica,Liberia,Nicaragua,Peru,Peru(SMartin,Pangoa,nacional),Peru, Ecuador, Venezuela,Peru, Madagascar,Philippines,Principe,Puerto Rico,Sao Tome,Sri Lanka,Uganda,Ven., Trinidad, Mad.,Venezuela, Dom. Rep.,Venezuela, Trinidad,West Africa 231  49.96104000 2.987013  
#&gt;                24) broad_bean_origin=Cost Rica, Ven,Fiji,Ivory Coast,Peru, Madagascar,Principe,Puerto Rico,Sao Tome,Sri Lanka,Venezuela, Dom. Rep.,Venezuela, Trinidad,West Africa 19   1.78947400 2.605263  
#&gt;                  48) cocoa_percent&lt; 0.735 12   1.25000000 2.500000  
#&gt;                    96) cocoa_percent&gt;=0.6 10   0.63125000 2.425000  
#&gt;                     192) broad_bean_origin=West Africa 2   0.00000000 2.000000 *
#&gt;                     193) broad_bean_origin=Fiji,Ivory Coast,Puerto Rico,Sri Lanka,Venezuela, Trinidad 8   0.17968750 2.531250  
#&gt;                       386) cocoa_percent&lt; 0.675 3   0.04166667 2.416667  
#&gt;                         772) review_date&gt;=2013.5 1   0.00000000 2.250000 *
#&gt;                         773) review_date&lt; 2013.5 2   0.00000000 2.500000 *
#&gt;                       387) cocoa_percent&gt;=0.675 5   0.07500000 2.600000  
#&gt;                         774) company_location=Israel,Puerto Rico 2   0.00000000 2.500000 *
#&gt;                         775) company_location=Sweden,U.S.A. 3   0.04166667 2.666667  
#&gt;                          1550) cocoa_percent&gt;=0.715 1   0.00000000 2.500000 *
#&gt;                          1551) cocoa_percent&lt; 0.715 2   0.00000000 2.750000 *
#&gt;                    97) cocoa_percent&lt; 0.6 2   0.28125000 2.875000  
#&gt;                     194) review_date&lt; 2011.5 1   0.00000000 2.500000 *
#&gt;                     195) review_date&gt;=2011.5 1   0.00000000 3.250000 *
#&gt;                  49) cocoa_percent&gt;=0.735 7   0.17857140 2.785714  
#&gt;                    98) broad_bean_origin=Cost Rica, Ven,Ivory Coast,Principe,Sao Tome,Venezuela, Dom. Rep. 5   0.05000000 2.700000  
#&gt;                     196) broad_bean_origin=Ivory Coast 1   0.00000000 2.500000 *
#&gt;                     197) broad_bean_origin=Cost Rica, Ven,Principe,Sao Tome,Venezuela, Dom. Rep. 4   0.00000000 2.750000 *
#&gt;                    99) broad_bean_origin=Fiji,West Africa 2   0.00000000 3.000000 *
#&gt;                25) broad_bean_origin=Carribean,Colombia, Ecuador,Costa Rica,Ecuador, Mad., PNG,Ghana,Ghana, Domin. Rep,Ghana, Panama, Ecuador,Grenada,Indonesia,Jamaica,Liberia,Nicaragua,Peru,Peru(SMartin,Pangoa,nacional),Peru, Ecuador, Venezuela,Philippines,Uganda,Ven., Trinidad, Mad. 212  45.15448000 3.021226  
#&gt;                  50) review_date&lt; 2008.5 18   2.50000000 2.750000  
#&gt;                   100) cocoa_percent&lt; 0.715 12   1.29166700 2.583333  
#&gt;                     200) review_date&lt; 2006.5 2   0.00000000 2.000000 *
#&gt;                     201) review_date&gt;=2006.5 10   0.47500000 2.700000  
#&gt;                       402) cocoa_percent&gt;=0.67 6   0.05208333 2.541667  
#&gt;                         804) broad_bean_origin=Ghana,Grenada,Peru 5   0.00000000 2.500000 *
#&gt;                         805) broad_bean_origin=Jamaica 1   0.00000000 2.750000 *
#&gt;                       403) cocoa_percent&lt; 0.67 4   0.04687500 2.937500  
#&gt;                         806) review_date&gt;=2007.5 1   0.00000000 2.750000 *
#&gt;                         807) review_date&lt; 2007.5 3   0.00000000 3.000000 *
#&gt;                   101) cocoa_percent&gt;=0.715 6   0.20833330 3.083333  
#&gt;                     202) bean_type=Blend,Criollo,Forastero 5   0.00000000 3.000000 *
#&gt;                     203) bean_type=Trinitario 1   0.00000000 3.500000 *
#&gt;                  51) review_date&gt;=2008.5 194  41.20747000 3.046392  
#&gt;                   102) company_location=Colombia,Ireland,Lithuania,Niacragua,Peru,South Africa 22   4.07954500 2.795455  
#&gt;                     204) review_date&lt; 2014 16   3.10937500 2.718750  
#&gt;                       408) cocoa_percent&lt; 0.715 8   1.84375000 2.562500  
#&gt;                         816) cocoa_percent&gt;=0.675 2   0.50000000 2.000000  
#&gt;                          1632) review_date&lt; 2011.5 1   0.00000000 1.500000 *
#&gt;                          1633) review_date&gt;=2011.5 1   0.00000000 2.500000 *
#&gt;                         817) cocoa_percent&lt; 0.675 6   0.50000000 2.750000  
#&gt;                          1634) cocoa_percent&lt; 0.565 3   0.12500000 2.500000  
#&gt;                            3268) cocoa_percent&gt;=0.505 2   0.03125000 2.375000  
#&gt;                              6536) review_date&lt; 2011.5 1   0.00000000 2.250000 *
#&gt;                              6537) review_date&gt;=2011.5 1   0.00000000 2.500000 *
#&gt;                            3269) cocoa_percent&lt; 0.505 1   0.00000000 2.750000 *
#&gt;                          1635) cocoa_percent&gt;=0.565 3   0.00000000 3.000000 *
#&gt;                       409) cocoa_percent&gt;=0.715 8   0.87500000 2.875000  
#&gt;                         818) company_location=Ireland,Niacragua 4   0.04687500 2.687500  
#&gt;                          1636) review_date&gt;=2012.5 3   0.04166667 2.666667  
#&gt;                            3272) cocoa_percent&lt; 0.82 2   0.03125000 2.625000 *
#&gt;                            3273) cocoa_percent&gt;=0.82 1   0.00000000 2.750000 *
#&gt;                          1637) review_date&lt; 2012.5 1   0.00000000 2.750000 *
#&gt;                         819) company_location=Peru 4   0.54687500 3.062500  
#&gt;                          1638) cocoa_percent&lt; 0.735 3   0.29166670 2.916667  
#&gt;                            3276) review_date&lt; 2011.5 1   0.00000000 2.500000 *
#&gt;                            3277) review_date&gt;=2011.5 2   0.03125000 3.125000  
#&gt;                              6554) review_date&lt; 2012.5 1   0.00000000 3.000000 *
#&gt;                              6555) review_date&gt;=2012.5 1   0.00000000 3.250000 *
#&gt;                          1639) cocoa_percent&gt;=0.735 1   0.00000000 3.500000 *
#&gt;                     205) review_date&gt;=2014 6   0.62500000 3.000000  
#&gt;                       410) review_date&gt;=2015.5 5   0.32500000 2.900000  
#&gt;                         820) company_location=South Africa 1   0.00000000 2.500000 *
#&gt;                         821) company_location=Peru 4   0.12500000 3.000000 *
#&gt;                       411) review_date&lt; 2015.5 1   0.00000000 3.500000 *
#&gt;                   103) company_location=Belgium,Ecuador,Grenada,Hungary,Israel,Japan,Nicaragua,South Korea,Spain,Sweden,U.K.,U.S.A. 172  35.56541000 3.078488  
#&gt;                     206) company_location=Belgium,Grenada,Israel,Japan,Nicaragua,South Korea,Spain,Sweden,U.K.,U.S.A. 169  34.21746000 3.068047  
#&gt;                       412) bean_type=Trinitario, Criollo 1   0.00000000 2.250000 *
#&gt;                       413) bean_type=Amazon mix,Blend,Criollo,Criollo, Trinitario,Forastero,Forastero (Nacional),Forastero, Trinitario,Matina,Trinitario,Trinitario (Amelonado) 168  33.54427000 3.072917  
#&gt;                         826) cocoa_percent&lt; 0.605 6   0.17708330 2.791667  
#&gt;                          1652) bean_type=Forastero,Trinitario 5   0.12500000 2.750000 *
#&gt;                          1653) bean_type=Criollo 1   0.00000000 3.000000 *
#&gt;                         827) cocoa_percent&gt;=0.605 162  32.87500000 3.083333  
#&gt;                          1654) bean_type=Blend,Criollo,Criollo, Trinitario,Forastero,Forastero, Trinitario,Trinitario (Amelonado) 92  20.51291000 3.057065  
#&gt;                            3308) cocoa_percent&gt;=0.69 82  16.98780000 3.012195  
#&gt;                              6616) company_location=Nicaragua,Spain,Sweden,U.S.A. 68  15.01746000 2.974265  
#&gt;                               13232) review_date&lt; 2014.5 40   8.96093800 2.906250  
#&gt;                                 26464) broad_bean_origin=Ecuador, Mad., PNG,Ghana,Indonesia,Nicaragua,Peru,Peru, Ecuador, Venezuela 38   8.21710500 2.881579  
#&gt;                                   52928) review_date&gt;=2010.5 34   7.37683800 2.845588  
#&gt;                                    105856) broad_bean_origin=Ghana,Indonesia 3   0.04166667 2.583333  
#&gt;                                      211712) cocoa_percent&lt; 0.72 2   0.00000000 2.500000 *
#&gt;                                      211713) cocoa_percent&gt;=0.72 1   0.00000000 2.750000 *
#&gt;                                    105857) broad_bean_origin=Ecuador, Mad., PNG,Nicaragua,Peru,Peru, Ecuador, Venezuela 31   7.10887100 2.870968  
#&gt;                                      211714) cocoa_percent&gt;=0.71 17   3.52941200 2.794118  
#&gt;                                        423428) review_date&gt;=2012.5 10   0.90000000 2.650000  
#&gt;                                          846856) cocoa_percent&lt; 0.73 3   0.04166667 2.333333 *
#&gt;                                          846857) cocoa_percent&gt;=0.73 7   0.42857140 2.785714  
#&gt;                                           1693714) cocoa_percent&lt; 0.785 6   0.17708330 2.708333  
#&gt;                                             3387428) cocoa_percent&lt; 0.745 3   0.04166667 2.666667  
#&gt;                                               6774856) broad_bean_origin=Peru 2   0.03125000 2.625000 *
#&gt;                                               6774857) broad_bean_origin=Nicaragua 1   0.00000000 2.750000 *
#&gt;                                             3387429) cocoa_percent&gt;=0.745 3   0.12500000 2.750000 *
#&gt;                                           1693715) cocoa_percent&gt;=0.785 1   0.00000000 3.250000 *
#&gt;                                        423429) review_date&lt; 2012.5 7   2.12500000 3.000000  
#&gt;                                          846858) cocoa_percent&gt;=0.795 2   0.28125000 2.375000  
#&gt;                                           1693716) cocoa_percent&lt; 0.815 1   0.00000000 2.000000 *
#&gt;                                           1693717) cocoa_percent&gt;=0.815 1   0.00000000 2.750000 *
#&gt;                                          846859) cocoa_percent&lt; 0.795 5   0.75000000 3.250000  
#&gt;                                           1693718) cocoa_percent&lt; 0.765 4   0.04687500 3.062500  
#&gt;                                             3387436) cocoa_percent&lt; 0.73 2   0.00000000 3.000000 *
#&gt;                                             3387437) cocoa_percent&gt;=0.73 2   0.03125000 3.125000  
#&gt;                                               6774874) review_date&lt; 2011.5 1   0.00000000 3.000000 *
#&gt;                                               6774875) review_date&gt;=2011.5 1   0.00000000 3.250000 *
#&gt;                                           1693719) cocoa_percent&gt;=0.765 1   0.00000000 4.000000 *
#&gt;                                      211715) cocoa_percent&lt; 0.71 14   3.35714300 2.964286  
#&gt;                                        423430) review_date&lt; 2013.5 12   2.18750000 2.875000  
#&gt;                                          846860) review_date&lt; 2012.5 7   1.00000000 2.750000  
#&gt;                                           1693720) broad_bean_origin=Peru 3   0.29166670 2.416667  
#&gt;                                             3387440) review_date&gt;=2011.5 2   0.12500000 2.250000 *
#&gt;                                             3387441) review_date&lt; 2011.5 1   0.00000000 2.750000 *
#&gt;                                           1693721) broad_bean_origin=Ecuador, Mad., PNG,Nicaragua 4   0.12500000 3.000000 *
#&gt;                                          846861) review_date&gt;=2012.5 5   0.92500000 3.050000 *
#&gt;                                        423431) review_date&gt;=2013.5 2   0.50000000 3.500000  
#&gt;                                          846862) broad_bean_origin=Nicaragua 1   0.00000000 3.000000 *
#&gt;                                          846863) broad_bean_origin=Peru 1   0.00000000 4.000000 *
#&gt;                                   52929) review_date&lt; 2010.5 4   0.42187500 3.187500  
#&gt;                                    105858) broad_bean_origin=Ghana 3   0.00000000 3.000000 *
#&gt;                                    105859) broad_bean_origin=Peru 1   0.00000000 3.750000 *
#&gt;                                 26465) broad_bean_origin=Uganda 2   0.28125000 3.375000  
#&gt;                                   52930) cocoa_percent&lt; 0.715 1   0.00000000 3.000000 *
#&gt;                                   52931) cocoa_percent&gt;=0.715 1   0.00000000 3.750000 *
#&gt;                               13233) review_date&gt;=2014.5 28   5.60714300 3.071429  
#&gt;                                 26466) cocoa_percent&gt;=0.71 10   1.65625000 2.875000  
#&gt;                                   52932) cocoa_percent&lt; 0.76 3   0.66666670 2.666667  
#&gt;                                    105864) cocoa_percent&gt;=0.735 1   0.00000000 2.000000 *
#&gt;                                    105865) cocoa_percent&lt; 0.735 2   0.00000000 3.000000 *
#&gt;                                   52933) cocoa_percent&gt;=0.76 7   0.80357140 2.964286  
#&gt;                                    105866) review_date&gt;=2015.5 2   0.03125000 2.625000  
#&gt;                                      211732) cocoa_percent&gt;=0.85 1   0.00000000 2.500000 *
#&gt;                                      211733) cocoa_percent&lt; 0.85 1   0.00000000 2.750000 *
#&gt;                                    105867) review_date&lt; 2015.5 5   0.45000000 3.100000  
#&gt;                                      211734) broad_bean_origin=Nicaragua 3   0.37500000 3.000000 *
#&gt;                                      211735) broad_bean_origin=Peru 2   0.00000000 3.250000 *
#&gt;                                 26467) cocoa_percent&lt; 0.71 18   3.35069400 3.180556  
#&gt;                                   52934) broad_bean_origin=Ghana,Peru,Uganda 13   2.26923100 3.057692  
#&gt;                                    105868) review_date&gt;=2015.5 4   0.56250000 2.875000  
#&gt;                                      211736) review_date&lt; 2016.5 2   0.03125000 2.625000  
#&gt;                                        423472) broad_bean_origin=Peru 1   0.00000000 2.500000 *
#&gt;                                        423473) broad_bean_origin=Uganda 1   0.00000000 2.750000 *
#&gt;                                      211737) review_date&gt;=2016.5 2   0.28125000 3.125000 *
#&gt;                                    105869) review_date&lt; 2015.5 9   1.51388900 3.138889  
#&gt;                                      211738) bean_type=Forastero 8   1.09375000 3.062500  
#&gt;                                        423476) broad_bean_origin=Peru 6   0.50000000 3.000000 *
#&gt;                                        423477) broad_bean_origin=Ghana 2   0.50000000 3.250000 *
#&gt;                                      211739) bean_type=Criollo 1   0.00000000 3.750000 *
#&gt;                                   52935) broad_bean_origin=Nicaragua 5   0.37500000 3.500000  
#&gt;                                    105870) review_date&lt; 2015.5 3   0.16666670 3.333333 *
#&gt;                                    105871) review_date&gt;=2015.5 2   0.00000000 3.750000 *
#&gt;                              6617) company_location=Belgium,Israel,Japan,U.K. 14   1.39732100 3.196429  
#&gt;                               13234) review_date&gt;=2015.5 1   0.00000000 2.750000 *
#&gt;                               13235) review_date&lt; 2015.5 13   1.18269200 3.230769  
#&gt;                                 26470) cocoa_percent&lt; 0.755 10   0.75625000 3.175000  
#&gt;                                   52940) company_location=U.K. 6   0.42708330 3.041667  
#&gt;                                    105880) review_date&gt;=2014.5 1   0.00000000 2.750000 *
#&gt;                                    105881) review_date&lt; 2014.5 5   0.32500000 3.100000  
#&gt;                                      211762) broad_bean_origin=Peru 3   0.04166667 2.916667  
#&gt;                                        423524) review_date&gt;=2011.5 1   0.00000000 2.750000 *
#&gt;                                        423525) review_date&lt; 2011.5 2   0.00000000 3.000000 *
#&gt;                                      211763) broad_bean_origin=Nicaragua 2   0.03125000 3.375000  
#&gt;                                        423526) review_date&lt; 2012.5 1   0.00000000 3.250000 *
#&gt;                                        423527) review_date&gt;=2012.5 1   0.00000000 3.500000 *
#&gt;                                   52941) company_location=Belgium,Israel,Japan 4   0.06250000 3.375000  
#&gt;                                    105882) company_location=Japan 2   0.00000000 3.250000 *
#&gt;                                    105883) company_location=Belgium,Israel 2   0.00000000 3.500000 *
#&gt;                                 26471) cocoa_percent&gt;=0.755 3   0.29166670 3.416667  
#&gt;                                   52942) cocoa_percent&gt;=0.815 1   0.00000000 3.000000 *
#&gt;                                   52943) cocoa_percent&lt; 0.815 2   0.03125000 3.625000  
#&gt;                                    105886) review_date&gt;=2014.5 1   0.00000000 3.500000 *
#&gt;                                    105887) review_date&lt; 2014.5 1   0.00000000 3.750000 *
#&gt;                            3309) cocoa_percent&lt; 0.69 10   2.00625000 3.425000  
#&gt;                              6618) broad_bean_origin=Nicaragua 1   0.00000000 2.500000 *
#&gt;                              6619) broad_bean_origin=Ghana,Peru 9   1.05555600 3.527778  
#&gt;                               13238) review_date&gt;=2009.5 8   0.80468750 3.468750  
#&gt;                                 26476) broad_bean_origin=Ghana 2   0.28125000 3.125000  
#&gt;                                   52952) review_date&gt;=2011 1   0.00000000 2.750000 *
#&gt;                                   52953) review_date&lt; 2011 1   0.00000000 3.500000 *
#&gt;                                 26477) broad_bean_origin=Peru 6   0.20833330 3.583333  
#&gt;                                   52954) cocoa_percent&lt; 0.665 4   0.00000000 3.500000 *
#&gt;                                   52955) cocoa_percent&gt;=0.665 2   0.12500000 3.750000  
#&gt;                                    105910) review_date&gt;=2014 1   0.00000000 3.500000 *
#&gt;                                    105911) review_date&lt; 2014 1   0.00000000 4.000000 *
#&gt;                               13239) review_date&lt; 2009.5 1   0.00000000 4.000000 *
#&gt;                          1655) bean_type=Amazon mix,Forastero (Nacional),Matina,Trinitario 70  12.21518000 3.117857  
#&gt;                            3310) cocoa_percent&lt; 0.655 5   1.17500000 2.700000  
#&gt;                              6620) review_date&lt; 2013.5 4   0.37500000 2.500000  
#&gt;                               13240) review_date&lt; 2009.5 1   0.00000000 2.000000 *
#&gt;                               13241) review_date&gt;=2009.5 3   0.04166667 2.666667  
#&gt;                                 26482) review_date&gt;=2011 1   0.00000000 2.500000 *
#&gt;                                 26483) review_date&lt; 2011 2   0.00000000 2.750000 *
#&gt;                              6621) review_date&gt;=2013.5 1   0.00000000 3.500000 *
#&gt;                            3311) cocoa_percent&gt;=0.655 65  10.10000000 3.150000  
#&gt;                              6622) broad_bean_origin=Costa Rica,Ghana, Domin. Rep,Grenada,Jamaica,Liberia,Nicaragua,Peru(SMartin,Pangoa,nacional),Philippines 48   6.71744800 3.098958  
#&gt;                               13244) cocoa_percent&lt; 0.705 28   3.04241100 3.026786  
#&gt;                                 26488) broad_bean_origin=Ghana, Domin. Rep,Philippines 2   0.03125000 2.625000  
#&gt;                                   52976) review_date&gt;=2010.5 1   0.00000000 2.500000 *
#&gt;                                   52977) review_date&lt; 2010.5 1   0.00000000 2.750000 *
#&gt;                                 26489) broad_bean_origin=Costa Rica,Grenada,Jamaica,Liberia,Peru(SMartin,Pangoa,nacional) 26   2.66346200 3.057692  
#&gt;                                   52978) cocoa_percent&gt;=0.68 24   2.41406200 3.031250  
#&gt;                                    105956) company_location=U.K. 4   0.79687500 2.812500  
#&gt;                                      211912) review_date&lt; 2014.5 1   0.00000000 2.750000 *
#&gt;                                      211913) review_date&gt;=2014.5 3   0.79166670 2.833333 *
#&gt;                                    105957) company_location=South Korea,U.S.A. 20   1.38750000 3.075000  
#&gt;                                      211914) company_location=U.S.A. 17   1.27941200 3.044118  
#&gt;                                        423828) review_date&lt; 2010.5 3   0.29166670 2.916667  
#&gt;                                          847656) review_date&gt;=2009.5 1   0.00000000 2.500000 *
#&gt;                                          847657) review_date&lt; 2009.5 2   0.03125000 3.125000 *
#&gt;                                        423829) review_date&gt;=2010.5 14   0.92857140 3.071429  
#&gt;                                          847658) broad_bean_origin=Costa Rica,Liberia,Peru(SMartin,Pangoa,nacional) 12   0.72916670 3.041667  
#&gt;                                           1695316) review_date&lt; 2013.5 7   0.37500000 3.000000  
#&gt;                                             3390632) review_date&gt;=2012.5 1   0.00000000 2.750000 *
#&gt;                                             3390633) review_date&lt; 2012.5 6   0.30208330 3.041667  
#&gt;                                               6781266) review_date&gt;=2011.5 2   0.00000000 3.000000 *
#&gt;                                               6781267) review_date&lt; 2011.5 4   0.29687500 3.062500 *
#&gt;                                           1695317) review_date&gt;=2013.5 5   0.32500000 3.100000  
#&gt;                                             3390634) broad_bean_origin=Liberia,Peru(SMartin,Pangoa,nacional) 3   0.12500000 3.000000  
#&gt;                                               6781268) review_date&lt; 2015 1   0.00000000 2.750000 *
#&gt;                                               6781269) review_date&gt;=2015 2   0.03125000 3.125000  
#&gt;                                                13562538) broad_bean_origin=Peru(SMartin,Pangoa,nacional) 1   0.00000000 3.000000 *
#&gt;                                                13562539) broad_bean_origin=Liberia 1   0.00000000 3.250000 *
#&gt;                                             3390635) broad_bean_origin=Costa Rica 2   0.12500000 3.250000  
#&gt;                                               6781270) review_date&gt;=2014.5 1   0.00000000 3.000000 *
#&gt;                                               6781271) review_date&lt; 2014.5 1   0.00000000 3.500000 *
#&gt;                                          847659) broad_bean_origin=Jamaica 2   0.12500000 3.250000  
#&gt;                                           1695318) review_date&gt;=2012 1   0.00000000 3.000000 *
#&gt;                                           1695319) review_date&lt; 2012 1   0.00000000 3.500000 *
#&gt;                                      211915) company_location=South Korea 3   0.00000000 3.250000 *
#&gt;                                   52979) cocoa_percent&lt; 0.68 2   0.03125000 3.375000  
#&gt;                                    105958) review_date&lt; 2011.5 1   0.00000000 3.250000 *
#&gt;                                    105959) review_date&gt;=2011.5 1   0.00000000 3.500000 *
#&gt;                               13245) cocoa_percent&gt;=0.705 20   3.32500000 3.200000  
#&gt;                                 26490) review_date&gt;=2014 7   1.17857100 2.964286  
#&gt;                                   52980) cocoa_percent&gt;=0.745 5   0.67500000 2.800000  
#&gt;                                    105960) review_date&lt; 2015.5 3   0.04166667 2.583333  
#&gt;                                      211920) cocoa_percent&lt; 0.79 2   0.00000000 2.500000 *
#&gt;                                      211921) cocoa_percent&gt;=0.79 1   0.00000000 2.750000 *
#&gt;                                    105961) review_date&gt;=2015.5 2   0.28125000 3.125000  
#&gt;                                      211922) cocoa_percent&lt; 0.775 1   0.00000000 2.750000 *
#&gt;                                      211923) cocoa_percent&gt;=0.775 1   0.00000000 3.500000 *
#&gt;                                   52981) cocoa_percent&lt; 0.745 2   0.03125000 3.375000  
#&gt;                                    105962) review_date&lt; 2015.5 1   0.00000000 3.250000 *
#&gt;                                    105963) review_date&gt;=2015.5 1   0.00000000 3.500000 *
#&gt;                                 26491) review_date&lt; 2014 13   1.54807700 3.326923  
#&gt;                                   52982) broad_bean_origin=Ghana, Domin. Rep,Grenada,Liberia,Nicaragua,Philippines 7   0.55357140 3.214286  
#&gt;                                    105964) cocoa_percent&lt; 0.76 5   0.20000000 3.100000  
#&gt;                                      211928) broad_bean_origin=Ghana, Domin. Rep,Philippines 2   0.03125000 2.875000  
#&gt;                                        423856) review_date&gt;=2010.5 1   0.00000000 2.750000 *
#&gt;                                        423857) review_date&lt; 2010.5 1   0.00000000 3.000000 *
#&gt;                                      211929) broad_bean_origin=Grenada,Liberia,Nicaragua 3   0.00000000 3.250000 *
#&gt;                                    105965) cocoa_percent&gt;=0.76 2   0.12500000 3.500000  
#&gt;                                      211930) review_date&gt;=2009.5 1   0.00000000 3.250000 *
#&gt;                                      211931) review_date&lt; 2009.5 1   0.00000000 3.750000 *
#&gt;                                   52983) broad_bean_origin=Costa Rica,Jamaica 6   0.80208330 3.458333  
#&gt;                                    105966) review_date&lt; 2009.5 1   0.00000000 2.750000 *
#&gt;                                    105967) review_date&gt;=2009.5 5   0.20000000 3.600000  
#&gt;                                      211934) broad_bean_origin=Costa Rica 3   0.12500000 3.500000  
#&gt;                                        423868) cocoa_percent&lt; 0.735 1   0.00000000 3.250000 *
#&gt;                                        423869) cocoa_percent&gt;=0.735 2   0.03125000 3.625000  
#&gt;                                          847738) review_date&gt;=2010.5 1   0.00000000 3.500000 *
#&gt;                                          847739) review_date&lt; 2010.5 1   0.00000000 3.750000 *
#&gt;                                      211935) broad_bean_origin=Jamaica 2   0.00000000 3.750000 *
#&gt;                              6623) broad_bean_origin=Indonesia,Peru 17   2.90441200 3.294118  
#&gt;                               13246) cocoa_percent&gt;=0.71 6   0.42708330 3.041667  
#&gt;                                 26492) review_date&lt; 2009.5 1   0.00000000 2.750000 *
#&gt;                                 26493) review_date&gt;=2009.5 5   0.32500000 3.100000  
#&gt;                                   52986) broad_bean_origin=Peru 3   0.04166667 2.916667  
#&gt;                                    105972) review_date&lt; 2012.5 1   0.00000000 2.750000 *
#&gt;                                    105973) review_date&gt;=2012.5 2   0.00000000 3.000000 *
#&gt;                                   52987) broad_bean_origin=Indonesia 2   0.03125000 3.375000  
#&gt;                                    105974) cocoa_percent&gt;=0.735 1   0.00000000 3.250000 *
#&gt;                                    105975) cocoa_percent&lt; 0.735 1   0.00000000 3.500000 *
#&gt;                               13247) cocoa_percent&lt; 0.71 11   1.88636400 3.431818  
#&gt;                                 26494) review_date&gt;=2013.5 8   1.34375000 3.312500  
#&gt;                                   52988) company_location=U.K. 1   0.00000000 2.750000 *
#&gt;                                   52989) company_location=U.S.A. 7   0.98214290 3.392857  
#&gt;                                    105978) review_date&lt; 2014.5 3   0.16666670 3.333333 *
#&gt;                                    105979) review_date&gt;=2014.5 4   0.79687500 3.437500  
#&gt;                                      211958) review_date&gt;=2015.5 2   0.78125000 3.375000 *
#&gt;                                      211959) review_date&lt; 2015.5 2   0.00000000 3.500000 *
#&gt;                                 26495) review_date&lt; 2013.5 3   0.12500000 3.750000  
#&gt;                                   52990) bean_type=Forastero (Nacional) 1   0.00000000 3.500000 *
#&gt;                                   52991) bean_type=Trinitario 1   0.00000000 4.000000 *
#&gt;                     207) company_location=Ecuador,Hungary 3   0.29166670 3.666667  
#&gt;                       414) review_date&gt;=2012.5 1   0.00000000 3.250000 *
#&gt;                       415) review_date&lt; 2012.5 2   0.03125000 3.875000  
#&gt;                         830) company_location=Hungary 1   0.00000000 3.750000 *
#&gt;                         831) company_location=Ecuador 1   0.00000000 4.000000 *
#&gt;              13) broad_bean_origin=Belize,Bolivia,Brazil,Cameroon,Central and S. America,Colombia,Congo,Cuba,Domincan Republic,Dominican Republic,Ecuador,Ecuador, Costa Rica,Guatemala,Haiti,Hawaii,Honduras,Madagascar,Malaysia,Mexico,Nigeria,Panama,Papua New Guinea,Peru, Belize,Peru, Mad., Dom. Rep.,Sao Tome &amp; Principe,Solomon Islands,St. Lucia,Tanzania,Trinidad,Trinidad, Tobago,Venezuela,Venezuela, Java,Venezuela/ Ghana,Vietnam 676 131.50440000 3.183432  
#&gt;                26) cocoa_percent&gt;=0.755 108  17.56192000 2.997685  
#&gt;                  52) bean_type=Forastero (Arriba),Forastero (Arriba) ASS 12   2.30729200 2.604167  
#&gt;                   104) broad_bean_origin=Bolivia,Ecuador 11   1.43181800 2.522727  
#&gt;                     208) review_date&lt; 2007.5 1   0.00000000 2.000000 *
#&gt;                     209) review_date&gt;=2007.5 10   1.13125000 2.575000  
#&gt;                       418) cocoa_percent&lt; 0.835 6   0.58333330 2.416667  
#&gt;                         836) review_date&gt;=2008.5 1   0.00000000 2.000000 *
#&gt;                         837) review_date&lt; 2008.5 5   0.37500000 2.500000  
#&gt;                          1674) company_location=Ecuador 4   0.29687500 2.437500  
#&gt;                            3348) cocoa_percent&lt; 0.795 3   0.29166670 2.416667 *
#&gt;                            3349) cocoa_percent&gt;=0.795 1   0.00000000 2.500000 *
#&gt;                          1675) company_location=U.S.A. 1   0.00000000 2.750000 *
#&gt;                       419) cocoa_percent&gt;=0.835 4   0.17187500 2.812500 *
#&gt;                   105) broad_bean_origin=Dominican Republic 1   0.00000000 3.500000 *
#&gt;                  53) bean_type=Blend,Criollo,Criollo (Ocumare),Criollo, Forastero,Criollo, Trinitario,EET,Forastero,Forastero (Nacional),Trinitario 96  13.16406000 3.046875  
#&gt;                   106) broad_bean_origin=Domincan Republic,Dominican Republic,Guatemala,Hawaii,Honduras,Madagascar,Mexico,Trinidad,Venezuela 53   6.67924500 2.896226  
#&gt;                     212) company_location=Hungary,Madagascar,Portugal,Puerto Rico,U.K. 13   0.54807690 2.673077  
#&gt;                       424) company_location=Hungary,Portugal 3   0.04166667 2.416667  
#&gt;                         848) review_date&lt; 2014 2   0.03125000 2.375000  
#&gt;                          1696) cocoa_percent&lt; 0.8 1   0.00000000 2.250000 *
#&gt;                          1697) cocoa_percent&gt;=0.8 1   0.00000000 2.500000 *
#&gt;                         849) review_date&gt;=2014 1   0.00000000 2.500000 *
#&gt;                       425) company_location=Madagascar,Puerto Rico,U.K. 10   0.25000000 2.750000  
#&gt;                         850) broad_bean_origin=Dominican Republic 1   0.00000000 2.500000 *
#&gt;                         851) broad_bean_origin=Domincan Republic,Honduras,Madagascar,Venezuela 9   0.18055560 2.777778  
#&gt;                          1702) company_location=Madagascar,Puerto Rico 4   0.04687500 2.687500  
#&gt;                            3404) review_date&gt;=2010.5 2   0.03125000 2.625000  
#&gt;                              6808) review_date&lt; 2014 1   0.00000000 2.500000 *
#&gt;                              6809) review_date&gt;=2014 1   0.00000000 2.750000 *
#&gt;                            3405) review_date&lt; 2010.5 2   0.00000000 2.750000 *
#&gt;                          1703) company_location=U.K. 5   0.07500000 2.850000  
#&gt;                            3406) broad_bean_origin=Domincan Republic,Honduras 2   0.00000000 2.750000 *
#&gt;                            3407) broad_bean_origin=Madagascar,Venezuela 3   0.04166667 2.916667  
#&gt;                              6814) cocoa_percent&lt; 0.785 1   0.00000000 2.750000 *
#&gt;                              6815) cocoa_percent&gt;=0.785 2   0.00000000 3.000000 *
#&gt;                     213) company_location=Japan,U.S.A.,Venezuela 40   5.27343800 2.968750  
#&gt;                       426) broad_bean_origin=Hawaii,Mexico,Trinidad 3   0.04166667 2.666667  
#&gt;                         852) cocoa_percent&gt;=0.81 1   0.00000000 2.500000 *
#&gt;                         853) cocoa_percent&lt; 0.81 2   0.00000000 2.750000 *
#&gt;                       427) broad_bean_origin=Dominican Republic,Guatemala,Honduras,Madagascar,Venezuela 37   4.93581100 2.993243  
#&gt;                         854) company_location=Japan,U.S.A. 36   4.67187500 2.979167  
#&gt;                          1708) review_date&lt; 2013.5 14   1.71428600 2.892857  
#&gt;                            3416) cocoa_percent&lt; 0.845 11   0.76136360 2.818182  
#&gt;                              6832) review_date&gt;=2012.5 1   0.00000000 2.250000 *
#&gt;                              6833) review_date&lt; 2012.5 10   0.40625000 2.875000  
#&gt;                               13666) broad_bean_origin=Dominican Republic,Madagascar 3   0.12500000 2.750000  
#&gt;                                 27332) cocoa_percent&lt; 0.78 1   0.00000000 2.500000 *
#&gt;                                 27333) cocoa_percent&gt;=0.78 2   0.03125000 2.875000  
#&gt;                                   54666) review_date&lt; 2011.5 1   0.00000000 2.750000 *
#&gt;                                   54667) review_date&gt;=2011.5 1   0.00000000 3.000000 *
#&gt;                               13667) broad_bean_origin=Venezuela 7   0.21428570 2.928571  
#&gt;                                 27334) cocoa_percent&gt;=0.765 5   0.07500000 2.850000  
#&gt;                                   54668) cocoa_percent&gt;=0.805 2   0.00000000 2.750000 *
#&gt;                                   54669) cocoa_percent&lt; 0.805 3   0.04166667 2.916667  
#&gt;                                    109338) cocoa_percent&lt; 0.775 1   0.00000000 2.750000 *
#&gt;                                    109339) cocoa_percent&gt;=0.775 2   0.00000000 3.000000 *
#&gt;                                 27335) cocoa_percent&lt; 0.765 2   0.03125000 3.125000 *
#&gt;                            3417) cocoa_percent&gt;=0.845 3   0.66666670 3.166667  
#&gt;                              6834) cocoa_percent&gt;=0.87 1   0.00000000 2.500000 *
#&gt;                              6835) cocoa_percent&lt; 0.87 2   0.00000000 3.500000 *
#&gt;                          1709) review_date&gt;=2013.5 22   2.78693200 3.034091  
#&gt;                            3418) review_date&gt;=2014.5 16   1.35937500 2.968750  
#&gt;                              6836) cocoa_percent&lt; 0.81 14   1.05357100 2.928571  
#&gt;                               13672) cocoa_percent&gt;=0.795 5   0.42500000 2.800000  
#&gt;                                 27344) broad_bean_origin=Honduras,Madagascar 2   0.03125000 2.625000  
#&gt;                                   54688) review_date&gt;=2015.5 1   0.00000000 2.500000 *
#&gt;                                   54689) review_date&lt; 2015.5 1   0.00000000 2.750000 *
#&gt;                                 27345) broad_bean_origin=Dominican Republic,Venezuela 2   0.03125000 3.125000  
#&gt;                                   54690) review_date&gt;=2015.5 1   0.00000000 3.000000 *
#&gt;                                   54691) review_date&lt; 2015.5 1   0.00000000 3.250000 *
#&gt;                               13673) cocoa_percent&lt; 0.795 9   0.50000000 3.000000  
#&gt;                                 27346) broad_bean_origin=Guatemala,Madagascar,Venezuela 8   0.21875000 2.937500  
#&gt;                                   54692) review_date&lt; 2015.5 7   0.10714290 2.892857  
#&gt;                                    109384) bean_type=Trinitario 2   0.00000000 2.750000 *
#&gt;                                    109385) bean_type=Criollo 5   0.05000000 2.950000  
#&gt;                                      218770) company_location=U.S.A. 3   0.04166667 2.916667  
#&gt;                                        437540) cocoa_percent&gt;=0.765 2   0.03125000 2.875000 *
#&gt;                                        437541) cocoa_percent&lt; 0.765 1   0.00000000 3.000000 *
#&gt;                                      218771) company_location=Japan 2   0.00000000 3.000000 *
#&gt;                                   54693) review_date&gt;=2015.5 1   0.00000000 3.250000 *
#&gt;                                 27347) broad_bean_origin=Honduras 1   0.00000000 3.500000 *
#&gt;                              6837) cocoa_percent&gt;=0.81 2   0.12500000 3.250000  
#&gt;                               13674) review_date&lt; 2015.5 1   0.00000000 3.000000 *
#&gt;                               13675) review_date&gt;=2015.5 1   0.00000000 3.500000 *
#&gt;                            3419) review_date&lt; 2014.5 6   1.17708300 3.208333  
#&gt;                              6838) broad_bean_origin=Dominican Republic,Honduras 5   0.82500000 3.100000  
#&gt;                               13676) cocoa_percent&gt;=0.825 2   0.28125000 2.875000  
#&gt;                                 27352) cocoa_percent&lt; 0.875 1   0.00000000 2.500000 *
#&gt;                                 27353) cocoa_percent&gt;=0.875 1   0.00000000 3.250000 *
#&gt;                               13677) cocoa_percent&lt; 0.825 3   0.37500000 3.250000  
#&gt;                                 27354) cocoa_percent&lt; 0.785 1   0.00000000 3.000000 *
#&gt;                                 27355) cocoa_percent&gt;=0.785 2   0.28125000 3.375000 *
#&gt;                              6839) broad_bean_origin=Venezuela 1   0.00000000 3.750000 *
#&gt;                         855) company_location=Venezuela 1   0.00000000 3.500000 *
#&gt;                   107) broad_bean_origin=Belize,Bolivia,Brazil,Central and S. America,Colombia,Cuba,Ecuador,Sao Tome &amp; Principe,Venezuela/ Ghana,Vietnam 43   3.79941900 3.232558  
#&gt;                     214) broad_bean_origin=Belize,Bolivia,Brazil,Colombia,Ecuador,Sao Tome &amp; Principe,Vietnam 40   3.15000000 3.200000  
#&gt;                       428) review_date&lt; 2012.5 6   0.30208330 2.958333  
#&gt;                         856) company_location=Ecuador,U.S.A. 2   0.00000000 2.750000 *
#&gt;                         857) company_location=Nicaragua,Spain,U.K. 4   0.17187500 3.062500  
#&gt;                          1714) review_date&lt; 2009.5 1   0.00000000 2.750000 *
#&gt;                          1715) review_date&gt;=2009.5 3   0.04166667 3.166667  
#&gt;                            3430) company_location=U.K. 1   0.00000000 3.000000 *
#&gt;                            3431) company_location=Nicaragua,Spain 2   0.00000000 3.250000 *
#&gt;                       429) review_date&gt;=2012.5 34   2.43566200 3.242647  
#&gt;                         858) cocoa_percent&gt;=0.775 25   1.81500000 3.180000  
#&gt;                          1716) broad_bean_origin=Brazil,Colombia 3   0.16666670 2.916667  
#&gt;                            3432) cocoa_percent&lt; 0.825 2   0.00000000 2.750000 *
#&gt;                            3433) cocoa_percent&gt;=0.825 1   0.00000000 3.250000 *
#&gt;                          1717) broad_bean_origin=Belize,Bolivia,Ecuador,Vietnam 22   1.41193200 3.215909  
#&gt;                            3434) review_date&gt;=2015.5 5   0.42500000 3.050000  
#&gt;                              6868) cocoa_percent&gt;=0.875 1   0.00000000 2.750000 *
#&gt;                              6869) cocoa_percent&lt; 0.875 4   0.31250000 3.125000  
#&gt;                               13738) cocoa_percent&lt; 0.825 3   0.29166670 3.083333  
#&gt;                                 27476) cocoa_percent&gt;=0.79 1   0.00000000 3.000000 *
#&gt;                                 27477) cocoa_percent&lt; 0.79 2   0.28125000 3.125000 *
#&gt;                               13739) cocoa_percent&gt;=0.825 1   0.00000000 3.250000 *
#&gt;                            3435) review_date&lt; 2015.5 17   0.80882350 3.264706  
#&gt;                              6870) company_location=Belgium,U.K. 5   0.45000000 3.150000  
#&gt;                               13740) review_date&gt;=2013.5 2   0.03125000 2.875000  
#&gt;                                 27480) review_date&lt; 2014.5 1   0.00000000 2.750000 *
#&gt;                                 27481) review_date&gt;=2014.5 1   0.00000000 3.000000 *
#&gt;                               13741) review_date&lt; 2013.5 3   0.16666670 3.333333  
#&gt;                                 27482) cocoa_percent&gt;=0.86 1   0.00000000 3.000000 *
#&gt;                                 27483) cocoa_percent&lt; 0.86 2   0.00000000 3.500000 *
#&gt;                              6871) company_location=Ecuador,U.S.A. 12   0.26562500 3.312500  
#&gt;                               13742) broad_bean_origin=Belize,Bolivia 8   0.12500000 3.250000  
#&gt;                                 27484) review_date&lt; 2014.5 5   0.05000000 3.200000  
#&gt;                                   54968) review_date&gt;=2013.5 2   0.03125000 3.125000  
#&gt;                                    109936) cocoa_percent&lt; 0.85 1   0.00000000 3.000000 *
#&gt;                                    109937) cocoa_percent&gt;=0.85 1   0.00000000 3.250000 *
#&gt;                                   54969) review_date&lt; 2013.5 3   0.00000000 3.250000 *
#&gt;                                 27485) review_date&gt;=2014.5 3   0.04166667 3.333333  
#&gt;                                   54970) cocoa_percent&gt;=0.83 1   0.00000000 3.250000 *
#&gt;                                   54971) cocoa_percent&lt; 0.83 2   0.03125000 3.375000 *
#&gt;                               13743) broad_bean_origin=Ecuador 4   0.04687500 3.437500  
#&gt;                                 27486) review_date&lt; 2014.5 2   0.03125000 3.375000  
#&gt;                                   54972) cocoa_percent&gt;=0.805 1   0.00000000 3.250000 *
#&gt;                                   54973) cocoa_percent&lt; 0.805 1   0.00000000 3.500000 *
#&gt;                                 27487) review_date&gt;=2014.5 2   0.00000000 3.500000 *
#&gt;                         859) cocoa_percent&lt; 0.775 9   0.25000000 3.416667  
#&gt;                          1718) broad_bean_origin=Belize 1   0.00000000 3.000000 *
#&gt;                          1719) broad_bean_origin=Bolivia,Brazil,Colombia,Ecuador 8   0.05468750 3.468750  
#&gt;                            3438) review_date&lt; 2014.5 3   0.04166667 3.416667  
#&gt;                              6876) cocoa_percent&gt;=0.765 1   0.00000000 3.250000 *
#&gt;                              6877) cocoa_percent&lt; 0.765 2   0.00000000 3.500000 *
#&gt;                            3439) review_date&gt;=2014.5 5   0.00000000 3.500000 *
#&gt;                     215) broad_bean_origin=Central and S. America,Cuba,Venezuela/ Ghana 3   0.04166667 3.666667  
#&gt;                       430) review_date&lt; 2008.5 1   0.00000000 3.500000 *
#&gt;                       431) review_date&gt;=2008.5 2   0.00000000 3.750000 *
#&gt;                27) cocoa_percent&lt; 0.755 568 109.50780000 3.218750  
#&gt;                  54) cocoa_percent&lt; 0.645 46   4.55027200 2.983696  
#&gt;                   108) bean_type=Forastero (Nacional) 1   0.00000000 2.000000 *
#&gt;                   109) bean_type=Blend,Criollo,Forastero (Arriba),Forastero (Arriba) ASS,Trinitario 45   3.56111100 3.005556  
#&gt;                     218) review_date&gt;=2012.5 17   1.00735300 2.897059  
#&gt;                       436) broad_bean_origin=Bolivia,Ecuador,St. Lucia,Venezuela 7   0.30357140 2.714286  
#&gt;                         872) company_location=St. Lucia,U.S.A. 6   0.20833330 2.666667  
#&gt;                          1744) review_date&gt;=2013.5 3   0.04166667 2.583333  
#&gt;                            3488) review_date&lt; 2015 1   0.00000000 2.500000 *
#&gt;                            3489) review_date&gt;=2015 2   0.03125000 2.625000  
#&gt;                              6978) broad_bean_origin=Bolivia 1   0.00000000 2.500000 *
#&gt;                              6979) broad_bean_origin=Ecuador 1   0.00000000 2.750000 *
#&gt;                          1745) review_date&lt; 2013.5 3   0.12500000 2.750000  
#&gt;                            3490) broad_bean_origin=Venezuela 1   0.00000000 2.500000 *
#&gt;                            3491) broad_bean_origin=Bolivia,St. Lucia 2   0.03125000 2.875000  
#&gt;                              6982) company_location=St. Lucia 1   0.00000000 2.750000 *
#&gt;                              6983) company_location=U.S.A. 1   0.00000000 3.000000 *
#&gt;                         873) company_location=Venezuela 1   0.00000000 3.000000 *
#&gt;                       437) broad_bean_origin=Dominican Republic,Madagascar,Papua New Guinea,Vietnam 10   0.30625000 3.025000  
#&gt;                         874) cocoa_percent&gt;=0.625 2   0.00000000 2.750000 *
#&gt;                         875) cocoa_percent&lt; 0.625 8   0.11718750 3.093750  
#&gt;                          1750) broad_bean_origin=Dominican Republic 4   0.00000000 3.000000 *
#&gt;                          1751) broad_bean_origin=Madagascar,Papua New Guinea,Vietnam 4   0.04687500 3.187500  
#&gt;                            3502) company_location=U.S.A. 2   0.03125000 3.125000 *
#&gt;                            3503) company_location=Japan 2   0.00000000 3.250000 *
#&gt;                     219) review_date&lt; 2012.5 28   2.23214300 3.071429  
#&gt;                       438) review_date&lt; 2011.5 27   2.04166700 3.055556  
#&gt;                         876) broad_bean_origin=Ecuador,Hawaii,Papua New Guinea,Venezuela 26   1.83653800 3.038462  
#&gt;                          1752) company_location=Belgium,Venezuela 3   0.04166667 2.833333  
#&gt;                            3504) review_date&gt;=2008.5 2   0.00000000 2.750000 *
#&gt;                            3505) review_date&lt; 2008.5 1   0.00000000 3.000000 *
#&gt;                          1753) company_location=Ecuador,Spain,U.S.A. 23   1.65217400 3.065217  
#&gt;                            3506) bean_type=Criollo,Forastero (Arriba) 18   1.40625000 3.041667  
#&gt;                              7012) cocoa_percent&lt; 0.625 15   1.18333300 3.016667  
#&gt;                               14024) cocoa_percent&gt;=0.575 8   0.46875000 2.937500  
#&gt;                                 28048) company_location=Ecuador 1   0.00000000 2.500000 *
#&gt;                                 28049) company_location=Spain,U.S.A. 7   0.25000000 3.000000  
#&gt;                                   56098) company_location=U.S.A. 6   0.17708330 2.958333  
#&gt;                                    112196) cocoa_percent&lt; 0.605 2   0.03125000 2.875000 *
#&gt;                                    112197) cocoa_percent&gt;=0.605 4   0.12500000 3.000000  
#&gt;                                      224394) cocoa_percent&gt;=0.615 2   0.03125000 2.875000  
#&gt;                                        448788) review_date&gt;=2009 1   0.00000000 2.750000 *
#&gt;                                        448789) review_date&lt; 2009 1   0.00000000 3.000000 *
#&gt;                                      224395) cocoa_percent&lt; 0.615 2   0.03125000 3.125000  
#&gt;                                        448790) review_date&lt; 2010 1   0.00000000 3.000000 *
#&gt;                                        448791) review_date&gt;=2010 1   0.00000000 3.250000 *
#&gt;                                   56099) company_location=Spain 1   0.00000000 3.250000 *
#&gt;                               14025) cocoa_percent&lt; 0.575 7   0.60714290 3.107143  
#&gt;                                 28050) review_date&gt;=2008.5 4   0.37500000 3.000000  
#&gt;                                   56100) company_location=Ecuador 2   0.00000000 2.750000 *
#&gt;                                   56101) company_location=U.S.A. 2   0.12500000 3.250000  
#&gt;                                    112202) review_date&lt; 2009.5 1   0.00000000 3.000000 *
#&gt;                                    112203) review_date&gt;=2009.5 1   0.00000000 3.500000 *
#&gt;                                 28051) review_date&lt; 2008.5 3   0.12500000 3.250000 *
#&gt;                              7013) cocoa_percent&gt;=0.625 3   0.16666670 3.166667  
#&gt;                               14026) cocoa_percent&gt;=0.635 2   0.00000000 3.000000 *
#&gt;                               14027) cocoa_percent&lt; 0.635 1   0.00000000 3.500000 *
#&gt;                            3507) bean_type=Blend,Forastero (Arriba) ASS 5   0.20000000 3.150000  
#&gt;                              7014) broad_bean_origin=Hawaii 1   0.00000000 3.000000 *
#&gt;                              7015) broad_bean_origin=Ecuador 1   0.00000000 3.250000 *
#&gt;                         877) broad_bean_origin=Madagascar 1   0.00000000 3.500000 *
#&gt;                       439) review_date&gt;=2011.5 1   0.00000000 3.500000 *
#&gt;                  55) cocoa_percent&gt;=0.645 522 102.19200000 3.239464  
#&gt;                   110) broad_bean_origin=Belize,Bolivia,Brazil,Cameroon,Colombia,Congo,Domincan Republic,Dominican Republic,Ecuador,Ecuador, Costa Rica,Hawaii,Madagascar,Malaysia,Mexico,Nigeria,Panama,Papua New Guinea,St. Lucia,Tanzania,Trinidad,Venezuela,Vietnam 498  97.38617000 3.225402  
#&gt;                     220) company_location=Belgium,Eucador,Lithuania,Mexico,South Africa,South Korea,U.K. 58  26.46983000 3.051724  
#&gt;                       440) review_date&lt; 2009.5 16  17.73438000 2.718750  
#&gt;                         880) broad_bean_origin=Brazil,Ecuador,Mexico,Tanzania 10   9.93125000 2.525000  
#&gt;                          1760) review_date&gt;=2006.5 9   7.51388900 2.361111  
#&gt;                            3520) review_date&lt; 2007.5 3   5.04166700 1.916667  
#&gt;                              7040) cocoa_percent&lt; 0.71 1   0.00000000 1.000000 *
#&gt;                              7041) cocoa_percent&gt;=0.71 2   3.78125000 2.375000  
#&gt;                               14082) cocoa_percent&gt;=0.725 1   0.00000000 1.000000 *
#&gt;                               14083) cocoa_percent&lt; 0.725 1   0.00000000 3.750000 *
#&gt;                            3521) review_date&gt;=2007.5 6   1.58333300 2.583333  
#&gt;                              7042) company_location=Mexico,U.K. 4   1.06250000 2.375000  
#&gt;                               14084) cocoa_percent&gt;=0.71 3   0.54166670 2.166667  
#&gt;                                 28168) review_date&gt;=2008.5 2   0.03125000 1.875000  
#&gt;                                   56336) company_location=U.K. 1   0.00000000 1.750000 *
#&gt;                                   56337) company_location=Mexico 1   0.00000000 2.000000 *
#&gt;                                 28169) review_date&lt; 2008.5 1   0.00000000 2.750000 *
#&gt;                               14085) cocoa_percent&lt; 0.71 1   0.00000000 3.000000 *
#&gt;                              7043) company_location=Belgium 2   0.00000000 3.000000 *
#&gt;                          1761) review_date&lt; 2006.5 1   0.00000000 4.000000 *
#&gt;                         881) broad_bean_origin=Madagascar,Trinidad,Venezuela 6   6.80208300 3.041667  
#&gt;                          1762) cocoa_percent&lt; 0.715 4   4.04687500 2.562500  
#&gt;                            3524) review_date&lt; 2007 3   2.16666700 2.166667  
#&gt;                              7048) cocoa_percent&lt; 0.705 2   1.12500000 1.750000  
#&gt;                               14096) company_location=Belgium 1   0.00000000 1.000000 *
#&gt;                               14097) company_location=U.K. 1   0.00000000 2.500000 *
#&gt;                              7049) cocoa_percent&gt;=0.705 1   0.00000000 3.000000 *
#&gt;                            3525) review_date&gt;=2007 1   0.00000000 3.750000 *
#&gt;                          1763) cocoa_percent&gt;=0.715 2   0.00000000 4.000000 *
#&gt;                       441) review_date&gt;=2009.5 42   6.28571400 3.178571  
#&gt;                         882) company_location=Eucador,Lithuania,Mexico,South Africa,South Korea 7   0.23214290 2.857143  
#&gt;                          1764) company_location=South Africa,South Korea 3   0.12500000 2.750000  
#&gt;                            3528) review_date&lt; 2014.5 1   0.00000000 2.500000 *
#&gt;                            3529) review_date&gt;=2014.5 2   0.03125000 2.875000  
#&gt;                              7058) review_date&lt; 2015.5 1   0.00000000 2.750000 *
#&gt;                              7059) review_date&gt;=2015.5 1   0.00000000 3.000000 *
#&gt;                          1765) company_location=Eucador,Lithuania,Mexico 4   0.04687500 2.937500  
#&gt;                            3530) cocoa_percent&gt;=0.745 2   0.03125000 2.875000  
#&gt;                              7060) review_date&gt;=2012 1   0.00000000 2.750000 *
#&gt;                              7061) review_date&lt; 2012 1   0.00000000 3.000000 *
#&gt;                            3531) cocoa_percent&lt; 0.745 2   0.00000000 3.000000 *
#&gt;                         883) company_location=Belgium,U.K. 35   5.18571400 3.242857  
#&gt;                          1766) broad_bean_origin=Domincan Republic,Panama,Papua New Guinea 4   0.29687500 2.812500  
#&gt;                            3532) review_date&lt; 2012.5 2   0.03125000 2.625000  
#&gt;                              7064) review_date&lt; 2010.5 1   0.00000000 2.500000 *
#&gt;                              7065) review_date&gt;=2010.5 1   0.00000000 2.750000 *
#&gt;                            3533) review_date&gt;=2012.5 2   0.12500000 3.000000  
#&gt;                              7066) review_date&gt;=2014.5 1   0.00000000 2.750000 *
#&gt;                              7067) review_date&lt; 2014.5 1   0.00000000 3.250000 *
#&gt;                          1767) broad_bean_origin=Cameroon,Colombia,Dominican Republic,Ecuador,Madagascar,Malaysia,St. Lucia,Trinidad,Venezuela 31   4.05241900 3.298387  
#&gt;                            3534) broad_bean_origin=Cameroon,Dominican Republic,Ecuador,Madagascar,Malaysia,St. Lucia,Trinidad,Venezuela 30   3.54375000 3.275000  
#&gt;                              7068) company_location=U.K. 21   2.36309500 3.190476  
#&gt;                               14136) cocoa_percent&gt;=0.725 3   0.04166667 2.916667  
#&gt;                                 28272) broad_bean_origin=Venezuela 1   0.00000000 2.750000 *
#&gt;                                 28273) broad_bean_origin=Ecuador,Malaysia 2   0.00000000 3.000000 *
#&gt;                               14137) cocoa_percent&lt; 0.725 18   2.05902800 3.236111  
#&gt;                                 28274) review_date&lt; 2010.5 4   0.37500000 3.000000  
#&gt;                                   56548) cocoa_percent&lt; 0.715 3   0.04166667 2.833333  
#&gt;                                    113096) cocoa_percent&lt; 0.705 2   0.00000000 2.750000 *
#&gt;                                    113097) cocoa_percent&gt;=0.705 1   0.00000000 3.000000 *
#&gt;                                   56549) cocoa_percent&gt;=0.715 1   0.00000000 3.500000 *
#&gt;                                 28275) review_date&gt;=2010.5 14   1.39732100 3.303571  
#&gt;                                   56550) broad_bean_origin=Madagascar,Malaysia,St. Lucia,Trinidad 9   0.97222220 3.194444  
#&gt;                                    113100) review_date&gt;=2014.5 3   0.12500000 3.000000  
#&gt;                                      226200) review_date&lt; 2016 2   0.03125000 2.875000  
#&gt;                                        452400) broad_bean_origin=St. Lucia 1   0.00000000 2.750000 *
#&gt;                                        452401) broad_bean_origin=Trinidad 1   0.00000000 3.000000 *
#&gt;                                      226201) review_date&gt;=2016 1   0.00000000 3.250000 *
#&gt;                                    113101) review_date&lt; 2014.5 6   0.67708330 3.291667  
#&gt;                                      226202) cocoa_percent&gt;=0.71 3   0.04166667 3.166667  
#&gt;                                        452404) review_date&lt; 2013.5 2   0.03125000 3.125000  
#&gt;                                          904808) broad_bean_origin=Madagascar 1   0.00000000 3.000000 *
#&gt;                                          904809) broad_bean_origin=Trinidad 1   0.00000000 3.250000 *
#&gt;                                        452405) review_date&gt;=2013.5 1   0.00000000 3.250000 *
#&gt;                                      226203) cocoa_percent&lt; 0.71 3   0.54166670 3.416667  
#&gt;                                        452406) review_date&lt; 2012 2   0.03125000 3.125000 *
#&gt;                                        452407) review_date&gt;=2012 1   0.00000000 4.000000 *
#&gt;                                   56551) broad_bean_origin=Dominican Republic,Ecuador,Venezuela 5   0.12500000 3.500000  
#&gt;                                    113102) cocoa_percent&lt; 0.715 4   0.04687500 3.437500  
#&gt;                                      226204) review_date&gt;=2013 2   0.03125000 3.375000 *
#&gt;                                      226205) review_date&lt; 2013 2   0.00000000 3.500000 *
#&gt;                                    113103) cocoa_percent&gt;=0.715 1   0.00000000 3.750000 *
#&gt;                              7069) company_location=Belgium 9   0.68055560 3.472222  
#&gt;                               14138) broad_bean_origin=Cameroon,Trinidad,Venezuela 5   0.17500000 3.300000  
#&gt;                                 28276) cocoa_percent&gt;=0.745 2   0.03125000 3.125000  
#&gt;                                   56552) bean_type=Criollo 1   0.00000000 3.000000 *
#&gt;                                   56553) bean_type=Trinitario 1   0.00000000 3.250000 *
#&gt;                                 28277) cocoa_percent&lt; 0.745 3   0.04166667 3.416667  
#&gt;                                   56554) review_date&gt;=2014 1   0.00000000 3.250000 *
#&gt;                                   56555) review_date&lt; 2014 2   0.00000000 3.500000 *
#&gt;                               14139) broad_bean_origin=Ecuador,Madagascar 4   0.17187500 3.687500  
#&gt;                                 28278) cocoa_percent&lt; 0.715 2   0.00000000 3.500000 *
#&gt;                                 28279) cocoa_percent&gt;=0.715 2   0.03125000 3.875000  
#&gt;                                   56558) review_date&lt; 2012 1   0.00000000 3.750000 *
#&gt;                                   56559) review_date&gt;=2012 1   0.00000000 4.000000 *
#&gt;                            3535) broad_bean_origin=Colombia 1   0.00000000 4.000000 *
#&gt;                     221) company_location=Colombia,Ecuador,Hungary,Israel,Japan,Madagascar,Spain,St. Lucia,Sweden,U.S.A.,Venezuela 440  68.93622000 3.248295  
#&gt;                       442) cocoa_percent&gt;=0.705 167  28.74102000 3.163174  
#&gt;                         884) bean_type=Blend,Criollo,Criollo, Trinitario,Forastero,Forastero (Arriba),Forastero (Arriba) ASS,Forastero (Nacional),Trinitario 163  27.31748000 3.150307  
#&gt;                          1768) broad_bean_origin=Bolivia,Brazil,Congo,Domincan Republic,Hawaii,Mexico,Venezuela 50   9.78125000 3.025000  
#&gt;                            3536) review_date&lt; 2012.5 24   4.36458300 2.895833  
#&gt;                              7072) company_location=Hungary,U.S.A.,Venezuela 21   3.39285700 2.821429  
#&gt;                               14144) review_date&gt;=2007.5 20   2.48750000 2.775000  
#&gt;                                 28288) broad_bean_origin=Bolivia,Brazil,Hawaii,Mexico 10   1.40000000 2.650000  
#&gt;                                   56576) cocoa_percent&gt;=0.725 7   0.92857140 2.535714  
#&gt;                                    113152) cocoa_percent&lt; 0.74 2   0.12500000 2.250000 *
#&gt;                                    113153) cocoa_percent&gt;=0.74 5   0.57500000 2.650000  
#&gt;                                      226306) review_date&gt;=2011.5 2   0.28125000 2.375000 *
#&gt;                                      226307) review_date&lt; 2011.5 3   0.04166667 2.833333  
#&gt;                                        452614) review_date&lt; 2010.5 2   0.00000000 2.750000 *
#&gt;                                        452615) review_date&gt;=2010.5 1   0.00000000 3.000000 *
#&gt;                                   56577) cocoa_percent&lt; 0.725 3   0.16666670 2.916667  
#&gt;                                    113154) review_date&lt; 2011 1   0.00000000 2.750000 *
#&gt;                                    113155) review_date&gt;=2011 2   0.12500000 3.000000 *
#&gt;                                 28289) broad_bean_origin=Venezuela 10   0.77500000 2.900000  
#&gt;                                   56578) company_location=Venezuela 1   0.00000000 2.500000 *
#&gt;                                   56579) company_location=Hungary,U.S.A. 9   0.59722220 2.944444  
#&gt;                                    113158) bean_type=Trinitario 3   0.04166667 2.916667  
#&gt;                                      226316) cocoa_percent&lt; 0.74 1   0.00000000 2.750000 *
#&gt;                                      226317) cocoa_percent&gt;=0.74 2   0.00000000 3.000000 *
#&gt;                                    113159) bean_type=Criollo 6   0.55208330 2.958333  
#&gt;                                      226318) cocoa_percent&lt; 0.725 4   0.17187500 2.812500  
#&gt;                                        452636) review_date&gt;=2010.5 2   0.03125000 2.625000  
#&gt;                                          905272) cocoa_percent&lt; 0.715 1   0.00000000 2.500000 *
#&gt;                                          905273) cocoa_percent&gt;=0.715 1   0.00000000 2.750000 *
#&gt;                                        452637) review_date&lt; 2010.5 2   0.00000000 3.000000 *
#&gt;                                      226319) cocoa_percent&gt;=0.725 2   0.12500000 3.250000  
#&gt;                                        452638) review_date&lt; 2010.5 1   0.00000000 3.000000 *
#&gt;                                        452639) review_date&gt;=2010.5 1   0.00000000 3.500000 *
#&gt;                               14145) review_date&lt; 2007.5 1   0.00000000 3.750000 *
#&gt;                              7073) company_location=Spain 3   0.04166667 3.416667  
#&gt;                               14146) broad_bean_origin=Mexico 1   0.00000000 3.250000 *
#&gt;                               14147) broad_bean_origin=Venezuela 2   0.00000000 3.500000 *
#&gt;                            3537) review_date&gt;=2012.5 26   4.64663500 3.144231  
#&gt;                              7074) broad_bean_origin=Brazil,Congo,Domincan Republic,Venezuela 16   2.23437500 3.031250  
#&gt;                               14148) review_date&gt;=2015.5 4   0.17187500 2.812500  
#&gt;                                 28296) cocoa_percent&gt;=0.745 1   0.00000000 2.500000 *
#&gt;                                 28297) cocoa_percent&lt; 0.745 3   0.04166667 2.916667  
#&gt;                                   56594) cocoa_percent&lt; 0.715 1   0.00000000 2.750000 *
#&gt;                                   56595) cocoa_percent&gt;=0.715 2   0.00000000 3.000000 *
#&gt;                               14149) review_date&lt; 2015.5 12   1.80729200 3.104167  
#&gt;                                 28298) review_date&lt; 2014.5 5   0.32500000 2.850000  
#&gt;                                   56596) cocoa_percent&gt;=0.745 1   0.00000000 2.500000 *
#&gt;                                   56597) cocoa_percent&lt; 0.745 4   0.17187500 2.937500  
#&gt;                                    113194) company_location=U.S.A. 3   0.04166667 2.833333  
#&gt;                                      226388) review_date&gt;=2013.5 2   0.00000000 2.750000 *
#&gt;                                      226389) review_date&lt; 2013.5 1   0.00000000 3.000000 *
#&gt;                                    113195) company_location=Venezuela 1   0.00000000 3.250000 *
#&gt;                                 28299) review_date&gt;=2014.5 7   0.92857140 3.285714  
#&gt;                                   56598) broad_bean_origin=Brazil,Congo 3   0.37500000 3.000000  
#&gt;                                    113196) cocoa_percent&gt;=0.745 2   0.00000000 2.750000 *
#&gt;                                    113197) cocoa_percent&lt; 0.745 1   0.00000000 3.500000 *
#&gt;                                   56599) broad_bean_origin=Venezuela 4   0.12500000 3.500000  
#&gt;                                    113198) company_location=Venezuela 1   0.00000000 3.250000 *
#&gt;                                    113199) company_location=U.S.A. 3   0.04166667 3.583333  
#&gt;                                      226398) cocoa_percent&lt; 0.745 2   0.00000000 3.500000 *
#&gt;                                      226399) cocoa_percent&gt;=0.745 1   0.00000000 3.750000 *
#&gt;                              7075) broad_bean_origin=Bolivia,Hawaii 10   1.88125000 3.325000  
#&gt;                               14150) cocoa_percent&lt; 0.715 1   0.00000000 3.000000 *
#&gt;                               14151) cocoa_percent&gt;=0.715 9   1.76388900 3.361111  
#&gt;                                 28302) broad_bean_origin=Bolivia 5   1.25000000 3.250000 *
#&gt;                                 28303) broad_bean_origin=Hawaii 4   0.37500000 3.500000  
#&gt;                                   56606) cocoa_percent&lt; 0.735 3   0.29166670 3.416667  
#&gt;                                    113212) review_date&lt; 2014.5 2   0.28125000 3.375000 *
#&gt;                                    113213) review_date&gt;=2014.5 1   0.00000000 3.500000 *
#&gt;                                   56607) cocoa_percent&gt;=0.735 1   0.00000000 3.750000 *
#&gt;                          1769) broad_bean_origin=Belize,Colombia,Dominican Republic,Ecuador,Madagascar,Panama,Papua New Guinea,Tanzania,Trinidad,Vietnam 113  16.40376000 3.205752  
#&gt;                            3538) company_location=Ecuador,Madagascar,Spain,U.S.A. 108  15.20081000 3.192130  
#&gt;                              7076) bean_type=Blend,Criollo, Trinitario,Forastero (Arriba),Forastero (Arriba) ASS,Trinitario 105  14.46429000 3.178571  
#&gt;                               14152) broad_bean_origin=Belize,Colombia,Dominican Republic,Ecuador,Papua New Guinea,Tanzania 75  10.77167000 3.143333  
#&gt;                                 28304) company_location=Spain 1   0.00000000 2.500000 *
#&gt;                                 28305) company_location=Ecuador,U.S.A. 74  10.35220000 3.152027  
#&gt;                                   56610) bean_type=Forastero (Arriba) ASS,Trinitario 62   8.93246000 3.149194  
#&gt;                                    113220) review_date&lt; 2009.5 3   0.16666670 2.833333  
#&gt;                                      226440) broad_bean_origin=Tanzania 1   0.00000000 2.500000 *
#&gt;                                      226441) broad_bean_origin=Dominican Republic,Ecuador 2   0.00000000 3.000000 *
#&gt;                                    113221) review_date&gt;=2009.5 59   8.45127100 3.165254  
#&gt;                                      226442) broad_bean_origin=Colombia 1   0.00000000 2.750000 *
#&gt;                                      226443) broad_bean_origin=Belize,Dominican Republic,Ecuador,Papua New Guinea,Tanzania 58   8.27586200 3.172414  
#&gt;                                        452886) cocoa_percent&lt; 0.715 1   0.00000000 2.750000 *
#&gt;                                        452887) cocoa_percent&gt;=0.715 57   8.09429800 3.179825  
#&gt;                                          905774) broad_bean_origin=Belize,Dominican Republic 37   5.44256800 3.141892  
#&gt;                                           1811548) cocoa_percent&lt; 0.7275 17   1.38235300 3.102941  
#&gt;                                             3623096) review_date&gt;=2014.5 1   0.00000000 2.750000 *
#&gt;                                             3623097) review_date&lt; 2014.5 16   1.25000000 3.125000  
#&gt;                                               7246194) broad_bean_origin=Belize 4   0.12500000 3.000000  
#&gt;                                                14492388) review_date&lt; 2012.5 1   0.00000000 2.750000 *
#&gt;                                                14492389) review_date&gt;=2012.5 3   0.04166667 3.083333  
#&gt;                                                  28984778) review_date&lt; 2013.5 1   0.00000000 3.000000 *
#&gt;                                                  28984779) review_date&gt;=2013.5 2   0.03125000 3.125000 *
#&gt;                                               7246195) broad_bean_origin=Dominican Republic 12   1.04166700 3.166667  
#&gt;                                                14492390) review_date&gt;=2011.5 8   0.87500000 3.125000  
#&gt;                                                  28984780) review_date&lt; 2012.5 1   0.00000000 2.500000 *
#&gt;                                                  28984781) review_date&gt;=2012.5 7   0.42857140 3.214286  
#&gt;                                                    57969562) review_date&gt;=2013.5 4   0.06250000 3.125000  
#&gt;                                                     115939124) cocoa_percent&gt;=0.7225 1   0.00000000 3.000000 *
#&gt;                                                     115939125) cocoa_percent&lt; 0.7225 3   0.04166667 3.166667 *
#&gt;                                                    57969563) review_date&lt; 2013.5 3   0.29166670 3.333333 *
#&gt;                                                14492391) review_date&lt; 2011.5 4   0.12500000 3.250000  
#&gt;                                                  28984782) review_date&lt; 2010.5 1   0.00000000 3.000000 *
#&gt;                                                  28984783) review_date&gt;=2010.5 3   0.04166667 3.333333 *
#&gt;                                           1811549) cocoa_percent&gt;=0.7275 20   4.01250000 3.175000  
#&gt;                                             3623098) cocoa_percent&gt;=0.745 9   1.62500000 3.083333  
#&gt;                                               7246196) review_date&lt; 2011 1   0.00000000 2.500000 *
#&gt;                                               7246197) review_date&gt;=2011 8   1.24218800 3.156250  
#&gt;                                                14492394) broad_bean_origin=Dominican Republic 6   0.83333330 3.083333  
#&gt;                                                  28984788) review_date&lt; 2014.5 3   0.29166670 2.916667  
#&gt;                                                    57969576) review_date&gt;=2012.5 2   0.12500000 2.750000  
#&gt;                                                     115939152) review_date&lt; 2013.5 1   0.00000000 2.500000 *
#&gt;                                                     115939153) review_date&gt;=2013.5 1   0.00000000 3.000000 *
#&gt;                                                    57969577) review_date&lt; 2012.5 1   0.00000000 3.250000 *
#&gt;                                                  28984789) review_date&gt;=2014.5 3   0.37500000 3.250000  
#&gt;                                                    57969578) review_date&gt;=2015.5 2   0.00000000 3.000000 *
#&gt;                                                    57969579) review_date&lt; 2015.5 1   0.00000000 3.750000 *
#&gt;                                                14492395) broad_bean_origin=Belize 2   0.28125000 3.375000  
#&gt;                                                  28984790) review_date&gt;=2013.5 1   0.00000000 3.000000 *
#&gt;                                                  28984791) review_date&lt; 2013.5 1   0.00000000 3.750000 *
#&gt;                                             3623099) cocoa_percent&lt; 0.745 11   2.25000000 3.250000  
#&gt;                                               7246198) review_date&gt;=2010.5 10   1.97500000 3.200000  
#&gt;                                                14492396) review_date&lt; 2013.5 9   1.87500000 3.166667  
#&gt;                                                  28984792) review_date&gt;=2012.5 3   0.87500000 3.000000  
#&gt;                                                    57969584) cocoa_percent&gt;=0.735 1   0.00000000 2.250000 *
#&gt;                                                    57969585) cocoa_percent&lt; 0.735 2   0.03125000 3.375000  
#&gt;                                                     115939170) broad_bean_origin=Belize 1   0.00000000 3.250000 *
#&gt;                                                     115939171) broad_bean_origin=Dominican Republic 1   0.00000000 3.500000 *
#&gt;                                                  28984793) review_date&lt; 2012.5 6   0.87500000 3.250000  
#&gt;                                                    57969586) cocoa_percent&lt; 0.735 2   0.12500000 3.000000 *
#&gt;                                                    57969587) cocoa_percent&gt;=0.735 4   0.56250000 3.375000 *
#&gt;                                                14492397) review_date&gt;=2013.5 1   0.00000000 3.500000 *
#&gt;                                               7246199) review_date&lt; 2010.5 1   0.00000000 3.750000 *
#&gt;                                          905775) broad_bean_origin=Ecuador,Papua New Guinea,Tanzania 20   2.50000000 3.250000  
#&gt;                                           1811550) cocoa_percent&gt;=0.7225 15   2.02500000 3.200000  
#&gt;                                             3623100) cocoa_percent&lt; 0.7275 1   0.00000000 2.500000 *
#&gt;                                             3623101) cocoa_percent&gt;=0.7275 14   1.50000000 3.250000  
#&gt;                                               7246202) cocoa_percent&lt; 0.745 6   0.84375000 3.125000  
#&gt;                                                14492404) cocoa_percent&gt;=0.735 2   0.28125000 2.875000  
#&gt;                                                  28984808) broad_bean_origin=Ecuador 1   0.00000000 2.500000 *
#&gt;                                                  28984809) broad_bean_origin=Tanzania 1   0.00000000 3.250000 *
#&gt;                                                14492405) cocoa_percent&lt; 0.735 4   0.37500000 3.250000  
#&gt;                                                  28984810) review_date&gt;=2015.5 1   0.00000000 2.750000 *
#&gt;                                                  28984811) review_date&lt; 2015.5 3   0.04166667 3.416667  
#&gt;                                                    57969622) review_date&gt;=2014.5 2   0.03125000 3.375000 *
#&gt;                                                    57969623) review_date&lt; 2014.5 1   0.00000000 3.500000 *
#&gt;                                               7246203) cocoa_percent&gt;=0.745 8   0.49218750 3.343750  
#&gt;                                                14492406) review_date&lt; 2014.5 3   0.04166667 3.083333  
#&gt;                                                  28984812) company_location=U.S.A. 2   0.00000000 3.000000 *
#&gt;                                                  28984813) company_location=Ecuador 1   0.00000000 3.250000 *
#&gt;                                                14492407) review_date&gt;=2014.5 5   0.12500000 3.500000  
#&gt;                                                  28984814) review_date&lt; 2015.5 3   0.04166667 3.416667  
#&gt;                                                    57969628) broad_bean_origin=Tanzania 1   0.00000000 3.250000 *
#&gt;                                                    57969629) broad_bean_origin=Ecuador 2   0.00000000 3.500000 *
#&gt;                                                  28984815) review_date&gt;=2015.5 2   0.03125000 3.625000  
#&gt;                                                    57969630) broad_bean_origin=Tanzania 1   0.00000000 3.500000 *
#&gt;                                                    57969631) broad_bean_origin=Ecuador 1   0.00000000 3.750000 *
#&gt;                                           1811551) cocoa_percent&lt; 0.7225 5   0.32500000 3.400000  
#&gt;                                             3623102) review_date&gt;=2014.5 3   0.12500000 3.250000  
#&gt;                                               7246204) broad_bean_origin=Tanzania 2   0.03125000 3.125000  
#&gt;                                                14492408) review_date&lt; 2015.5 1   0.00000000 3.000000 *
#&gt;                                                14492409) review_date&gt;=2015.5 1   0.00000000 3.250000 *
#&gt;                                               7246205) broad_bean_origin=Papua New Guinea 1   0.00000000 3.500000 *
#&gt;                                             3623103) review_date&lt; 2014.5 2   0.03125000 3.625000  
#&gt;                                               7246206) review_date&gt;=2012.5 1   0.00000000 3.500000 *
#&gt;                                               7246207) review_date&lt; 2012.5 1   0.00000000 3.750000 *
#&gt;                                   56611) bean_type=Blend,Criollo, Trinitario,Forastero (Arriba) 12   1.41666700 3.166667  
#&gt;                                    113222) cocoa_percent&gt;=0.735 5   0.87500000 3.000000  
#&gt;                                      226444) review_date&gt;=2007.5 3   0.12500000 2.750000 *
#&gt;                                      226445) review_date&lt; 2007.5 2   0.28125000 3.375000 *
#&gt;                                    113223) cocoa_percent&lt; 0.735 7   0.30357140 3.285714  
#&gt;                                      226446) broad_bean_origin=Belize,Ecuador 6   0.25000000 3.250000  
#&gt;                                        452892) bean_type=Criollo, Trinitario,Forastero (Arriba) 4   0.17187500 3.187500  
#&gt;                                          905784) review_date&lt; 2007.5 1   0.00000000 3.000000 *
#&gt;                                          905785) review_date&gt;=2007.5 3   0.12500000 3.250000  
#&gt;                                           1811570) cocoa_percent&gt;=0.715 2   0.03125000 3.125000  
#&gt;                                             3623140) review_date&lt; 2011 1   0.00000000 3.000000 *
#&gt;                                             3623141) review_date&gt;=2011 1   0.00000000 3.250000 *
#&gt;                                           1811571) cocoa_percent&lt; 0.715 1   0.00000000 3.500000 *
#&gt;                                        452893) bean_type=Blend 2   0.03125000 3.375000  
#&gt;                                          905786) review_date&gt;=2010.5 1   0.00000000 3.250000 *
#&gt;                                          905787) review_date&lt; 2010.5 1   0.00000000 3.500000 *
#&gt;                                      226447) broad_bean_origin=Colombia 1   0.00000000 3.500000 *
#&gt;                               14153) broad_bean_origin=Madagascar,Panama,Trinidad,Vietnam 30   3.36666700 3.266667  
#&gt;                                 28306) cocoa_percent&lt; 0.7375 18   1.50000000 3.166667  
#&gt;                                   56612) cocoa_percent&gt;=0.7325 1   0.00000000 2.500000 *
#&gt;                                   56613) cocoa_percent&lt; 0.7325 17   1.02941200 3.205882  
#&gt;                                    113226) company_location=Madagascar,U.S.A. 15   0.83333330 3.166667  
#&gt;                                      226452) cocoa_percent&lt; 0.7275 12   0.55729170 3.104167  
#&gt;                                        452904) review_date&lt; 2010 2   0.03125000 2.875000  
#&gt;                                          905808) review_date&gt;=2008.5 1   0.00000000 2.750000 *
#&gt;                                          905809) review_date&lt; 2008.5 1   0.00000000 3.000000 *
#&gt;                                        452905) review_date&gt;=2010 10   0.40000000 3.150000  
#&gt;                                          905810) review_date&gt;=2014.5 4   0.00000000 3.000000 *
#&gt;                                          905811) review_date&lt; 2014.5 6   0.25000000 3.250000  
#&gt;                                           1811622) cocoa_percent&gt;=0.7225 1   0.00000000 3.000000 *
#&gt;                                           1811623) cocoa_percent&lt; 0.7225 5   0.17500000 3.300000  
#&gt;                                             3623246) company_location=U.S.A. 4   0.12500000 3.250000  
#&gt;                                               7246492) review_date&lt; 2012.5 1   0.00000000 3.000000 *
#&gt;                                               7246493) review_date&gt;=2012.5 3   0.04166667 3.333333  
#&gt;                                                14492986) broad_bean_origin=Trinidad 1   0.00000000 3.250000 *
#&gt;                                                14492987) broad_bean_origin=Madagascar 2   0.03125000 3.375000 *
#&gt;                                             3623247) company_location=Madagascar 1   0.00000000 3.500000 *
#&gt;                                      226453) cocoa_percent&gt;=0.7275 3   0.04166667 3.416667  
#&gt;                                        452906) review_date&gt;=2010.5 2   0.03125000 3.375000  
#&gt;                                          905812) review_date&lt; 2015 1   0.00000000 3.250000 *
#&gt;                                          905813) review_date&gt;=2015 1   0.00000000 3.500000 *
#&gt;                                        452907) review_date&lt; 2010.5 1   0.00000000 3.500000 *
#&gt;                                    113227) company_location=Spain 2   0.00000000 3.500000 *
#&gt;                                 28307) cocoa_percent&gt;=0.7375 12   1.41666700 3.416667  
#&gt;                                   56614) review_date&lt; 2007.5 1   0.00000000 2.750000 *
#&gt;                                   56615) review_date&gt;=2007.5 11   0.93181820 3.477273  
#&gt;                                    113230) review_date&gt;=2014.5 2   0.03125000 3.125000  
#&gt;                                      226460) review_date&lt; 2015.5 1   0.00000000 3.000000 *
#&gt;                                      226461) review_date&gt;=2015.5 1   0.00000000 3.250000 *
#&gt;                                    113231) review_date&lt; 2014.5 9   0.59722220 3.555556  
#&gt;                                      226462) cocoa_percent&gt;=0.745 8   0.37500000 3.500000  
#&gt;                                        452924) company_location=Spain 1   0.00000000 3.250000 *
#&gt;                                        452925) company_location=Madagascar,U.S.A. 7   0.30357140 3.535714  
#&gt;                                          905850) review_date&gt;=2010.5 3   0.00000000 3.500000 *
#&gt;                                          905851) review_date&lt; 2010.5 4   0.29687500 3.562500  
#&gt;                                           1811702) review_date&lt; 2008.5 2   0.00000000 3.500000 *
#&gt;                                           1811703) review_date&gt;=2008.5 2   0.28125000 3.625000 *
#&gt;                                      226463) cocoa_percent&lt; 0.745 1   0.00000000 4.000000 *
#&gt;                              7077) bean_type=Criollo,Forastero,Forastero (Nacional) 3   0.04166667 3.666667  
#&gt;                               14154) bean_type=Forastero 1   0.00000000 3.500000 *
#&gt;                               14155) bean_type=Criollo,Forastero (Nacional) 2   0.00000000 3.750000 *
#&gt;                            3539) company_location=Colombia,Israel,Sweden 5   0.75000000 3.500000  
#&gt;                              7078) bean_type=Forastero (Nacional) 1   0.00000000 2.750000 *
#&gt;                              7079) bean_type=Trinitario 1   0.00000000 3.500000 *
#&gt;                         885) bean_type=Beniano,Nacional (Arriba) 4   0.29687500 3.687500  
#&gt;                          1770) review_date&lt; 2014 2   0.12500000 3.500000 *
#&gt;                          1771) review_date&gt;=2014 2   0.03125000 3.875000  
#&gt;                            3542) cocoa_percent&gt;=0.73 1   0.00000000 3.750000 *
#&gt;                            3543) cocoa_percent&lt; 0.73 1   0.00000000 4.000000 *
#&gt;                       443) cocoa_percent&lt; 0.705 273  38.24496000 3.300366  
#&gt;                         886) bean_type=Beniano,Criollo (Porcelana),Forastero (Arriba),Forastero (Nacional),Trinitario, Criollo,Trinitario, Forastero 22   4.29829500 3.170455  
#&gt;                          1772) company_location=Japan,U.S.A. 10   0.90000000 2.900000  
#&gt;                            3544) broad_bean_origin=Venezuela 2   0.00000000 2.500000 *
#&gt;                            3545) broad_bean_origin=Belize,Bolivia,Brazil,Ecuador 8   0.50000000 3.000000  
#&gt;                              7090) review_date&gt;=2006.5 7   0.21428570 2.928571  
#&gt;                               14180) bean_type=Forastero (Nacional) 2   0.12500000 2.750000  
#&gt;                                 28360) review_date&lt; 2014 1   0.00000000 2.500000 *
#&gt;                                 28361) review_date&gt;=2014 1   0.00000000 3.000000 *
#&gt;                               14181) bean_type=Beniano,Forastero (Arriba),Trinitario, Criollo,Trinitario, Forastero 5   0.00000000 3.000000 *
#&gt;                              7091) review_date&lt; 2006.5 1   0.00000000 3.500000 *
#&gt;                          1773) company_location=Colombia,Ecuador 12   2.05729200 3.395833  
#&gt;                            3546) cocoa_percent&lt; 0.66 1   0.00000000 2.750000 *
#&gt;                            3547) cocoa_percent&gt;=0.66 11   1.60227300 3.454545  
#&gt;                              7094) review_date&lt; 2015.5 10   1.27500000 3.400000  
#&gt;                               14188) review_date&gt;=2006.5 9   0.87500000 3.333333  
#&gt;                                 28376) review_date&lt; 2010 5   0.30000000 3.200000  
#&gt;                                   56752) review_date&gt;=2008.5 2   0.00000000 3.000000 *
#&gt;                                   56753) review_date&lt; 2008.5 3   0.16666670 3.333333  
#&gt;                                    113506) review_date&gt;=2007.5 2   0.12500000 3.250000 *
#&gt;                                    113507) review_date&lt; 2007.5 1   0.00000000 3.500000 *
#&gt;                                 28377) review_date&gt;=2010 4   0.37500000 3.500000  
#&gt;                                   56754) review_date&gt;=2014.5 1   0.00000000 3.250000 *
#&gt;                                   56755) review_date&lt; 2014.5 3   0.29166670 3.583333  
#&gt;                                    113510) review_date&lt; 2012.5 1   0.00000000 3.500000 *
#&gt;                                    113511) review_date&gt;=2012.5 2   0.28125000 3.625000 *
#&gt;                               14189) review_date&lt; 2006.5 1   0.00000000 4.000000 *
#&gt;                              7095) review_date&gt;=2015.5 1   0.00000000 4.000000 *
#&gt;                         887) bean_type=Amazon,Amazon, ICS,Blend,CCN51,Criollo,Criollo, +,Criollo, Trinitario,EET,Forastero,Forastero (Parazinho),Trinitario 251  33.54283000 3.311753  
#&gt;                          1774) broad_bean_origin=Bolivia,Colombia,Dominican Republic,Ecuador, Costa Rica,Nigeria,St. Lucia,Trinidad 77  10.82305000 3.224026  
#&gt;                            3548) bean_type=Trinitario 63   9.10714300 3.214286  
#&gt;                              7096) company_location=Colombia,Israel,Japan 9   1.05555600 3.027778  
#&gt;                               14192) review_date&lt; 2013 2   0.03125000 2.625000  
#&gt;                                 28384) review_date&gt;=2010.5 1   0.00000000 2.500000 *
#&gt;                                 28385) review_date&lt; 2010.5 1   0.00000000 2.750000 *
#&gt;                               14193) review_date&gt;=2013 7   0.60714290 3.142857  
#&gt;                                 28386) cocoa_percent&gt;=0.67 5   0.42500000 3.050000  
#&gt;                                   56772) cocoa_percent&lt; 0.695 1   0.00000000 2.750000 *
#&gt;                                   56773) cocoa_percent&gt;=0.695 4   0.31250000 3.125000  
#&gt;                                    113546) review_date&gt;=2014.5 1   0.00000000 3.000000 *
#&gt;                                    113547) review_date&lt; 2014.5 3   0.29166670 3.166667 *
#&gt;                                 28387) cocoa_percent&lt; 0.67 2   0.03125000 3.375000 *
#&gt;                              7097) company_location=St. Lucia,U.S.A. 54   7.68634300 3.245370  
#&gt;                               14194) review_date&lt; 2008.5 6   0.67708330 3.041667  
#&gt;                                 28388) cocoa_percent&gt;=0.69 4   0.06250000 2.875000  
#&gt;                                   56776) review_date&gt;=2007.5 3   0.04166667 2.833333  
#&gt;                                    113552) broad_bean_origin=Dominican Republic 2   0.00000000 2.750000 *
#&gt;                                    113553) broad_bean_origin=Trinidad 1   0.00000000 3.000000 *
#&gt;                                   56777) review_date&lt; 2007.5 1   0.00000000 3.000000 *
#&gt;                                 28389) cocoa_percent&lt; 0.69 2   0.28125000 3.375000  
#&gt;                                   56778) review_date&lt; 2007 1   0.00000000 3.000000 *
#&gt;                                   56779) review_date&gt;=2007 1   0.00000000 3.750000 *
#&gt;                               14195) review_date&gt;=2008.5 48   6.72916700 3.270833  
#&gt;                                 28390) review_date&gt;=2011.5 39   6.25000000 3.250000  
#&gt;                                   56780) review_date&lt; 2015.5 34   5.11764700 3.235294  
#&gt;                                    113560) broad_bean_origin=Colombia,Dominican Republic,St. Lucia 28   4.16741100 3.223214  
#&gt;                                      227120) review_date&lt; 2014.5 24   3.37239600 3.197917  
#&gt;                                        454240) cocoa_percent&lt; 0.69 2   0.12500000 3.000000 *
#&gt;                                        454241) cocoa_percent&gt;=0.69 22   3.16193200 3.215909  
#&gt;                                          908482) review_date&gt;=2013.5 8   1.36718800 3.156250 *
#&gt;                                          908483) review_date&lt; 2013.5 14   1.75000000 3.250000 *
#&gt;                                      227121) review_date&gt;=2014.5 4   0.68750000 3.375000  
#&gt;                                        454242) cocoa_percent&gt;=0.69 3   0.50000000 3.250000 *
#&gt;                                        454243) cocoa_percent&lt; 0.69 1   0.00000000 3.750000 *
#&gt;                                    113561) broad_bean_origin=Trinidad 6   0.92708330 3.291667  
#&gt;                                      227122) review_date&gt;=2014.5 4   0.56250000 3.125000 *
#&gt;                                      227123) review_date&lt; 2014.5 2   0.03125000 3.625000  
#&gt;                                        454246) review_date&lt; 2013.5 1   0.00000000 3.500000 *
#&gt;                                        454247) review_date&gt;=2013.5 1   0.00000000 3.750000 *
#&gt;                                   56781) review_date&gt;=2015.5 5   1.07500000 3.350000  
#&gt;                                    113562) review_date&gt;=2016.5 2   0.78125000 3.125000 *
#&gt;                                    113563) review_date&lt; 2016.5 3   0.12500000 3.500000  
#&gt;                                      227126) broad_bean_origin=Ecuador, Costa Rica 1   0.00000000 3.250000 *
#&gt;                                      227127) broad_bean_origin=Dominican Republic,Trinidad 2   0.03125000 3.625000  
#&gt;                                        454254) broad_bean_origin=Trinidad 1   0.00000000 3.500000 *
#&gt;                                        454255) broad_bean_origin=Dominican Republic 1   0.00000000 3.750000 *
#&gt;                                 28391) review_date&lt; 2011.5 9   0.38888890 3.361111  
#&gt;                                   56782) broad_bean_origin=Trinidad 1   0.00000000 3.000000 *
#&gt;                                   56783) broad_bean_origin=Dominican Republic,Nigeria 8   0.24218750 3.406250  
#&gt;                                    113566) broad_bean_origin=Nigeria 1   0.00000000 3.250000 *
#&gt;                                    113567) broad_bean_origin=Dominican Republic 7   0.21428570 3.428571  
#&gt;                                      227134) review_date&gt;=2010.5 4   0.06250000 3.375000 *
#&gt;                                      227135) review_date&lt; 2010.5 3   0.12500000 3.500000 *
#&gt;                            3549) bean_type=Amazon, ICS,CCN51,Criollo,Criollo, Trinitario 14   1.68303600 3.267857  
#&gt;                              7098) cocoa_percent&gt;=0.69 9   1.13888900 3.138889  
#&gt;                               14196) review_date&gt;=2015.5 2   0.28125000 2.875000 *
#&gt;                               14197) review_date&lt; 2015.5 7   0.67857140 3.214286  
#&gt;                                 28394) review_date&lt; 2014.5 4   0.12500000 3.000000  
#&gt;                                   56788) review_date&lt; 2012.5 1   0.00000000 2.750000 *
#&gt;                                   56789) review_date&gt;=2012.5 3   0.04166667 3.083333  
#&gt;                                    113578) review_date&gt;=2013.5 2   0.00000000 3.000000 *
#&gt;                                    113579) review_date&lt; 2013.5 1   0.00000000 3.250000 *
#&gt;                                 28395) review_date&gt;=2014.5 3   0.12500000 3.500000 *
#&gt;                              7099) cocoa_percent&lt; 0.69 5   0.12500000 3.500000  
#&gt;                               14198) review_date&lt; 2013 2   0.03125000 3.375000  
#&gt;                                 28396) cocoa_percent&lt; 0.675 1   0.00000000 3.250000 *
#&gt;                                 28397) cocoa_percent&gt;=0.675 1   0.00000000 3.500000 *
#&gt;                               14199) review_date&gt;=2013 3   0.04166667 3.583333  
#&gt;                                 28398) cocoa_percent&lt; 0.675 2   0.00000000 3.500000 *
#&gt;                                 28399) cocoa_percent&gt;=0.675 1   0.00000000 3.750000 *
#&gt;                          1775) broad_bean_origin=Belize,Brazil,Congo,Domincan Republic,Ecuador,Hawaii,Madagascar,Mexico,Papua New Guinea,Tanzania,Venezuela,Vietnam 174  21.86494000 3.350575  
#&gt;                            3550) bean_type=Amazon,Blend,Criollo,Criollo, +,Forastero (Parazinho),Trinitario 170  21.35331000 3.342647  
#&gt;                              7100) company_location=Sweden 2   0.00000000 3.000000 *
#&gt;                              7101) company_location=Hungary,Japan,Madagascar,Spain,U.S.A.,Venezuela 168  21.11570000 3.346726  
#&gt;                               14202) review_date&gt;=2011.5 127  14.18898000 3.326772  
#&gt;                                 28404) company_location=Hungary,Japan,Madagascar,U.S.A. 122  13.57018000 3.313525  
#&gt;                                   56808) broad_bean_origin=Mexico,Venezuela 25   4.19000000 3.180000  
#&gt;                                    113616) cocoa_percent&gt;=0.69 24   3.85156200 3.156250  
#&gt;                                      227232) review_date&lt; 2013.5 10   1.05625000 3.025000  
#&gt;                                        454464) review_date&gt;=2012.5 6   0.67708330 2.958333  
#&gt;                                          908928) broad_bean_origin=Mexico 2   0.03125000 2.625000 *
#&gt;                                          908929) broad_bean_origin=Venezuela 4   0.31250000 3.125000 *
#&gt;                                        454465) review_date&lt; 2012.5 4   0.31250000 3.125000  
#&gt;                                          908930) broad_bean_origin=Venezuela 2   0.03125000 2.875000 *
#&gt;                                          908931) broad_bean_origin=Mexico 2   0.03125000 3.375000 *
#&gt;                                      227233) review_date&gt;=2013.5 14   2.50000000 3.250000  
#&gt;                                        454466) review_date&gt;=2015.5 3   0.50000000 3.000000 *
#&gt;                                        454467) review_date&lt; 2015.5 11   1.76136400 3.318182  
#&gt;                                          908934) bean_type=Criollo 2   0.12500000 3.250000  
#&gt;                                           1817868) review_date&gt;=2014.5 1   0.00000000 3.000000 *
#&gt;                                           1817869) review_date&lt; 2014.5 1   0.00000000 3.500000 *
#&gt;                                          908935) bean_type=Trinitario 9   1.62500000 3.333333  
#&gt;                                           1817870) review_date&lt; 2014.5 4   1.29687500 3.312500 *
#&gt;                                           1817871) review_date&gt;=2014.5 5   0.32500000 3.350000 *
#&gt;                                    113617) cocoa_percent&lt; 0.69 1   0.00000000 3.750000 *
#&gt;                                   56809) broad_bean_origin=Belize,Brazil,Domincan Republic,Ecuador,Hawaii,Madagascar,Papua New Guinea,Tanzania,Vietnam 97   8.81958800 3.347938  
#&gt;                                    113618) review_date&lt; 2013.5 34   3.39154400 3.286765  
#&gt;                                      227236) broad_bean_origin=Brazil,Ecuador,Hawaii 17   1.48529400 3.220588  
#&gt;                                        454472) cocoa_percent&gt;=0.675 16   1.40234400 3.203125  
#&gt;                                          908944) bean_type=Criollo 1   0.00000000 3.250000 *
#&gt;                                          908945) bean_type=Blend,Forastero (Parazinho) 15   1.40000000 3.200000  
#&gt;                                           1817890) broad_bean_origin=Brazil,Ecuador 11   1.01136400 3.181818  
#&gt;                                             3635780) review_date&lt; 2012.5 7   0.85714290 3.107143  
#&gt;                                               7271560) broad_bean_origin=Ecuador 5   0.57500000 3.100000 *
#&gt;                                               7271561) broad_bean_origin=Brazil 2   0.28125000 3.125000 *
#&gt;                                             3635781) review_date&gt;=2012.5 4   0.04687500 3.312500 *
#&gt;                                           1817891) broad_bean_origin=Hawaii 4   0.37500000 3.250000  
#&gt;                                             3635782) review_date&gt;=2012.5 2   0.28125000 3.125000 *
#&gt;                                             3635783) review_date&lt; 2012.5 2   0.03125000 3.375000 *
#&gt;                                        454473) cocoa_percent&lt; 0.675 1   0.00000000 3.500000 *
#&gt;                                      227237) broad_bean_origin=Madagascar,Papua New Guinea 17   1.75735300 3.352941  
#&gt;                                        454474) cocoa_percent&lt; 0.675 1   0.00000000 2.750000 *
#&gt;                                        454475) cocoa_percent&gt;=0.675 16   1.37109400 3.390625  
#&gt;                                          908950) cocoa_percent&gt;=0.695 11   0.79545450 3.363636  
#&gt;                                           1817900) broad_bean_origin=Papua New Guinea 2   0.12500000 3.250000  
#&gt;                                             3635800) review_date&lt; 2012.5 1   0.00000000 3.000000 *
#&gt;                                             3635801) review_date&gt;=2012.5 1   0.00000000 3.500000 *
#&gt;                                           1817901) broad_bean_origin=Madagascar 9   0.63888890 3.388889  
#&gt;                                             3635802) bean_type=Trinitario 7   0.60714290 3.357143  
#&gt;                                               7271604) review_date&gt;=2012.5 2   0.12500000 3.250000 *
#&gt;                                               7271605) review_date&lt; 2012.5 5   0.45000000 3.400000  
#&gt;                                                14543210) company_location=Hungary 1   0.00000000 3.250000 *
#&gt;                                                14543211) company_location=U.S.A. 4   0.42187500 3.437500 *
#&gt;                                             3635803) bean_type=Criollo 2   0.00000000 3.500000 *
#&gt;                                          908951) cocoa_percent&lt; 0.695 5   0.55000000 3.450000  
#&gt;                                           1817902) cocoa_percent&lt; 0.685 1   0.00000000 3.250000 *
#&gt;                                           1817903) cocoa_percent&gt;=0.685 4   0.50000000 3.500000 *
#&gt;                                    113619) review_date&gt;=2013.5 63   5.23214300 3.380952  
#&gt;                                      227238) review_date&gt;=2014.5 54   4.68981500 3.351852  
#&gt;                                        454476) broad_bean_origin=Madagascar,Tanzania 16   1.75000000 3.250000  
#&gt;                                          908952) review_date&gt;=2016.5 1   0.00000000 2.750000 *
#&gt;                                          908953) review_date&lt; 2016.5 15   1.48333300 3.283333  
#&gt;                                           1817906) review_date&lt; 2015.5 10   0.68125000 3.225000  
#&gt;                                             3635812) company_location=Japan 1   0.00000000 3.000000 *
#&gt;                                             3635813) company_location=Hungary,U.S.A. 9   0.62500000 3.250000  
#&gt;                                               7271626) broad_bean_origin=Tanzania 3   0.16666670 3.166667 *
#&gt;                                               7271627) broad_bean_origin=Madagascar 6   0.42708330 3.291667  
#&gt;                                                14543254) company_location=Hungary 1   0.00000000 3.250000 *
#&gt;                                                14543255) company_location=U.S.A. 5   0.42500000 3.300000 *
#&gt;                                           1817907) review_date&gt;=2015.5 5   0.70000000 3.400000  
#&gt;                                             3635814) cocoa_percent&lt; 0.69 2   0.50000000 3.250000 *
#&gt;                                             3635815) cocoa_percent&gt;=0.69 3   0.12500000 3.500000 *
#&gt;                                        454477) broad_bean_origin=Belize,Brazil,Domincan Republic,Ecuador,Vietnam 38   2.70394700 3.394737  
#&gt;                                          908954) cocoa_percent&lt; 0.685 3   0.12500000 3.250000  
#&gt;                                           1817908) review_date&lt; 2015.5 1   0.00000000 3.000000 *
#&gt;                                           1817909) review_date&gt;=2015.5 2   0.03125000 3.375000  
#&gt;                                             3635818) broad_bean_origin=Ecuador 1   0.00000000 3.250000 *
#&gt;                                             3635819) broad_bean_origin=Domincan Republic 1   0.00000000 3.500000 *
#&gt;                                          908955) cocoa_percent&gt;=0.685 35   2.51071400 3.407143  
#&gt;                                           1817910) broad_bean_origin=Belize,Domincan Republic,Ecuador,Vietnam 32   2.36718800 3.390625  
#&gt;                                             3635820) company_location=Hungary 2   0.00000000 3.250000 *
#&gt;                                             3635821) company_location=Japan,U.S.A. 30   2.32500000 3.400000  
#&gt;                                               7271642) broad_bean_origin=Domincan Republic 9   0.59722220 3.305556  
#&gt;                                                14543284) review_date&lt; 2015.5 6   0.25000000 3.250000 *
#&gt;                                                14543285) review_date&gt;=2015.5 3   0.29166670 3.416667 *
#&gt;                                               7271643) broad_bean_origin=Belize,Ecuador,Vietnam 21   1.61309500 3.440476  
#&gt;                                                14543286) review_date&gt;=2015.5 11   0.40909090 3.409091  
#&gt;                                                  29086572) broad_bean_origin=Belize 4   0.04687500 3.312500  
#&gt;                                                    58173144) review_date&gt;=2016.5 1   0.00000000 3.250000 *
#&gt;                                                    58173145) review_date&lt; 2016.5 3   0.04166667 3.333333 *
#&gt;                                                  29086573) broad_bean_origin=Ecuador 7   0.30357140 3.464286  
#&gt;                                                    58173146) review_date&lt; 2016.5 6   0.30208330 3.458333 *
#&gt;                                                    58173147) review_date&gt;=2016.5 1   0.00000000 3.500000 *
#&gt;                                                14543287) review_date&lt; 2015.5 10   1.18125000 3.475000  
#&gt;                                                  29086574) bean_type=Trinitario 9   1.18055600 3.472222  
#&gt;                                                    58173148) broad_bean_origin=Belize,Ecuador 8   1.17968800 3.468750  
#&gt;                                                     116346296) broad_bean_origin=Ecuador 3   0.79166670 3.416667 *
#&gt;                                                     116346297) broad_bean_origin=Belize 5   0.37500000 3.500000 *
#&gt;                                                    58173149) broad_bean_origin=Vietnam 1   0.00000000 3.500000 *
#&gt;                                                  29086575) bean_type=Blend 1   0.00000000 3.500000 *
#&gt;                                           1817911) broad_bean_origin=Brazil 3   0.04166667 3.583333  
#&gt;                                             3635822) review_date&lt; 2015.5 2   0.00000000 3.500000 *
#&gt;                                             3635823) review_date&gt;=2015.5 1   0.00000000 3.750000 *
#&gt;                                      227239) review_date&lt; 2014.5 9   0.22222220 3.555556  
#&gt;                                        454478) cocoa_percent&lt; 0.66 1   0.00000000 3.250000 *
#&gt;                                        454479) cocoa_percent&gt;=0.66 8   0.11718750 3.593750  
#&gt;                                          908958) cocoa_percent&gt;=0.685 7   0.08928571 3.571429  
#&gt;                                           1817916) broad_bean_origin=Ecuador 2   0.00000000 3.500000 *
#&gt;                                           1817917) broad_bean_origin=Belize,Hawaii 5   0.07500000 3.600000  
#&gt;                                             3635834) broad_bean_origin=Belize 3   0.04166667 3.583333 *
#&gt;                                             3635835) broad_bean_origin=Hawaii 2   0.03125000 3.625000 *
#&gt;                                          908959) cocoa_percent&lt; 0.685 1   0.00000000 3.750000 *
#&gt;                                 28405) company_location=Spain,Venezuela 5   0.07500000 3.650000  
#&gt;                                   56810) bean_type=Criollo 1   0.00000000 3.500000 *
#&gt;                                   56811) bean_type=Trinitario 1   0.00000000 3.750000 *
#&gt;                               14203) review_date&lt; 2011.5 41   6.71951200 3.408537  
#&gt;                                 28406) broad_bean_origin=Belize,Ecuador,Madagascar,Tanzania,Venezuela 35   5.54285700 3.364286  
#&gt;                                   56812) company_location=Spain,Venezuela 2   0.00000000 2.750000 *
#&gt;                                   56813) company_location=Hungary,Madagascar,U.S.A. 33   4.74242400 3.401515  
#&gt;                                    113626) review_date&lt; 2010.5 23   3.30434800 3.326087  
#&gt;                                      227252) review_date&gt;=2009.5 7   1.10714300 3.107143  
#&gt;                                        454504) cocoa_percent&lt; 0.675 2   0.00000000 2.750000 *
#&gt;                                        454505) cocoa_percent&gt;=0.675 5   0.75000000 3.250000  
#&gt;                                          909010) broad_bean_origin=Madagascar,Venezuela 3   0.00000000 3.000000 *
#&gt;                                          909011) broad_bean_origin=Ecuador 2   0.28125000 3.625000  
#&gt;                                           1818022) cocoa_percent&lt; 0.69 1   0.00000000 3.250000 *
#&gt;                                           1818023) cocoa_percent&gt;=0.69 1   0.00000000 4.000000 *
#&gt;                                      227253) review_date&lt; 2009.5 16   1.71484400 3.421875  
#&gt;                                        454506) bean_type=Trinitario 12   1.56250000 3.375000  
#&gt;                                          909012) cocoa_percent&lt; 0.665 4   0.75000000 3.250000  
#&gt;                                           1818024) cocoa_percent&gt;=0.655 1   0.00000000 2.500000 *
#&gt;                                           1818025) cocoa_percent&lt; 0.655 3   0.00000000 3.500000 *
#&gt;                                          909013) cocoa_percent&gt;=0.665 8   0.71875000 3.437500  
#&gt;                                           1818026) review_date&gt;=2007.5 6   0.33333330 3.333333  
#&gt;                                             3636052) cocoa_percent&gt;=0.685 4   0.25000000 3.250000  
#&gt;                                               7272104) company_location=Madagascar 1   0.00000000 3.000000 *
#&gt;                                               7272105) company_location=U.S.A. 3   0.16666670 3.333333 *
#&gt;                                             3636053) cocoa_percent&lt; 0.685 2   0.00000000 3.500000 *
#&gt;                                           1818027) review_date&lt; 2007.5 2   0.12500000 3.750000 *
#&gt;                                        454507) bean_type=Blend,Criollo,Criollo, + 4   0.04687500 3.562500  
#&gt;                                          909014) review_date&lt; 2006.5 2   0.00000000 3.500000 *
#&gt;                                          909015) review_date&gt;=2006.5 2   0.03125000 3.625000  
#&gt;                                           1818030) review_date&gt;=2008 1   0.00000000 3.500000 *
#&gt;                                           1818031) review_date&lt; 2008 1   0.00000000 3.750000 *
#&gt;                                    113627) review_date&gt;=2010.5 10   1.00625000 3.575000  
#&gt;                                      227254) company_location=Hungary 2   0.12500000 3.250000 *
#&gt;                                      227255) company_location=U.S.A. 8   0.61718750 3.656250  
#&gt;                                        454510) broad_bean_origin=Belize,Madagascar,Tanzania 5   0.25000000 3.500000  
#&gt;                                          909020) bean_type=Trinitario 4   0.17187500 3.437500  
#&gt;                                           1818040) broad_bean_origin=Tanzania 1   0.00000000 3.250000 *
#&gt;                                           1818041) broad_bean_origin=Belize,Madagascar 3   0.12500000 3.500000 *
#&gt;                                          909021) bean_type=Blend 1   0.00000000 3.750000 *
#&gt;                                        454511) broad_bean_origin=Venezuela 3   0.04166667 3.916667  
#&gt;                                          909022) cocoa_percent&lt; 0.69 1   0.00000000 3.750000 *
#&gt;                                          909023) cocoa_percent&gt;=0.69 2   0.00000000 4.000000 *
#&gt;                                 28407) broad_bean_origin=Brazil,Mexico,Papua New Guinea 6   0.70833330 3.666667  
#&gt;                                   56814) bean_type=Blend 1   0.00000000 3.000000 *
#&gt;                                   56815) bean_type=Criollo 5   0.17500000 3.800000  
#&gt;                                    113630) company_location=U.S.A. 3   0.04166667 3.666667  
#&gt;                                      227260) cocoa_percent&gt;=0.69 1   0.00000000 3.500000 *
#&gt;                                      227261) cocoa_percent&lt; 0.69 2   0.00000000 3.750000 *
#&gt;                                    113631) company_location=Spain 2   0.00000000 4.000000 *
#&gt;                            3551) bean_type=Criollo, Trinitario,EET,Forastero 4   0.04687500 3.687500  
#&gt;                              7102) broad_bean_origin=Tanzania 1   0.00000000 3.500000 *
#&gt;                              7103) broad_bean_origin=Brazil,Domincan Republic,Ecuador 3   0.00000000 3.750000 *
#&gt;                   111) broad_bean_origin=Cuba,Guatemala,Haiti,Honduras,Peru, Belize,Peru, Mad., Dom. Rep.,Solomon Islands,Trinidad, Tobago,Venezuela, Java 24   2.66406200 3.531250  
#&gt;                     222) company_location=Japan,U.S.A. 17   1.61764700 3.411765  
#&gt;                       444) cocoa_percent&lt; 0.675 1   0.00000000 2.750000 *
#&gt;                       445) cocoa_percent&gt;=0.675 16   1.15234400 3.453125  
#&gt;                         890) review_date&gt;=2014.5 13   0.94230770 3.403846  
#&gt;                          1780) cocoa_percent&gt;=0.74 2   0.12500000 3.000000  
#&gt;                            3560) broad_bean_origin=Guatemala 1   0.00000000 2.750000 *
#&gt;                            3561) broad_bean_origin=Honduras 1   0.00000000 3.250000 *
#&gt;                          1781) cocoa_percent&lt; 0.74 11   0.43181820 3.477273  
#&gt;                            3562) review_date&lt; 2015.5 5   0.32500000 3.400000  
#&gt;                              7124) cocoa_percent&lt; 0.71 4   0.31250000 3.375000 *
#&gt;                              7125) cocoa_percent&gt;=0.71 1   0.00000000 3.500000 *
#&gt;                            3563) review_date&gt;=2015.5 6   0.05208333 3.541667  
#&gt;                              7126) broad_bean_origin=Haiti,Honduras,Solomon Islands 5   0.00000000 3.500000 *
#&gt;                              7127) broad_bean_origin=Guatemala 1   0.00000000 3.750000 *
#&gt;                         891) review_date&lt; 2014.5 3   0.04166667 3.666667  
#&gt;                          1782) broad_bean_origin=Peru, Mad., Dom. Rep. 1   0.00000000 3.500000 *
#&gt;                          1783) broad_bean_origin=Honduras,Peru, Belize 2   0.00000000 3.750000 *
#&gt;                     223) company_location=Belgium,Hungary,Lithuania,U.K. 7   0.21428570 3.821429  
#&gt;                       446) broad_bean_origin=Cuba,Honduras,Trinidad, Tobago 4   0.04687500 3.687500  
#&gt;                         892) cocoa_percent&gt;=0.73 1   0.00000000 3.500000 *
#&gt;                         893) cocoa_percent&lt; 0.73 3   0.00000000 3.750000 *
#&gt;                       447) broad_bean_origin=Guatemala,Haiti,Venezuela, Java 3   0.00000000 4.000000 *
#&gt;             7) company_location=Amsterdam,Argentina,Australia,Austria,Bolivia,Brazil,Canada,Chile,Costa Rica,Denmark,Domincan Republic,Fiji,Finland,France,Germany,Guatemala,Honduras,Iceland,Italy,Netherlands,New Zealand,Philippines,Poland,Russia,Sao Tome,Scotland,Singapore,Suriname,Switzerland,Vietnam 508  98.80512000 3.322835  
#&gt;              14) broad_bean_origin=Australia,Belize,Bolivia,Burma,Carribean,Colombia,Costa Rica,Cuba,Ecuador,El Salvador,Fiji,Gabon,Ghana,Grenada,Guatemala,India,Ivory Coast,Mexico,Panama,Papua New Guinea,Sao Tome,South America, Africa,Sri Lanka,Suriname,Tanzania,Tobago,Togo,Trinidad,Trinidad, Tobago,Trinidad-Tobago,Uganda,Vanuatu,Venezuela, Carribean,Venezuela, Ghana,West Africa 204  35.17249000 3.199755  
#&gt;                28) company_location=Austria,Bolivia,Canada,Costa Rica,Fiji,France,Germany,Honduras,Italy,New Zealand,Russia,Scotland,Suriname 152  26.35485000 3.136513  
#&gt;                  56) broad_bean_origin=Belize,Burma,Carribean,Cuba,Ecuador,El Salvador,Ivory Coast,Mexico,Panama,Sri Lanka,Tanzania,Togo,Trinidad, Tobago,Trinidad-Tobago,Uganda,Venezuela, Carribean,Venezuela, Ghana,West Africa 72  13.48611000 3.013889  
#&gt;                   112) review_date&lt; 2014.5 52   9.95192300 2.942308  
#&gt;                     224) cocoa_percent&gt;=0.665 45   8.43611100 2.894444  
#&gt;                       448) bean_type=Criollo,Forastero,Forastero (Arriba),Nacional 23   4.17934800 2.826087  
#&gt;                         896) cocoa_percent&gt;=0.705 12   0.93229170 2.604167  
#&gt;                          1792) broad_bean_origin=Cuba,Ecuador,Tanzania,West Africa 8   0.30468750 2.468750  
#&gt;                            3584) broad_bean_origin=Tanzania 1   0.00000000 2.000000 *
#&gt;                            3585) broad_bean_origin=Cuba,Ecuador,West Africa 7   0.05357143 2.535714  
#&gt;                              7170) cocoa_percent&gt;=0.715 6   0.00000000 2.500000 *
#&gt;                              7171) cocoa_percent&lt; 0.715 1   0.00000000 2.750000 *
#&gt;                          1793) broad_bean_origin=Ivory Coast,Mexico 4   0.18750000 2.875000  
#&gt;                            3586) review_date&gt;=2011.5 1   0.00000000 2.500000 *
#&gt;                            3587) review_date&lt; 2011.5 3   0.00000000 3.000000 *
#&gt;                         897) cocoa_percent&lt; 0.705 11   2.01136400 3.068182  
#&gt;                          1794) broad_bean_origin=Belize,Burma,Cuba,Mexico,Panama,Trinidad-Tobago,Uganda 9   0.75000000 2.916667  
#&gt;                            3588) broad_bean_origin=Mexico,Panama,Trinidad-Tobago,Uganda 4   0.04687500 2.687500  
#&gt;                              7176) broad_bean_origin=Mexico 1   0.00000000 2.500000 *
#&gt;                              7177) broad_bean_origin=Panama,Trinidad-Tobago,Uganda 3   0.00000000 2.750000 *
#&gt;                            3589) broad_bean_origin=Belize,Burma,Cuba 5   0.32500000 3.100000  
#&gt;                              7178) broad_bean_origin=Belize,Burma 2   0.00000000 3.000000 *
#&gt;                              7179) broad_bean_origin=Cuba 3   0.29166670 3.166667  
#&gt;                               14358) review_date&gt;=2011 2   0.28125000 3.125000 *
#&gt;                               14359) review_date&lt; 2011 1   0.00000000 3.250000 *
#&gt;                          1795) broad_bean_origin=Ecuador,Tanzania 2   0.12500000 3.750000  
#&gt;                            3590) review_date&gt;=2009.5 1   0.00000000 3.500000 *
#&gt;                            3591) review_date&lt; 2009.5 1   0.00000000 4.000000 *
#&gt;                       449) bean_type=Blend,Forastero (Nacional),Trinitario,Trinitario, Forastero 22   4.03693200 2.965909  
#&gt;                         898) review_date&lt; 2013.5 17   2.88235300 2.897059  
#&gt;                          1796) company_location=Canada,Italy 8   1.34375000 2.687500  
#&gt;                            3592) review_date&gt;=2009 6   1.08333300 2.583333  
#&gt;                              7184) review_date&lt; 2010.5 1   0.00000000 2.000000 *
#&gt;                              7185) review_date&gt;=2010.5 5   0.67500000 2.700000  
#&gt;                               14370) broad_bean_origin=Belize,Carribean 4   0.56250000 2.625000  
#&gt;                                 28740) cocoa_percent&lt; 0.805 2   0.28125000 2.375000  
#&gt;                                   57480) review_date&lt; 2012 1   0.00000000 2.000000 *
#&gt;                                   57481) review_date&gt;=2012 1   0.00000000 2.750000 *
#&gt;                                 28741) cocoa_percent&gt;=0.805 2   0.03125000 2.875000 *
#&gt;                               14371) broad_bean_origin=Ecuador 1   0.00000000 3.000000 *
#&gt;                            3593) review_date&lt; 2009 2   0.00000000 3.000000 *
#&gt;                          1797) company_location=Austria,France 9   0.87500000 3.083333  
#&gt;                            3594) broad_bean_origin=Ecuador,Sri Lanka,Venezuela, Carribean,Venezuela, Ghana 7   0.08928571 2.928571  
#&gt;                              7188) review_date&gt;=2008 3   0.04166667 2.833333  
#&gt;                               14376) review_date&lt; 2010.5 2   0.00000000 2.750000 *
#&gt;                               14377) review_date&gt;=2010.5 1   0.00000000 3.000000 *
#&gt;                              7189) review_date&lt; 2008 4   0.00000000 3.000000 *
#&gt;                            3595) broad_bean_origin=Carribean,Cuba 2   0.03125000 3.625000  
#&gt;                              7190) review_date&gt;=2008.5 1   0.00000000 3.500000 *
#&gt;                              7191) review_date&lt; 2008.5 1   0.00000000 3.750000 *
#&gt;                         899) review_date&gt;=2013.5 5   0.80000000 3.200000  
#&gt;                          1798) cocoa_percent&gt;=0.74 4   0.42187500 3.062500  
#&gt;                            3596) cocoa_percent&lt; 0.775 2   0.00000000 2.750000 *
#&gt;                            3597) cocoa_percent&gt;=0.775 2   0.03125000 3.375000  
#&gt;                              7194) cocoa_percent&gt;=0.81 1   0.00000000 3.250000 *
#&gt;                              7195) cocoa_percent&lt; 0.81 1   0.00000000 3.500000 *
#&gt;                          1799) cocoa_percent&lt; 0.74 1   0.00000000 3.750000 *
#&gt;                     225) cocoa_percent&lt; 0.665 7   0.75000000 3.250000  
#&gt;                       450) review_date&lt; 2008 2   0.00000000 3.000000 *
#&gt;                       451) review_date&gt;=2008 5   0.57500000 3.350000  
#&gt;                         902) cocoa_percent&lt; 0.65 3   0.04166667 3.083333  
#&gt;                          1804) review_date&lt; 2011 2   0.00000000 3.000000 *
#&gt;                          1805) review_date&gt;=2011 1   0.00000000 3.250000 *
#&gt;                         903) cocoa_percent&gt;=0.65 2   0.00000000 3.750000 *
#&gt;                   113) review_date&gt;=2014.5 20   2.57500000 3.200000  
#&gt;                     226) bean_type=Nacional (Arriba),Trinitario 9   0.88888890 3.138889  
#&gt;                       452) company_location=Austria,Germany 3   0.04166667 2.833333  
#&gt;                         904) cocoa_percent&lt; 0.74 1   0.00000000 2.750000 *
#&gt;                         905) cocoa_percent&gt;=0.74 2   0.03125000 2.875000  
#&gt;                          1810) cocoa_percent&gt;=0.805 1   0.00000000 2.750000 *
#&gt;                          1811) cocoa_percent&lt; 0.805 1   0.00000000 3.000000 *
#&gt;                       453) company_location=Canada,France 6   0.42708330 3.291667  
#&gt;                         906) review_date&lt; 2015.5 2   0.00000000 3.000000 *
#&gt;                         907) review_date&gt;=2015.5 4   0.17187500 3.437500  
#&gt;                          1814) cocoa_percent&gt;=0.74 3   0.04166667 3.333333  
#&gt;                            3628) company_location=Canada 2   0.00000000 3.250000 *
#&gt;                            3629) company_location=France 1   0.00000000 3.500000 *
#&gt;                          1815) cocoa_percent&lt; 0.74 1   0.00000000 3.750000 *
#&gt;                     227) bean_type=Criollo, Trinitario,Trinitario, TCGA 11   1.62500000 3.250000  
#&gt;                       454) company_location=Canada,France,Honduras,Russia 8   0.86718750 3.093750  
#&gt;                         908) review_date&gt;=2015.5 2   0.28125000 2.875000  
#&gt;                          1816) cocoa_percent&gt;=0.71 1   0.00000000 2.500000 *
#&gt;                          1817) cocoa_percent&lt; 0.71 1   0.00000000 3.250000 *
#&gt;                         909) review_date&lt; 2015.5 6   0.45833330 3.166667  
#&gt;                          1818) cocoa_percent&lt; 0.71 5   0.32500000 3.100000  
#&gt;                            3636) company_location=France,Honduras 4   0.29687500 3.062500  
#&gt;                              7272) company_location=Honduras 1   0.00000000 3.000000 *
#&gt;                              7273) company_location=France 3   0.29166670 3.083333 *
#&gt;                            3637) company_location=Russia 1   0.00000000 3.250000 *
#&gt;                          1819) cocoa_percent&gt;=0.71 1   0.00000000 3.500000 *
#&gt;                       455) company_location=Austria,Germany,Italy 3   0.04166667 3.666667  
#&gt;                         910) company_location=Austria 1   0.00000000 3.500000 *
#&gt;                         911) company_location=Germany,Italy 2   0.00000000 3.750000 *
#&gt;                  57) broad_bean_origin=Bolivia,Colombia,Costa Rica,Fiji,Gabon,Ghana,Grenada,Guatemala,India,Papua New Guinea,Sao Tome,Suriname,Tobago,Trinidad,Vanuatu 80  10.81172000 3.246875  
#&gt;                   114) company_location=Austria,Italy,New Zealand 24   3.24739600 3.135417  
#&gt;                     228) bean_type=Criollo, Trinitario,Forastero 11   1.47727300 3.045455  
#&gt;                       456) cocoa_percent&gt;=0.665 6   0.70833330 2.833333  
#&gt;                         912) broad_bean_origin=Ghana,Sao Tome 2   0.03125000 2.375000  
#&gt;                          1824) cocoa_percent&gt;=0.75 1   0.00000000 2.250000 *
#&gt;                          1825) cocoa_percent&lt; 0.75 1   0.00000000 2.500000 *
#&gt;                         913) broad_bean_origin=Bolivia,Colombia,Papua New Guinea 4   0.04687500 3.062500  
#&gt;                          1826) cocoa_percent&lt; 0.825 3   0.00000000 3.000000 *
#&gt;                          1827) cocoa_percent&gt;=0.825 1   0.00000000 3.250000 *
#&gt;                       457) cocoa_percent&lt; 0.665 5   0.17500000 3.300000  
#&gt;                         914) review_date&lt; 2011.5 3   0.04166667 3.166667  
#&gt;                          1828) review_date&lt; 2010 1   0.00000000 3.000000 *
#&gt;                          1829) review_date&gt;=2010 2   0.00000000 3.250000 *
#&gt;                         915) review_date&gt;=2011.5 2   0.00000000 3.500000 *
#&gt;                     229) bean_type=Trinitario 13   1.60576900 3.211538  
#&gt;                       458) company_location=Austria 5   0.50000000 3.000000  
#&gt;                         916) cocoa_percent&gt;=0.79 2   0.00000000 2.750000 *
#&gt;                         917) cocoa_percent&lt; 0.79 3   0.29166670 3.166667  
#&gt;                          1834) broad_bean_origin=Bolivia 1   0.00000000 2.750000 *
#&gt;                          1835) broad_bean_origin=Colombia,Trinidad 2   0.03125000 3.375000  
#&gt;                            3670) cocoa_percent&lt; 0.76 1   0.00000000 3.250000 *
#&gt;                            3671) cocoa_percent&gt;=0.76 1   0.00000000 3.500000 *
#&gt;                       459) company_location=Italy,New Zealand 8   0.74218750 3.343750  
#&gt;                         918) cocoa_percent&lt; 0.68 1   0.00000000 2.750000 *
#&gt;                         919) cocoa_percent&gt;=0.68 7   0.33928570 3.428571  
#&gt;                          1838) cocoa_percent&gt;=0.81 1   0.00000000 3.250000 *
#&gt;                          1839) cocoa_percent&lt; 0.81 6   0.30208330 3.458333  
#&gt;                            3678) company_location=New Zealand 4   0.29687500 3.437500  
#&gt;                              7356) cocoa_percent&lt; 0.72 3   0.29166670 3.416667 *
#&gt;                              7357) cocoa_percent&gt;=0.72 1   0.00000000 3.500000 *
#&gt;                            3679) company_location=Italy 2   0.00000000 3.500000 *
#&gt;                   115) company_location=Bolivia,Canada,Costa Rica,Fiji,France,Germany,Suriname 56   7.13839300 3.294643  
#&gt;                     230) broad_bean_origin=Bolivia,Costa Rica,Fiji,Gabon,Grenada,Guatemala,Papua New Guinea,Suriname,Tobago,Trinidad 40   4.67343700 3.231250  
#&gt;                       460) cocoa_percent&lt; 0.665 7   1.46428600 3.071429  
#&gt;                         920) broad_bean_origin=Fiji,Trinidad 3   0.04166667 2.666667  
#&gt;                          1840) review_date&lt; 2008.5 1   0.00000000 2.500000 *
#&gt;                          1841) review_date&gt;=2008.5 2   0.00000000 2.750000 *
#&gt;                         921) broad_bean_origin=Papua New Guinea,Tobago 4   0.56250000 3.375000  
#&gt;                          1842) review_date&gt;=2007.5 3   0.04166667 3.166667  
#&gt;                            3684) cocoa_percent&gt;=0.635 1   0.00000000 3.000000 *
#&gt;                            3685) cocoa_percent&lt; 0.635 2   0.00000000 3.250000 *
#&gt;                          1843) review_date&lt; 2007.5 1   0.00000000 4.000000 *
#&gt;                       461) cocoa_percent&gt;=0.665 33   2.99242400 3.265152  
#&gt;                         922) bean_type=Criollo, Trinitario,Forastero 8   0.34375000 3.187500  
#&gt;                          1844) review_date&lt; 2014.5 4   0.00000000 3.000000 *
#&gt;                          1845) review_date&gt;=2014.5 4   0.06250000 3.375000  
#&gt;                            3690) cocoa_percent&gt;=0.77 1   0.00000000 3.250000 *
#&gt;                            3691) cocoa_percent&lt; 0.77 3   0.04166667 3.416667  
#&gt;                              7382) broad_bean_origin=Costa Rica 2   0.03125000 3.375000 *
#&gt;                              7383) broad_bean_origin=Guatemala 1   0.00000000 3.500000 *
#&gt;                         923) bean_type=Criollo,Nacional,Trinitario 25   2.58500000 3.290000  
#&gt;                          1846) review_date&lt; 2009 1   0.00000000 2.750000 *
#&gt;                          1847) review_date&gt;=2009 24   2.28125000 3.312500  
#&gt;                            3694) broad_bean_origin=Gabon,Grenada,Guatemala,Papua New Guinea,Suriname 11   0.88636360 3.181818  
#&gt;                              7388) review_date&gt;=2013.5 4   0.25000000 3.000000  
#&gt;                               14776) review_date&lt; 2014.5 1   0.00000000 2.750000 *
#&gt;                               14777) review_date&gt;=2014.5 3   0.16666670 3.083333  
#&gt;                                 29554) cocoa_percent&lt; 0.715 2   0.12500000 3.000000  
#&gt;                                   59108) company_location=Canada 1   0.00000000 2.750000 *
#&gt;                                   59109) company_location=Suriname 1   0.00000000 3.250000 *
#&gt;                                 29555) cocoa_percent&gt;=0.715 1   0.00000000 3.250000 *
#&gt;                              7389) review_date&lt; 2013.5 7   0.42857140 3.285714  
#&gt;                               14778) broad_bean_origin=Gabon,Grenada 4   0.29687500 3.187500  
#&gt;                                 29556) company_location=Canada 1   0.00000000 2.750000 *
#&gt;                                 29557) company_location=France,Germany 3   0.04166667 3.333333  
#&gt;                                   59114) cocoa_percent&gt;=0.7 2   0.00000000 3.250000 *
#&gt;                                   59115) cocoa_percent&lt; 0.7 1   0.00000000 3.500000 *
#&gt;                               14779) broad_bean_origin=Guatemala,Papua New Guinea 3   0.04166667 3.416667  
#&gt;                                 29558) review_date&gt;=2012.5 1   0.00000000 3.250000 *
#&gt;                                 29559) review_date&lt; 2012.5 2   0.00000000 3.500000 *
#&gt;                            3695) broad_bean_origin=Bolivia,Fiji,Trinidad 13   1.04807700 3.423077  
#&gt;                              7390) review_date&lt; 2010.5 1   0.00000000 3.000000 *
#&gt;                              7391) review_date&gt;=2010.5 12   0.85416670 3.458333  
#&gt;                               14782) review_date&gt;=2013.5 5   0.55000000 3.300000  
#&gt;                                 29564) broad_bean_origin=Bolivia 3   0.29166670 3.166667  
#&gt;                                   59128) review_date&lt; 2014.5 1   0.00000000 2.750000 *
#&gt;                                   59129) review_date&gt;=2014.5 2   0.03125000 3.375000  
#&gt;                                    118258) review_date&lt; 2015.5 1   0.00000000 3.250000 *
#&gt;                                    118259) review_date&gt;=2015.5 1   0.00000000 3.500000 *
#&gt;                                 29565) broad_bean_origin=Trinidad 2   0.12500000 3.500000  
#&gt;                                   59130) review_date&gt;=2014.5 1   0.00000000 3.250000 *
#&gt;                                   59131) review_date&lt; 2014.5 1   0.00000000 3.750000 *
#&gt;                               14783) review_date&lt; 2013.5 7   0.08928571 3.571429  
#&gt;                                 29566) company_location=Fiji,France,Germany 4   0.00000000 3.500000 *
#&gt;                                 29567) company_location=Bolivia,Canada 3   0.04166667 3.666667  
#&gt;                                   59134) bean_type=Nacional 1   0.00000000 3.500000 *
#&gt;                                   59135) bean_type=Trinitario 1   0.00000000 3.750000 *
#&gt;                     231) broad_bean_origin=Colombia,Ghana,Sao Tome,Vanuatu 16   1.90234400 3.453125  
#&gt;                       462) review_date&lt; 2006.5 4   0.17187500 3.187500  
#&gt;                         924) broad_bean_origin=Sao Tome,Vanuatu 2   0.00000000 3.000000 *
#&gt;                         925) broad_bean_origin=Colombia,Ghana 2   0.03125000 3.375000  
#&gt;                          1850) bean_type=Forastero 1   0.00000000 3.250000 *
#&gt;                          1851) bean_type=Trinitario 1   0.00000000 3.500000 *
#&gt;                       463) review_date&gt;=2006.5 12   1.35416700 3.541667  
#&gt;                         926) company_location=Canada,France 9   1.05555600 3.472222  
#&gt;                          1852) cocoa_percent&lt; 0.725 7   0.73214290 3.392857  
#&gt;                            3704) bean_type=Forastero 6   0.58333330 3.333333  
#&gt;                              7408) cocoa_percent&gt;=0.675 4   0.29687500 3.187500  
#&gt;                               14816) broad_bean_origin=Sao Tome 1   0.00000000 2.750000 *
#&gt;                               14817) broad_bean_origin=Colombia,Ghana 3   0.04166667 3.333333  
#&gt;                                 29634) cocoa_percent&lt; 0.69 1   0.00000000 3.250000 *
#&gt;                                 29635) cocoa_percent&gt;=0.69 2   0.03125000 3.375000  
#&gt;                                   59270) review_date&gt;=2012.5 1   0.00000000 3.250000 *
#&gt;                                   59271) review_date&lt; 2012.5 1   0.00000000 3.500000 *
#&gt;                              7409) cocoa_percent&lt; 0.675 2   0.03125000 3.625000  
#&gt;                               14818) review_date&lt; 2011.5 1   0.00000000 3.500000 *
#&gt;                               14819) review_date&gt;=2011.5 1   0.00000000 3.750000 *
#&gt;                            3705) bean_type=Forastero (Amelonado) 1   0.00000000 3.750000 *
#&gt;                          1853) cocoa_percent&gt;=0.725 2   0.12500000 3.750000  
#&gt;                            3706) review_date&gt;=2011 1   0.00000000 3.500000 *
#&gt;                            3707) review_date&lt; 2011 1   0.00000000 4.000000 *
#&gt;                         927) company_location=Germany 3   0.12500000 3.750000  
#&gt;                          1854) review_date&lt; 2013.5 2   0.03125000 3.625000  
#&gt;                            3708) review_date&gt;=2010.5 1   0.00000000 3.500000 *
#&gt;                            3709) review_date&lt; 2010.5 1   0.00000000 3.750000 *
#&gt;                          1855) review_date&gt;=2013.5 1   0.00000000 4.000000 *
#&gt;                29) company_location=Argentina,Australia,Guatemala,Iceland,Netherlands,Poland,Singapore,Switzerland 52   6.43269200 3.384615  
#&gt;                  58) broad_bean_origin=Australia,Bolivia,Fiji,Guatemala,India,Papua New Guinea,South America, Africa,Trinidad,Vanuatu 33   4.36742400 3.265152  
#&gt;                   116) review_date&gt;=2007 32   3.81054700 3.242188  
#&gt;                     232) cocoa_percent&gt;=0.675 24   3.05989600 3.177083  
#&gt;                       464) review_date&gt;=2013.5 11   1.18181800 3.022727  
#&gt;                         928) broad_bean_origin=Australia,Bolivia,Vanuatu 5   0.20000000 2.850000  
#&gt;                          1856) cocoa_percent&lt; 0.76 3   0.00000000 2.750000 *
#&gt;                          1857) cocoa_percent&gt;=0.76 2   0.12500000 3.000000  
#&gt;                            3714) review_date&lt; 2014.5 1   0.00000000 2.750000 *
#&gt;                            3715) review_date&gt;=2014.5 1   0.00000000 3.250000 *
#&gt;                         929) broad_bean_origin=Guatemala,Papua New Guinea,Trinidad 6   0.70833330 3.166667  
#&gt;                          1858) cocoa_percent&lt; 0.69 2   0.00000000 2.750000 *
#&gt;                          1859) cocoa_percent&gt;=0.69 4   0.18750000 3.375000  
#&gt;                            3718) broad_bean_origin=Guatemala,Papua New Guinea 3   0.00000000 3.250000 *
#&gt;                            3719) broad_bean_origin=Trinidad 1   0.00000000 3.750000 *
#&gt;                       465) review_date&lt; 2013.5 13   1.39423100 3.307692  
#&gt;                         930) review_date&lt; 2011.5 8   0.36718750 3.156250  
#&gt;                          1860) broad_bean_origin=Guatemala,South America, Africa 3   0.04166667 2.916667  
#&gt;                            3720) review_date&gt;=2009.5 2   0.03125000 2.875000  
#&gt;                              7440) review_date&lt; 2010.5 1   0.00000000 2.750000 *
#&gt;                              7441) review_date&gt;=2010.5 1   0.00000000 3.000000 *
#&gt;                            3721) review_date&lt; 2009.5 1   0.00000000 3.000000 *
#&gt;                          1861) broad_bean_origin=Australia,Bolivia,India 5   0.05000000 3.300000  
#&gt;                            3722) cocoa_percent&gt;=0.69 3   0.00000000 3.250000 *
#&gt;                            3723) cocoa_percent&lt; 0.69 2   0.03125000 3.375000  
#&gt;                              7446) review_date&lt; 2010 1   0.00000000 3.250000 *
#&gt;                              7447) review_date&gt;=2010 1   0.00000000 3.500000 *
#&gt;                         931) review_date&gt;=2011.5 5   0.55000000 3.550000  
#&gt;                          1862) company_location=Switzerland 1   0.00000000 3.000000 *
#&gt;                          1863) company_location=Australia,Guatemala 4   0.17187500 3.687500  
#&gt;                            3726) bean_type=Forastero,Trinitario 3   0.04166667 3.583333  
#&gt;                              7452) company_location=Australia 2   0.00000000 3.500000 *
#&gt;                              7453) company_location=Guatemala 1   0.00000000 3.750000 *
#&gt;                            3727) bean_type=Criollo 1   0.00000000 4.000000 *
#&gt;                     233) cocoa_percent&lt; 0.675 8   0.34375000 3.437500  
#&gt;                       466) broad_bean_origin=Fiji,Guatemala,Vanuatu 3   0.00000000 3.250000 *
#&gt;                       467) broad_bean_origin=Australia,Bolivia,Papua New Guinea 5   0.17500000 3.550000  
#&gt;                         934) cocoa_percent&lt; 0.655 2   0.03125000 3.375000  
#&gt;                          1868) review_date&gt;=2015.5 1   0.00000000 3.250000 *
#&gt;                          1869) review_date&lt; 2015.5 1   0.00000000 3.500000 *
#&gt;                         935) cocoa_percent&gt;=0.655 3   0.04166667 3.666667  
#&gt;                          1870) broad_bean_origin=Papua New Guinea 1   0.00000000 3.500000 *
#&gt;                          1871) broad_bean_origin=Australia,Bolivia 2   0.00000000 3.750000 *
#&gt;                   117) review_date&lt; 2007 1   0.00000000 4.000000 *
#&gt;                  59) broad_bean_origin=Belize,Colombia,Ecuador,Ghana,Grenada,Tanzania 19   0.77631580 3.592105  
#&gt;                   118) review_date&lt; 2014.5 9   0.09722222 3.444444  
#&gt;                     236) broad_bean_origin=Tanzania 1   0.00000000 3.250000 *
#&gt;                     237) broad_bean_origin=Colombia,Ecuador,Ghana,Grenada 8   0.05468750 3.468750  
#&gt;                       474) company_location=Poland 3   0.04166667 3.416667  
#&gt;                         948) broad_bean_origin=Ecuador 1   0.00000000 3.250000 *
#&gt;                         949) broad_bean_origin=Colombia,Ghana 2   0.00000000 3.500000 *
#&gt;                       475) company_location=Argentina,Australia,Switzerland 5   0.00000000 3.500000 *
#&gt;                   119) review_date&gt;=2014.5 10   0.30625000 3.725000  
#&gt;                     238) company_location=Netherlands,Singapore 4   0.04687500 3.562500  
#&gt;                       476) cocoa_percent&gt;=0.685 3   0.00000000 3.500000 *
#&gt;                       477) cocoa_percent&lt; 0.685 1   0.00000000 3.750000 *
#&gt;                     239) company_location=Australia,Iceland 6   0.08333333 3.833333  
#&gt;                       478) broad_bean_origin=Belize,Tanzania 3   0.00000000 3.750000 *
#&gt;                       479) broad_bean_origin=Ecuador 3   0.04166667 3.916667  
#&gt;                         958) review_date&gt;=2015.5 2   0.03125000 3.875000 *
#&gt;                         959) review_date&lt; 2015.5 1   0.00000000 4.000000 *
#&gt;              15) broad_bean_origin=Brazil,Congo,DR, Ecuador, Peru,Dom. Rep., Madagascar,Domincan Republic,Dominican Republic,Gre., PNG, Haw., Haiti, Mad,Guat., D.R., Peru, Mad., PNG,Haiti,Hawaii,Honduras,Indonesia,Jamaica,Mad., Java, PNG,Madagascar,Nicaragua,PNG, Vanuatu, Mad,Peru,Peru, Dom. Rep,Philippines,Samoa,Sao Tome &amp; Principe,Solomon Islands,South America,Trinidad, Ecuador,Ven, Bolivia, D.R.,Ven.,Ecu.,Peru,Nic.,Venezuela,Vietnam 304  58.46854000 3.405428  
#&gt;                30) company_location=Austria,Denmark,Domincan Republic,Finland,France,Germany,Honduras,New Zealand,Scotland,Singapore,Switzerland,Vietnam 163  33.47853000 3.315951  
#&gt;                  60) cocoa_percent&gt;=0.81 8   2.87500000 2.750000  
#&gt;                   120) company_location=France 2   0.12500000 1.750000  
#&gt;                     240) review_date&gt;=2006.5 1   0.00000000 1.500000 *
#&gt;                     241) review_date&lt; 2006.5 1   0.00000000 2.000000 *
#&gt;                   121) company_location=Austria,Denmark,Domincan Republic,Switzerland,Vietnam 6   0.08333333 3.083333  
#&gt;                     242) company_location=Austria,Domincan Republic,Switzerland 4   0.00000000 3.000000 *
#&gt;                     243) company_location=Denmark,Vietnam 2   0.00000000 3.250000 *
#&gt;                  61) cocoa_percent&lt; 0.81 155  27.90887000 3.345161  
#&gt;                   122) cocoa_percent&lt; 0.625 12   3.68229200 2.979167  
#&gt;                     244) review_date&lt; 2007.5 2   0.00000000 2.000000 *
#&gt;                     245) review_date&gt;=2007.5 10   1.38125000 3.175000  
#&gt;                       490) review_date&gt;=2015.5 1   0.00000000 2.500000 *
#&gt;                       491) review_date&lt; 2015.5 9   0.87500000 3.250000  
#&gt;                         982) company_location=Denmark,Domincan Republic,France,Germany 8   0.59375000 3.187500  
#&gt;                          1964) review_date&gt;=2011.5 4   0.17187500 3.062500  
#&gt;                            3928) company_location=Denmark,France 2   0.03125000 2.875000  
#&gt;                              7856) review_date&lt; 2013.5 1   0.00000000 2.750000 *
#&gt;                              7857) review_date&gt;=2013.5 1   0.00000000 3.000000 *
#&gt;                            3929) company_location=Domincan Republic 2   0.00000000 3.250000 *
#&gt;                          1965) review_date&lt; 2011.5 4   0.29687500 3.312500  
#&gt;                            3930) review_date&gt;=2010 1   0.00000000 3.250000 *
#&gt;                            3931) review_date&lt; 2010 3   0.29166670 3.333333  
#&gt;                              7862) company_location=Germany 1   0.00000000 3.250000 *
#&gt;                              7863) company_location=France 2   0.28125000 3.375000 *
#&gt;                         983) company_location=Austria 1   0.00000000 3.750000 *
#&gt;                   123) cocoa_percent&gt;=0.625 143  22.48427000 3.375874  
#&gt;                     246) broad_bean_origin=Congo,Honduras,Madagascar,Peru,Solomon Islands,Vietnam 68  10.19485000 3.301471  
#&gt;                       492) company_location=Denmark,Germany,Singapore,Switzerland 12   0.55729170 3.020833  
#&gt;                         984) review_date&gt;=2015.5 3   0.04166667 2.833333  
#&gt;                          1968) cocoa_percent&lt; 0.705 2   0.00000000 2.750000 *
#&gt;                          1969) cocoa_percent&gt;=0.705 1   0.00000000 3.000000 *
#&gt;                         985) review_date&lt; 2015.5 9   0.37500000 3.083333  
#&gt;                          1970) review_date&lt; 2011.5 6   0.05208333 2.958333  
#&gt;                            3940) review_date&gt;=2009.5 2   0.03125000 2.875000  
#&gt;                              7880) review_date&lt; 2010.5 1   0.00000000 2.750000 *
#&gt;                              7881) review_date&gt;=2010.5 1   0.00000000 3.000000 *
#&gt;                            3941) review_date&lt; 2009.5 4   0.00000000 3.000000 *
#&gt;                          1971) review_date&gt;=2011.5 3   0.04166667 3.333333  
#&gt;                            3942) cocoa_percent&lt; 0.675 1   0.00000000 3.250000 *
#&gt;                            3943) cocoa_percent&gt;=0.675 2   0.03125000 3.375000  
#&gt;                              7886) company_location=Denmark 1   0.00000000 3.250000 *
#&gt;                              7887) company_location=Germany 1   0.00000000 3.500000 *
#&gt;                       493) company_location=Austria,Finland,France,Honduras,New Zealand,Scotland,Vietnam 56   8.48995500 3.361607  
#&gt;                         986) review_date&gt;=2008 51   6.98039200 3.313725  
#&gt;                          1972) cocoa_percent&gt;=0.715 26   3.87740400 3.201923  
#&gt;                            3944) review_date&lt; 2010 1   0.00000000 2.750000 *
#&gt;                            3945) review_date&gt;=2010 25   3.66500000 3.220000  
#&gt;                              7890) bean_type=Trinitario 15   1.45833300 3.166667  
#&gt;                               15780) company_location=France 7   0.75000000 3.000000  
#&gt;                                 31560) review_date&lt; 2014.5 4   0.04687500 2.937500  
#&gt;                                   63120) broad_bean_origin=Vietnam 2   0.03125000 2.875000  
#&gt;                                    126240) cocoa_percent&lt; 0.775 1   0.00000000 2.750000 *
#&gt;                                    126241) cocoa_percent&gt;=0.775 1   0.00000000 3.000000 *
#&gt;                                   63121) broad_bean_origin=Madagascar 2   0.00000000 3.000000 *
#&gt;                                 31561) review_date&gt;=2014.5 3   0.66666670 3.083333  
#&gt;                                   63122) broad_bean_origin=Madagascar 1   0.00000000 2.750000 *
#&gt;                                   63123) broad_bean_origin=Vietnam 2   0.50000000 3.250000 *
#&gt;                               15781) company_location=Honduras,New Zealand,Vietnam 8   0.34375000 3.312500  
#&gt;                                 31562) review_date&lt; 2011.5 1   0.00000000 3.000000 *
#&gt;                                 31563) review_date&gt;=2011.5 7   0.23214290 3.357143  
#&gt;                                   63126) cocoa_percent&gt;=0.79 2   0.03125000 3.125000  
#&gt;                                    126252) review_date&lt; 2013 1   0.00000000 3.000000 *
#&gt;                                    126253) review_date&gt;=2013 1   0.00000000 3.250000 *
#&gt;                                   63127) cocoa_percent&lt; 0.79 5   0.05000000 3.450000  
#&gt;                                    126254) company_location=New Zealand 1   0.00000000 3.250000 *
#&gt;                                    126255) company_location=Vietnam 4   0.00000000 3.500000 *
#&gt;                              7891) bean_type=Criollo,Forastero (Nacional) 10   2.10000000 3.300000  
#&gt;                               15782) review_date&gt;=2011.5 7   1.35714300 3.142857  
#&gt;                                 31564) review_date&lt; 2014 4   0.31250000 2.875000  
#&gt;                                   63128) review_date&gt;=2012.5 1   0.00000000 2.500000 *
#&gt;                                   63129) review_date&lt; 2012.5 3   0.12500000 3.000000  
#&gt;                                    126258) broad_bean_origin=Peru 2   0.03125000 2.875000 *
#&gt;                                    126259) broad_bean_origin=Madagascar 1   0.00000000 3.250000 *
#&gt;                                 31565) review_date&gt;=2014 3   0.37500000 3.500000  
#&gt;                                   63130) company_location=France 2   0.00000000 3.250000 *
#&gt;                                   63131) company_location=Scotland 1   0.00000000 4.000000 *
#&gt;                               15783) review_date&lt; 2011.5 3   0.16666670 3.666667  
#&gt;                                 31566) broad_bean_origin=Peru 2   0.00000000 3.500000 *
#&gt;                                 31567) broad_bean_origin=Madagascar 1   0.00000000 4.000000 *
#&gt;                          1973) cocoa_percent&lt; 0.715 25   2.44000000 3.430000  
#&gt;                            3946) cocoa_percent&gt;=0.64 24   2.10156200 3.406250  
#&gt;                              7892) cocoa_percent&lt; 0.69 4   0.31250000 3.125000  
#&gt;                               15784) review_date&lt; 2014 3   0.12500000 3.000000  
#&gt;                                 31568) company_location=Scotland 1   0.00000000 2.750000 *
#&gt;                                 31569) company_location=Austria 2   0.03125000 3.125000  
#&gt;                                   63138) review_date&lt; 2011.5 1   0.00000000 3.000000 *
#&gt;                                   63139) review_date&gt;=2011.5 1   0.00000000 3.250000 *
#&gt;                               15785) review_date&gt;=2014 1   0.00000000 3.500000 *
#&gt;                              7893) cocoa_percent&gt;=0.69 20   1.40937500 3.462500  
#&gt;                               15786) broad_bean_origin=Madagascar,Solomon Islands 5   0.25000000 3.250000  
#&gt;                                 31572) bean_type=Trinitario 1   0.00000000 3.000000 *
#&gt;                                 31573) bean_type=Criollo,Criollo, Trinitario 4   0.17187500 3.312500  
#&gt;                                   63146) company_location=France,New Zealand 2   0.03125000 3.125000  
#&gt;                                    126292) review_date&lt; 2014.5 1   0.00000000 3.000000 *
#&gt;                                    126293) review_date&gt;=2014.5 1   0.00000000 3.250000 *
#&gt;                                   63147) company_location=Austria,Finland 2   0.00000000 3.500000 *
#&gt;                               15787) broad_bean_origin=Congo,Honduras,Peru,Vietnam 15   0.85833330 3.533333  
#&gt;                                 31574) bean_type=Criollo (Amarru) 2   0.12500000 3.250000 *
#&gt;                                 31575) bean_type=Forastero,Forastero (Nacional),Trinitario 13   0.54807690 3.576923  
#&gt;                                   63150) company_location=France,Honduras,New Zealand 8   0.37500000 3.500000  
#&gt;                                    126300) broad_bean_origin=Vietnam 2   0.03125000 3.375000  
#&gt;                                      252600) review_date&gt;=2013 1   0.00000000 3.250000 *
#&gt;                                      252601) review_date&lt; 2013 1   0.00000000 3.500000 *
#&gt;                                    126301) broad_bean_origin=Honduras,Peru 6   0.30208330 3.541667  
#&gt;                                      252602) review_date&lt; 2013.5 2   0.03125000 3.375000 *
#&gt;                                      252603) review_date&gt;=2013.5 4   0.18750000 3.625000  
#&gt;                                        505206) review_date&gt;=2014.5 2   0.00000000 3.500000 *
#&gt;                                        505207) review_date&lt; 2014.5 2   0.12500000 3.750000  
#&gt;                                         1010414) company_location=Honduras 1   0.00000000 3.500000 *
#&gt;                                         1010415) company_location=France 1   0.00000000 4.000000 *
#&gt;                                   63151) company_location=Austria,Scotland,Vietnam 5   0.05000000 3.700000  
#&gt;                                    126302) review_date&lt; 2012.5 2   0.03125000 3.625000  
#&gt;                                      252604) review_date&gt;=2011.5 1   0.00000000 3.500000 *
#&gt;                                      252605) review_date&lt; 2011.5 1   0.00000000 3.750000 *
#&gt;                                    126303) review_date&gt;=2012.5 3   0.00000000 3.750000 *
#&gt;                            3947) cocoa_percent&lt; 0.64 1   0.00000000 4.000000 *
#&gt;                         987) review_date&lt; 2008 5   0.20000000 3.850000  
#&gt;                          1974) cocoa_percent&lt; 0.645 2   0.12500000 3.750000  
#&gt;                            3948) review_date&lt; 2006.5 1   0.00000000 3.500000 *
#&gt;                            3949) review_date&gt;=2006.5 1   0.00000000 4.000000 *
#&gt;                          1975) cocoa_percent&gt;=0.645 3   0.04166667 3.916667  
#&gt;                            3950) bean_type=Criollo 1   0.00000000 3.750000 *
#&gt;                            3951) bean_type=Trinitario 2   0.00000000 4.000000 *
#&gt;                     247) broad_bean_origin=Brazil,Domincan Republic,Dominican Republic,Haiti,Indonesia,Jamaica,Nicaragua,Samoa,Sao Tome &amp; Principe,Venezuela 75  11.57167000 3.443333  
#&gt;                       494) bean_type=Blend,Criollo (Ocumare 61),Criollo (Porcelana),Trinitario, Criollo 10   0.72500000 3.300000  
#&gt;                         988) review_date&lt; 2008.5 4   0.04687500 3.062500  
#&gt;                          1976) review_date&lt; 2006.5 2   0.00000000 3.000000 *
#&gt;                          1977) review_date&gt;=2006.5 2   0.03125000 3.125000  
#&gt;                            3954) review_date&gt;=2007.5 1   0.00000000 3.000000 *
#&gt;                            3955) review_date&lt; 2007.5 1   0.00000000 3.250000 *
#&gt;                         989) review_date&gt;=2008.5 6   0.30208330 3.458333  
#&gt;                          1978) cocoa_percent&gt;=0.68 3   0.00000000 3.250000 *
#&gt;                          1979) cocoa_percent&lt; 0.68 3   0.04166667 3.666667  
#&gt;                            3958) review_date&gt;=2012 1   0.00000000 3.500000 *
#&gt;                            3959) review_date&lt; 2012 2   0.00000000 3.750000 *
#&gt;                       495) bean_type=Criollo,Criollo, Trinitario,Forastero,Trinitario 65  10.60962000 3.465385  
#&gt;                         990) review_date&gt;=2008.5 53   8.97169800 3.419811  
#&gt;                          1980) review_date&lt; 2010.5 10   2.27500000 3.150000  
#&gt;                            3960) company_location=France 4   1.17187500 2.812500  
#&gt;                              7920) review_date&lt; 2009.5 2   0.28125000 2.375000  
#&gt;                               15840) cocoa_percent&gt;=0.725 1   0.00000000 2.000000 *
#&gt;                               15841) cocoa_percent&lt; 0.725 1   0.00000000 2.750000 *
#&gt;                              7921) review_date&gt;=2009.5 2   0.12500000 3.250000  
#&gt;                               15842) cocoa_percent&lt; 0.725 1   0.00000000 3.000000 *
#&gt;                               15843) cocoa_percent&gt;=0.725 1   0.00000000 3.500000 *
#&gt;                            3961) company_location=Germany,Switzerland 6   0.34375000 3.375000  
#&gt;                              7922) bean_type=Trinitario 4   0.12500000 3.250000  
#&gt;                               15844) cocoa_percent&lt; 0.71 2   0.03125000 3.125000  
#&gt;                                 31688) company_location=Germany 1   0.00000000 3.000000 *
#&gt;                                 31689) company_location=Switzerland 1   0.00000000 3.250000 *
#&gt;                               15845) cocoa_percent&gt;=0.71 2   0.03125000 3.375000  
#&gt;                                 31690) company_location=Germany 1   0.00000000 3.250000 *
#&gt;                                 31691) company_location=Switzerland 1   0.00000000 3.500000 *
#&gt;                              7923) bean_type=Criollo, Trinitario 2   0.03125000 3.625000 *
#&gt;                          1981) review_date&gt;=2010.5 43   5.79941900 3.482558  
#&gt;                            3962) review_date&gt;=2011.5 29   4.30172400 3.405172  
#&gt;                              7924) cocoa_percent&lt; 0.685 3   0.29166670 3.083333  
#&gt;                               15848) company_location=Germany,Switzerland 2   0.03125000 2.875000  
#&gt;                                 31696) review_date&lt; 2014 1   0.00000000 2.750000 *
#&gt;                                 31697) review_date&gt;=2014 1   0.00000000 3.000000 *
#&gt;                               15849) company_location=France 1   0.00000000 3.500000 *
#&gt;                              7925) cocoa_percent&gt;=0.685 26   3.66346200 3.442308  
#&gt;                               15850) company_location=Denmark,Domincan Republic,France,New Zealand 20   3.18750000 3.375000  
#&gt;                                 31700) cocoa_percent&gt;=0.71 7   1.46428600 3.178571  
#&gt;                                   63400) broad_bean_origin=Venezuela 3   0.12500000 2.750000  
#&gt;                                    126800) review_date&lt; 2013.5 1   0.00000000 2.500000 *
#&gt;                                    126801) review_date&gt;=2013.5 2   0.03125000 2.875000  
#&gt;                                      253602) review_date&gt;=2015 1   0.00000000 2.750000 *
#&gt;                                      253603) review_date&lt; 2015 1   0.00000000 3.000000 *
#&gt;                                   63401) broad_bean_origin=Brazil,Dominican Republic 4   0.37500000 3.500000  
#&gt;                                    126802) review_date&gt;=2014.5 1   0.00000000 3.250000 *
#&gt;                                    126803) review_date&lt; 2014.5 3   0.29166670 3.583333  
#&gt;                                      253606) broad_bean_origin=Dominican Republic 1   0.00000000 3.250000 *
#&gt;                                      253607) broad_bean_origin=Brazil 2   0.12500000 3.750000  
#&gt;                                        507214) review_date&lt; 2013.5 1   0.00000000 3.500000 *
#&gt;                                        507215) review_date&gt;=2013.5 1   0.00000000 4.000000 *
#&gt;                                 31701) cocoa_percent&lt; 0.71 13   1.30769200 3.480769  
#&gt;                                   63402) bean_type=Criollo,Criollo, Trinitario 11   1.01136400 3.431818  
#&gt;                                    126804) cocoa_percent&gt;=0.695 10   0.65625000 3.375000  
#&gt;                                      253608) broad_bean_origin=Brazil,Venezuela 3   0.29166670 3.166667  
#&gt;                                        507216) review_date&gt;=2013.5 2   0.28125000 3.125000 *
#&gt;                                        507217) review_date&lt; 2013.5 1   0.00000000 3.250000 *
#&gt;                                      253609) broad_bean_origin=Dominican Republic,Nicaragua,Samoa 7   0.17857140 3.464286  
#&gt;                                        507218) review_date&lt; 2012.5 3   0.16666670 3.416667 *
#&gt;                                        507219) review_date&gt;=2012.5 4   0.00000000 3.500000 *
#&gt;                                    126805) cocoa_percent&lt; 0.695 1   0.00000000 4.000000 *
#&gt;                                   63403) bean_type=Trinitario 2   0.12500000 3.750000  
#&gt;                                    126806) review_date&gt;=2014.5 1   0.00000000 3.500000 *
#&gt;                                    126807) review_date&lt; 2014.5 1   0.00000000 4.000000 *
#&gt;                               15851) company_location=Austria,Germany,Scotland,Switzerland 6   0.08333333 3.666667  
#&gt;                                 31702) broad_bean_origin=Domincan Republic 2   0.00000000 3.500000 *
#&gt;                                 31703) broad_bean_origin=Dominican Republic,Sao Tome &amp; Principe,Venezuela 4   0.00000000 3.750000 *
#&gt;                            3963) review_date&lt; 2011.5 14   0.96428570 3.642857  
#&gt;                              7926) broad_bean_origin=Nicaragua 4   0.04687500 3.437500  
#&gt;                               15852) company_location=Denmark 3   0.04166667 3.416667 *
#&gt;                               15853) company_location=France 1   0.00000000 3.500000 *
#&gt;                              7927) broad_bean_origin=Brazil,Haiti,Indonesia,Venezuela 10   0.68125000 3.725000  
#&gt;                               15854) broad_bean_origin=Brazil,Indonesia,Venezuela 9   0.59722220 3.694444  
#&gt;                                 31708) cocoa_percent&gt;=0.68 8   0.49218750 3.656250  
#&gt;                                   63416) bean_type=Criollo 7   0.48214290 3.642857  
#&gt;                                    126832) cocoa_percent&gt;=0.735 2   0.03125000 3.625000 *
#&gt;                                    126833) cocoa_percent&lt; 0.735 5   0.45000000 3.650000 *
#&gt;                                   63417) bean_type=Trinitario 1   0.00000000 3.750000 *
#&gt;                                 31709) cocoa_percent&lt; 0.68 1   0.00000000 4.000000 *
#&gt;                               15855) broad_bean_origin=Haiti 1   0.00000000 4.000000 *
#&gt;                         991) review_date&lt; 2008.5 12   1.04166700 3.666667  
#&gt;                          1982) broad_bean_origin=Brazil,Indonesia,Sao Tome &amp; Principe 4   0.18750000 3.375000  
#&gt;                            3964) broad_bean_origin=Brazil 2   0.12500000 3.250000  
#&gt;                              7928) review_date&lt; 2007 1   0.00000000 3.000000 *
#&gt;                              7929) review_date&gt;=2007 1   0.00000000 3.500000 *
#&gt;                            3965) broad_bean_origin=Indonesia,Sao Tome &amp; Principe 2   0.00000000 3.500000 *
#&gt;                          1983) broad_bean_origin=Jamaica,Venezuela 8   0.34375000 3.812500  
#&gt;                            3966) review_date&gt;=2006.5 3   0.04166667 3.666667  
#&gt;                              7932) cocoa_percent&gt;=0.655 2   0.03125000 3.625000  
#&gt;                               15864) review_date&lt; 2007.5 1   0.00000000 3.500000 *
#&gt;                               15865) review_date&gt;=2007.5 1   0.00000000 3.750000 *
#&gt;                              7933) cocoa_percent&lt; 0.655 1   0.00000000 3.750000 *
#&gt;                            3967) review_date&lt; 2006.5 5   0.20000000 3.900000  
#&gt;                              7934) bean_type=Trinitario 4   0.18750000 3.875000  
#&gt;                               15868) broad_bean_origin=Venezuela 3   0.16666670 3.833333 *
#&gt;                               15869) broad_bean_origin=Jamaica 1   0.00000000 4.000000 *
#&gt;                              7935) bean_type=Criollo 1   0.00000000 4.000000 *
#&gt;                31) company_location=Amsterdam,Argentina,Australia,Brazil,Canada,Chile,Guatemala,Italy,Netherlands,Philippines,Poland,Sao Tome 141  22.17642000 3.508865  
#&gt;                  62) bean_type=Criollo,Criollo (Ocumare 61),Criollo, Trinitario,Forastero,Forastero (Catongo),Forastero (Nacional),Trinitario,Trinitario (Scavina),Trinitario, Criollo 107  14.94159000 3.476636  
#&gt;                   124) broad_bean_origin=Brazil,Domincan Republic,Dominican Republic,Haiti,Hawaii,Indonesia,Jamaica,Madagascar,Nicaragua,Peru,Philippines,Sao Tome &amp; Principe,South America,Venezuela,Vietnam 101  13.83911000 3.452970  
#&gt;                     248) cocoa_percent&gt;=0.79 5   0.80000000 3.050000  
#&gt;                       496) broad_bean_origin=Sao Tome &amp; Principe,Venezuela 4   0.18750000 2.875000  
#&gt;                         992) bean_type=Criollo 1   0.00000000 2.500000 *
#&gt;                         993) bean_type=Forastero 1   0.00000000 3.000000 *
#&gt;                       497) broad_bean_origin=Peru 1   0.00000000 3.750000 *
#&gt;                     249) cocoa_percent&lt; 0.79 96  12.18490000 3.473958  
#&gt;                       498) company_location=Amsterdam,Argentina,Australia,Brazil,Canada,Italy,Netherlands,Philippines 89  11.39747000 3.449438  
#&gt;                         996) broad_bean_origin=Dominican Republic,Haiti 20   1.98437500 3.312500  
#&gt;                          1992) cocoa_percent&gt;=0.71 10   0.97500000 3.200000  
#&gt;                            3984) cocoa_percent&lt; 0.76 9   0.63888890 3.138889  
#&gt;                              7968) review_date&lt; 2014.5 6   0.42708330 3.041667  
#&gt;                               15936) review_date&gt;=2011.5 5   0.17500000 2.950000  
#&gt;                                 31872) cocoa_percent&lt; 0.745 4   0.06250000 2.875000  
#&gt;                                   63744) cocoa_percent&gt;=0.73 1   0.00000000 2.750000 *
#&gt;                                   63745) cocoa_percent&lt; 0.73 3   0.04166667 2.916667  
#&gt;                                    127490) review_date&lt; 2013.5 2   0.03125000 2.875000 *
#&gt;                                    127491) review_date&gt;=2013.5 1   0.00000000 3.000000 *
#&gt;                                 31873) cocoa_percent&gt;=0.745 1   0.00000000 3.250000 *
#&gt;                               15937) review_date&lt; 2011.5 1   0.00000000 3.500000 *
#&gt;                              7969) review_date&gt;=2014.5 3   0.04166667 3.333333  
#&gt;                               15938) review_date&lt; 2015.5 2   0.00000000 3.250000 *
#&gt;                               15939) review_date&gt;=2015.5 1   0.00000000 3.500000 *
#&gt;                            3985) cocoa_percent&gt;=0.76 1   0.00000000 3.750000 *
#&gt;                          1993) cocoa_percent&lt; 0.71 10   0.75625000 3.425000  
#&gt;                            3986) review_date&lt; 2010.5 2   0.00000000 3.000000 *
#&gt;                            3987) review_date&gt;=2010.5 8   0.30468750 3.531250  
#&gt;                              7974) broad_bean_origin=Haiti 1   0.00000000 3.250000 *
#&gt;                              7975) broad_bean_origin=Dominican Republic 7   0.21428570 3.571429  
#&gt;                               15950) review_date&gt;=2015.5 2   0.03125000 3.375000  
#&gt;                                 31900) company_location=Canada 1   0.00000000 3.250000 *
#&gt;                                 31901) company_location=Australia 1   0.00000000 3.500000 *
#&gt;                               15951) review_date&lt; 2015.5 5   0.07500000 3.650000  
#&gt;                                 31902) company_location=Australia 1   0.00000000 3.500000 *
#&gt;                                 31903) company_location=Canada 4   0.04687500 3.687500  
#&gt;                                   63806) review_date&gt;=2012.5 3   0.04166667 3.666667 *
#&gt;                                   63807) review_date&lt; 2012.5 1   0.00000000 3.750000 *
#&gt;                         997) broad_bean_origin=Brazil,Domincan Republic,Hawaii,Indonesia,Jamaica,Madagascar,Nicaragua,Peru,Philippines,South America,Venezuela,Vietnam 69   8.92934800 3.489130  
#&gt;                          1994) cocoa_percent&lt; 0.675 11   1.13636400 3.318182  
#&gt;                            3988) review_date&gt;=2011.5 9   0.62500000 3.250000  
#&gt;                              7976) broad_bean_origin=Brazil,Hawaii,Peru,Venezuela 4   0.04687500 3.187500  
#&gt;                               15952) review_date&gt;=2014.5 1   0.00000000 3.000000 *
#&gt;                               15953) review_date&lt; 2014.5 3   0.00000000 3.250000 *
#&gt;                              7977) broad_bean_origin=Madagascar,Philippines 5   0.55000000 3.300000  
#&gt;                               15954) cocoa_percent&lt; 0.665 4   0.29687500 3.187500  
#&gt;                                 31908) company_location=Canada 2   0.12500000 3.000000  
#&gt;                                   63816) review_date&lt; 2014.5 1   0.00000000 2.750000 *
#&gt;                                   63817) review_date&gt;=2014.5 1   0.00000000 3.250000 *
#&gt;                                 31909) company_location=Australia,Philippines 2   0.03125000 3.375000  
#&gt;                                   63818) review_date&gt;=2014 1   0.00000000 3.250000 *
#&gt;                                   63819) review_date&lt; 2014 1   0.00000000 3.500000 *
#&gt;                               15955) cocoa_percent&gt;=0.665 1   0.00000000 3.750000 *
#&gt;                            3989) review_date&lt; 2011.5 2   0.28125000 3.625000  
#&gt;                              7978) review_date&lt; 2009 1   0.00000000 3.250000 *
#&gt;                              7979) review_date&gt;=2009 1   0.00000000 4.000000 *
#&gt;                          1995) cocoa_percent&gt;=0.675 58   7.41056000 3.521552  
#&gt;                            3990) bean_type=Criollo (Ocumare 61),Trinitario, Criollo 2   0.00000000 3.250000 *
#&gt;                            3991) bean_type=Criollo,Criollo, Trinitario,Forastero,Forastero (Catongo),Forastero (Nacional),Trinitario,Trinitario (Scavina) 56   7.25781200 3.531250  
#&gt;                              7982) cocoa_percent&lt; 0.74 54   6.98148100 3.518519  
#&gt;                               15964) cocoa_percent&gt;=0.71 4   0.79687500 3.312500  
#&gt;                                 31928) company_location=Australia,Italy 2   0.03125000 2.875000  
#&gt;                                   63856) review_date&lt; 2013 1   0.00000000 2.750000 *
#&gt;                                   63857) review_date&gt;=2013 1   0.00000000 3.000000 *
#&gt;                                 31929) company_location=Canada 2   0.00000000 3.750000 *
#&gt;                               15965) cocoa_percent&lt; 0.71 50   6.00125000 3.535000  
#&gt;                                 31930) company_location=Amsterdam,Argentina,Brazil,Canada,Italy,Netherlands 44   5.61931800 3.511364  
#&gt;                                   63860) review_date&gt;=2007.5 37   2.99324300 3.486486  
#&gt;                                    127720) broad_bean_origin=Brazil,Indonesia,Madagascar,Nicaragua,Peru,South America,Venezuela,Vietnam 35   2.64285700 3.464286  
#&gt;                                      255440) bean_type=Criollo,Criollo, Trinitario,Forastero,Forastero (Catongo),Trinitario,Trinitario (Scavina) 33   2.46969700 3.446970  
#&gt;                                        510880) review_date&lt; 2010.5 8   0.74218750 3.343750  
#&gt;                                         1021760) company_location=Italy 2   0.00000000 3.000000 *
#&gt;                                         1021761) company_location=Argentina,Canada 6   0.42708330 3.458333  
#&gt;                                           2043522) review_date&gt;=2008.5 3   0.29166670 3.333333  
#&gt;                                             4087044) company_location=Argentina 1   0.00000000 3.250000 *
#&gt;                                             4087045) company_location=Canada 2   0.28125000 3.375000 *
#&gt;                                           2043523) review_date&lt; 2008.5 3   0.04166667 3.583333  
#&gt;                                             4087046) bean_type=Forastero,Trinitario 2   0.00000000 3.500000 *
#&gt;                                             4087047) bean_type=Criollo 1   0.00000000 3.750000 *
#&gt;                                        510881) review_date&gt;=2010.5 25   1.61500000 3.480000  
#&gt;                                         1021762) broad_bean_origin=Indonesia,Peru 4   0.54687500 3.312500  
#&gt;                                           2043524) review_date&gt;=2012.5 3   0.29166670 3.166667  
#&gt;                                             4087048) cocoa_percent&gt;=0.69 2   0.12500000 3.000000  
#&gt;                                               8174096) broad_bean_origin=Peru 1   0.00000000 2.750000 *
#&gt;                                               8174097) broad_bean_origin=Indonesia 1   0.00000000 3.250000 *
#&gt;                                             4087049) cocoa_percent&lt; 0.69 1   0.00000000 3.500000 *
#&gt;                                           2043525) review_date&lt; 2012.5 1   0.00000000 3.750000 *
#&gt;                                         1021763) broad_bean_origin=Brazil,Madagascar,Nicaragua,South America,Venezuela,Vietnam 21   0.93452380 3.511905  
#&gt;                                           2043526) review_date&gt;=2013.5 13   0.39423080 3.442308  
#&gt;                                             4087052) review_date&lt; 2014.5 4   0.17187500 3.312500  
#&gt;                                               8174104) broad_bean_origin=Nicaragua 1   0.00000000 3.250000 *
#&gt;                                               8174105) broad_bean_origin=Madagascar 1   0.00000000 3.500000 *
#&gt;                                             4087053) review_date&gt;=2014.5 9   0.12500000 3.500000  
#&gt;                                               8174106) broad_bean_origin=Venezuela 2   0.03125000 3.375000 *
#&gt;                                               8174107) broad_bean_origin=Brazil,Madagascar,Nicaragua,South America,Vietnam 7   0.05357143 3.535714  
#&gt;                                                16348214) broad_bean_origin=Brazil,Madagascar,South America,Vietnam 5   0.00000000 3.500000 *
#&gt;                                                16348215) broad_bean_origin=Nicaragua 2   0.03125000 3.625000  
#&gt;                                                  32696430) review_date&gt;=2016.5 1   0.00000000 3.500000 *
#&gt;                                                  32696431) review_date&lt; 2016.5 1   0.00000000 3.750000 *
#&gt;                                           2043527) review_date&lt; 2013.5 8   0.37500000 3.625000  
#&gt;                                             4087054) bean_type=Forastero,Forastero (Catongo) 3   0.12500000 3.500000 *
#&gt;                                             4087055) bean_type=Criollo 5   0.17500000 3.700000  
#&gt;                                               8174110) review_date&lt; 2011.5 2   0.00000000 3.500000 *
#&gt;                                               8174111) review_date&gt;=2011.5 3   0.04166667 3.833333  
#&gt;                                                16348222) review_date&lt; 2012.5 1   0.00000000 3.750000 *
#&gt;                                                16348223) review_date&gt;=2012.5 2   0.03125000 3.875000 *
#&gt;                                      255441) bean_type=Forastero (Nacional) 2   0.00000000 3.750000 *
#&gt;                                    127721) broad_bean_origin=Hawaii,Jamaica 2   0.03125000 3.875000  
#&gt;                                      255442) review_date&lt; 2012.5 1   0.00000000 3.750000 *
#&gt;                                      255443) review_date&gt;=2012.5 1   0.00000000 4.000000 *
#&gt;                                   63861) review_date&lt; 2007.5 7   2.48214300 3.642857  
#&gt;                                    127722) broad_bean_origin=Indonesia,Jamaica,Madagascar,Peru 5   0.32500000 3.400000  
#&gt;                                      255444) broad_bean_origin=Jamaica,Peru 2   0.03125000 3.125000  
#&gt;                                        510888) review_date&gt;=2006.5 1   0.00000000 3.000000 *
#&gt;                                        510889) review_date&lt; 2006.5 1   0.00000000 3.250000 *
#&gt;                                      255445) broad_bean_origin=Indonesia,Madagascar 3   0.04166667 3.583333  
#&gt;                                        510890) broad_bean_origin=Madagascar 2   0.00000000 3.500000 *
#&gt;                                        510891) broad_bean_origin=Indonesia 1   0.00000000 3.750000 *
#&gt;                                    127723) broad_bean_origin=Venezuela 2   1.12500000 4.250000  
#&gt;                                      255446) review_date&lt; 2006.5 1   0.00000000 3.500000 *
#&gt;                                      255447) review_date&gt;=2006.5 1   0.00000000 5.000000 *
#&gt;                                 31931) company_location=Australia 6   0.17708330 3.708333  
#&gt;                                   63862) review_date&gt;=2014 5   0.07500000 3.650000  
#&gt;                                    127724) broad_bean_origin=Domincan Republic,Madagascar 3   0.04166667 3.583333  
#&gt;                                      255448) review_date&lt; 2015.5 1   0.00000000 3.500000 *
#&gt;                                      255449) review_date&gt;=2015.5 2   0.03125000 3.625000  
#&gt;                                        510898) broad_bean_origin=Domincan Republic 1   0.00000000 3.500000 *
#&gt;                                        510899) broad_bean_origin=Madagascar 1   0.00000000 3.750000 *
#&gt;                                    127725) broad_bean_origin=Venezuela 2   0.00000000 3.750000 *
#&gt;                                   63863) review_date&lt; 2014 1   0.00000000 4.000000 *
#&gt;                              7983) cocoa_percent&gt;=0.74 2   0.03125000 3.875000  
#&gt;                               15966) review_date&lt; 2014.5 1   0.00000000 3.750000 *
#&gt;                               15967) review_date&gt;=2014.5 1   0.00000000 4.000000 *
#&gt;                       499) company_location=Chile,Guatemala,Poland,Sao Tome 7   0.05357143 3.785714  
#&gt;                         998) review_date&gt;=2009 6   0.00000000 3.750000 *
#&gt;                         999) review_date&lt; 2009 1   0.00000000 4.000000 *
#&gt;                   125) broad_bean_origin=Guat., D.R., Peru, Mad., PNG,PNG, Vanuatu, Mad,Peru, Dom. Rep,Solomon Islands,Ven, Bolivia, D.R.,Ven.,Ecu.,Peru,Nic. 6   0.09375000 3.875000  
#&gt;                     250) broad_bean_origin=PNG, Vanuatu, Mad,Solomon Islands,Ven.,Ecu.,Peru,Nic. 3   0.00000000 3.750000 *
#&gt;                     251) broad_bean_origin=Guat., D.R., Peru, Mad., PNG,Peru, Dom. Rep,Ven, Bolivia, D.R. 3   0.00000000 4.000000 *
#&gt;                  63) bean_type=Blend,Blend-Forastero,Criollo,Criollo (Ocumare 67),Criollo (Ocumare 77),Criollo (Porcelana),Forastero (Parazinho),Trinitario (85% Criollo),Trinitario, Nacional 34   6.77389700 3.610294  
#&gt;                   126) review_date&gt;=2006.5 33   4.78409100 3.568182  
#&gt;                     252) broad_bean_origin=Brazil,Mad., Java, PNG,Trinidad, Ecuador 18   2.52777800 3.361111  
#&gt;                       504) company_location=Australia 1   0.00000000 2.500000 *
#&gt;                       505) company_location=Brazil,Canada 17   1.74264700 3.411765  
#&gt;                        1010) review_date&lt; 2009.5 2   0.00000000 3.000000 *
#&gt;                        1011) review_date&gt;=2009.5 15   1.35833300 3.466667  
#&gt;                          2022) review_date&gt;=2011 12   0.81250000 3.375000  
#&gt;                            4044) cocoa_percent&lt; 0.625 2   0.03125000 2.875000  
#&gt;                              8088) review_date&gt;=2012.5 1   0.00000000 2.750000 *
#&gt;                              8089) review_date&lt; 2012.5 1   0.00000000 3.000000 *
#&gt;                            4045) cocoa_percent&gt;=0.625 10   0.18125000 3.475000  
#&gt;                              8090) review_date&lt; 2013.5 4   0.06250000 3.375000  
#&gt;                               16180) review_date&gt;=2012.5 3   0.04166667 3.333333  
#&gt;                                 32360) cocoa_percent&lt; 0.825 2   0.00000000 3.250000 *
#&gt;                                 32361) cocoa_percent&gt;=0.825 1   0.00000000 3.500000 *
#&gt;                               16181) review_date&lt; 2012.5 1   0.00000000 3.500000 *
#&gt;                              8091) review_date&gt;=2013.5 6   0.05208333 3.541667  
#&gt;                               16182) review_date&lt; 2015.5 4   0.00000000 3.500000 *
#&gt;                               16183) review_date&gt;=2015.5 2   0.03125000 3.625000  
#&gt;                                 32366) cocoa_percent&lt; 0.725 1   0.00000000 3.500000 *
#&gt;                                 32367) cocoa_percent&gt;=0.725 1   0.00000000 3.750000 *
#&gt;                          2023) review_date&lt; 2011 3   0.04166667 3.833333  
#&gt;                            4046) cocoa_percent&lt; 0.55 1   0.00000000 3.750000 *
#&gt;                            4047) cocoa_percent&gt;=0.55 2   0.03125000 3.875000  
#&gt;                              8094) cocoa_percent&gt;=0.675 1   0.00000000 3.750000 *
#&gt;                              8095) cocoa_percent&lt; 0.675 1   0.00000000 4.000000 *
#&gt;                     253) broad_bean_origin=DR, Ecuador, Peru,Dom. Rep., Madagascar,Dominican Republic,Gre., PNG, Haw., Haiti, Mad,Madagascar,Venezuela 15   0.55833330 3.816667  
#&gt;                       506) bean_type=Blend,Blend-Forastero,Criollo,Criollo (Ocumare 77),Trinitario, Nacional 10   0.37500000 3.750000  
#&gt;                        1012) company_location=Italy 7   0.21428570 3.678571  
#&gt;                          2024) cocoa_percent&gt;=0.765 1   0.00000000 3.500000 *
#&gt;                          2025) cocoa_percent&lt; 0.765 6   0.17708330 3.708333  
#&gt;                            4050) cocoa_percent&lt; 0.725 5   0.07500000 3.650000  
#&gt;                              8100) bean_type=Blend 3   0.04166667 3.583333  
#&gt;                               16200) review_date&lt; 2007.5 1   0.00000000 3.500000 *
#&gt;                               16201) review_date&gt;=2007.5 2   0.03125000 3.625000  
#&gt;                                 32402) review_date&gt;=2011 1   0.00000000 3.500000 *
#&gt;                                 32403) review_date&lt; 2011 1   0.00000000 3.750000 *
#&gt;                              8101) bean_type=Blend-Forastero,Criollo,Criollo (Ocumare 77) 2   0.00000000 3.750000 *
#&gt;                            4051) cocoa_percent&gt;=0.725 1   0.00000000 4.000000 *
#&gt;                        1013) company_location=Canada 3   0.04166667 3.916667  
#&gt;                          2026) review_date&lt; 2011 1   0.00000000 3.750000 *
#&gt;                          2027) review_date&gt;=2011 2   0.00000000 4.000000 *
#&gt;                       507) bean_type=Criollo (Ocumare 67),Criollo (Porcelana),Trinitario (85% Criollo) 5   0.05000000 3.950000  
#&gt;                        1014) bean_type=Trinitario (85% Criollo) 2   0.03125000 3.875000  
#&gt;                          2028) broad_bean_origin=Venezuela 1   0.00000000 3.750000 *
#&gt;                          2029) broad_bean_origin=Madagascar 1   0.00000000 4.000000 *
#&gt;                        1015) bean_type=Criollo (Ocumare 67),Criollo (Porcelana) 3   0.00000000 4.000000 *
#&gt;                   127) review_date&lt; 2006.5 1   0.00000000 5.000000 *</code></pre>
</div>
</div>
<p>Amazing alteration! You built models using all available hyperparameters. The simple tree stump should have very high bias, while the last model is so complex that it should have high variance. Let’s see how it performs when used for predictions.</p>
</section>
<section id="in-sample-and-out-of-sample-performance" class="level2" data-number="2.17">
<h2 data-number="2.17" class="anchored" data-anchor-id="in-sample-and-out-of-sample-performance"><span class="header-section-number">2.17</span> In-sample and out-of-sample performance</h2>
<p>Does a more sophisticated model always perform better? As we discussed in the video, that’s only half the truth.</p>
<p>Overfitted models understand the structure of their training set perfectly but cannot generalize to new data. That’s a bummer! At the end of the day, the main purpose of a predictive model is to perform well on new data, right? Go investigate!</p>
<p>Pre-loaded is the last model of the previous exercise, <code>complex_model</code>, and your training and test data (<code>chocolate_train</code> and <code>chocolate_test</code>).</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>complex_model</code> to predict the training set grades, add these predictions to the original training data, and calculate their mean absolute error.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Assign chocolate_model to complex</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>complex_model <span class="ot">&lt;-</span> chocolate_model</span>
<span id="cb66-3"><a href="#cb66-3"></a></span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="co"># Predict on and combine with training data and calculate the error</span></span>
<span id="cb66-5"><a href="#cb66-5"></a><span class="fu">predict</span>(complex_model, <span class="at">new_data =</span> chocolate_train) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6"></a>  <span class="fu">bind_cols</span>(chocolate_train) <span class="sc">%&gt;%</span> </span>
<span id="cb66-7"><a href="#cb66-7"></a>  <span class="fu">mae</span>(<span class="at">estimate =</span> .pred,</span>
<span id="cb66-8"><a href="#cb66-8"></a>         <span class="at">truth =</span> final_grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"mae","2":"standard","3":"0.06098247"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Adapt your code to predict test set grades, add these predictions to the original test data, and calculate the mean absolute error.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Predict on and combine with test data and calculate the error</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="fu">predict</span>(complex_model, <span class="at">new_data =</span> chocolate_test) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3"></a>  <span class="fu">bind_cols</span>(chocolate_test) <span class="sc">%&gt;%</span> </span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="fu">mae</span>(<span class="at">estimate =</span> .pred,</span>
<span id="cb67-5"><a href="#cb67-5"></a>         <span class="at">truth =</span> final_grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"mae","2":"standard","3":"0.4907672"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>You are a great fit for this task, but unfortunately, your model is overfitted. The out-of-sample-error is 10 times higher than the in-sample error, which is close to 0 - that model is way too complex! In the next chapter, you will overcome this by tuning your model’s hyperparameters!</p>
</section>
</section>
<section id="hyperparameters-and-ensemble-models" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 3. Hyperparameters and Ensemble Models</h1>
<p>Time to get serious with tuning your hyperparameters and interpreting receiver operating characteristic (ROC) curves. In this chapter, you’ll leverage the wisdom of the crowd with ensemble models like bagging or random forests and build ensembles that forecast which credit card customers are most likely to churn.</p>
<section id="tuning-hyperparameters" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="tuning-hyperparameters"><span class="header-section-number">3.1</span> Tuning hyperparameters</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Tuning hyperparameters</strong></p>
<p>Welcome back!</p>
<p><strong>2. Hyperparameters</strong></p>
<p>As we discussed earlier in the course, there are several knobs that you can turn to influence the shape and complexity of your trees. Some knobs result in larger or more complex trees, while others force trees to stay small and shallow.These knobs are called “hyperparameters”. They control a model’s complexity and need to be specified before model training.For decision trees, we have the following three parameters: min_n, which is the minimum number of samples required to split a node, tree_depth, which stands for the maximum depth of a tree, and cost_complexity, which is a penalty number that punishes the size of the tree.</p>
<p><strong>3. Why tuning?</strong></p>
<p>When specifying none of these hyperparameters, parsnip chooses the following default values for you: minimum samples per node of 20, maximum depth of 30, and cost_complexity of 0-point-01.These are chosen so that they work well in many cases. However, they may not be the best choice for all datasets.The goal of tuning is now to find the set of hyperparameters that gives your model the best possible performance.</p>
<p><strong>4. Tuning with tidymodels using the tune package</strong></p>
<p>Tidymodels has a toolbox containing functions that make tuning hyperparameters real easy: The tune package. The first step is to create a set of hyperparameter values, called a grid, that is the pool in which we search for the best candidate.</p>
<p><strong>5. Tuning with tidymodels</strong></p>
<p>The second step is to create a dummy model specification in which we label hyperparameters for tuning.</p>
<p><strong>6. Tuning with tidymodels</strong></p>
<p>The third step is to build and evaluate one model for every hyperparameter combination at every grid point.</p>
<p><strong>7. Tuning with tidymodels</strong></p>
<p>The fourth step is to select the best performing hyperparameters from all results and plug these into the dummy specification. This way, we get a final specification with the optimal performing hyperparameters.</p>
<p><strong>8. Step 1: Create placeholders: tune()</strong></p>
<p>Let’s get to coding.To label hyperparameters for tuning, set them equal to tune() in the model specification.It will let other functions know that they need to be optimized.In the printed model specification, the labeled hyperparameters appear under “Main Arguments”.</p>
<p><strong>9. Step 2: Create a tuning grid: grid_regular()</strong></p>
<p>Tidymodels provides different ways for creating grids. One is the grid_regular() function, which creates an evenly-spaced grid. We use the parameters() function on our specification which extracts the parameters to be tuned and the levels argument to set the number of levels for each parameter to three. We get a tibble with two columns, one for each parameter, and, three times three, nine rows or parameter combinations.</p>
<p><strong>10. Step 3: Tune the grid: tune_grid()</strong></p>
<p>The tune_grid() function performs the hyperparameter tuning.It fits a model for every grid point and evaluates the model using cross-validation and a provided metric.It takes the following arguments: a dummy model specification with labeled parameters for tuning, a model formula, a cross-validation object, resamples, a tuning grid, grid, and a metrics function.</p>
<p><strong>11. Step 3: Tune the grid: tune_grid()</strong></p>
<p>The result can be visualized using the autoplot() function.This plot shows a declining accuracy with higher cost-complexity parameter, that means simpler trees perform worse.</p>
<p><strong>12. Step 4: Use the best parameters: finalize_model()</strong></p>
<p>The select_best() function is used to select the best performing hyperparameters. We pass our tune_results object as an argument.This function returns a tibble with the hyperparameter values that produced the largest average performance metric value. From our tuning grid, the best performing model was number 4 and had a min_n of 2 and a tree_depth of 8.One last step is needed to finalize the tuning: Once you found the best hyperparameters, you need to plug them into the specification. This is what the finalize_model() function is for.Pass the dummy specification to the finalize_model() function and provide the results of the select_best() function as an argument. In this case, we pass spec_untuned to finalize_model() and provide the final_params tibble.This returns an updated specification with the model hyperparameter values set to the optimal values found during the tuning process.</p>
<p><strong>13. Let’s tune!</strong></p>
<p>Now it’s your turn to tune your models.</p>
</section>
<section id="generate-a-tuning-grid" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="generate-a-tuning-grid"><span class="header-section-number">3.2</span> Generate a tuning grid</h2>
<p>The standard hyperparameters of most models provide a good fit for most datasets. Yet, they need optimization for the best performance. Otherwise, it’s like driving a car with an activated hand brake. Release the brake and tune your models!</p>
<p>In this exercise, you’ll create two objects that serve as a starting point: a tuning grid (a set of hyperparameter combinations) and a model specification that you later train with every value of the grid.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create an <code>rpart</code> powered classification tree specification, flagging the <code>tree_depth</code> and <code>cost_complexity</code> parameters for tuning.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Create a specification with tuning placeholders</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>tune_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb68-3"><a href="#cb68-3"></a>                           <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb68-4"><a href="#cb68-4"></a>  <span class="co"># Specify mode</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="#cb68-6"></a>  <span class="co"># Specify engine</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) </span>
<span id="cb68-8"><a href="#cb68-8"></a></span>
<span id="cb68-9"><a href="#cb68-9"></a>tune_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Decision Tree Model Specification (classification)
#&gt; 
#&gt; Main Arguments:
#&gt;   cost_complexity = tune()
#&gt;   tree_depth = tune()
#&gt; 
#&gt; Computational engine: rpart</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Create a regular grid of <code>tune_spec</code>’s hyperparameters that contains two levels for each one.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Create a regular grid</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>tree_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">parameters</span>(tune_spec),</span>
<span id="cb70-3"><a href="#cb70-3"></a>                          <span class="at">levels =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: `parameters.model_spec()` was deprecated in tune 0.1.6.9003.
#&gt; ℹ Please use `hardhat::extract_parameter_set_dials()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>tree_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cost_complexity"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["tree_depth"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"1e-10","2":"1"},{"1":"1e-01","2":"1"},{"1":"1e-10","2":"15"},{"1":"1e-01","2":"15"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Shiny specification and glossy grid! Note that the grid has four grid points (rows) because there are two levels for each of the two hyperparameters, resulting in <span class="math inline">\(2*2\)</span> possible combinations. Time to find out which of these combinations is the best for your model. Let’s tune!</p>
</section>
<section id="tune-along-the-grid" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="tune-along-the-grid"><span class="header-section-number">3.3</span> Tune along the grid</h2>
<p>After creating the tuning grid and a dummy specification, you need to fit a model on every grid point and evaluate the resulting model. This is very easy in the <code>tidymodels</code> framework using the <code>tune_grid()</code> function, as introduced in the slides.</p>
<p>In the remaining exercises, you will use the <strong>credit card customers dataset</strong>, which has the following columns:</p>
<ul>
<li><code>still_customer</code>: flag (<em>yes</em> or <em>no</em>) that indicates if a customer is still an active customer</li>
<li><code>total_trans_amt</code>: total sum of transactions in USD</li>
<li><code>customer_age</code>: age of the customer</li>
<li><code>income_category</code>: labels like <em>$60K - $80K</em> or <em>Less than $40K</em> to indicate the category of yearly income</li>
<li>… and 16 more columns.</li>
</ul>
<p>Feel free to inspect the <code>customers</code> tibble in the console! The results of the previous exercise, <code>tree_grid</code> and <code>tune_spec</code>, are still loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create three cross-validation folds of your dataset and save them as <code>folds</code>.</li>
<li>Create <code>tune_results</code> by tuning the specification along the grid using all predictors to predict <code>still_customer</code>, your CV folds as resamples, and <code>metric_set(accuracy)</code>.</li>
<li>Use <code>autoplot()</code> to plot the tuning results.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># Load data</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>customers <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/bank_churners.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-3"><a href="#cb73-3"></a>              <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Rows: 10127 Columns: 20
#&gt; ── Column specification ────────────────────────────────────────────────────────
#&gt; Delimiter: ","
#&gt; chr  (6): still_customer, gender, education_level, marital_status, income_ca...
#&gt; dbl (14): customer_age, dependent_count, months_on_book, total_relationship_...
#&gt; 
#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="fu">set.seed</span>(<span class="dv">275</span>)</span>
<span id="cb75-2"><a href="#cb75-2"></a></span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="co"># Create CV folds of the customers tibble</span></span>
<span id="cb75-4"><a href="#cb75-4"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(customers, <span class="dv">3</span>)</span>
<span id="cb75-5"><a href="#cb75-5"></a></span>
<span id="cb75-6"><a href="#cb75-6"></a><span class="co"># Tune along the grid</span></span>
<span id="cb75-7"><a href="#cb75-7"></a>tune_results <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(tune_spec, </span>
<span id="cb75-8"><a href="#cb75-8"></a>                          still_customer <span class="sc">~</span> .,</span>
<span id="cb75-9"><a href="#cb75-9"></a>                          <span class="at">resamples =</span> folds,</span>
<span id="cb75-10"><a href="#cb75-10"></a>                          <span class="at">grid =</span> tree_grid,</span>
<span id="cb75-11"><a href="#cb75-11"></a>                          <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb75-12"><a href="#cb75-12"></a></span>
<span id="cb75-13"><a href="#cb75-13"></a><span class="co"># Plot the tuning results</span></span>
<span id="cb75-14"><a href="#cb75-14"></a><span class="fu">autoplot</span>(tune_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Tidy model tuning along the tune grid! The plot shows that trees with a <code>tree_depth</code> of only <code>1</code> (red line) perform worst and performance declines with higher <code>cost_complexity</code> (simpler trees). Let’s pick the winner in the next exercise.</p>
</section>
<section id="pick-the-winner" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="pick-the-winner"><span class="header-section-number">3.4</span> Pick the winner</h2>
<p>Once tuning has been performed, it’s time to pick the optimal hyperparameters from the results and build the final model. Two helpers from <code>tidymodels</code> come in handy:</p>
<p>The function <code>select_best()</code> extracts the optimal hyperparameters from a tuning results tibble, and <code>finalize_model()</code> plugs these results into the specification, replacing the placeholders.</p>
<p>It’s your turn to try this using the results of the last exercise! The objects <code>tune_spec</code>, <code>tune_results</code>, and <code>customers</code> are still loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Extract the best-performing parameters of <code>tune_results</code> and save them as <code>final_params</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># Select the parameters that perform best</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>final_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(tune_results)</span>
<span id="cb76-3"><a href="#cb76-3"></a></span>
<span id="cb76-4"><a href="#cb76-4"></a>final_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cost_complexity"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["tree_depth"],"name":[2],"type":["int"],"align":["right"]},{"label":[".config"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"1e-10","2":"15","3":"Preprocessor1_Model3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Update your untuned tree specification with <code>final_params</code> and save this as <code>best_spec</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># Finalize the specification</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>best_spec <span class="ot">&lt;-</span> <span class="fu">finalize_model</span>(tune_spec, final_params)</span>
<span id="cb77-3"><a href="#cb77-3"></a></span>
<span id="cb77-4"><a href="#cb77-4"></a>best_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Decision Tree Model Specification (classification)
#&gt; 
#&gt; Main Arguments:
#&gt;   cost_complexity = 1e-10
#&gt;   tree_depth = 15
#&gt; 
#&gt; Computational engine: rpart</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Create your final model by fitting the tuned specification <code>best_spec</code> to the <code>customers</code> tibble.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># Build the final model</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>final_model <span class="ot">&lt;-</span> <span class="fu">fit</span>(best_spec,</span>
<span id="cb79-3"><a href="#cb79-3"></a>                   still_customer <span class="sc">~</span> .,</span>
<span id="cb79-4"><a href="#cb79-4"></a>                   <span class="at">data =</span> customers)</span>
<span id="cb79-5"><a href="#cb79-5"></a></span>
<span id="cb79-6"><a href="#cb79-6"></a>final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; n= 10127 
#&gt; 
#&gt; node), split, n, loss, yval, (yprob)
#&gt;       * denotes terminal node
#&gt; 
#&gt;    1) root 10127 1627 no (0.839340377 0.160659623)  
#&gt;      2) total_trans_ct&gt;=54.5 6669  325 no (0.951267057 0.048732943)  
#&gt;        4) total_trans_amt&lt; 5365 5141   91 no (0.982299164 0.017700836)  
#&gt;          8) total_trans_ct&gt;=57.5 4868   46 no (0.990550534 0.009449466)  
#&gt;           16) total_trans_ct&gt;=63.5 4203   10 no (0.997620747 0.002379253) *
#&gt;           17) total_trans_ct&lt; 63.5 665   36 no (0.945864662 0.054135338)  
#&gt;             34) total_revolving_bal&gt;=406 508   12 no (0.976377953 0.023622047) *
#&gt;             35) total_revolving_bal&lt; 406 157   24 no (0.847133758 0.152866242)  
#&gt;               70) total_ct_chng_q4_q1&gt;=0.506 143   17 no (0.881118881 0.118881119)  
#&gt;                140) total_trans_amt&gt;=2934.5 96    4 no (0.958333333 0.041666667) *
#&gt;                141) total_trans_amt&lt; 2934.5 47   13 no (0.723404255 0.276595745)  
#&gt;                  282) credit_limit&gt;=3151 30    3 no (0.900000000 0.100000000) *
#&gt;                  283) credit_limit&lt; 3151 17    7 yes (0.411764706 0.588235294) *
#&gt;               71) total_ct_chng_q4_q1&lt; 0.506 14    7 no (0.500000000 0.500000000) *
#&gt;          9) total_trans_ct&lt; 57.5 273   45 no (0.835164835 0.164835165)  
#&gt;           18) total_relationship_count&gt;=2.5 255   29 no (0.886274510 0.113725490)  
#&gt;             36) total_trans_amt&lt; 4621 247   23 no (0.906882591 0.093117409)  
#&gt;               72) credit_limit&gt;=2227.5 209   11 no (0.947368421 0.052631579) *
#&gt;               73) credit_limit&lt; 2227.5 38   12 no (0.684210526 0.315789474)  
#&gt;                146) avg_open_to_buy&lt; 1697.5 26    2 no (0.923076923 0.076923077) *
#&gt;                147) avg_open_to_buy&gt;=1697.5 12    2 yes (0.166666667 0.833333333) *
#&gt;             37) total_trans_amt&gt;=4621 8    2 yes (0.250000000 0.750000000) *
#&gt;           19) total_relationship_count&lt; 2.5 18    2 yes (0.111111111 0.888888889) *
#&gt;        5) total_trans_amt&gt;=5365 1528  234 no (0.846858639 0.153141361)  
#&gt;         10) total_trans_ct&gt;=78.5 1272   41 no (0.967767296 0.032232704)  
#&gt;           20) total_ct_chng_q4_q1&lt; 0.928 1224   24 no (0.980392157 0.019607843)  
#&gt;             40) total_trans_ct&gt;=81.5 1176   13 no (0.988945578 0.011054422) *
#&gt;             41) total_trans_ct&lt; 81.5 48   11 no (0.770833333 0.229166667)  
#&gt;               82) total_trans_amt&lt; 8458 41    4 no (0.902439024 0.097560976) *
#&gt;               83) total_trans_amt&gt;=8458 7    0 yes (0.000000000 1.000000000) *
#&gt;           21) total_ct_chng_q4_q1&gt;=0.928 48   17 no (0.645833333 0.354166667)  
#&gt;             42) total_trans_amt&gt;=11339 28    0 no (1.000000000 0.000000000) *
#&gt;             43) total_trans_amt&lt; 11339 20    3 yes (0.150000000 0.850000000) *
#&gt;         11) total_trans_ct&lt; 78.5 256   63 yes (0.246093750 0.753906250)  
#&gt;           22) total_revolving_bal&gt;=825 113   55 yes (0.486725664 0.513274336)  
#&gt;             44) total_trans_ct&gt;=68.5 73   23 no (0.684931507 0.315068493)  
#&gt;               88) total_trans_amt&lt; 8536 59   10 no (0.830508475 0.169491525)  
#&gt;                176) contacts_count_12_mon&lt; 2.5 32    0 no (1.000000000 0.000000000) *
#&gt;                177) contacts_count_12_mon&gt;=2.5 27   10 no (0.629629630 0.370370370)  
#&gt;                  354) total_trans_amt&lt; 7933 20    4 no (0.800000000 0.200000000) *
#&gt;                  355) total_trans_amt&gt;=7933 7    1 yes (0.142857143 0.857142857) *
#&gt;               89) total_trans_amt&gt;=8536 14    1 yes (0.071428571 0.928571429) *
#&gt;             45) total_trans_ct&lt; 68.5 40    5 yes (0.125000000 0.875000000) *
#&gt;           23) total_revolving_bal&lt; 825 143    8 yes (0.055944056 0.944055944)  
#&gt;             46) total_amt_chng_q4_q1&lt; 0.737 30    8 yes (0.266666667 0.733333333)  
#&gt;               92) total_trans_ct&gt;=69.5 15    7 no (0.533333333 0.466666667) *
#&gt;               93) total_trans_ct&lt; 69.5 15    0 yes (0.000000000 1.000000000) *
#&gt;             47) total_amt_chng_q4_q1&gt;=0.737 113    0 yes (0.000000000 1.000000000) *
#&gt;      3) total_trans_ct&lt; 54.5 3458 1302 no (0.623481781 0.376518219)  
#&gt;        6) total_revolving_bal&gt;=613.5 2329  468 no (0.799055389 0.200944611)  
#&gt;         12) total_relationship_count&gt;=2.5 2115  302 no (0.857210402 0.142789598)  
#&gt;           24) total_trans_amt&lt; 2103 1598  104 no (0.934918648 0.065081352)  
#&gt;             48) total_trans_amt&gt;=924.5 1575   84 no (0.946666667 0.053333333)  
#&gt;               96) total_amt_chng_q4_q1&gt;=0.4115 1482   58 no (0.960863698 0.039136302)  
#&gt;                192) total_ct_chng_q4_q1&gt;=0.2455 1455   50 no (0.965635739 0.034364261)  
#&gt;                  384) total_revolving_bal&lt; 2515.5 1333   33 no (0.975243811 0.024756189) *
#&gt;                  385) total_revolving_bal&gt;=2515.5 122   17 no (0.860655738 0.139344262)  
#&gt;                    770) total_trans_amt&gt;=1149.5 113   11 no (0.902654867 0.097345133) *
#&gt;                    771) total_trans_amt&lt; 1149.5 9    3 yes (0.333333333 0.666666667) *
#&gt;                193) total_ct_chng_q4_q1&lt; 0.2455 27    8 no (0.703703704 0.296296296)  
#&gt;                  386) months_on_book&gt;=35 20    3 no (0.850000000 0.150000000) *
#&gt;                  387) months_on_book&lt; 35 7    2 yes (0.285714286 0.714285714) *
#&gt;               97) total_amt_chng_q4_q1&lt; 0.4115 93   26 no (0.720430108 0.279569892)  
#&gt;                194) total_trans_amt&lt; 1668 69    8 no (0.884057971 0.115942029) *
#&gt;                195) total_trans_amt&gt;=1668 24    6 yes (0.250000000 0.750000000) *
#&gt;             49) total_trans_amt&lt; 924.5 23    3 yes (0.130434783 0.869565217) *
#&gt;           25) total_trans_amt&gt;=2103 517  198 no (0.617021277 0.382978723)  
#&gt;             50) total_ct_chng_q4_q1&gt;=0.6315 273   47 no (0.827838828 0.172161172)  
#&gt;              100) total_amt_chng_q4_q1&gt;=0.909 140    5 no (0.964285714 0.035714286) *
#&gt;              101) total_amt_chng_q4_q1&lt; 0.909 133   42 no (0.684210526 0.315789474)  
#&gt;                202) total_ct_chng_q4_q1&gt;=0.887 42    1 no (0.976190476 0.023809524) *
#&gt;                203) total_ct_chng_q4_q1&lt; 0.887 91   41 no (0.549450549 0.450549451)  
#&gt;                  406) credit_limit&gt;=9135 23    2 no (0.913043478 0.086956522) *
#&gt;                  407) credit_limit&lt; 9135 68   29 yes (0.426470588 0.573529412)  
#&gt;                    814) months_inactive_12_mon&lt; 2.5 27    9 no (0.666666667 0.333333333)  
#&gt;                     1628) total_amt_chng_q4_q1&lt; 0.7175 12    1 no (0.916666667 0.083333333) *
#&gt;                     1629) total_amt_chng_q4_q1&gt;=0.7175 15    7 yes (0.466666667 0.533333333) *
#&gt;                    815) months_inactive_12_mon&gt;=2.5 41   11 yes (0.268292683 0.731707317)  
#&gt;                     1630) total_trans_ct&gt;=52.5 9    2 no (0.777777778 0.222222222) *
#&gt;                     1631) total_trans_ct&lt; 52.5 32    4 yes (0.125000000 0.875000000) *
#&gt;             51) total_ct_chng_q4_q1&lt; 0.6315 244   93 yes (0.381147541 0.618852459)  
#&gt;              102) customer_age&lt; 37.5 66   12 no (0.818181818 0.181818182)  
#&gt;                204) total_revolving_bal&lt; 2479 59    6 no (0.898305085 0.101694915) *
#&gt;                205) total_revolving_bal&gt;=2479 7    1 yes (0.142857143 0.857142857) *
#&gt;              103) customer_age&gt;=37.5 178   39 yes (0.219101124 0.780898876)  
#&gt;                206) total_trans_ct&gt;=52.5 13    2 no (0.846153846 0.153846154) *
#&gt;                207) total_trans_ct&lt; 52.5 165   28 yes (0.169696970 0.830303030)  
#&gt;                  414) card_category=Silver 9    2 no (0.777777778 0.222222222) *
#&gt;                  415) card_category=Blue,Gold 156   21 yes (0.134615385 0.865384615)  
#&gt;                    830) months_inactive_12_mon&lt; 1.5 9    4 no (0.555555556 0.444444444) *
#&gt;                    831) months_inactive_12_mon&gt;=1.5 147   16 yes (0.108843537 0.891156463)  
#&gt;                     1662) total_ct_chng_q4_q1&gt;=0.566 32    9 yes (0.281250000 0.718750000)  
#&gt;                       3324) total_trans_amt&lt; 2364 13    5 no (0.615384615 0.384615385) *
#&gt;                       3325) total_trans_amt&gt;=2364 19    1 yes (0.052631579 0.947368421) *
#&gt;                     1663) total_ct_chng_q4_q1&lt; 0.566 115    7 yes (0.060869565 0.939130435) *
#&gt;         13) total_relationship_count&lt; 2.5 214   48 yes (0.224299065 0.775700935)  
#&gt;           26) total_ct_chng_q4_q1&gt;=0.961 23    4 no (0.826086957 0.173913043)  
#&gt;             52) total_trans_amt&lt; 1860.5 16    0 no (1.000000000 0.000000000) *
#&gt;             53) total_trans_amt&gt;=1860.5 7    3 yes (0.428571429 0.571428571) *
#&gt;           27) total_ct_chng_q4_q1&lt; 0.961 191   29 yes (0.151832461 0.848167539)  
#&gt;             54) total_ct_chng_q4_q1&gt;=0.5335 94   25 yes (0.265957447 0.734042553)  
#&gt;              108) contacts_count_12_mon&lt; 2.5 36   17 yes (0.472222222 0.527777778)  
#&gt;                216) total_relationship_count&gt;=1.5 25    9 no (0.640000000 0.360000000)  
#&gt;                  432) total_trans_amt&lt; 1854 14    2 no (0.857142857 0.142857143) *
#&gt;                  433) total_trans_amt&gt;=1854 11    4 yes (0.363636364 0.636363636) *
#&gt;                217) total_relationship_count&lt; 1.5 11    1 yes (0.090909091 0.909090909) *
#&gt;              109) contacts_count_12_mon&gt;=2.5 58    8 yes (0.137931034 0.862068966) *
#&gt;             55) total_ct_chng_q4_q1&lt; 0.5335 97    4 yes (0.041237113 0.958762887) *
#&gt;        7) total_revolving_bal&lt; 613.5 1129  295 yes (0.261293180 0.738706820)  
#&gt;         14) total_ct_chng_q4_q1&gt;=0.646 301  143 no (0.524916944 0.475083056)  
#&gt;           28) total_relationship_count&gt;=2.5 239   85 no (0.644351464 0.355648536)  
#&gt;             56) total_trans_amt&lt; 1967 127   19 no (0.850393701 0.149606299)  
#&gt;              112) total_trans_amt&gt;=1012.5 115    8 no (0.930434783 0.069565217) *
#&gt;              113) total_trans_amt&lt; 1012.5 12    1 yes (0.083333333 0.916666667) *
#&gt;             57) total_trans_amt&gt;=1967 112   46 yes (0.410714286 0.589285714)  
#&gt;              114) total_amt_chng_q4_q1&gt;=1.048 13    0 no (1.000000000 0.000000000) *
#&gt;              115) total_amt_chng_q4_q1&lt; 1.048 99   33 yes (0.333333333 0.666666667)  
#&gt;                230) total_trans_amt&gt;=2940.5 21    5 no (0.761904762 0.238095238) *
#&gt;                231) total_trans_amt&lt; 2940.5 78   17 yes (0.217948718 0.782051282)  
#&gt;                  462) total_trans_ct&gt;=51.5 20    9 yes (0.450000000 0.550000000)  
#&gt;                    924) dependent_count&lt; 2.5 11    4 no (0.636363636 0.363636364) *
#&gt;                    925) dependent_count&gt;=2.5 9    2 yes (0.222222222 0.777777778) *
#&gt;                  463) total_trans_ct&lt; 51.5 58    8 yes (0.137931034 0.862068966) *
#&gt;           29) total_relationship_count&lt; 2.5 62    4 yes (0.064516129 0.935483871) *
#&gt;         15) total_ct_chng_q4_q1&lt; 0.646 828  137 yes (0.165458937 0.834541063)  
#&gt;           30) months_inactive_12_mon&lt; 1.5 90   43 no (0.522222222 0.477777778)  
#&gt;             60) total_trans_amt&lt; 2088.5 62   21 no (0.661290323 0.338709677)  
#&gt;              120) total_trans_amt&gt;=1062.5 50   10 no (0.800000000 0.200000000) *
#&gt;              121) total_trans_amt&lt; 1062.5 12    1 yes (0.083333333 0.916666667) *
#&gt;             61) total_trans_amt&gt;=2088.5 28    6 yes (0.214285714 0.785714286)  
#&gt;              122) total_trans_ct&gt;=48.5 7    2 no (0.714285714 0.285714286) *
#&gt;              123) total_trans_ct&lt; 48.5 21    1 yes (0.047619048 0.952380952) *
#&gt;           31) months_inactive_12_mon&gt;=1.5 738   90 yes (0.121951220 0.878048780)  
#&gt;             62) total_trans_amt&lt; 1805 225   60 yes (0.266666667 0.733333333)  
#&gt;              124) total_relationship_count&gt;=3.5 86   41 no (0.523255814 0.476744186)  
#&gt;                248) total_trans_amt&gt;=1071.5 72   27 no (0.625000000 0.375000000)  
#&gt;                  496) total_amt_chng_q4_q1&gt;=0.433 56   14 no (0.750000000 0.250000000) *
#&gt;                  497) total_amt_chng_q4_q1&lt; 0.433 16    3 yes (0.187500000 0.812500000) *
#&gt;                249) total_trans_amt&lt; 1071.5 14    0 yes (0.000000000 1.000000000) *
#&gt;              125) total_relationship_count&lt; 3.5 139   15 yes (0.107913669 0.892086331)  
#&gt;                250) credit_limit&gt;=4249.5 86   15 yes (0.174418605 0.825581395)  
#&gt;                  500) total_trans_amt&gt;=1103 59   15 yes (0.254237288 0.745762712)  
#&gt;                   1000) total_trans_amt&lt; 1604.5 33   13 yes (0.393939394 0.606060606)  
#&gt;                     2000) total_amt_chng_q4_q1&gt;=0.4205 26   13 no (0.500000000 0.500000000)  
#&gt;                       4000) customer_age&gt;=42.5 19    7 no (0.631578947 0.368421053) *
#&gt;                       4001) customer_age&lt; 42.5 7    1 yes (0.142857143 0.857142857) *
#&gt;                     2001) total_amt_chng_q4_q1&lt; 0.4205 7    0 yes (0.000000000 1.000000000) *
#&gt;                   1001) total_trans_amt&gt;=1604.5 26    2 yes (0.076923077 0.923076923) *
#&gt;                  501) total_trans_amt&lt; 1103 27    0 yes (0.000000000 1.000000000) *
#&gt;                251) credit_limit&lt; 4249.5 53    0 yes (0.000000000 1.000000000) *
#&gt;             63) total_trans_amt&gt;=1805 513   30 yes (0.058479532 0.941520468)  
#&gt;              126) customer_age&lt; 31.5 15    3 no (0.800000000 0.200000000) *
#&gt;              127) customer_age&gt;=31.5 498   18 yes (0.036144578 0.963855422)  
#&gt;                254) total_trans_ct&gt;=47.5 89   11 yes (0.123595506 0.876404494)  
#&gt;                  508) total_trans_amt&lt; 2148.5 20    8 yes (0.400000000 0.600000000)  
#&gt;                   1016) total_amt_chng_q4_q1&gt;=0.6325 8    1 no (0.875000000 0.125000000) *
#&gt;                   1017) total_amt_chng_q4_q1&lt; 0.6325 12    1 yes (0.083333333 0.916666667) *
#&gt;                  509) total_trans_amt&gt;=2148.5 69    3 yes (0.043478261 0.956521739) *
#&gt;                255) total_trans_ct&lt; 47.5 409    7 yes (0.017114914 0.982885086) *</code></pre>
</div>
</div>
<p>Fearless finalization! You just selected the optimal hyperparameters, plugged them into the specification, and trained the final model. It seems that you now officially gained tuning experience - spot on!</p>
</section>
<section id="more-model-measures" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="more-model-measures"><span class="header-section-number">3.5</span> More model measures</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. More model measures</strong> Welcome back. So far, you evaluated your binary classification models using accuracy.</p>
<p><strong>2. Limits of accuracy</strong> But do you recall that one exercise where the model that always predicted “no” achieved a very high accuracy? That is easily possible with an imbalanced data set.</p>
<p><strong>3. Sensitivity or true positive rate</strong> Fortunately, there are more binary classification metrics. One is sensitivity. Sensitivity or true positive rate is the proportion of all positive outcomes that were found by your model. For example, of the credit card customers that did churn, how many did our model predict correctly?</p>
<p><strong>4. Specificity or true negative rate</strong> Specificity or true negative rate measures the proportion of all negative outcomes that were correctly classified. For example, of the credit card customers that did not churn, what proportion did our model predict correctly?</p>
<p><strong>5. Different thresholds</strong> So far, you have only used the predict function to calculate predicted classes. It predicted “yes” if the probability was more than 0-point-5, and “no” otherwise. What if you calculated predicted probabilities instead? You could try different thresholds for your class predictions and would get different confusion matrices and performance measures. Is there one threshold among these that performs best?</p>
<p><strong>6. ROC (Receiver-operating-characteristic) curve</strong> The ROC curve, an acronym for receiver-operating-characteristic, visualizes the performance of a classification model across all possible probability thresholds. For each unique threshold, a point that represents the true positive rate or sensitivity and the false positive rate or one minus the specificity is added to the plot.</p>
<p><strong>7. ROC curve and AUC</strong> An ideal ROC curve would fall into the top-left corner of the graph, with a true positive rate or sensitivity of 1 and a false positive rate or 1 minus specificity of 0. The overall performance of a classifier, summarized over all possible thresholds, is given by the area under this curve (AUC).</p>
<p><strong>8. Area under the ROC curve</strong> An AUC of zero point five corresponds to a ROC curve along the diagonal and indicates that a model performs no better than random chance. An AUC of one corresponds to a model that perfectly classifies every example, while an AUC of zero means that your model is classifying every observation wrongly. So, ROC curves and the AUC are useful for comparing different classifiers, since they take into account all possible thresholds.</p>
<p><strong>9. yardstick sensitivity: sens()</strong> Let’s see how all that is coded in tidymodels. Imagine you have the class predictions tibble containing the predicted and true classes. The sens() function calculates sensitivity and takes the same arguments as the conf_mat() and accuracy() functions. For data, we supply our predictions tibble. For estimate column we specify dot-pred_class and for the truth column, we specify true_class. As you would expect, the function returns a tibble that gives the sensitivity in the column dot-estimate. In this case, 87-point-2 percent of all positive outcomes were found by the model.</p>
<p><strong>10. yardstick ROC: roc_curve()</strong> To plot a ROC curve, you first need predicted probabilities instead of predicted classes. Use the predict function with the model, test data and type equals to “prob”. Then, add these predictions to the test data tibble using bind_cols(). The next step is to create a tibble with sensitivity and specificity for many different thresholds. This is done by the roc_curve() function. Pass the predictions tibble as first argument, the dot-pred_yes column as estimate and the still_customer column as truth argument. This will return a tibble with specificity and sensitivity for all unique thresholds. Using the autoplot() function, you get a graphical representation of this curve.</p>
<p><strong>11. yardstick AUC: roc_auc()</strong> Calculating the area under the curve is no different. Same arguments as usual: data, estimate, and truth. The result is the familiar tibble containing our result in the dot-estimate column. Our area under the curve is 0-point-872, or 87-point-2 percent here.</p>
<p><strong>12. Let’s measure!</strong> Now it’s your turn to draw receiver-operating-characteristic curves and calculate sensitivity and area under the curve.</p>
</section>
<section id="calculate-specificity" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="calculate-specificity"><span class="header-section-number">3.6</span> Calculate specificity</h2>
<p>Using different measures for model performance allows you to more accurately assess it. There are several metrics for different use cases. <strong>Specificity</strong> measures the proportion of <strong>true negative</strong> outcomes correctly identified:</p>
<p><span class="math display">\[\\text{specificity} = \\frac{TN}{TN + FP}\]</span></p>
<p>This formula implies that with specificity approaching 100%, the number of false positives (FP) <em>approaches 0</em>.</p>
<p>In this exercise, you are going to investigate the out-of-sample specificity of your model with cross-validation.</p>
<p>Pre-loaded is the training data of the credit card customers dataset, <code>customers_train</code>, and a decision tree specification, <code>tree_spec</code>, which was generated using the following code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2"></a>                <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3"></a>                <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create three CV folds of <code>customers_train</code> and save them as <code>folds</code>.</li>
<li>Calculate cross-validated <code>specificity</code> using the <code>fit_resamples()</code> function that takes your specification <code>tree_spec</code>, a model formula, the CV folds, and an appropriate metric set. Use all predictors to predict <code>still_customer</code>, saving the results to <code>specificities</code>.</li>
<li>Aggregate the results using a single function.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="do">##  !!! Create customer train</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="co"># Create the split</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>customers_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(customers, <span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb82-4"><a href="#cb82-4"></a></span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="co"># Extract the training and test set</span></span>
<span id="cb82-6"><a href="#cb82-6"></a>customers_train <span class="ot">&lt;-</span> <span class="fu">training</span>(customers_split)</span>
<span id="cb82-7"><a href="#cb82-7"></a>customers_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(customers_split)</span>
<span id="cb82-8"><a href="#cb82-8"></a></span>
<span id="cb82-9"><a href="#cb82-9"></a><span class="do">## !!! Create tree_spec</span></span>
<span id="cb82-10"><a href="#cb82-10"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb82-11"><a href="#cb82-11"></a>                <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-12"><a href="#cb82-12"></a>                <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb82-13"><a href="#cb82-13"></a></span>
<span id="cb82-14"><a href="#cb82-14"></a><span class="co"># Create CV folds of the training data</span></span>
<span id="cb82-15"><a href="#cb82-15"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(customers_train, <span class="at">v =</span> <span class="dv">3</span>)</span>
<span id="cb82-16"><a href="#cb82-16"></a></span>
<span id="cb82-17"><a href="#cb82-17"></a><span class="co"># Calculate CV specificity</span></span>
<span id="cb82-18"><a href="#cb82-18"></a>specificities <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(tree_spec, </span>
<span id="cb82-19"><a href="#cb82-19"></a>                               still_customer <span class="sc">~</span> .,</span>
<span id="cb82-20"><a href="#cb82-20"></a>                               <span class="at">resamples =</span> folds,</span>
<span id="cb82-21"><a href="#cb82-21"></a>                               <span class="at">metrics =</span> <span class="fu">metric_set</span>(specificity))</span>
<span id="cb82-22"><a href="#cb82-22"></a></span>
<span id="cb82-23"><a href="#cb82-23"></a><span class="co"># Collect the metrics</span></span>
<span id="cb82-24"><a href="#cb82-24"></a><span class="fu">collect_metrics</span>(specificities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"specificity","2":"binary","3":"0.7692333","4":"3","5":"0.00399394","6":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Well done - you calculated the cross-validated specificity of your model. Such a high specificity indicates that there are very few false positives, so any person the model classifies as positive is likely to be a true positive.</p>
</section>
<section id="draw-the-roc-curve" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="draw-the-roc-curve"><span class="header-section-number">3.7</span> Draw the ROC curve</h2>
<p>Visualizing model performance with a ROC curve allows you to gather the performance across all possible thresholds into a single plot. It shows the sensitivity and specificity for every threshold. The more “up and left” a ROC curve is, the better the model.</p>
<p>You are going to predict class probabilities of credit card customers having churned and plot the results as a ROC curve.</p>
<p>Pre-loaded is a <code>model</code>, which is a decision tree that was trained on the credit card customers training set, and the test data, <code>customers_test</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>model</code> to predict class probabilities on the test set.</li>
<li>Add the results to the test set using <code>bind_cols()</code> and save the result as <code>predictions</code>.</li>
<li>Calculate the ROC curve of the result.</li>
<li>Plot the ROC curve using <code>autoplot()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="do">## Assign model</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>model <span class="ot">&lt;-</span> tree_spec <span class="sc">|&gt;</span> <span class="fu">fit</span>(still_customer <span class="sc">~</span> ., customers_train)</span>
<span id="cb83-3"><a href="#cb83-3"></a></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="co"># Predict probabilities on test set</span></span>
<span id="cb83-5"><a href="#cb83-5"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, </span>
<span id="cb83-6"><a href="#cb83-6"></a>                       customers_test,</span>
<span id="cb83-7"><a href="#cb83-7"></a>                       <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-8"><a href="#cb83-8"></a>  <span class="co"># Add test set</span></span>
<span id="cb83-9"><a href="#cb83-9"></a>  <span class="fu">bind_cols</span>(customers_test)</span>
<span id="cb83-10"><a href="#cb83-10"></a></span>
<span id="cb83-11"><a href="#cb83-11"></a><span class="co"># Calculate the ROC curve for all thresholds</span></span>
<span id="cb83-12"><a href="#cb83-12"></a>roc <span class="ot">&lt;-</span> <span class="fu">roc_curve</span>(predictions, </span>
<span id="cb83-13"><a href="#cb83-13"></a>                 <span class="at">estimate =</span> .pred_yes, </span>
<span id="cb83-14"><a href="#cb83-14"></a>                 <span class="at">truth =</span> still_customer)</span>
<span id="cb83-15"><a href="#cb83-15"></a></span>
<span id="cb83-16"><a href="#cb83-16"></a><span class="co"># Plot the ROC curve</span></span>
<span id="cb83-17"><a href="#cb83-17"></a><span class="fu">autoplot</span>(roc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-40-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Well predicted, wizard! You predicted on the test set and plotted the ROC curve. It looks really good, being very steep and located very much in the top left corner. Wonder what the area under this curve is? Find out in the following exercise!</p>
</section>
<section id="area-under-the-roc-curve" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="area-under-the-roc-curve"><span class="header-section-number">3.8</span> Area under the ROC curve</h2>
<p>The area under the ROC curve boils down many other performance estimates to one single number and allows you to assess a model’s performance very quickly. For this reason, it is a very common performance measure for classification models.</p>
<p>Using AUC, you can rate the performance of a model using a grading system, where A is the best grade:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">AUC</th>
<th style="text-align: left;">Grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0.9 - 1</td>
<td style="text-align: left;">A</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.8 - 0.9</td>
<td style="text-align: left;">B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.7 - 0.8</td>
<td style="text-align: left;">C</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.6 - 0.7</td>
<td style="text-align: left;">D</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.5 - 0.6</td>
<td style="text-align: left;">E</td>
</tr>
</tbody>
</table>
<p>You are going to calculate your model’s AUC using the <code>predictions</code> tibble from the last exercise, which is still loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the area under the ROC curve using the <code>roc_auc()</code> function and the <code>predictions</code> tibble.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># Calculate area under the curve</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>auc_result <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(predictions,</span>
<span id="cb84-3"><a href="#cb84-3"></a>                      <span class="at">estimate =</span> .pred_yes, </span>
<span id="cb84-4"><a href="#cb84-4"></a>                      <span class="at">truth =</span> still_customer)</span>
<span id="cb84-5"><a href="#cb84-5"></a></span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The area under the ROC curve is"</span>, <span class="fu">round</span>(auc_result<span class="sc">$</span>.estimate, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "The area under the ROC curve is 0.061"</code></pre>
</div>
</div>
<p>Too easy for you! An AUC of over 92% corresponds to grade A in the grading system and suggests a very helpful model!</p>
</section>
<section id="bagged-trees" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="bagged-trees"><span class="header-section-number">3.9</span> Bagged trees</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Bagged trees</strong></p>
<p>Decision trees are easy to understand and interpret, but often a small change in the data can result in a very different series of splits and a very different model. This is one of the main drawbacks of decision trees: the high variance that you have observed in the exercises.</p>
<p><strong>2. Many heads are better than one</strong></p>
<p>One solution to this is the wisdom of the crowd: The collective knowledge of many people typically exceeds the knowledge of any single individual. This brings up the idea of so-called “ensemble models”, which means that you use several models and their predictions together instead of one single model.</p>
<p><strong>3. Bootstrap &amp; aggregation</strong></p>
<p>What does the term “bagged trees” mean? Bagging is an ensemble method and is shorthand for Bootstrap Aggregation. Bootstrapping simply means sampling rows at random from the training dataset, with replacement. When you draw samples with replacement, that means that you’ll draw a single training example more than once. This results in a modified version of the training set where some rows are represented multiple times and some rows are absent. This let’s you generate new data that’s similar to the data you started with. By doing this, you can fit many different, but similar, models.Aggregation is done using the average prediction of all models as the final regression prediction, or the majority vote in classification.</p>
<p><strong>4. Step 1: Bootstrap and train</strong></p>
<p>Bagging works in the following way:First, you draw a sample with replacement from the original training setThen, you train a decision tree model using that sampled training set.Repeat these steps as many times as you like - that could be 10 times, 100 times, or 1000. Typically, the more trees, the better the model, but the more training time you need. This example shows an ensemble of three bagged trees.</p>
<p><strong>5. Step 2: Aggregate</strong></p>
<p>Now, let’s say you have three bootstrapped trees that make up your ensemble. To generate a prediction using a bagged tree model, you generate predictions from each of the trees and then simply aggregate the predictions together to get a final prediction. The bagged, or “ensemble” prediction is the average prediction or majority vote across the bootstrapped trees.Bagging can dramatically reduce the variance of unstable models such as trees, leading to improved performance.</p>
<p><strong>6. Coding: Specify the bagged trees</strong></p>
<p>Fitting a bagged decision tree model in R is very similar to fitting a decision tree. The package baguette offers a bag_tree() function that behaves similarly to the decision_tree() function.We specify the mode as “classification” and set the engine to “rpart”. Additionally, we can specify how many bagged trees we want to create, using the times parameter. Let’s specify an ensemble of 100 bagged trees.</p>
<p><strong>7. Train all trees</strong></p>
<p>Fitting works exactly like you already know.Tidymodels is taking care of taking the bootstrap samples and training all of the trees behind the scenes.Simply use the fit() function as usual, using a formula and the training data.Here we use the formula still_customer, as modeled according to all other variables in the data, which is what the dot stands for. The data is set to our credit customers training dataset.When you print the final model, you get a summary of the model ensemble: The fit time is 24 seconds, we have 100 members in our ensemble, that is 100 trees, and finally, a tibble showing the importance of the predictors for the final outcome.In our example, the count of total transactions is the most important predictor.</p>
<p><strong>8. Let’s bootstrap!</strong></p>
<p>Now that you know how to create a bagged model ensemble, it’s your turn to practice.</p>
</section>
<section id="create-bagged-trees" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="create-bagged-trees"><span class="header-section-number">3.10</span> Create bagged trees</h2>
<p>Ensemble models like bagged trees are more powerful than single decision trees. Each tree in the ensemble gives a vote, and the average or majority vote is your prediction. This ensures you use swarm intelligence instead of relying on a single tree. For bagged trees, the bootstrap method ensures that in every ensemble tree, only a <em>bootstrapped sample</em> (sampled with replacement) of the original dataset is used to train the tree and create the prediction.</p>
<p>Put this into practice by building a bagged classification tree yourself!</p>
<p>The credit card customers training data is pre-loaded as <code>customers_train</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>bag_tree()</code> to create a bagged tree classification model with an <code>"rpart"</code> engine that builds 20 bagged trees.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># Create the specification</span></span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="fu">library</span>(baguette)</span>
<span id="cb86-3"><a href="#cb86-3"></a></span>
<span id="cb86-4"><a href="#cb86-4"></a>spec_bagged <span class="ot">&lt;-</span> <span class="fu">bag_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="#cb86-5"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="#cb86-6"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>, <span class="at">times =</span> <span class="dv">20</span>)</span>
<span id="cb86-7"><a href="#cb86-7"></a></span>
<span id="cb86-8"><a href="#cb86-8"></a>spec_bagged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Bagged Decision Tree Model Specification (classification)
#&gt; 
#&gt; Main Arguments:
#&gt;   cost_complexity = 0
#&gt;   min_n = 2
#&gt; 
#&gt; Engine-Specific Arguments:
#&gt;   times = 20
#&gt; 
#&gt; Computational engine: rpart</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Train a model on the training data using <code>still_customer</code> as the outcome and <code>total_trans_amt</code>, <code>customer_age</code>, and <code>education_level</code>as predictor variables.</li>
<li>Print the model to see the importance of variables.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># Fit to the training data</span></span>
<span id="cb88-2"><a href="#cb88-2"></a>model_bagged <span class="ot">&lt;-</span> <span class="fu">fit</span>(spec_bagged,</span>
<span id="cb88-3"><a href="#cb88-3"></a>                    <span class="at">formula =</span> still_customer <span class="sc">~</span> total_trans_amt <span class="sc">+</span> customer_age <span class="sc">+</span> education_level, </span>
<span id="cb88-4"><a href="#cb88-4"></a>                    <span class="at">data =</span> customers_train)</span>
<span id="cb88-5"><a href="#cb88-5"></a></span>
<span id="cb88-6"><a href="#cb88-6"></a><span class="co"># Print the model</span></span>
<span id="cb88-7"><a href="#cb88-7"></a>model_bagged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; Bagged CART (classification with 20 members)
#&gt; 
#&gt; Variable importance scores include:
#&gt; 
#&gt; # A tibble: 3 × 4
#&gt;   term            value std.error  used
#&gt;   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
#&gt; 1 total_trans_amt 1357.     12.4     20
#&gt; 2 customer_age     583.      4.79    20
#&gt; 3 education_level  198.      3.50    20</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h2 id="question-3" data-number="3.11" class="anchored"><span class="header-section-number">3.11</span> <em>Question</em></h2>
<p>What is the least important variable for the model?<br> <br> ⬜ Total amount of transactions<br> ⬜ Customer age<br> ✅ Education level<br></p>
</blockquote>
<p>Exactly! The education level seems to be the least important predictor for customer churn, while total transaction amount is quite relevant.</p>
</section>
<section id="in-sample-roc-and-auc" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="in-sample-roc-and-auc"><span class="header-section-number">3.12</span> In-sample ROC and AUC</h2>
<p>How well do bagged trees capture the structure of your training set? Are they better than decision trees? Do they overfit? Using ROC and AUC is a great way of assessing this.</p>
<p>In this exercise, you are going to generate these in-sample predictions and calculate their ROC and AUC. Listen up, there will be surprises!</p>
<p>Pre-loaded is the result of the previous exercise, <code>model_bagged</code>, and training data, <code>customers_train</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use <code>model_bagged</code> to generate <strong>probability</strong> predictions with your training set and add them to the training set tibble, saving the result as <code>predictions</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># Predict on training set and add to training set</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_bagged,</span>
<span id="cb90-3"><a href="#cb90-3"></a>                       <span class="at">new_data =</span> customers_train, </span>
<span id="cb90-4"><a href="#cb90-4"></a>                       <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-5"><a href="#cb90-5"></a>    <span class="fu">bind_cols</span>(customers_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Generate the ROC curve of the <code>predictions</code> tibble and plot the result.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># Create and plot the ROC curve</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="fu">roc_curve</span>(predictions, </span>
<span id="cb91-3"><a href="#cb91-3"></a>          <span class="at">estimate =</span> .pred_yes, </span>
<span id="cb91-4"><a href="#cb91-4"></a>          <span class="at">truth =</span> still_customer) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Calculate the AUC of the <code>predictions</code> tibble.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="co"># Calculate the AUC</span></span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="fu">roc_auc</span>(predictions,</span>
<span id="cb92-3"><a href="#cb92-3"></a>        <span class="at">estimate =</span> .pred_yes, </span>
<span id="cb92-4"><a href="#cb92-4"></a>        <span class="at">truth =</span> still_customer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"9.755601e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Convincing curve! You created in-sample predictions and got a terrific ROC curve and an AUC value of 99.9%. But wait, that looks too good to be true! Time to check the out-of-sample performance!</p>
</section>
<section id="check-for-overfitting" class="level2" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="check-for-overfitting"><span class="header-section-number">3.13</span> Check for overfitting</h2>
<p>A very high in-sample AUC like \(99.9\%\) can be an indicator of overfitting. It is also possible that your dataset is just very well structured, or your model might just be terrific!</p>
<p>To check which of these is true, you need to produce out-of-sample estimates of your AUC, and because you don’t want to touch your test set yet, you can produce these using cross-validation on your training set.</p>
<p>Your training data, <code>customers_train</code>, and the bagged tree specification, <code>spec_bagged</code>, are still available in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Using <code>fit_resamples()</code>, estimate your <code>roc_auc</code> metric using <strong>three</strong> CV folds of your training set and the model formula <code>still_customer ~ total_trans_amt + customer_age + education_level</code>.</li>
<li>Collect the metrics of the result to display the AUC.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="fu">set.seed</span>(<span class="dv">55</span>)</span>
<span id="cb93-2"><a href="#cb93-2"></a></span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="co"># Estimate AUC using cross-validation</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(spec_bagged,</span>
<span id="cb93-5"><a href="#cb93-5"></a>                            still_customer <span class="sc">~</span> total_trans_amt <span class="sc">+</span> customer_age <span class="sc">+</span> education_level, </span>
<span id="cb93-6"><a href="#cb93-6"></a>                            <span class="at">resamples =</span> <span class="fu">vfold_cv</span>(customers_train, <span class="at">v =</span> <span class="dv">3</span>),</span>
<span id="cb93-7"><a href="#cb93-7"></a>                            <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc))</span>
<span id="cb93-8"><a href="#cb93-8"></a> </span>
<span id="cb93-9"><a href="#cb93-9"></a><span class="co"># Collect metrics</span></span>
<span id="cb93-10"><a href="#cb93-10"></a><span class="fu">collect_metrics</span>(cv_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.8540068","4":"3","5":"0.009386631","6":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>You revealed the hidden secret! The cross-validated out-of-sample AUC is just over 80%, in contrast to the in-sample AUC of 99.9%. That means your model is overfitting! You should reduce the complexity by increasing <code>cost_complexity</code> in the specification, or by tuning your model.</p>
</section>
<section id="random-forest" class="level2" data-number="3.14">
<h2 data-number="3.14" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">3.14</span> Random forest</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Random forest</strong></p>
<p>Welcome back! Now you know that bagged trees are a big improvement over single decision trees. You might have heard of random forests, which are an improvement upon bagged trees.</p>
<p><strong>2. Random forest</strong></p>
<p>Random forests are particularly suited for high-dimensional data. As a result of their ease-of-use and out-of-the-box performance, random forest is a very popular machine learning algorithm and is implemented in a variety of packages, like the ranger or randomForest package. Tidymodels has you covered: the rand_forest() function in the parsnip package provides an interface to these implementations.</p>
<p><strong>3. Idea</strong></p>
<p>The basic idea behind random forest is identical to bagging - both are ensembles of trees trained on bootstrapped samples of the training data.However, in the random forest algorithm, there is a slight tweak to the way the decision trees are built that leads to better performance. The key difference is that when training the trees that make up the ensemble, we add a bit of extra randomness to the model - hence the name, random forest. At each split in the tree, rather than considering all features, or input variables, for the split, we sample a subset of these features or predictors and consider only these few variables as a candidate for the split.</p>
<p><strong>4. Intuition</strong></p>
<p>Let’s sharpen our intuition using this picture. In this case, there are four trees, and in every split, different predictor variables or features are used to make the next split.Each tree then gives a vote for a class, and the majority vote is the final class prediction.How can using fewer predictors lead to better performance?Well, adding this extra bit of randomness leads to a collection of trees that are further de-correlated (or more different) from one another. So, random forest improves upon bagging by reducing the correlation between the sampled trees.</p>
<p><strong>5. Coding: Specify a random forest model</strong></p>
<p>To run the random forest algorithm you will use the rand_forest() function from the parsnip package. Let’s take a look at this call.The hyperparameters here are: mtry, the number of predictors seen at each node (the default is the square root of total predictors), trees, the size of your forest, and min_n, which you know from decision trees - it’s the smallest node size allowed.As usual, you set the mode using set_mode() and the engine using set_engine(). You can use the ranger engine or the randomForest engine here.</p>
<p><strong>6. Coding: Specify a random forest model</strong></p>
<p>A complete sample specification looks like this:Use the rand_forest() function with trees, the size of the forest, to be 100 trees. Use mode classification and the ranger engine.You can always add more trees to improve the performance of the ensemble - more trees almost always means better performance in a random forest.</p>
<p><strong>7. Training a forest</strong></p>
<p>The syntax for training a random forest model follows standard conventions for parsnip models. We take our specification and specify still_customer as the outcome variable and all other columns as the input variables using the familiar formula interface. We choose the data to be customers_train, the training data of credit card customers.</p>
<p><strong>8. Variable importance</strong></p>
<p>When specifying the engine, you can also specify the algorithm that controls the node split. Possible values for the ranger engine are impurity or permutation.We’ll use impurity here and train a model to the customers_train training data using all predictors.We pass the result to the vip() function from the vip package, which calculates the variable importance for our predictors.This way, you get an intuition for which predictors are more important in your dataset. Here we see that the total amount of transactions is the most helpful predictor.</p>
<p><strong>9. Let’s plant a random forest!</strong></p>
<p>Now it’s your turn to grow your first random forest!</p>
</section>
<section id="bagged-trees-vs.-random-forest" class="level2" data-number="3.15">
<h2 data-number="3.15" class="anchored" data-anchor-id="bagged-trees-vs.-random-forest"><span class="header-section-number">3.15</span> Bagged trees vs.&nbsp;random forest</h2>
<blockquote class="blockquote">
<h2 id="question-4" data-number="3.16" class="anchored"><span class="header-section-number">3.16</span> <em>Question</em></h2>
<p>What is the main difference between the two ensemble methods <em>bagged trees</em> and <em>random forest</em>?<br> <br> ⬜ In a random forest, the decision trees are trained on a random subset of the rows, but in bagging, all the rows are used.<br> ✅ In a random forest, only a subset of features is selected at random at each split in a decision tree. In bagging, all features are used.<br> ⬜ Bagging is a deterministic algorithm that uses no randomness, whereas random forest is non-deterministic, which means there is randomness involved.<br></p>
</blockquote>
<p>Correct! Random forest uses a random subset of features at each split to decorrelate the trees in the forest and reduce overfitting.</p>
</section>
<section id="variable-importance" class="level2" data-number="3.17">
<h2 data-number="3.17" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">3.17</span> Variable importance</h2>
<p>You already know that bagged trees are an ensemble model that overcomes the variance problem of decision trees. Now you learned that the random forest algorithm further improves this by using only a random subset of the features in each tree. This further decorrelates the ensemble, improving its predictive performance.</p>
<p>In this exercise, you will build a random forest yourself and plot the importance of the predictors using the <code>vip</code> package. The training data, <code>customers_train</code>, is pre-loaded in your workspace.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create <code>spec</code>, the specification of a random forest classification model using the <code>"ranger"</code> engine and <code>"impurity"</code> variable importance.</li>
<li>Create <code>model</code> by fitting the tibble <code>customers_train</code> to <code>spec</code> using <code>still_customer</code> as the outcome and all other columns as the predictor variables.</li>
<li>Plot the variable importance using the <code>vip()</code> function from the <code>vip</code> package (which is not pre-loaded).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="co"># Specify a random forest</span></span>
<span id="cb94-2"><a href="#cb94-2"></a>spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3"></a>    <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4"></a>    <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>)</span>
<span id="cb94-5"><a href="#cb94-5"></a></span>
<span id="cb94-6"><a href="#cb94-6"></a><span class="co"># Train the forest</span></span>
<span id="cb94-7"><a href="#cb94-7"></a>model <span class="ot">&lt;-</span> spec <span class="sc">%&gt;%</span></span>
<span id="cb94-8"><a href="#cb94-8"></a>    <span class="fu">fit</span>(still_customer <span class="sc">~</span> ., </span>
<span id="cb94-9"><a href="#cb94-9"></a>        <span class="at">data =</span> customers_train)</span>
<span id="cb94-10"><a href="#cb94-10"></a></span>
<span id="cb94-11"><a href="#cb94-11"></a><span class="co"># Plot the variable importance</span></span>
<span id="cb94-12"><a href="#cb94-12"></a>vip<span class="sc">::</span><span class="fu">vip</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-48-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Good job, ranger! You specified a random forest, trained it on real data, and visualized the variable importance. Seems that the total transaction amount is the most helpful predictor for predicting who is a churned customer.</p>
</section>
</section>
<section id="boosted-trees" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 4. Boosted Trees</h1>
<p>Ready for the high society of tree-based models? Apply gradient boosting to create powerful ensembles that perform better than anything that you have seen or built. Learn about their fine-tuning and how to compare different models to pick a winner for production.</p>
<section id="introduction-to-boosting" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="introduction-to-boosting"><span class="header-section-number">4.1</span> Introduction to boosting</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Introduction to boosting</strong></p>
<p>Welcome to the final chapter of this course!</p>
<p><strong>2. Model comparison</strong></p>
<p>In the first two chapters, you learned how to use the training data to create a single classifier.</p>
<p><strong>3. Model comparison</strong></p>
<p>In Chapters two and three, you applied the ensemble methods bagging and random forests to use different training data in parallel to create independent models that use the wisdom of the crowd.The idea is that the combined prediction of individual models is superior to any of the individual predictions on their own. Because the estimators are independent, these can be trained in parallel to speed up the model building.</p>
<p><strong>4. Model comparison</strong></p>
<p>Let’s discuss an improvement of this idea:</p>
<p><strong>5. Model comparison</strong></p>
<p>What if each subsequent model would try to fix the errors of the previous model?</p>
<p><strong>6. Model comparison</strong></p>
<p>Then each model would take advantage of the previous estimator’s knowledge.This way, models cannot be trained in parallel, but the result should be better because each model is an improvement of its predecessor.</p>
<p><strong>7. Model comparison</strong></p>
<p>This technique is called “boosting”.Intuitively, this is similar to the way in which we learn. When you are coding and try to solve the exercises of this course, you receive feedback on the correctness of your solution. You learn from the feedback, and if you made a mistake, which of course very rarely happens, you modify your code for the next attempt. This way, you are iteratively learning and improving. That is also the reason why boosted trees generally perform better than bagged trees.</p>
<p><strong>8. Adaboost</strong></p>
<p>The first famous boosting algorithm was Adaboost. AdaBoost stands for Adaptive Boosting.In AdaBoost, each predictor pays more attention to the instances wrongly predicted by its predecessor by constantly changing the weights of training instances.The Adaboost Algorithm is as follows:Start by training a decision tree where each observation is assigned an equal weight.</p>
<p><strong>9. Adaboost</strong></p>
<p>After evaluating the first tree, increase the weight of the observations that are difficult to classify and lower the weights of these observations that are easy to classify.</p>
<p><strong>10. Adaboost</strong></p>
<p>Repeat this process for a specified number of iterations. Subsequent trees help in classifying observations that are not well classified by preceding trees.</p>
<p><strong>11. Adaboost</strong></p>
<p>The prediction for the final ensemble model is a weighted sum of the predictions made by previous tree models.Adaboost was improved by adding a technique called gradient descent to the process. In the next lesson, we will dive deeper into this technique called “gradient boosting”.</p>
<p><strong>12. Coding: Specify a boosted ensemble</strong></p>
<p>Now let’s see how to create such a boosted model using tidymodels. boost_tree() is a way to generate a specification of a model before fitting and allows the model to be created using different packages in R.Since tidymodels is set up well, fitting and making predictions follows the same processes as for the other models you’ve used so far.We set the mode to classification and the engine to “xgboost”, a popular R package that implements the gradient boosting algorithm.This way, you’re finished specifying your boosting ensemble.There are a number of hyperparameters that you can specify and tune, in fact far more than for bagged trees, but let’s go with the defaults for now.Of course, there is more work to do, but it’s obvious that the interface to boosting in tidymodels is very easy, and there is not much boilerplate to get started.</p>
<p><strong>13. Let’s boost!</strong></p>
<p>Now it’s your turn to test your understanding of boosting.</p>
</section>
<section id="bagging-vs.-boosting" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="bagging-vs.-boosting"><span class="header-section-number">4.2</span> Bagging vs.&nbsp;boosting</h2>
<p>The terms <em>bagging</em> and <em>boosting</em> may sound similar, but these are two machine learning algorithms that follow different approaches.</p>
<blockquote class="blockquote">
<h2 id="question-5" data-number="4.3" class="anchored"><span class="header-section-number">4.3</span> <em>Question</em></h2>
<p>What is one of the main differences between bagged trees and boosted trees?<br> <br> ⬜ Boosted trees have fewer hyperparameters than bagged trees, making them easier to tune.<br> ⬜ The performance of boosted trees is generally not as great as the performance of bagged trees.<br> ✅ In contrast to bagged trees, boosted trees iteratively improve the model fit by considering past fits.<br></p>
</blockquote>
<p>Correct! Boosting is an iterative algorithm that considers past fits to improve performance.</p>
</section>
<section id="specify-a-boosted-ensemble" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="specify-a-boosted-ensemble"><span class="header-section-number">4.4</span> Specify a boosted ensemble</h2>
<p>Boosting is more advanced than bagging because models are trained sequentially, with each model improving on the previous one, instead of all models learning in parallel. There are several R packages that implement this powerful algorithm, and <code>tidymodels</code> has you covered. It provides a simple interface to generate boosted trees.</p>
<p>Your task in the following three steps is to create the initial specification for an ensemble of boosted trees that you will use in the following exercises.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Use the appropriate <code>parsnip</code> function to specify a boosted tree model.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># Specify the model class</span></span>
<span id="cb95-2"><a href="#cb95-2"></a>boost_spec <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>()</span>
<span id="cb95-3"><a href="#cb95-3"></a></span>
<span id="cb95-4"><a href="#cb95-4"></a>boost_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Boosted Tree Model Specification (unknown mode)
#&gt; 
#&gt; Computational engine: xgboost</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Set the mode to <code>"classification"</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Specify the model class</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>boost_spec <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>    <span class="co"># Set the mode</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>    <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb97-5"><a href="#cb97-5"></a></span>
<span id="cb97-6"><a href="#cb97-6"></a>boost_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Boosted Tree Model Specification (classification)
#&gt; 
#&gt; Computational engine: xgboost</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Use the <code>"xgboost"</code> package to power your model.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Specify the model class</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>boost_spec <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3"></a>    <span class="co"># Set the mode</span></span>
<span id="cb99-4"><a href="#cb99-4"></a>    <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-5"><a href="#cb99-5"></a>    <span class="co"># Set the engine</span></span>
<span id="cb99-6"><a href="#cb99-6"></a>    <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb99-7"><a href="#cb99-7"></a></span>
<span id="cb99-8"><a href="#cb99-8"></a>boost_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Boosted Tree Model Specification (classification)
#&gt; 
#&gt; Computational engine: xgboost</code></pre>
</div>
</div>
<p>Savvy specification - defining boosted models is just as easy as creating decision trees, isn’t it?</p>
</section>
<section id="gradient-boosting" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="gradient-boosting"><span class="header-section-number">4.5</span> Gradient boosting</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Gradient boosting</strong></p>
<p>Welcome back! Let’s recap and strengthen what we know about boosting so far.</p>
<p><strong>2. Recap: boosting</strong></p>
<p>In boosting, weak learners like decision trees with only one split are used, which perform only slightly better than a random chance. Boosting focuses on sequentially adding up these weak learners and filtering out the observations that a learner gets correct at every step. Basically, the stress is on developing new weak learners to handle the remaining difficult observations at each step.One of the very first boosting algorithms developed was Adaboost. Gradient boosting improved upon some of the features of Adaboost to create a stronger and more efficient algorithm.</p>
<p><strong>3. Comparison</strong></p>
<p>Adaboost uses decision stumps as weak learners. Decision stumps are nothing but decision trees with only one single split. It also attaches weights to observations, adding more weight to ‘difficult-to-classify’ observations and less weight to those that are easy to classify.Gradient boosting uses short, less-complex decision trees instead of decision stumps.Instead of weighing the observations, it uses an error function called a loss function to measure how far off it is.Since the loss function optimization is done using gradient descent, the method is called “gradient boosting”.</p>
<p><strong>4. Pros &amp; cons of boosting</strong></p>
<p>One of the reasons that boosting is so popular is that if tuned properly, the performance is often better than any other algorithm in your toolbox.An optimized boosted model can outperform even the state of the art in deep learning on many datasets. Boosting is a good option for unbalanced datasets. In applications like forgery or fraud detection, the classes will be almost certainly imbalanced, where the number of authentic transactions will be huge when compared with unauthentic transactions.One problem that we may encounter in gradient boosting decision trees but not random forests is overfitting due to the addition of too many trees. In random forests, the addition of too many trees won’t cause overfitting. The accuracy of the model doesn’t improve after a certain point, but no problem of overfitting is faced.Depending on how you adjust the learning rate hyperparameter, the learning in boosted ensembles can be slow, especially since it’s an iterative and not a parallel algorithm.Additionally, there are a few more tuning hyperparameters than in the other models that you already know.</p>
<p><strong>5. Hyperparameters for gradient boosting</strong></p>
<p>Talking about hyperparameters, let’s discuss the hyperparameters boosted trees have. There are some that you already know from previous models, and some that we need to introduce.min_n is the minimum number of data points in a node that is required for the node to be split further. Single decision trees have the same parameter.tree_depth is the maximum depth of the tree, the number of splits. Again, you already know this from simple decision trees.sample_size is the amount of data exposed to the fitting routine. This is similar to bagged trees or random forests.trees is the number of trees contained in the ensemble. This is similar to random forests or bagged trees.</p>
<p><strong>6. Hyperparameters for gradient boosting</strong></p>
<p>mtry is the number of predictors that will be randomly sampled at each split when creating the tree models. You already know this from random forests.learn_rate is the rate at which the boosting algorithm adapts from iteration to iteration.loss_reduction is the reduction in the loss function required to split further.And finally, stop_iter, the number of iterations without improvement before the algorithm stops.</p>
<p><strong>7. Let’s practice!</strong></p>
<p>Fine. It’s your turn now to train a boosted model using the credit card customers dataset.</p>
</section>
<section id="train-a-boosted-ensemble" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="train-a-boosted-ensemble"><span class="header-section-number">4.6</span> Train a boosted ensemble</h2>
<p>Boosted ensemble models are among the most powerful machine learning methods that exist today. After you learned about the theoretical foundations, it’s time to put these into practice. You will create a boosted model ensemble using the credit card customers training data.</p>
<p>Pre-loaded in your workspace are the training data <code>customers_train</code> and the boosted tree specification that you created previously, <code>boost_spec</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Train a boosted classification model on the <code>customers_train</code> tibble using <code>still_customer</code> as the response variable and all other columns as the predictor variables.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># Train the model on the training set</span></span>
<span id="cb101-2"><a href="#cb101-2"></a>boost_model <span class="ot">&lt;-</span> <span class="fu">fit</span>(boost_spec,</span>
<span id="cb101-3"><a href="#cb101-3"></a>                   <span class="at">formula =</span> still_customer <span class="sc">~</span> ., </span>
<span id="cb101-4"><a href="#cb101-4"></a>                   <span class="at">data =</span> customers_train)</span>
<span id="cb101-5"><a href="#cb101-5"></a></span>
<span id="cb101-6"><a href="#cb101-6"></a>boost_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; ##### xgb.Booster
#&gt; raw: 55.4 Kb 
#&gt; call:
#&gt;   xgboost::xgb.train(params = list(eta = 0.3, max_depth = 6, gamma = 0, 
#&gt;     colsample_bytree = 1, colsample_bynode = 1, min_child_weight = 1, 
#&gt;     subsample = 1), data = x$data, nrounds = 15, watchlist = x$watchlist, 
#&gt;     verbose = 0, nthread = 1, objective = "binary:logistic")
#&gt; params (as set within xgb.train):
#&gt;   eta = "0.3", max_depth = "6", gamma = "0", colsample_bytree = "1", colsample_bynode = "1", min_child_weight = "1", subsample = "1", nthread = "1", objective = "binary:logistic", validate_parameters = "TRUE"
#&gt; xgb.attributes:
#&gt;   niter
#&gt; callbacks:
#&gt;   cb.evaluation.log()
#&gt; # of features: 37 
#&gt; niter: 15
#&gt; nfeatures : 37 
#&gt; evaluation_log:
#&gt;     iter training_logloss
#&gt;        1       0.47806782
#&gt;        2       0.35573192
#&gt; ---                      
#&gt;       14       0.06428223
#&gt;       15       0.05826139</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h2 id="question-6" data-number="4.7" class="anchored"><span class="header-section-number">4.7</span> <em>Question</em></h2>
<p>Which of these is <strong>not</strong> a hyperparameter that you can specify in <code>boost_tree()</code>?<br> <br> ⬜ <code>loss_reduction</code><br> ⬜ <code>stop_iter</code><br> ✅ <code>ensemble_size</code><br></p>
</blockquote>
<p>Correct, this one does not exist. Instead, the ensemble size is set using the parameter <code>trees</code>.</p>
</section>
<section id="evaluate-the-ensemble" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="evaluate-the-ensemble"><span class="header-section-number">4.8</span> Evaluate the ensemble</h2>
<p>So far, so good. But how good exactly? Prove your model evaluation skills by cross-validating your out-of-sample AUC!</p>
<p>The specification <code>boost_spec</code> and the <code>customers_train</code> tibble are still loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create five CV folds of your training set and save them as <code>folds</code>.</li>
<li>Fit and evaluate a model that predicts <code>still_customer</code> for every fold, using your specification, all predictor variables, and the AUC metric.</li>
<li>Collect the metrics of <code>cv_results</code> and check the mean AUC.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="fu">set.seed</span>(<span class="dv">99</span>)</span>
<span id="cb103-2"><a href="#cb103-2"></a></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="co"># Create CV folds</span></span>
<span id="cb103-4"><a href="#cb103-4"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(customers_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb103-5"><a href="#cb103-5"></a></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="co"># Fit and evaluate models for all folds</span></span>
<span id="cb103-7"><a href="#cb103-7"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(boost_spec,</span>
<span id="cb103-8"><a href="#cb103-8"></a>                            still_customer <span class="sc">~</span> ., </span>
<span id="cb103-9"><a href="#cb103-9"></a>                            <span class="at">resamples =</span> folds,</span>
<span id="cb103-10"><a href="#cb103-10"></a>                            <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc))</span>
<span id="cb103-11"><a href="#cb103-11"></a></span>
<span id="cb103-12"><a href="#cb103-12"></a><span class="co"># Collect cross-validated metrics</span></span>
<span id="cb103-13"><a href="#cb103-13"></a><span class="fu">collect_metrics</span>(cv_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.9875492","4":"5","5":"0.001969284","6":"Preprocessor1_Model1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Very well done! A cross-validated out-of-sample AUC of over 95% is very promising, given the model is not tuned yet.</p>
</section>
<section id="compare-to-a-single-classifier" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="compare-to-a-single-classifier"><span class="header-section-number">4.9</span> Compare to a single classifier</h2>
<p>You learned that boosted trees are among the best machine learning algorithms available. To underpin that, you will now compare the AUC of a boosted model to a simple decision tree classifier.</p>
<p>In this exercise, you will use the whole machine-learning pipeline from specification to evaluation.</p>
<p>The training data <code>customers_train</code> is still pre-loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Specify, fit, and predict probabilities of a boosted model on the training data using the given formula and add the results to the data.</li>
<li>Calculate the in-sample AUC of your predictions.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb104-2"><a href="#cb104-2"></a></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="co"># Specify, fit, predict, and combine with training data</span></span>
<span id="cb104-4"><a href="#cb104-4"></a>predictions <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb104-5"><a href="#cb104-5"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-6"><a href="#cb104-6"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-7"><a href="#cb104-7"></a>  <span class="fu">fit</span>(still_customer <span class="sc">~</span> ., <span class="at">data =</span> customers_train) <span class="sc">%&gt;%</span></span>
<span id="cb104-8"><a href="#cb104-8"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> customers_train, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-9"><a href="#cb104-9"></a>  <span class="fu">bind_cols</span>(customers_train)</span>
<span id="cb104-10"><a href="#cb104-10"></a></span>
<span id="cb104-11"><a href="#cb104-11"></a><span class="co"># Calculate AUC</span></span>
<span id="cb104-12"><a href="#cb104-12"></a><span class="fu">roc_auc</span>(predictions, </span>
<span id="cb104-13"><a href="#cb104-13"></a>        <span class="at">truth =</span> still_customer, </span>
<span id="cb104-14"><a href="#cb104-14"></a>        <span class="at">estimate =</span> .pred_yes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.001503011"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Change your code so that the same is done using a simple decision tree classifier.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb105-2"><a href="#cb105-2"></a></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="co"># Specify, fit, predict and combine with training data</span></span>
<span id="cb105-4"><a href="#cb105-4"></a>predictions <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb105-5"><a href="#cb105-5"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-6"><a href="#cb105-6"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-7"><a href="#cb105-7"></a>  <span class="fu">fit</span>(still_customer <span class="sc">~</span> ., <span class="at">data =</span> customers_train) <span class="sc">%&gt;%</span></span>
<span id="cb105-8"><a href="#cb105-8"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> customers_train, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-9"><a href="#cb105-9"></a>  <span class="fu">bind_cols</span>(customers_train)</span>
<span id="cb105-10"><a href="#cb105-10"></a></span>
<span id="cb105-11"><a href="#cb105-11"></a><span class="co"># Calculate AUC</span></span>
<span id="cb105-12"><a href="#cb105-12"></a><span class="fu">roc_auc</span>(predictions, </span>
<span id="cb105-13"><a href="#cb105-13"></a>        <span class="at">truth =</span> still_customer,</span>
<span id="cb105-14"><a href="#cb105-14"></a>        <span class="at">estimate =</span> .pred_yes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.07206587"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Good job! Boosting beats the decision tree with 99.8% versus 92.9% in-sample AUC.</p>
</section>
<section id="optimize-the-boosted-ensemble" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="optimize-the-boosted-ensemble"><span class="header-section-number">4.10</span> Optimize the boosted ensemble</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Optimize the boosted ensemble</strong></p>
<p>Welcome back! Now that you created and trained a boosted classifier using the built-in hyperparameters, it’s time to alter these hyperparameters to maximize the performance.Let’s tune the boosted ensemble!</p>
<p><strong>2. Starting point: untuned performance</strong></p>
<p>As a starting point, the out-of-the-box performance observed in the exercises was 95%. That’s already fantastic given just the standard hyperparameters were used.</p>
<p><strong>3. Tuning workflow</strong></p>
<p>This overview shows the steps you learned for tuning a specification.First, use tune() to flag hyperparameters for tuning in your specification.</p>
<p><strong>4. Tuning workflow</strong></p>
<p>Then, create a grid of hyperparameters with grid_regular() or others.</p>
<p><strong>5. Tuning workflow</strong></p>
<p>Then, use vfold_cv() to create cross-validation folds.</p>
<p><strong>6. Tuning workflow</strong></p>
<p>You pass all that into the tune_grid() function, and go for coffee or a jog.</p>
<p><strong>7. Tuning workflow</strong></p>
<p>After you come back, call select_best() to select the best results.</p>
<p><strong>8. Tuning workflow</strong></p>
<p>and finalize your model specification with the winners.</p>
<p><strong>9. Tuning workflow</strong></p>
<p>As a last step, you fit your final model using the optimal hyperparameters to the training data to get your optimized full model.</p>
<p><strong>10. Step 1: Create the tuning spec</strong></p>
<p>Let’s get to coding! As a first step, create the model specification.Let’s choose and fix 500 trees and optimize for learning rate, tree_depth, and sample_size.The console output reflects these decisions.</p>
<p><strong>11. Step 2: Create the tuning grid</strong></p>
<p>Then, we need a grid containing all hyperparameter combinations that we want to try.You already know grid_regular(), which creates an evenly-spaced grid of all the hyperparameters. It takes the tuning parameters, which we extract by applying the function parameters() to our dummy specification, and the levels, which is the number of levels each tuning parameter should get. Let’s specify two levels for each of our three tuning parameters.The result is a tibble with 8 rows, that is eight possible combinations of the three hyperparameters having two levels each.Another possibility is grid_random(), which creates a random, and not evenly spaced grid. The size parameter specifies the number of random combinations in the result. Size equals 8 gives us 8 random combinations of values.</p>
<p><strong>12. Step 3: The tuning</strong></p>
<p>Now for the actual tuning. The tune_grid() function takes the dummy specification, the model formula, the resamples, which are some cross-validation folds, a tuning grid, and a list of metrics.In our case, the dummy specification is boost_spec, the model formula is “still_customer is modeled as a function of all other parameters”, resamples is six folds of the training data customers_train, the tuning grid is tunegrid_boost, which we created in the previous slide, and metrics is a metric_set containing only the roc_auc metric.</p>
<p><strong>13. Visualize the result</strong></p>
<p>It’s always helpful and interesting to visualize the tuning results. The autoplot() function creates an overview of the tuning results. In our case, we see one plot per sample_size, tree_depth on the x axis, the AUC on the y axis, and different colors for different learning rates.The green line containing the smallest learning rate achieves only an area under curve of 50%, and there seems to be not much difference between a tree_depth of 8 or 12, both have an AUC value of 95 to close to 100%.</p>
<p><strong>14. Step 4: Finalize the model</strong></p>
<p>The optimal hyperparameter combination can be extracted using select_best(). This gives you a one-row tibble containing one column for every hyperparameter.We see that Model17 with a tree_depth of 8, a learn_rate of 0-point-1 and a sample_size of 55% yields the best results.Then, plug these into the specification containing the placeholders using finalize_model(). This finalizes your specification after tuning.</p>
<p><strong>15. Last step: Train the final model</strong></p>
<p>Finally, you train the final model on the whole training set customers_train. Printing the model reveals information like that it took 2-point-3 seconds to train and is 344 kilobytes in size.</p>
<p><strong>16. Your turn!</strong></p>
<p>Now it’s your turn to apply that to your boosted ensemble!</p>
</section>
<section id="tuning-preparation" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="tuning-preparation"><span class="header-section-number">4.11</span> Tuning preparation</h2>
<p>Tuning preparation is the foundation for tuning success. There are two main steps in preparing your tuning: marking hyperparameters using <code>tune()</code> in the model specification and creating a grid of hyperparameters that is used in tuning.</p>
<p>You are going to execute these two fundamental steps of the tuning process in this exercise.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create a boosting specification with an <code>"xgboost"</code> engine for a classification model using 500 trees and mark the following parameters as tuning parameters: <code>learn_rate</code>, <code>tree_depth</code>, and <code>sample_size</code>. Save the result as <code>boost_spec</code>.</li>
<li>Build a regular tuning grid for the tuning parameters of <code>boost_spec</code> with three levels for each parameter.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="co"># Create the specification with placeholders</span></span>
<span id="cb106-2"><a href="#cb106-2"></a>boost_spec <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(</span>
<span id="cb106-3"><a href="#cb106-3"></a>                <span class="at">trees =</span> <span class="dv">500</span>,</span>
<span id="cb106-4"><a href="#cb106-4"></a>                <span class="at">learn_rate =</span> <span class="fu">tune</span>(),</span>
<span id="cb106-5"><a href="#cb106-5"></a>                <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb106-6"><a href="#cb106-6"></a>                <span class="at">sample_size =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb106-7"><a href="#cb106-7"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-8"><a href="#cb106-8"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb106-9"><a href="#cb106-9"></a></span>
<span id="cb106-10"><a href="#cb106-10"></a><span class="co"># Create the tuning grid</span></span>
<span id="cb106-11"><a href="#cb106-11"></a>tunegrid_boost <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">parameters</span>(boost_spec), </span>
<span id="cb106-12"><a href="#cb106-12"></a>                               <span class="at">levels =</span> <span class="dv">3</span>)</span>
<span id="cb106-13"><a href="#cb106-13"></a></span>
<span id="cb106-14"><a href="#cb106-14"></a>tunegrid_boost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["tree_depth"],"name":[1],"type":["int"],"align":["right"]},{"label":["learn_rate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sample_size"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.00100000","3":"0.10"},{"1":"8","2":"0.00100000","3":"0.10"},{"1":"15","2":"0.00100000","3":"0.10"},{"1":"1","2":"0.01778279","3":"0.10"},{"1":"8","2":"0.01778279","3":"0.10"},{"1":"15","2":"0.01778279","3":"0.10"},{"1":"1","2":"0.31622777","3":"0.10"},{"1":"8","2":"0.31622777","3":"0.10"},{"1":"15","2":"0.31622777","3":"0.10"},{"1":"1","2":"0.00100000","3":"0.55"},{"1":"8","2":"0.00100000","3":"0.55"},{"1":"15","2":"0.00100000","3":"0.55"},{"1":"1","2":"0.01778279","3":"0.55"},{"1":"8","2":"0.01778279","3":"0.55"},{"1":"15","2":"0.01778279","3":"0.55"},{"1":"1","2":"0.31622777","3":"0.55"},{"1":"8","2":"0.31622777","3":"0.55"},{"1":"15","2":"0.31622777","3":"0.55"},{"1":"1","2":"0.00100000","3":"1.00"},{"1":"8","2":"0.00100000","3":"1.00"},{"1":"15","2":"0.00100000","3":"1.00"},{"1":"1","2":"0.01778279","3":"1.00"},{"1":"8","2":"0.01778279","3":"1.00"},{"1":"15","2":"0.01778279","3":"1.00"},{"1":"1","2":"0.31622777","3":"1.00"},{"1":"8","2":"0.31622777","3":"1.00"},{"1":"15","2":"0.31622777","3":"1.00"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Profound preparation! Let’s see which of these 27 hyperparameter combinations gives the best tuning result.</p>
</section>
<section id="the-actual-tuning" class="level2" data-number="4.12">
<h2 data-number="4.12" class="anchored" data-anchor-id="the-actual-tuning"><span class="header-section-number">4.12</span> The actual tuning</h2>
<p>The best hyperparameters make the best model for your data. Once you decided on a tuning grid, you need to train and evaluate models on every grid point to see which grid point gives the best model performance.</p>
<p>This can take some time, given that using k-fold cross-validation, an ensemble size of <code>n</code> trees, and a tuning grid of <code>t</code> combinations makes <code>k * n * t</code> models to be trained in total.</p>
<p>It’s your turn to perform the actual tuning! Pre-loaded are <code>customers_train</code> and the results of the last exercise, <code>boost_spec</code> and <code>tunegrid_boost</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="co"># A tibble: 27 x 3</span></span>
<span id="cb107-2"><a href="#cb107-2"></a>   tree_depth   learn_rate sample_size</span>
<span id="cb107-3"><a href="#cb107-3"></a>        <span class="sc">&lt;</span>int<span class="sc">&gt;</span>        <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb107-4"><a href="#cb107-4"></a> <span class="dv">1</span>          <span class="dv">1</span> <span class="fl">0.0000000001</span>        <span class="fl">0.1</span> </span>
<span id="cb107-5"><a href="#cb107-5"></a> <span class="dv">2</span>          <span class="dv">8</span> <span class="fl">0.0000000001</span>        <span class="fl">0.1</span> </span>
<span id="cb107-6"><a href="#cb107-6"></a> <span class="dv">3</span>         <span class="dv">15</span> <span class="fl">0.0000000001</span>        <span class="fl">0.1</span> </span>
<span id="cb107-7"><a href="#cb107-7"></a> <span class="dv">4</span>          <span class="dv">1</span> <span class="fl">0.00000316</span>          <span class="fl">0.1</span> </span>
<span id="cb107-8"><a href="#cb107-8"></a> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Create six folds of the training data using <code>vfold_cv()</code> and save them as <code>folds</code>.</li>
<li>Use <code>tune_grid()</code> to tune <code>boost_spec</code> using your folds, your tuning grid, and the <code>roc_auc</code> metric. Save the results as <code>tune_results</code>.</li>
<li>Plot the results to visualize the result of the tuning process.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="co"># Create CV folds of training data</span></span>
<span id="cb108-2"><a href="#cb108-2"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(customers_train, <span class="at">v =</span> <span class="dv">6</span>)</span>
<span id="cb108-3"><a href="#cb108-3"></a></span>
<span id="cb108-4"><a href="#cb108-4"></a><span class="co"># Tune along the grid</span></span>
<span id="cb108-5"><a href="#cb108-5"></a>tune_results <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(boost_spec,</span>
<span id="cb108-6"><a href="#cb108-6"></a>                          still_customer <span class="sc">~</span> .,</span>
<span id="cb108-7"><a href="#cb108-7"></a>                          <span class="at">resamples =</span> folds,</span>
<span id="cb108-8"><a href="#cb108-8"></a>                          <span class="at">grid =</span> tunegrid_boost,</span>
<span id="cb108-9"><a href="#cb108-9"></a>                          <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc))</span>
<span id="cb108-10"><a href="#cb108-10"></a></span>
<span id="cb108-11"><a href="#cb108-11"></a><span class="co"># Plot the results</span></span>
<span id="cb108-12"><a href="#cb108-12"></a><span class="fu">autoplot</span>(tune_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-58-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Totally terrific tuning result! Note the large AUC difference between the green and red <code>learn_rate</code> lines. A <code>tree_depth</code> of 8 or 12 doesn’t seem to make much difference regardless of the <code>learn_rate</code>.</p>
</section>
<section id="finalize-the-model" class="level2" data-number="4.13">
<h2 data-number="4.13" class="anchored" data-anchor-id="finalize-the-model"><span class="header-section-number">4.13</span> Finalize the model</h2>
<p>Once you have executed the tuning process and found the best-performing hyperparameters, there are only two last steps to finalize your model: plug the winners into the dummy model specification and re-train your model on the whole training set using this final specification.</p>
<p>This way, your final model will be trained on the whole training set using the optimal hyperparameters.</p>
<p>Pre-loaded in your workspace are <code>tune_results</code> from the last exercise, the untuned specification, <code>boost_spec</code>, and the training data, <code>customers_train</code>.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Select the best-performing hyperparameters of <code>tune_results</code> and save them as <code>best_params</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="co"># Select the final hyperparameters</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(tune_results)</span>
<span id="cb109-3"><a href="#cb109-3"></a></span>
<span id="cb109-4"><a href="#cb109-4"></a>best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["tree_depth"],"name":[1],"type":["int"],"align":["right"]},{"label":["learn_rate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sample_size"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".config"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"15","2":"0.01778279","3":"0.55","4":"Preprocessor1_Model15"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Create <code>final_spec</code> by plugging the best parameters into the untuned specification.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="co"># Finalize the specification</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>final_spec <span class="ot">&lt;-</span> <span class="fu">finalize_model</span>(boost_spec, best_params)</span>
<span id="cb110-3"><a href="#cb110-3"></a></span>
<span id="cb110-4"><a href="#cb110-4"></a>final_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Boosted Tree Model Specification (classification)
#&gt; 
#&gt; Main Arguments:
#&gt;   trees = 500
#&gt;   tree_depth = 15
#&gt;   learn_rate = 0.0177827941003892
#&gt;   sample_size = 0.55
#&gt; 
#&gt; Computational engine: xgboost</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Create <code>final_model</code>, the final model trained on the whole training set, using all predictor variables.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="co"># Train the final model on the full training data</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>final_model <span class="ot">&lt;-</span> final_spec <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">formula =</span> still_customer <span class="sc">~</span> ., </span>
<span id="cb112-3"><a href="#cb112-3"></a>                                  <span class="at">data =</span> customers_train)</span>
<span id="cb112-4"><a href="#cb112-4"></a></span>
<span id="cb112-5"><a href="#cb112-5"></a>final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; ##### xgb.Booster
#&gt; raw: 2.2 Mb 
#&gt; call:
#&gt;   xgboost::xgb.train(params = list(eta = 0.0177827941003892, max_depth = 15L, 
#&gt;     gamma = 0, colsample_bytree = 1, colsample_bynode = 1, min_child_weight = 1, 
#&gt;     subsample = 0.55), data = x$data, nrounds = 500, watchlist = x$watchlist, 
#&gt;     verbose = 0, nthread = 1, objective = "binary:logistic")
#&gt; params (as set within xgb.train):
#&gt;   eta = "0.0177827941003892", max_depth = "15", gamma = "0", colsample_bytree = "1", colsample_bynode = "1", min_child_weight = "1", subsample = "0.55", nthread = "1", objective = "binary:logistic", validate_parameters = "TRUE"
#&gt; xgb.attributes:
#&gt;   niter
#&gt; callbacks:
#&gt;   cb.evaluation.log()
#&gt; # of features: 37 
#&gt; niter: 500
#&gt; nfeatures : 37 
#&gt; evaluation_log:
#&gt;     iter training_logloss
#&gt;        1       0.67844145
#&gt;        2       0.66382334
#&gt; ---                      
#&gt;      499       0.01769510
#&gt;      500       0.01764986</code></pre>
</div>
</div>
<p>That’s the final fit! You plugged the best-performing hyperparameters into your dummy specification and obtained a tuned model from the whole training set! Note that in the training log in the console, you can clearly see how the error (<code>training_logloss</code>) declines across iterations.</p>
</section>
<section id="model-comparison" class="level2" data-number="4.14">
<h2 data-number="4.14" class="anchored" data-anchor-id="model-comparison"><span class="header-section-number">4.14</span> Model comparison</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Model comparison</strong></p>
<p>Congratulations! You came a long way and made great progress so far. The most important task after model research is comparing these models to choose one that is most useful for you.</p>
<p><strong>2. Motivation</strong></p>
<p>The remaining exercises will reveal exactly how to perform a model comparison across all models of this course: Decision Trees, Bagged Trees, Random Forest, and Gradient Boosting. We’ll use the test set predictions from each of the models to compute the out-of-sample AUC. The model with the highest AUC is considered to be the best performing model. Finally, we’ll visualize the ROC curves of all models and plot them all on the same graph. Let’s jump right into it!</p>
<p><strong>3. Combine predictions</strong></p>
<p>To simplify programming overhead, we are going to leverage the tidy tibble format of the predictions.Use the bind_cols() function to combine the predictions of the decision_tree, preds_tree,</p>
<p><strong>4. Combine predictions</strong></p>
<p>with the bagged tree predictions, preds_bagging,</p>
<p><strong>5. Combine predictions</strong></p>
<p>the random forest predictions, preds_forest,</p>
<p><strong>6. Combine predictions</strong></p>
<p>the boosted ensemble predictions, preds_boosting,</p>
<p><strong>7. Combine predictions</strong></p>
<p>and the column still_customer, which is extracted by selecting it from the test data.</p>
<p><strong>8. Calculate decision tree AUC</strong></p>
<p>This way, calculating the AUC is real easy: Just call the roc_auc function with the combined predictions tibble giving the truth column still_customer and the estimate column containing the predicted probabilities. For the decision tree, this would be the preds_tree column, and we see an AUC of 91-point-1 percent.</p>
<p><strong>9. Calculate bagged tree AUC</strong></p>
<p>for the bagged ensemble this would be the preds_bagging column, where we see an AUC of 93-point-6 percent.</p>
<p><strong>10. Calculate random forest AUC</strong></p>
<p>for the random forest the preds_forest column, where we see an AUC of 97-point-4 percent.</p>
<p><strong>11. Calculate boosted AUC</strong></p>
<p>and for the boosted ensemble the preds_boosting column, which states an AUC of 98-point-4 percent.</p>
<p><strong>12. Combine all AUCs</strong></p>
<p>If you combine these calls using the bind_rows() function, the AUCs are combined into one single tibble.</p>
<p><strong>13. Combine all AUCs</strong></p>
<p>To state which AUC belongs to which model, it’s advisable to name all the arguments in the bind_rows() call and provide the dot-id argument to create a result column that contains the model names.The result is a beautiful tibble giving all the AUCs in a tabular form. We see that the boosted tree beats all other models.Well, this can be done more tidy.</p>
<p><strong>14. Reformat the results</strong></p>
<p>Let’s tidy that up while creating the ROC curves. Right now, the model predictions are stored in one column per model. It would be cleaner if all predictions were in one single numeric column.The pivot_longer() function from the tidyr package can do that. First, provide the tibble to be reshaped, preds_combined.Then, in the cols argument, specify the columns to be transformed into rows, which is all columns that start with “preds_”. The argument names_to specifies the name of the new column that stores our identifiers and values_to is the name of the column where all the numeric values go.The result is a tibble with new columns model and predictions containing the same information as before, but in a different shape. We have 4044 rows now, exactly four times the number of rows as before, because we transformed four columns into one row each.</p>
<p><strong>15. Calculate cutoff values</strong></p>
<p>The rest is real easy. Group the predictions by model, so that one curve per model is calculated.Then, for every possible cutoff, calculate sensitivity and specificity using the roc_curve() function that takes the truth column “still_customer” and the estimate column “predictions”.</p>
<p><strong>16. Plot ROC curves</strong></p>
<p>As a last step, we call the autoplot() function on the result to see all the ROC curves on one single plot.See the order in which your models improved? Violet, the decision tree, performs worst, and green, the boosted tree, performs best.</p>
<p><strong>17. Let’s compare!</strong></p>
<p>Now it’s your turn to compare your models!</p>
</section>
<section id="compare-auc" class="level2" data-number="4.15">
<h2 data-number="4.15" class="anchored" data-anchor-id="compare-auc"><span class="header-section-number">4.15</span> Compare AUC</h2>
<p>Comparing different models is the core of model selection. In the final two exercises, you’ll perform a model comparison across all types of models in this course: decision trees, bagged trees, random forests, and gradient boosting.</p>
<p>The models were all tuned to perfection and trained on the same training set, <code>customers_train</code>, and predictions were made for the <code>customers_test</code> dataset. The results are numeric probabilities and are available as <code>preds_combined</code> in your session:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>tibble [<span class="dv">1</span>,<span class="dv">011</span> × <span class="dv">5</span>]</span>
<span id="cb114-2"><a href="#cb114-2"></a> <span class="sc">$</span> preds_tree    <span class="sc">:</span> <span class="fl">0.144</span> <span class="fl">0.441</span> ...</span>
<span id="cb114-3"><a href="#cb114-3"></a> <span class="sc">$</span> preds_bagging <span class="sc">:</span> <span class="fl">0.115</span> <span class="fl">0.326</span> ...</span>
<span id="cb114-4"><a href="#cb114-4"></a> <span class="sc">$</span> preds_forest  <span class="sc">:</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="fl">0.286</span> ...</span>
<span id="cb114-5"><a href="#cb114-5"></a> <span class="sc">$</span> preds_boosting<span class="sc">:</span> <span class="fl">0.136</span> <span class="fl">0.149</span> ...</span>
<span id="cb114-6"><a href="#cb114-6"></a> <span class="sc">$</span> still_customer<span class="sc">:</span> <span class="st">"no"</span>,<span class="st">"no"</span>, ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Calculate the AUC for each prediction column in <code>preds_combined</code>, always using <code>still_customer</code> as the truth column.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="co"># load data</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>preds_combined <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/preds_combined.rds"</span>)</span>
<span id="cb115-3"><a href="#cb115-3"></a></span>
<span id="cb115-4"><a href="#cb115-4"></a><span class="co"># Calculate the AUC for each model</span></span>
<span id="cb115-5"><a href="#cb115-5"></a>auc_tree   <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(preds_combined, <span class="at">truth =</span> still_customer, <span class="at">estimate =</span> preds_tree)</span>
<span id="cb115-6"><a href="#cb115-6"></a>auc_bagged <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(preds_combined, <span class="at">truth =</span> still_customer, <span class="at">estimate =</span> preds_bagging)</span>
<span id="cb115-7"><a href="#cb115-7"></a>auc_forest <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(preds_combined, <span class="at">truth =</span> still_customer, <span class="at">estimate =</span> preds_forest)</span>
<span id="cb115-8"><a href="#cb115-8"></a>auc_boost  <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(preds_combined, <span class="at">truth =</span> still_customer, <span class="at">estimate =</span> preds_boosting)</span>
<span id="cb115-9"><a href="#cb115-9"></a></span>
<span id="cb115-10"><a href="#cb115-10"></a><span class="co"># Print the results</span></span>
<span id="cb115-11"><a href="#cb115-11"></a>auc_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.08879364"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>auc_bagged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.05827117"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>auc_forest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.01976908"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a>auc_boost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.0134072"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Combine the results into one single tibble.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="co"># Combine AUCs into one tibble</span></span>
<span id="cb119-2"><a href="#cb119-2"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(auc_tree,</span>
<span id="cb119-3"><a href="#cb119-3"></a>                      auc_bagged,</span>
<span id="cb119-4"><a href="#cb119-4"></a>                      auc_forest,</span>
<span id="cb119-5"><a href="#cb119-5"></a>                      auc_boost)</span>
<span id="cb119-6"><a href="#cb119-6"></a></span>
<span id="cb119-7"><a href="#cb119-7"></a>combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"roc_auc","2":"binary","3":"0.08879364"},{"1":"roc_auc","2":"binary","3":"0.05827117"},{"1":"roc_auc","2":"binary","3":"0.01976908"},{"1":"roc_auc","2":"binary","3":"0.01340720"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Change the code so that the arguments to <code>bind_rows()</code> are named <code>decision_tree</code>, <code>bagged_tree</code>, <code>random_forest</code>, and <code>boosted_tree</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># Combine AUCs into one tibble</span></span>
<span id="cb120-2"><a href="#cb120-2"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="at">decision_tree =</span> auc_tree,</span>
<span id="cb120-3"><a href="#cb120-3"></a>                      <span class="at">bagged_tree   =</span> auc_bagged,</span>
<span id="cb120-4"><a href="#cb120-4"></a>                      <span class="at">random_forest =</span> auc_forest,</span>
<span id="cb120-5"><a href="#cb120-5"></a>                      <span class="at">boosted_tree  =</span> auc_boost,</span>
<span id="cb120-6"><a href="#cb120-6"></a>                      <span class="at">.id =</span> <span class="st">"model"</span>)</span>
<span id="cb120-7"><a href="#cb120-7"></a></span>
<span id="cb120-8"><a href="#cb120-8"></a>combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".metric"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[3],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"decision_tree","2":"roc_auc","3":"binary","4":"0.08879364"},{"1":"bagged_tree","2":"roc_auc","3":"binary","4":"0.05827117"},{"1":"random_forest","2":"roc_auc","3":"binary","4":"0.01976908"},{"1":"boosted_tree","2":"roc_auc","3":"binary","4":"0.01340720"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Cool combination! You calculated and combined the AUC of all models. Note how there is a clear distinction between each of them, with the boosted ensemble having the highest AUC. However, four repeated calls to <code>roc_auc()</code> is cumbersome. In the next exercise, you’ll learn how to cut this down to just a few lines…</p>
</section>
<section id="plot-roc-curves" class="level2" data-number="4.16">
<h2 data-number="4.16" class="anchored" data-anchor-id="plot-roc-curves"><span class="header-section-number">4.16</span> Plot ROC curves</h2>
<p>You saw again that the boosted tree yields the highest AUC. Numbers are fine, but pictures are better! Why not visualize these results?</p>
<p>You are going to illustrate model performance by plotting all ROC curves on one common plot. As the AUC is literally the area under these ROC curves, the boosted model should have the largest area under its ROC curve and be the one in the upper left corner of the plot.</p>
<p>The predictions tibble, <code>preds_combined</code>, is still loaded.</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li>Reshape the <code>preds_combined</code> tibble so that all columns that start with <code>"preds_"</code> are rows instead of columns. Convert the names to a <code>"model"</code> column and the values to a column called <code>"predictions"</code>.</li>
<li>Group the results by <code>model</code>.</li>
<li>Calculate the ROC values for all cutoffs.</li>
<li>Produce a graphical plot of the curves.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="co"># Reshape the predictions into long format</span></span>
<span id="cb121-2"><a href="#cb121-2"></a>predictions_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(preds_combined,</span>
<span id="cb121-3"><a href="#cb121-3"></a>                                        <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"preds_"</span>),</span>
<span id="cb121-4"><a href="#cb121-4"></a>                                        <span class="at">names_to =</span> <span class="st">"model"</span>,</span>
<span id="cb121-5"><a href="#cb121-5"></a>                                        <span class="at">values_to =</span> <span class="st">"predictions"</span>)</span>
<span id="cb121-6"><a href="#cb121-6"></a></span>
<span id="cb121-7"><a href="#cb121-7"></a>predictions_long <span class="sc">%&gt;%</span></span>
<span id="cb121-8"><a href="#cb121-8"></a>  <span class="co"># Group by model</span></span>
<span id="cb121-9"><a href="#cb121-9"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb121-10"><a href="#cb121-10"></a>  <span class="co"># Calculate values for every cutoff</span></span>
<span id="cb121-11"><a href="#cb121-11"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> still_customer,</span>
<span id="cb121-12"><a href="#cb121-12"></a>            <span class="at">estimate =</span> predictions) <span class="sc">%&gt;%</span></span>
<span id="cb121-13"><a href="#cb121-13"></a>  <span class="co"># Create a plot from the calculated data</span></span>
<span id="cb121-14"><a href="#cb121-14"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-66-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="08_machine_learning_with_tree-based_models_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Fantastic plot! The ROC curves resemble the AUC differences, and you can clearly see the performance differences, with XGBoost and random forest being the winners. One last tip: The previous AUC exercise can easily be solved with this technique - just replace <code>roc_curve()</code> with <code>roc_auc()</code> and remove <code>autoplot()</code>! Save that code snippet - it might be useful in your own modeling career!<br><br>Congratulations, you almost finished the course and are now able to use tree-based models in R! Did you like the course? <a href="http://twitter.com/intent/tweet?text=I%20just%20finished%20Machine%20Learning%20with%20Tree-Based%20Models%20in%20R%20on%20@DataCamp:&amp;url=https%3A%2Fdatacamp.com/courses/machine-learning-with-tree-based-models-in-r">Let us know!</a></p>
</section>
<section id="wrap-up" class="level2" data-number="4.17">
<h2 data-number="4.17" class="anchored" data-anchor-id="wrap-up"><span class="header-section-number">4.17</span> Wrap-up</h2>
<p>Theory. Coming soon …</p>
<p><strong>1. Wrap-up</strong></p>
<p>Congratulations on all that you have accomplished. By taking this course, you mastered many foundations of machine learning in general and tree-based models in particular.</p>
<p><strong>2. 1. Data splitting - confusion matrix - accuracy</strong></p>
<p>In Chapter 1, you learned about basic techniques of machine learning like data splitting and how to use tidymodels to build and evaluate basic classification trees using the confusion matrix and the accuracy metric.</p>
<p><strong>3. 2. Regression - cross-validation - bias-variance tradeoff</strong></p>
<p>In Chapter 2, you extended this knowledge to build and evaluate regression trees, apply cross-validation for more robust evaluation, and how to detect and solve bias or variance issues.</p>
<p><strong>4. 3. Tuning - AUC - bagging - random forest</strong></p>
<p>In Chapter 3, you learned how to use the tidymodels framework to tune hyperparameters of tree models, and extended your knowledge of classification evaluation to sensitivity, specificity, ROC curves and area under the curve. You also learned how to build bagged tree models and random forests.</p>
<p><strong>5. 4. Boosting &amp; model comparison</strong></p>
<p>In Chapter 4, you learned about boosting, how to build an optimal gradient boosting ensemble model, and how to compare different models to see which one performs best.</p>
<p><strong>6. Thank you!</strong></p>
<p>I hope that you’ve enjoyed this course and found it helpful. Thanks again for taking the course and congratulations on all that you have accomplished. I wish you the best of luck on your journey of learning.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../../../content/R/topics/07_machine_learning/07_modeling_with_tidymodels/07_modeling_with_tidymodels.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">7.7: Modeling with tidymodels</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../../../content/R/topics/07_machine_learning/09_support_vector_machines/09_support_vector_machines.html" class="pagination-link">
        <span class="nav-page-text">7.9: Support Vector Machines</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2022 by <a href="https://www.startupengineer.io/authors/schwarz/">Joschka Schwarz</a> <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/jwarz/jwarz.github.io">View the source at GitHub</a></div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","closeEffect":"zoom","loop":true,"selector":".lightbox","descPosition":"bottom"});</script>



<script src="../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>